.class public Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
.super Lcom/samsung/android/knox/net/vpn/IKnoxVpnPolicy$Stub;
.source "KnoxVpnEngineService.java"

# interfaces
.implements Lcom/android/server/enterprise/EnterpriseServiceCallback;


# annotations
.annotation system Ldalvik/annotation/MemberClasses;
    value = {
        Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$ChainingStateMachine;,
        Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;,
        Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;,
        Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;,
        Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;
    }
.end annotation


# static fields
.field private static final ADD_CAPTIVE_EXEMPTS_RULES:I = 0x1

.field private static final BUILD_FINGERPRINT:Ljava/lang/String; = "ro.build.date"

.field private static final CONTAINER_ID:Ljava/lang/String; = "containerid"

.field private static final DBG:Z

.field private static final INVALID_CONTAINER_ID:I = 0x0

.field private static final INVALID_UID:I = -0x1

.field private static final KNOXVPN_SAVED_BUILD_FINGERPRINT:Ljava/lang/String; = "persist.sys.knoxvpn.date"

.field private static final MAP_BUNDLE_INTERFACE_NAME:Ljava/lang/String; = "bundle_interface_name"

.field private static final MAP_BUNDLE_INTERFACE_TYPE:Ljava/lang/String; = "bundle_interface_type"

.field private static final MAP_BUNDLE_PROFILE_NAME:Ljava/lang/String; = "bundle_profile_name"

.field private static final MAP_BUNDLE_USB_STATUS:Ljava/lang/String; = "bundle_usb_status"

.field private static final MAP_BUNDLE_V4_ADDRESS:Ljava/lang/String; = "bundle_v4_address"

.field private static final MAP_BUNDLE_V6_ADDRESS:Ljava/lang/String; = "bundle_v6_address"

.field private static final MAP_KEY_CAPTIVE:Ljava/lang/String; = "captive"

.field private static final MAP_KEY_EXTRA_REPLACING:Ljava/lang/String; = "new_install_or_update"

.field private static final MAP_KEY_PACKAGENAME:Ljava/lang/String; = "package"

.field private static final MAP_KEY_PAC_OPERATION:Ljava/lang/String; = "pac_operation"

.field private static final MAP_KEY_PROFILENAME:Ljava/lang/String; = "profileName"

.field private static final MAP_KEY_STATE:Ljava/lang/String; = "state"

.field private static final MAP_KEY_STATUS:Ljava/lang/String; = "status"

.field private static final MAP_KEY_UID:Ljava/lang/String; = "uid"

.field private static final MAP_KEY_VALUESTRING:Ljava/lang/String; = "value_string"

.field private static final NULL_OBJECT:Ljava/lang/Object;

.field private static final REMOVE_CAPTIVE_EXEMPTS_RULES:I = 0x0

.field private static final TAG:Ljava/lang/String; = "KnoxVpnEngineService"

.field private static final TETHER_AUTH_TAG:Ljava/lang/String; = "KnoxVpnTetherAuthentication"

.field protected static final VPN_RETURN_INT_ERROR:I = -0x1

.field protected static final VPN_RETURN_INT_SUCCESS:I


# instance fields
.field private isDeviceBootCompleted:Z

.field private mAMS:Lcom/android/server/am/ActivityManagerService;

.field private mChainingStateMachine:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$ChainingStateMachine;

.field private mConnectivityManagerService:Landroid/net/IConnectivityManager;

.field private mContext:Landroid/content/Context;

.field private mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

.field private mEDM:Lcom/samsung/android/knox/EnterpriseDeviceManager;

.field private mEnterpriseDeviceManagerService:Lcom/samsung/android/knox/IEnterpriseDeviceManager;

.field private mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

.field private mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

.field private mHandlerThread:Landroid/os/HandlerThread;

.field private mIgnoreConnectCheckForChaining:Ljava/util/concurrent/ConcurrentHashMap;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "Ljava/util/concurrent/ConcurrentHashMap<",
            "Ljava/lang/Integer;",
            "Ljava/lang/Boolean;",
            ">;"
        }
    .end annotation
.end field

.field private mInjector:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;

.field private mKeyStore:Landroid/security/KeyStore;

.field private mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

.field private mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

.field private mKnoxVpnPacProcessor:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

.field private mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

.field private mNetworkManagementService:Landroid/os/INetworkManagementService;

.field private mNetworkPolicyManager:Landroid/net/NetworkPolicyManager;

.field private mNotificationManager:Landroid/app/NotificationManager;

.field private mNotificationMap:Ljava/util/concurrent/ConcurrentHashMap;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "Ljava/util/concurrent/ConcurrentHashMap<",
            "Ljava/lang/String;",
            "Ljava/util/ArrayList<",
            "Ljava/lang/String;",
            ">;>;"
        }
    .end annotation
.end field

.field private mPersonaManager:Lcom/samsung/android/knox/SemPersonaManager;

.field private mPowerManager:Landroid/os/PowerManager;

.field private mProcessManager:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;

.field private mUsbManager:Landroid/hardware/usb/UsbManager;

.field private mVpnClientStatus:Ljava/util/List;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "Ljava/util/List<",
            "Ljava/lang/String;",
            ">;"
        }
    .end annotation
.end field

.field private mVpnConnectionList:Ljava/util/HashMap;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "Ljava/util/HashMap<",
            "Ljava/lang/String;",
            "Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;",
            ">;"
        }
    .end annotation
.end field

.field private mVpnInfoPolicy:Lcom/samsung/android/knox/net/vpn/IVpnInfoPolicy;

.field private mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

.field private receiver:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;

.field private vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

.field private vpnInterfaceMap:Ljava/util/concurrent/ConcurrentHashMap;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "Ljava/util/concurrent/ConcurrentHashMap<",
            "Ljava/lang/String;",
            "Ljava/lang/Object;",
            ">;"
        }
    .end annotation
.end field


# direct methods
.method static constructor <clinit>()V
    .registers 1

    .line 174
    invoke-static {}, Landroid/os/Debug;->semIsProductDev()Z

    move-result v0

    sput-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    .line 7584
    new-instance v0, Ljava/lang/Object;

    invoke-direct {v0}, Ljava/lang/Object;-><init>()V

    sput-object v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->NULL_OBJECT:Ljava/lang/Object;

    return-void
.end method

.method public constructor <init>()V
    .registers 3

    .line 277
    invoke-direct {p0}, Lcom/samsung/android/knox/net/vpn/IKnoxVpnPolicy$Stub;-><init>()V

    .line 190
    const/4 v0, 0x0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    .line 202
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandlerThread:Landroid/os/HandlerThread;

    .line 204
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    .line 206
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNetworkManagementService:Landroid/os/INetworkManagementService;

    .line 208
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mConnectivityManagerService:Landroid/net/IConnectivityManager;

    .line 210
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mEnterpriseDeviceManagerService:Lcom/samsung/android/knox/IEnterpriseDeviceManager;

    .line 212
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationMap:Ljava/util/concurrent/ConcurrentHashMap;

    .line 214
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    .line 216
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnPacProcessor:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    .line 218
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mProcessManager:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;

    .line 220
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mChainingStateMachine:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$ChainingStateMachine;

    .line 222
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKeyStore:Landroid/security/KeyStore;

    .line 224
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mAMS:Lcom/android/server/am/ActivityManagerService;

    .line 226
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationManager:Landroid/app/NotificationManager;

    .line 228
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mPowerManager:Landroid/os/PowerManager;

    .line 230
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNetworkPolicyManager:Landroid/net/NetworkPolicyManager;

    .line 232
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mPersonaManager:Lcom/samsung/android/knox/SemPersonaManager;

    .line 234
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mEDM:Lcom/samsung/android/knox/EnterpriseDeviceManager;

    .line 238
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->receiver:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;

    .line 241
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mIgnoreConnectCheckForChaining:Ljava/util/concurrent/ConcurrentHashMap;

    .line 243
    new-instance v1, Ljava/util/HashMap;

    invoke-direct {v1}, Ljava/util/HashMap;-><init>()V

    iput-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnConnectionList:Ljava/util/HashMap;

    .line 245
    new-instance v1, Ljava/util/ArrayList;

    invoke-direct {v1}, Ljava/util/ArrayList;-><init>()V

    iput-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnClientStatus:Ljava/util/List;

    .line 247
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 249
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mUsbManager:Landroid/hardware/usb/UsbManager;

    .line 251
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mInjector:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;

    .line 253
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    .line 257
    const/4 v0, 0x0

    iput-boolean v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->isDeviceBootCompleted:Z

    .line 279
    return-void
.end method

.method public constructor <init>(Landroid/content/Context;)V
    .registers 3
    .param p1, "context"    # Landroid/content/Context;

    .line 282
    new-instance v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;

    invoke-direct {v0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;-><init>(Landroid/content/Context;)V

    invoke-direct {p0, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;-><init>(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;)V

    .line 283
    return-void
.end method

.method public constructor <init>(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;)V
    .registers 4
    .param p1, "injector"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;

    .line 285
    invoke-direct {p0}, Lcom/samsung/android/knox/net/vpn/IKnoxVpnPolicy$Stub;-><init>()V

    .line 190
    const/4 v0, 0x0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    .line 202
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandlerThread:Landroid/os/HandlerThread;

    .line 204
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    .line 206
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNetworkManagementService:Landroid/os/INetworkManagementService;

    .line 208
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mConnectivityManagerService:Landroid/net/IConnectivityManager;

    .line 210
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mEnterpriseDeviceManagerService:Lcom/samsung/android/knox/IEnterpriseDeviceManager;

    .line 212
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationMap:Ljava/util/concurrent/ConcurrentHashMap;

    .line 214
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    .line 216
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnPacProcessor:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    .line 218
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mProcessManager:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;

    .line 220
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mChainingStateMachine:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$ChainingStateMachine;

    .line 222
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKeyStore:Landroid/security/KeyStore;

    .line 224
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mAMS:Lcom/android/server/am/ActivityManagerService;

    .line 226
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationManager:Landroid/app/NotificationManager;

    .line 228
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mPowerManager:Landroid/os/PowerManager;

    .line 230
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNetworkPolicyManager:Landroid/net/NetworkPolicyManager;

    .line 232
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mPersonaManager:Lcom/samsung/android/knox/SemPersonaManager;

    .line 234
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mEDM:Lcom/samsung/android/knox/EnterpriseDeviceManager;

    .line 238
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->receiver:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;

    .line 241
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mIgnoreConnectCheckForChaining:Ljava/util/concurrent/ConcurrentHashMap;

    .line 243
    new-instance v1, Ljava/util/HashMap;

    invoke-direct {v1}, Ljava/util/HashMap;-><init>()V

    iput-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnConnectionList:Ljava/util/HashMap;

    .line 245
    new-instance v1, Ljava/util/ArrayList;

    invoke-direct {v1}, Ljava/util/ArrayList;-><init>()V

    iput-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnClientStatus:Ljava/util/List;

    .line 247
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 249
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mUsbManager:Landroid/hardware/usb/UsbManager;

    .line 251
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mInjector:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;

    .line 253
    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    .line 257
    const/4 v0, 0x0

    iput-boolean v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->isDeviceBootCompleted:Z

    .line 286
    const-string v0, "KnoxVpnEngineService"

    const-string v1, "Initializing in constructor"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 287
    iput-object p1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mInjector:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;

    .line 288
    iget-object v0, p1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;->mContext:Landroid/content/Context;

    invoke-static {v0}, Ljava/util/Objects;->requireNonNull(Ljava/lang/Object;)Ljava/lang/Object;

    check-cast v0, Landroid/content/Context;

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    .line 290
    new-instance v0, Ljava/util/concurrent/ConcurrentHashMap;

    invoke-direct {v0}, Ljava/util/concurrent/ConcurrentHashMap;-><init>()V

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnInterfaceMap:Ljava/util/concurrent/ConcurrentHashMap;

    .line 291
    new-instance v0, Ljava/util/concurrent/ConcurrentHashMap;

    invoke-direct {v0}, Ljava/util/concurrent/ConcurrentHashMap;-><init>()V

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationMap:Ljava/util/concurrent/ConcurrentHashMap;

    .line 292
    new-instance v0, Ljava/util/concurrent/ConcurrentHashMap;

    invoke-direct {v0}, Ljava/util/concurrent/ConcurrentHashMap;-><init>()V

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mIgnoreConnectCheckForChaining:Ljava/util/concurrent/ConcurrentHashMap;

    .line 295
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-static {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getInstance(Landroid/content/Context;)Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    .line 296
    invoke-static {}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getInstance()Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    move-result-object v0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    .line 297
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mInjector:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;->getKnoxVpnStorageProviderInstance()Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    move-result-object v0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    .line 298
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mInjector:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;->getKnoxVpnApiValidationInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    move-result-object v0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    .line 299
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mInjector:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$Injector;->getKnoxVpnPacProcessorInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnPacProcessor:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    .line 300
    invoke-static {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;->getInstance(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;)Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;

    move-result-object v0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mProcessManager:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;

    .line 301
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-static {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->getInstance(Landroid/content/Context;)Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    move-result-object v0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    .line 303
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->initializeHandlerThread()V

    .line 306
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleKnoxVpnBuildUpdate()V

    .line 309
    invoke-virtual {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->initializeVpnDataAndVendors()V

    .line 311
    invoke-static {}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnVersion;->writeVersionInProperties()V

    .line 312
    return-void
.end method

.method private _getSharedUidPackges(Ljava/lang/String;ILandroid/content/pm/IPackageManager;Ljava/util/List;)Ljava/util/Set;
    .registers 12
    .param p1, "packageName"    # Ljava/lang/String;
    .param p2, "containerId"    # I
    .param p3, "pm"    # Landroid/content/pm/IPackageManager;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Ljava/lang/String;",
            "I",
            "Landroid/content/pm/IPackageManager;",
            "Ljava/util/List<",
            "Landroid/content/pm/PackageInfo;",
            ">;)",
            "Ljava/util/Set<",
            "Ljava/lang/String;",
            ">;"
        }
    .end annotation

    .line 2499
    .local p4, "installedPackages":Ljava/util/List;, "Ljava/util/List<Landroid/content/pm/PackageInfo;>;"
    const/4 v0, 0x0

    if-eqz p1, :cond_44

    .line 2500
    new-instance v1, Ljava/util/HashSet;

    invoke-direct {v1}, Ljava/util/HashSet;-><init>()V

    .line 2501
    .local v1, "packageNameSet":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    invoke-interface {v1, p1}, Ljava/util/Set;->add(Ljava/lang/Object;)Z

    .line 2503
    const/4 v2, 0x0

    :try_start_c
    invoke-interface {p3, p1, v2, p2}, Landroid/content/pm/IPackageManager;->getApplicationInfo(Ljava/lang/String;II)Landroid/content/pm/ApplicationInfo;

    move-result-object v2

    .line 2504
    .local v2, "appInfo":Landroid/content/pm/ApplicationInfo;
    if-nez v2, :cond_13

    .line 2505
    return-object v1

    .line 2507
    :cond_13
    invoke-interface {p4}, Ljava/util/List;->iterator()Ljava/util/Iterator;

    move-result-object v3

    :goto_17
    invoke-interface {v3}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_39

    invoke-interface {v3}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Landroid/content/pm/PackageInfo;

    .line 2508
    .local v4, "pkgInfo":Landroid/content/pm/PackageInfo;
    iget-object v5, v4, Landroid/content/pm/PackageInfo;->applicationInfo:Landroid/content/pm/ApplicationInfo;

    iget v5, v5, Landroid/content/pm/ApplicationInfo;->uid:I

    iget v6, v2, Landroid/content/pm/ApplicationInfo;->uid:I

    if-ne v5, v6, :cond_38

    iget-object v5, v4, Landroid/content/pm/PackageInfo;->packageName:Ljava/lang/String;

    invoke-virtual {v5, p1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v5

    if-nez v5, :cond_38

    .line 2509
    iget-object v5, v4, Landroid/content/pm/PackageInfo;->packageName:Ljava/lang/String;

    invoke-interface {v1, v5}, Ljava/util/Set;->add(Ljava/lang/Object;)Z
    :try_end_38
    .catch Ljava/lang/Exception; {:try_start_c .. :try_end_38} :catch_3b

    .line 2511
    .end local v4    # "pkgInfo":Landroid/content/pm/PackageInfo;
    :cond_38
    goto :goto_17

    .line 2515
    .end local v2    # "appInfo":Landroid/content/pm/ApplicationInfo;
    :cond_39
    nop

    .line 2516
    return-object v1

    .line 2512
    :catch_3b
    move-exception v2

    .line 2513
    .local v2, "e":Ljava/lang/Exception;
    const-string v3, "KnoxVpnEngineService"

    const-string v4, "_getSharedUidPackges: Exception"

    invoke-static {v3, v4, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I

    .line 2514
    return-object v0

    .line 2518
    .end local v1    # "packageNameSet":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    .end local v2    # "e":Ljava/lang/Exception;
    :cond_44
    return-object v0
.end method

.method static synthetic access$000(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Landroid/content/ComponentName;)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Landroid/content/ComponentName;

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->logVpnVendor(Landroid/content/ComponentName;)V

    return-void
.end method

.method static synthetic access$100(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;)Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;

    .line 172
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    return-object v0
.end method

.method static synthetic access$1000()Z
    .registers 1

    .line 172
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    return v0
.end method

.method static synthetic access$1100(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;ILandroid/os/Bundle;)V
    .registers 3
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # I
    .param p2, "x2"    # Landroid/os/Bundle;

    .line 172
    invoke-direct {p0, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->sendMessageToHandler(ILandroid/os/Bundle;)V

    return-void
.end method

.method static synthetic access$1200(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Landroid/os/Bundle;)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Landroid/os/Bundle;

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleVpnInterfaceState(Landroid/os/Bundle;)V

    return-void
.end method

.method static synthetic access$1300(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Landroid/os/Bundle;)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Landroid/os/Bundle;

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleActionPackageAdded(Landroid/os/Bundle;)V

    return-void
.end method

.method static synthetic access$1400(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Landroid/os/Bundle;)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Landroid/os/Bundle;

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleConnectivityAction(Landroid/os/Bundle;)V

    return-void
.end method

.method static synthetic access$1500(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Landroid/os/Bundle;)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Landroid/os/Bundle;

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleActionUserRemoved(Landroid/os/Bundle;)V

    return-void
.end method

.method static synthetic access$1600(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;)Landroid/content/Context;
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;

    .line 172
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    return-object v0
.end method

.method static synthetic access$1700(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;I)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # I

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleActionLockBootCompleted(I)V

    return-void
.end method

.method static synthetic access$1800(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;I)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # I

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->initializeVpnVendorForUserAfterLockBootComplete(I)V

    return-void
.end method

.method static synthetic access$1900(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;)Z
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;

    .line 172
    iget-boolean v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->isDeviceBootCompleted:Z

    return v0
.end method

.method static synthetic access$1902(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Z)Z
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Z

    .line 172
    iput-boolean p1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->isDeviceBootCompleted:Z

    return p1
.end method

.method static synthetic access$200(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Ljava/lang/String;Ljava/lang/Object;)V
    .registers 3
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Ljava/lang/String;
    .param p2, "x2"    # Ljava/lang/Object;

    .line 172
    invoke-direct {p0, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setVpnInterface(Ljava/lang/String;Ljava/lang/Object;)V

    return-void
.end method

.method static synthetic access$2000(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;I)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # I

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->initializeVpnVendorForUserAfterBootComplete(I)V

    return-void
.end method

.method static synthetic access$2100(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Landroid/os/Bundle;)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Landroid/os/Bundle;

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleActionAdminChanged(Landroid/os/Bundle;)V

    return-void
.end method

.method static synthetic access$2200(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;I)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # I

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->sendProxyBroadcast(I)V

    return-void
.end method

.method static synthetic access$2300(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;I)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # I

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->stopVpnConnectionAfterAdminRemoval(I)V

    return-void
.end method

.method static synthetic access$2400(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;)V
    .registers 1
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;

    .line 172
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->stopVpnConnectionForAirplaneMode()V

    return-void
.end method

.method static synthetic access$2500(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;)V
    .registers 1
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;

    .line 172
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleUserScreenUnlock()V

    return-void
.end method

.method static synthetic access$2600(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;)V
    .registers 1
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;

    .line 172
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnConnectionForAllClients()V

    return-void
.end method

.method static synthetic access$2700(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;I)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # I

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnConnectionForClient(I)V

    return-void
.end method

.method static synthetic access$2800(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;I)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # I

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->stopVpnConnectionForClient(I)V

    return-void
.end method

.method static synthetic access$2900(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Landroid/os/Bundle;)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Landroid/os/Bundle;

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleActionWifiChanged(Landroid/os/Bundle;)V

    return-void
.end method

.method static synthetic access$300(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;)Ljava/util/List;
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;

    .line 172
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnClientStatus:Ljava/util/List;

    return-object v0
.end method

.method static synthetic access$3000(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Landroid/os/Bundle;)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Landroid/os/Bundle;

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleActionMobileChanged(Landroid/os/Bundle;)V

    return-void
.end method

.method static synthetic access$3100(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Landroid/os/Bundle;)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Landroid/os/Bundle;

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleActionEthernetChanged(Landroid/os/Bundle;)V

    return-void
.end method

.method static synthetic access$3200(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Landroid/os/Bundle;)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Landroid/os/Bundle;

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleCaptivePortal(Landroid/os/Bundle;)V

    return-void
.end method

.method static synthetic access$3300(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Landroid/os/Bundle;)V
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Landroid/os/Bundle;

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleActionUsbTethering(Landroid/os/Bundle;)V

    return-void
.end method

.method static synthetic access$3400(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;

    .line 172
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    return-object v0
.end method

.method static synthetic access$3500(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;)Ljava/util/concurrent/ConcurrentHashMap;
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;

    .line 172
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mIgnoreConnectCheckForChaining:Ljava/util/concurrent/ConcurrentHashMap;

    return-object v0
.end method

.method static synthetic access$3600(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Ljava/lang/String;)I
    .registers 3
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Ljava/lang/String;

    .line 172
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnProfile(Ljava/lang/String;)I

    move-result v0

    return v0
.end method

.method static synthetic access$3700(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;)Lcom/android/server/am/ActivityManagerService;
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;

    .line 172
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getAMSInstance()Lcom/android/server/am/ActivityManagerService;

    move-result-object v0

    return-object v0
.end method

.method static synthetic access$3800(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;)Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;

    .line 172
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v0

    return-object v0
.end method

.method static synthetic access$3900(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;ILjava/util/HashMap;Ljava/util/HashSet;)V
    .registers 4
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # I
    .param p2, "x2"    # Ljava/util/HashMap;
    .param p3, "x3"    # Ljava/util/HashSet;

    .line 172
    invoke-direct {p0, p1, p2, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkExistsEmailPackageInProfiles(ILjava/util/HashMap;Ljava/util/HashSet;)V

    return-void
.end method

.method static synthetic access$400(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;)V
    .registers 3
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Ljava/lang/String;
    .param p2, "x2"    # Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    .line 172
    invoke-direct {p0, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->validateProfilesForVendor(Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;)V

    return-void
.end method

.method static synthetic access$4000(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Ljava/lang/String;Ljava/util/HashMap;Ljava/util/HashSet;)V
    .registers 4
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Ljava/lang/String;
    .param p2, "x2"    # Ljava/util/HashMap;
    .param p3, "x3"    # Ljava/util/HashSet;

    .line 172
    invoke-direct {p0, p1, p2, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->killRunningProcessToApplyProxy(Ljava/lang/String;Ljava/util/HashMap;Ljava/util/HashSet;)V

    return-void
.end method

.method static synthetic access$500(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;)Z
    .registers 2
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;

    .line 172
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->isNetworkConnected()Z

    move-result v0

    return v0
.end method

.method static synthetic access$600(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;)V
    .registers 3
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Ljava/lang/String;
    .param p2, "x2"    # Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    .line 172
    invoke-direct {p0, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnConnectionForBindedClient(Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;)V

    return-void
.end method

.method static synthetic access$700(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Ljava/lang/String;I)V
    .registers 3
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Ljava/lang/String;
    .param p2, "x2"    # I

    .line 172
    invoke-direct {p0, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->sendBindSuccessIntent(Ljava/lang/String;I)V

    return-void
.end method

.method static synthetic access$800(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Ljava/lang/String;Ljava/lang/String;I)V
    .registers 4
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Ljava/lang/String;
    .param p2, "x2"    # Ljava/lang/String;
    .param p3, "x3"    # I

    .line 172
    invoke-direct {p0, p1, p2, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->stopStrongwanProxyConnection(Ljava/lang/String;Ljava/lang/String;I)V

    return-void
.end method

.method static synthetic access$900(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Ljava/lang/String;I)Z
    .registers 4
    .param p0, "x0"    # Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .param p1, "x1"    # Ljava/lang/String;
    .param p2, "x2"    # I

    .line 172
    invoke-direct {p0, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->bindKnoxVpnInterface(Ljava/lang/String;I)Z

    move-result v0

    return v0
.end method

.method private declared-synchronized addAllPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 19
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    move-object/from16 v1, p0

    move-object/from16 v2, p1

    move-object/from16 v3, p2

    monitor-enter p0

    .line 2554
    :try_start_7
    const-string v0, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "addAllPackages : vpnContext.personaId value is "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget v5, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v5, " profileName value is "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2556
    new-instance v0, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    move-object v4, v0

    .line 2557
    .local v4, "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v0, -0x1

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v5

    invoke-virtual {v4, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2558
    const/4 v5, 0x1

    invoke-virtual {v4, v5, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_39
    .catchall {:try_start_7 .. :try_end_39} :catchall_24f

    .line 2562
    :try_start_39
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v6, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v6

    .line 2563
    .local v6, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v6, :cond_4a

    .line 2564
    const-string v0, "KnoxVpnEngineService"

    const-string v5, "Error while adding all the packages to vpn: The error code is -1"

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_48
    .catch Ljava/lang/Exception; {:try_start_39 .. :try_end_48} :catch_213
    .catchall {:try_start_39 .. :try_end_48} :catchall_24f

    .line 2565
    monitor-exit p0

    return-object v4

    .line 2568
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_4a
    :try_start_4a
    iget-object v7, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    iget v8, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    const-string v9, "ADD_ALL_PACKAGES"

    invoke-virtual {v7, v8, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v7

    invoke-direct {v1, v2, v7, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->writeAddAllPackageToDB(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Ljava/lang/String;)I

    move-result v7

    .line 2569
    .local v7, "updateDb":I
    if-ne v7, v0, :cond_8b

    .line 2570
    const/16 v0, 0x7e

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v4, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2571
    const-string v0, "KnoxVpnEngineService"

    const-string v5, "Error while adding all the packages to vpn: The error code is 126"

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2572
    const/4 v8, 0x3

    const/4 v9, 0x5

    const/4 v10, 0x0

    .line 2573
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v11

    const-string v12, "KnoxVpnEngineService"

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Error while adding all packages to vpn for profile "

    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v13

    iget v14, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2572
    invoke-static/range {v8 .. v14}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_89
    .catch Ljava/lang/Exception; {:try_start_4a .. :try_end_89} :catch_213
    .catchall {:try_start_4a .. :try_end_89} :catchall_24f

    .line 2576
    monitor-exit p0

    return-object v4

    .line 2579
    :cond_8b
    :try_start_8b
    iget v8, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    const/4 v10, 0x3

    if-nez v8, :cond_b8

    .line 2580
    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v8

    .line 2581
    .local v8, "activateState":I
    if-ne v8, v5, :cond_b8

    .line 2582
    invoke-direct {v1, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->blockIncomingICMPPackets(Z)V

    .line 2583
    iget-object v11, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getActiveNetworkInterface()Ljava/lang/String;

    move-result-object v11

    .line 2584
    .local v11, "defaultInterface":Ljava/lang/String;
    sget-object v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->AID_EXEMPT_LIST:[Ljava/lang/Integer;

    array-length v13, v12

    const/4 v14, 0x0

    :goto_a3
    if-ge v14, v13, :cond_b8

    aget-object v15, v12, v14

    invoke-virtual {v15}, Ljava/lang/Integer;->intValue()I

    move-result v15

    .line 2585
    .local v15, "aidUid":I
    iget-object v9, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v9, v15, v11, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    .line 2586
    iget-object v9, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v9, v15}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addExemptRulesForUid(I)V

    .line 2584
    .end local v15    # "aidUid":I
    add-int/lit8 v14, v14, 0x1

    goto :goto_a3

    .line 2591
    .end local v8    # "activateState":I
    .end local v11    # "defaultInterface":Ljava/lang/String;
    :cond_b8
    iget-object v8, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v8, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getDefaultNetworkInterface(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v8

    .line 2596
    .local v8, "defaultInterface":Ljava/lang/String;
    iget v9, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-direct {v1, v3, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->addContainerToExceptionList(Ljava/lang/String;I)V

    .line 2598
    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->refreshDomainInHashMap(Ljava/lang/String;)V

    .line 2600
    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVPNTransitionState(Ljava/lang/String;)I

    move-result v9

    const/4 v11, 0x0

    if-eq v9, v0, :cond_199

    if-eq v9, v5, :cond_199

    const/4 v0, 0x2

    if-eq v9, v0, :cond_171

    if-eq v9, v10, :cond_156

    const/4 v0, 0x4

    if-eq v9, v0, :cond_f2

    const/4 v0, 0x5

    if-eq v9, v0, :cond_199

    .line 2631
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v10

    iget v11, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v0, v9, v10, v11, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRangeRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;)V

    .line 2632
    const-string v0, "KnoxVpnEngineService"

    const-string v9, "addAllPackages : VPN State not valid"

    invoke-static {v0, v9}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    goto/16 :goto_1da

    .line 2602
    :cond_f2
    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v0

    .line 2603
    .local v0, "interfaceValue":Ljava/lang/String;
    const-string v9, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string v12, "addAllPackages : profileName = "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string/jumbo v12, "interfaceValue = "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    invoke-static {v9, v11}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2604
    if-eqz v0, :cond_1da

    .line 2605
    invoke-virtual {v6, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setInterfaceName(Ljava/lang/String;)V

    .line 2606
    iget-object v9, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget v11, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v12

    invoke-virtual {v9, v11, v0, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRulesRange(ILjava/lang/String;I)V

    .line 2607
    iget-object v9, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v11

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v12

    iget v13, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v9, v11, v12, v13, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRangeRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;)V

    .line 2608
    iget-object v9, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    iget v11, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v9, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->startUid(I)I

    move-result v9

    iget-object v11, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    iget v12, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v11, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->stopUid(I)I

    move-result v11

    invoke-direct {v1, v3, v9, v11, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setDnsSystemProperty(Ljava/lang/String;IILjava/lang/String;)V

    .line 2609
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v9

    iget v11, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v9, v11, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateProxyList(IZ)Ljava/util/HashMap;

    move-result-object v9

    invoke-direct {v1, v10, v3, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    goto/16 :goto_1da

    .line 2627
    .end local v0    # "interfaceValue":Ljava/lang/String;
    :cond_156
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget v9, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v10

    invoke-virtual {v0, v9, v11, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRulesRange(ILjava/lang/String;I)V

    .line 2628
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v10

    iget v11, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v0, v9, v10, v11, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRangeRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;)V

    .line 2629
    goto :goto_1da

    .line 2622
    :cond_171
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget v9, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v12

    invoke-virtual {v0, v9, v11, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRulesRange(ILjava/lang/String;I)V

    .line 2623
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v11

    iget v12, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v0, v9, v11, v12, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRangeRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;)V

    .line 2624
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v0

    iget v9, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v0, v9, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateProxyList(IZ)Ljava/util/HashMap;

    move-result-object v0

    invoke-direct {v1, v10, v3, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 2625
    goto :goto_1da

    .line 2615
    :cond_199
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget v9, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v12

    invoke-virtual {v0, v9, v11, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRulesRange(ILjava/lang/String;I)V

    .line 2616
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v11

    iget v12, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v0, v9, v11, v12, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRangeRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;)V

    .line 2617
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v0

    iget v9, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v0, v9, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateProxyList(IZ)Ljava/util/HashMap;

    move-result-object v0

    invoke-direct {v1, v10, v3, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 2618
    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnProfile(Ljava/lang/String;)I

    .line 2619
    const-string v0, "KnoxVpnEngineService"

    new-instance v9, Ljava/lang/StringBuilder;

    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V

    const-string v10, "addAllPackages : start connection called. profileName = "

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v9

    invoke-static {v0, v9}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2620
    nop

    .line 2637
    :cond_1da
    :goto_1da
    iget v0, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-direct {v1, v3, v0, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateNotification(Ljava/lang/String;IZ)V

    .line 2639
    const-string v0, "KnoxVpnEngineService"

    const-string/jumbo v5, "success while adding all the packages to vpn: The error code is 0"

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2640
    const/4 v0, 0x0

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v5

    invoke-virtual {v4, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2641
    invoke-virtual {v4, v0, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 2643
    const/4 v9, 0x5

    const/4 v10, 0x5

    const/4 v11, 0x1

    .line 2644
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v12

    const-string v13, "KnoxVpnEngineService"

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "success while adding all the packages to vpn for profile "

    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v14

    iget v15, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2643
    invoke-static/range {v9 .. v15}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_212
    .catch Ljava/lang/Exception; {:try_start_8b .. :try_end_212} :catch_213
    .catchall {:try_start_8b .. :try_end_212} :catchall_24f

    .line 2654
    .end local v6    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v7    # "updateDb":I
    .end local v8    # "defaultInterface":Ljava/lang/String;
    goto :goto_24d

    .line 2648
    :catch_213
    move-exception v0

    .line 2649
    .local v0, "e":Ljava/lang/Exception;
    :try_start_214
    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "Error while adding all the packages to vpn: exception occured: The error code is -1"

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2650
    const/4 v7, 0x3

    const/4 v8, 0x5

    const/4 v9, 0x0

    .line 2651
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v10

    const-string v11, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception while adding all the packages to vpn for profile "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v12

    iget v13, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2650
    invoke-static/range {v7 .. v13}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_24d
    .catchall {:try_start_214 .. :try_end_24d} :catchall_24f

    .line 2656
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_24d
    monitor-exit p0

    return-object v4

    .line 2553
    .end local v4    # "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    :catchall_24f
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method private declared-synchronized addBlockingRulesForPackages()V
    .registers 24

    move-object/from16 v8, p0

    monitor-enter p0

    .line 4401
    :try_start_3
    const-string v0, "KnoxVpnEngineService"

    const-string v1, "addBlockingRulesForPackages"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_a
    .catchall {:try_start_3 .. :try_end_a} :catchall_160

    .line 4403
    :try_start_a
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v0

    .line 4404
    .local v0, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    if-eqz v0, :cond_13f

    invoke-interface {v0}, Ljava/util/Collection;->size()I

    move-result v1

    if-gtz v1, :cond_1c

    move-object/from16 v19, v0

    goto/16 :goto_141

    .line 4407
    :cond_1c
    invoke-interface {v0}, Ljava/util/Collection;->size()I

    move-result v1

    const/4 v9, 0x3

    if-lez v1, :cond_34

    .line 4408
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->updateIpBlockingRule()V

    .line 4409
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    sget-object v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->BLOCK_APP_TRAFFIC:Ljava/lang/String;

    sget-object v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->BLOCK_APP_TRAFFIC:Ljava/lang/String;

    invoke-virtual {v1, v2, v3, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForNoUidPackets(Ljava/lang/String;Ljava/lang/String;I)V

    .line 4410
    invoke-virtual/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->allowAppsToMakeDnsQueryForNetId()V

    .line 4413
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_34
    invoke-interface {v0}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v10

    :goto_38
    invoke-interface {v10}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_13c

    invoke-interface {v10}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-object v11, v1

    .line 4414
    .local v11, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v1

    move-object v12, v1

    .line 4415
    .local v12, "profileName":Ljava/lang/String;
    invoke-virtual {v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v1

    move-object v13, v1

    .line 4416
    .local v13, "interfaceName":Ljava/lang/String;
    invoke-virtual {v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v1

    move v14, v1

    .line 4417
    .local v14, "vendorUid":I
    invoke-virtual {v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v1

    move v15, v1

    .line 4418
    .local v15, "activateState":I
    invoke-virtual {v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v1

    move-object v7, v1

    .line 4419
    .local v7, "ipChainName":Ljava/lang/String;
    invoke-virtual {v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v1

    move-object v6, v1

    .line 4420
    .local v6, "vendorPkgName":Ljava/lang/String;
    const/16 v16, -0x1

    .local v16, "uid":I
    const/16 v17, -0x1

    .line 4421
    .local v17, "cid":I
    new-instance v1, Ljava/util/ArrayList;

    invoke-direct {v1}, Ljava/util/ArrayList;-><init>()V

    move-object v5, v1

    .line 4423
    .local v5, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->createIpChainForProfile(Ljava/lang/String;)V

    .line 4425
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesInOutputChain(Ljava/lang/String;)V

    .line 4427
    invoke-direct {v8, v14, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->addExemptRulesForUid(ILjava/lang/String;)V

    .line 4429
    invoke-virtual {v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v1

    invoke-virtual {v1}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v18

    :goto_82
    invoke-interface/range {v18 .. v18}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_b3

    invoke-interface/range {v18 .. v18}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Ljava/lang/Integer;

    invoke-virtual {v1}, Ljava/lang/Integer;->intValue()I

    move-result v4

    .line 4430
    .local v4, "uid_1":I
    const/4 v2, 0x1

    const/4 v3, 0x1

    const/16 v19, 0x0

    const/16 v20, 0x0

    const/16 v21, 0x0

    move-object/from16 v1, p0

    move-object v9, v5

    .end local v5    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v9, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    move/from16 v5, v19

    move-object/from16 v22, v6

    .end local v6    # "vendorPkgName":Ljava/lang/String;
    .local v22, "vendorPkgName":Ljava/lang/String;
    move-object/from16 v6, v20

    move-object/from16 v19, v0

    move-object v0, v7

    .end local v7    # "ipChainName":Ljava/lang/String;
    .local v0, "ipChainName":Ljava/lang/String;
    .local v19, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    move-object/from16 v7, v21

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 4431
    .end local v4    # "uid_1":I
    move-object v7, v0

    move-object v5, v9

    move-object/from16 v0, v19

    move-object/from16 v6, v22

    const/4 v9, 0x3

    goto :goto_82

    .line 4433
    .end local v9    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v19    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .end local v22    # "vendorPkgName":Ljava/lang/String;
    .local v0, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v5    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v6    # "vendorPkgName":Ljava/lang/String;
    .restart local v7    # "ipChainName":Ljava/lang/String;
    :cond_b3
    move-object/from16 v19, v0

    move-object v9, v5

    move-object/from16 v22, v6

    move-object v0, v7

    .end local v5    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v6    # "vendorPkgName":Ljava/lang/String;
    .end local v7    # "ipChainName":Ljava/lang/String;
    .local v0, "ipChainName":Ljava/lang/String;
    .restart local v9    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v19    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v22    # "vendorPkgName":Ljava/lang/String;
    invoke-virtual {v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_c1
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    const/4 v3, 0x1

    if-eqz v2, :cond_10d

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 4434
    .local v2, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v4, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v4

    if-eqz v4, :cond_fb

    .line 4435
    iget-object v4, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v4

    .line 4436
    .end local v17    # "cid":I
    .local v4, "cid":I
    if-ne v15, v3, :cond_eb

    .line 4437
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {v8, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v5

    invoke-virtual {v3, v4, v13, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRulesRange(ILjava/lang/String;I)V

    .line 4439
    :cond_eb
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v5, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v5, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getDefaultNetworkInterface(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v5

    move-object/from16 v6, v22

    .end local v22    # "vendorPkgName":Ljava/lang/String;
    .restart local v6    # "vendorPkgName":Ljava/lang/String;
    invoke-virtual {v3, v6, v0, v4, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRangeRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;)V

    move/from16 v17, v4

    goto :goto_10a

    .line 4441
    .end local v4    # "cid":I
    .end local v6    # "vendorPkgName":Ljava/lang/String;
    .restart local v17    # "cid":I
    .restart local v22    # "vendorPkgName":Ljava/lang/String;
    :cond_fb
    move-object/from16 v6, v22

    .end local v22    # "vendorPkgName":Ljava/lang/String;
    .restart local v6    # "vendorPkgName":Ljava/lang/String;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v3

    .line 4442
    .end local v16    # "uid":I
    .local v3, "uid":I
    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v4

    invoke-interface {v9, v4}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    move/from16 v16, v3

    .line 4444
    .end local v2    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v3    # "uid":I
    .restart local v16    # "uid":I
    :goto_10a
    move-object/from16 v22, v6

    goto :goto_c1

    .line 4445
    .end local v6    # "vendorPkgName":Ljava/lang/String;
    .restart local v22    # "vendorPkgName":Ljava/lang/String;
    :cond_10d
    move-object/from16 v6, v22

    .end local v22    # "vendorPkgName":Ljava/lang/String;
    .restart local v6    # "vendorPkgName":Ljava/lang/String;
    invoke-interface {v9}, Ljava/util/List;->isEmpty()Z

    move-result v1

    if-nez v1, :cond_12b

    .line 4446
    if-ne v15, v3, :cond_120

    .line 4447
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {v8, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v2

    invoke-virtual {v1, v9, v13, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRules(Ljava/util/List;Ljava/lang/String;I)V

    .line 4449
    :cond_120
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getDefaultNetworkInterface(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v6, v0, v9, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;Ljava/util/List;Ljava/lang/String;)V

    .line 4451
    :cond_12b
    if-ne v15, v3, :cond_136

    .line 4452
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    sget-object v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->BLOCK_APP_TRAFFIC:Ljava/lang/String;

    const/4 v3, 0x3

    invoke-virtual {v1, v2, v0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMarkingRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;I)V
    :try_end_135
    .catch Ljava/lang/Exception; {:try_start_a .. :try_end_135} :catch_143
    .catchall {:try_start_a .. :try_end_135} :catchall_160

    goto :goto_137

    .line 4451
    :cond_136
    const/4 v3, 0x3

    .line 4454
    .end local v0    # "ipChainName":Ljava/lang/String;
    .end local v6    # "vendorPkgName":Ljava/lang/String;
    .end local v9    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v11    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v12    # "profileName":Ljava/lang/String;
    .end local v13    # "interfaceName":Ljava/lang/String;
    .end local v14    # "vendorUid":I
    .end local v15    # "activateState":I
    .end local v16    # "uid":I
    .end local v17    # "cid":I
    :goto_137
    move v9, v3

    move-object/from16 v0, v19

    goto/16 :goto_38

    .line 4413
    .end local v19    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .local v0, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_13c
    move-object/from16 v19, v0

    .line 4457
    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    goto :goto_15e

    .line 4404
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_13f
    move-object/from16 v19, v0

    .line 4405
    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v19    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :goto_141
    monitor-exit p0

    return-void

    .line 4455
    .end local v19    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :catch_143
    move-exception v0

    .line 4456
    .local v0, "e":Ljava/lang/Exception;
    :try_start_144
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "addBlockingRulesForPackages : Exception when reading package DB:"

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_15e
    .catchall {:try_start_144 .. :try_end_15e} :catchall_160

    .line 4458
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_15e
    monitor-exit p0

    return-void

    .line 4400
    :catchall_160
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method private addContainerToExceptionList(Ljava/lang/String;I)V
    .registers 9
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "containerId"    # I

    .line 8014
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v0

    .line 8016
    .local v0, "blockToken":J
    :try_start_4
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-static {v2}, Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;->getInstance(Landroid/content/Context;)Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;

    move-result-object v2

    .line 8017
    .local v2, "mEntProvider":Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;
    if-eqz v2, :cond_f

    .line 8018
    invoke-virtual {v2, p1, p2}, Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;->addContainerToExceptionList(Ljava/lang/String;I)I
    :try_end_f
    .catch Ljava/lang/Exception; {:try_start_4 .. :try_end_f} :catch_15
    .catchall {:try_start_4 .. :try_end_f} :catchall_13

    .line 8023
    .end local v2    # "mEntProvider":Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;
    :cond_f
    :goto_f
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 8024
    goto :goto_35

    .line 8023
    :catchall_13
    move-exception v2

    goto :goto_36

    .line 8020
    :catch_15
    move-exception v2

    .line 8021
    .local v2, "e":Ljava/lang/Exception;
    :try_start_16
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_f

    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception at addContainerToExceptionList API "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_34
    .catchall {:try_start_16 .. :try_end_34} :catchall_13

    goto :goto_f

    .line 8025
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_35
    return-void

    .line 8023
    :goto_36
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 8024
    throw v2
.end method

.method private addExemptRulesForUid(ILjava/lang/String;)V
    .registers 6
    .param p1, "vendorUid"    # I
    .param p2, "profileName"    # Ljava/lang/String;

    .line 6494
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v1, "addExemptRulesForUid : vendor = "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v1, " for profile "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    const-string v1, "KnoxVpnEngineService"

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6495
    invoke-virtual {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getChainingEnabledForProfile(I)I

    move-result v0

    const/4 v2, 0x1

    if-eq v0, v2, :cond_4c

    .line 6496
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v2, "addExemptRulesForUid : uid = "

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6497
    invoke-static {p1}, Landroid/os/UserHandle;->getAppId(I)I

    move-result v0

    const/16 v1, 0x3e8

    if-ne v0, v1, :cond_47

    .line 6498
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addExemptRulesForStrongswan(I)V

    goto :goto_4c

    .line 6500
    :cond_47
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addExemptRulesForUid(I)V

    .line 6503
    :cond_4c
    :goto_4c
    return-void
.end method

.method private addMiscRulesForProfile(Ljava/lang/String;)V
    .registers 12
    .param p1, "profileName"    # Ljava/lang/String;

    .line 7016
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v1, "addMiscRulesForProfile : profileName =  "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    const-string v1, "KnoxVpnEngineService"

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7017
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0

    .line 7018
    .local v0, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    const/4 v1, -0x1

    .local v1, "uid":I
    const/4 v2, -0x1

    .line 7019
    .local v2, "cid":I
    new-instance v3, Ljava/util/ArrayList;

    invoke-direct {v3}, Ljava/util/ArrayList;-><init>()V

    .line 7020
    .local v3, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    if-eqz v0, :cond_7b

    .line 7021
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v4

    .line 7022
    .local v4, "activateState":I
    if-nez v4, :cond_2c

    .line 7023
    return-void

    .line 7025
    :cond_2c
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v5

    .line 7026
    .local v5, "interfaceName":Ljava/lang/String;
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v6

    invoke-interface {v6}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v6

    :goto_38
    invoke-interface {v6}, Ljava/util/Iterator;->hasNext()Z

    move-result v7

    if-eqz v7, :cond_6c

    invoke-interface {v6}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v7

    check-cast v7, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 7027
    .local v7, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v8, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v8

    if-eqz v8, :cond_60

    .line 7028
    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v8, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v2

    .line 7029
    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v9

    invoke-virtual {v8, v2, v5, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRulesRange(ILjava/lang/String;I)V

    goto :goto_6b

    .line 7031
    :cond_60
    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v1

    .line 7032
    invoke-static {v1}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v8

    invoke-interface {v3, v8}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 7034
    .end local v7    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :goto_6b
    goto :goto_38

    .line 7035
    :cond_6c
    invoke-interface {v3}, Ljava/util/List;->isEmpty()Z

    move-result v6

    if-nez v6, :cond_7b

    .line 7036
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v7

    invoke-virtual {v6, v3, v5, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRules(Ljava/util/List;Ljava/lang/String;I)V

    .line 7039
    .end local v4    # "activateState":I
    .end local v5    # "interfaceName":Ljava/lang/String;
    :cond_7b
    return-void
.end method

.method private addPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;[Ljava/lang/String;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 43
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "packageList"    # [Ljava/lang/String;
    .param p3, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "[",
            "Ljava/lang/String;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    .line 1882
    move-object/from16 v1, p0

    move-object/from16 v2, p1

    move-object/from16 v3, p2

    move-object/from16 v4, p3

    const/4 v5, 0x0

    .local v5, "ALL_PACKAGES_ADDED":I
    const/4 v6, 0x1

    .local v6, "PARTIAL_PACKAGES_ADDED":I
    const/4 v7, 0x2

    .line 1883
    .local v7, "NO_PACKAGES_ADDED":I
    new-instance v0, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    move-object v8, v0

    .line 1884
    .local v8, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v9, 0x2

    invoke-static {v9}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v8, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1885
    const/4 v10, 0x1

    const/4 v11, -0x1

    invoke-virtual {v8, v10, v11}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1886
    if-nez v2, :cond_21

    return-object v8

    .line 1888
    :cond_21
    iget v12, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->adminId:I

    .line 1889
    .local v12, "adminId":I
    iget v13, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1890
    .local v13, "cid":I
    new-instance v0, Ljava/util/ArrayList;

    invoke-direct {v0}, Ljava/util/ArrayList;-><init>()V

    move-object v14, v0

    .line 1891
    .local v14, "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getIpChainNameForProfile(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v15

    .line 1892
    .local v15, "ipChainName":Ljava/lang/String;
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v9, "addPackages : profileName value is "

    invoke-virtual {v0, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string/jumbo v9, "personaId value is"

    invoke-virtual {v0, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v13}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    const-string v9, "KnoxVpnEngineService"

    invoke-static {v9, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1896
    :try_start_50
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v0, v2, v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->addPackagesToVpnValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;[Ljava/lang/String;Ljava/lang/String;)I

    move-result v0
    :try_end_56
    .catch Ljava/lang/Exception; {:try_start_50 .. :try_end_56} :catch_28a

    .line 1897
    .local v0, "addPackagesToVpnValidation":I
    const/16 v10, 0x64

    if-eq v0, v10, :cond_81

    .line 1898
    :try_start_5a
    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v10

    invoke-virtual {v8, v10}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1899
    new-instance v10, Ljava/lang/StringBuilder;

    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V

    const-string v11, "Error occured while adding packages to vpn(addPackagesToVpnValidation): The error code is "

    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v10

    invoke-static {v9, v10}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_75
    .catch Ljava/lang/Exception; {:try_start_5a .. :try_end_75} :catch_76

    .line 1900
    return-object v8

    .line 1975
    .end local v0    # "addPackagesToVpnValidation":I
    :catch_76
    move-exception v0

    move/from16 v17, v5

    move/from16 v18, v6

    move/from16 v19, v7

    move/from16 v21, v12

    goto/16 :goto_293

    .line 1903
    .restart local v0    # "addPackagesToVpnValidation":I
    :cond_81
    :try_start_81
    const-string/jumbo v10, "package"

    invoke-static {v10}, Landroid/os/ServiceManager;->getService(Ljava/lang/String;)Landroid/os/IBinder;

    move-result-object v10

    invoke-static {v10}, Landroid/content/pm/IPackageManager$Stub;->asInterface(Landroid/os/IBinder;)Landroid/content/pm/IPackageManager;

    move-result-object v10

    .line 1905
    .local v10, "pm":Landroid/content/pm/IPackageManager;
    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    .line 1908
    .local v11, "successPackages":Ljava/lang/StringBuilder;
    move/from16 v16, v0

    .end local v0    # "addPackagesToVpnValidation":I
    .local v16, "addPackagesToVpnValidation":I
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;
    :try_end_95
    .catch Ljava/lang/Exception; {:try_start_81 .. :try_end_95} :catch_28a

    move/from16 v17, v5

    .end local v5    # "ALL_PACKAGES_ADDED":I
    .local v17, "ALL_PACKAGES_ADDED":I
    :try_start_97
    const-string v5, "ADD_ALL_PACKAGES"

    invoke-virtual {v0, v13, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v0

    .line 1909
    .local v0, "addAllPackage":Ljava/lang/String;
    array-length v5, v3
    :try_end_9e
    .catch Ljava/lang/Exception; {:try_start_97 .. :try_end_9e} :catch_282

    move/from16 v18, v6

    .end local v6    # "PARTIAL_PACKAGES_ADDED":I
    .local v18, "PARTIAL_PACKAGES_ADDED":I
    const/4 v6, 0x0

    :goto_a1
    move/from16 v19, v7

    .end local v7    # "NO_PACKAGES_ADDED":I
    .local v19, "NO_PACKAGES_ADDED":I
    const-string v7, " added to vpn for profile "

    if-ge v6, v5, :cond_218

    :try_start_a7
    aget-object v20, v3, v6

    move-object/from16 v21, v20

    .line 1910
    .local v21, "packageName":Ljava/lang/String;
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move/from16 v20, v5

    move-object/from16 v5, v21

    .end local v21    # "packageName":Ljava/lang/String;
    .local v5, "packageName":Ljava/lang/String;
    invoke-virtual {v3, v13, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v3
    :try_end_b5
    .catch Ljava/lang/Exception; {:try_start_a7 .. :try_end_b5} :catch_213

    .line 1911
    .local v3, "appUid":I
    if-lez v3, :cond_16b

    .line 1912
    move/from16 v21, v12

    .end local v12    # "adminId":I
    .local v21, "adminId":I
    :try_start_b9
    iget-object v12, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v12, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getProfileOwningTheUid(I)Ljava/lang/String;

    move-result-object v12

    .line 1913
    .local v12, "profileOwningUid":Ljava/lang/String;
    if-eqz v12, :cond_e6

    invoke-virtual {v12, v4}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v22

    if-eqz v22, :cond_e6

    .line 1914
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    move-object/from16 v22, v12

    .end local v12    # "profileOwningUid":Ljava/lang/String;
    .local v22, "profileOwningUid":Ljava/lang/String;
    const-string v12, "addPackages:uid already added to the profile, skipping it "

    invoke-virtual {v7, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v9, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1915
    move-object/from16 v23, v0

    move-object/from16 v25, v10

    goto/16 :goto_203

    .line 1913
    .end local v22    # "profileOwningUid":Ljava/lang/String;
    .restart local v12    # "profileOwningUid":Ljava/lang/String;
    :cond_e6
    move-object/from16 v22, v12

    .line 1917
    .end local v12    # "profileOwningUid":Ljava/lang/String;
    .restart local v22    # "profileOwningUid":Ljava/lang/String;
    iget-object v12, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v12, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getProfileOwningThePackage(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v12

    .line 1918
    .local v12, "getProfileOwningThePackage":Ljava/lang/String;
    if-eqz v12, :cond_116

    invoke-virtual {v12, v4}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v23

    if-eqz v23, :cond_116

    .line 1919
    move-object/from16 v23, v0

    .end local v0    # "addAllPackage":Ljava/lang/String;
    .local v23, "addAllPackage":Ljava/lang/String;
    invoke-static {v3}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v0

    if-ne v13, v0, :cond_118

    .line 1920
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "addPackages:userId for the appId already added to the profile, skipping it "

    invoke-virtual {v0, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v9, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1921
    move-object/from16 v25, v10

    goto/16 :goto_203

    .line 1918
    .end local v23    # "addAllPackage":Ljava/lang/String;
    .restart local v0    # "addAllPackage":Ljava/lang/String;
    :cond_116
    move-object/from16 v23, v0

    .line 1924
    .end local v0    # "addAllPackage":Ljava/lang/String;
    .restart local v23    # "addAllPackage":Ljava/lang/String;
    :cond_118
    if-eqz v10, :cond_168

    .line 1925
    const-string v0, "android.permission.INTERNET"

    invoke-interface {v10, v0, v3}, Landroid/content/pm/IPackageManager;->checkUidPermission(Ljava/lang/String;I)I

    move-result v0

    .line 1926
    .local v0, "isPermissionGranted":I
    if-eqz v0, :cond_142

    .line 1927
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    move/from16 v24, v0

    .end local v0    # "isPermissionGranted":I
    .local v24, "isPermissionGranted":I
    const-string v0, "addPackages:uid is not granted internet permission "

    invoke-virtual {v7, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v9, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1928
    invoke-direct {v1, v4, v5, v13, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->writePackagestoPermissionCheckDb(Ljava/lang/String;Ljava/lang/String;II)V

    .line 1929
    move-object/from16 v25, v10

    goto/16 :goto_203

    .line 1931
    .end local v24    # "isPermissionGranted":I
    .restart local v0    # "isPermissionGranted":I
    :cond_142
    move/from16 v24, v0

    .end local v0    # "isPermissionGranted":I
    .restart local v24    # "isPermissionGranted":I
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    move-object/from16 v25, v10

    .end local v10    # "pm":Landroid/content/pm/IPackageManager;
    .local v25, "pm":Landroid/content/pm/IPackageManager;
    const-string v10, "addPackages:uid is granted internet permission "

    invoke-virtual {v0, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v9, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1932
    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-interface {v14, v0}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 1934
    invoke-direct {v1, v4, v13, v3, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->addUIDListToExceptionList(Ljava/lang/String;IILjava/lang/String;)V

    goto :goto_171

    .line 1924
    .end local v24    # "isPermissionGranted":I
    .end local v25    # "pm":Landroid/content/pm/IPackageManager;
    .restart local v10    # "pm":Landroid/content/pm/IPackageManager;
    :cond_168
    move-object/from16 v25, v10

    .end local v10    # "pm":Landroid/content/pm/IPackageManager;
    .restart local v25    # "pm":Landroid/content/pm/IPackageManager;
    goto :goto_171

    .line 1911
    .end local v21    # "adminId":I
    .end local v22    # "profileOwningUid":Ljava/lang/String;
    .end local v23    # "addAllPackage":Ljava/lang/String;
    .end local v25    # "pm":Landroid/content/pm/IPackageManager;
    .local v0, "addAllPackage":Ljava/lang/String;
    .restart local v10    # "pm":Landroid/content/pm/IPackageManager;
    .local v12, "adminId":I
    :cond_16b
    move-object/from16 v23, v0

    move-object/from16 v25, v10

    move/from16 v21, v12

    .line 1939
    .end local v0    # "addAllPackage":Ljava/lang/String;
    .end local v10    # "pm":Landroid/content/pm/IPackageManager;
    .end local v12    # "adminId":I
    .restart local v21    # "adminId":I
    .restart local v23    # "addAllPackage":Ljava/lang/String;
    .restart local v25    # "pm":Landroid/content/pm/IPackageManager;
    :goto_171
    invoke-direct {v1, v4, v5, v3, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->writePackageToDB(Ljava/lang/String;Ljava/lang/String;II)I

    move-result v0

    .line 1940
    .local v0, "writePackageResult":I
    const/4 v10, -0x1

    if-ne v0, v10, :cond_1fb

    .line 1941
    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v10, "Error occured while adding packages to vpn(writePackageToDB): The error code is "

    invoke-virtual {v6, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v9, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1942
    const/4 v6, 0x1

    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v10

    invoke-virtual {v8, v10}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1944
    invoke-virtual {v11}, Ljava/lang/StringBuilder;->length()I

    move-result v6

    if-lez v6, :cond_1ce

    .line 1945
    const/16 v26, 0x5

    const/16 v27, 0x5

    const/16 v28, 0x1

    .line 1946
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v29

    const-string v30, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    .line 1947
    invoke-virtual {v11}, Ljava/lang/StringBuilder;->length()I

    move-result v10

    const/4 v12, 0x2

    sub-int/2addr v10, v12

    const/4 v12, 0x0

    invoke-virtual {v11, v12, v10}, Ljava/lang/StringBuilder;->subSequence(II)Ljava/lang/CharSequence;

    move-result-object v10

    invoke-interface {v10}, Ljava/lang/CharSequence;->toString()Ljava/lang/String;

    move-result-object v10

    invoke-virtual {v6, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v31

    iget v6, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1945
    move/from16 v32, v6

    invoke-static/range {v26 .. v32}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 1951
    :cond_1ce
    const/16 v32, 0x3

    const/16 v33, 0x5

    const/16 v34, 0x0

    .line 1952
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v35

    const-string v36, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "Error occurred while adding package "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v7, " to vpn for profile "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v37

    iget v6, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1951
    move/from16 v38, v6

    invoke-static/range {v32 .. v38}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 1956
    return-object v8

    .line 1958
    :cond_1fb
    invoke-virtual {v11, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v7, ", "

    invoke-virtual {v11, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    .line 1909
    .end local v0    # "writePackageResult":I
    .end local v3    # "appUid":I
    .end local v5    # "packageName":Ljava/lang/String;
    :goto_203
    add-int/lit8 v6, v6, 0x1

    move-object/from16 v3, p2

    move/from16 v7, v19

    move/from16 v5, v20

    move/from16 v12, v21

    move-object/from16 v0, v23

    move-object/from16 v10, v25

    goto/16 :goto_a1

    .line 1975
    .end local v11    # "successPackages":Ljava/lang/StringBuilder;
    .end local v16    # "addPackagesToVpnValidation":I
    .end local v21    # "adminId":I
    .end local v23    # "addAllPackage":Ljava/lang/String;
    .end local v25    # "pm":Landroid/content/pm/IPackageManager;
    .restart local v12    # "adminId":I
    :catch_213
    move-exception v0

    move/from16 v21, v12

    .end local v12    # "adminId":I
    .restart local v21    # "adminId":I
    goto/16 :goto_293

    .line 1962
    .end local v21    # "adminId":I
    .local v0, "addAllPackage":Ljava/lang/String;
    .restart local v10    # "pm":Landroid/content/pm/IPackageManager;
    .restart local v11    # "successPackages":Ljava/lang/StringBuilder;
    .restart local v12    # "adminId":I
    .restart local v16    # "addPackagesToVpnValidation":I
    :cond_218
    move-object/from16 v23, v0

    move-object/from16 v25, v10

    move/from16 v21, v12

    .end local v0    # "addAllPackage":Ljava/lang/String;
    .end local v10    # "pm":Landroid/content/pm/IPackageManager;
    .end local v12    # "adminId":I
    .restart local v21    # "adminId":I
    .restart local v23    # "addAllPackage":Ljava/lang/String;
    .restart local v25    # "pm":Landroid/content/pm/IPackageManager;
    invoke-virtual {v11}, Ljava/lang/StringBuilder;->length()I

    move-result v0

    if-lez v0, :cond_258

    .line 1963
    const/16 v26, 0x5

    const/16 v27, 0x5

    const/16 v28, 0x1

    .line 1964
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v29

    const-string v30, "KnoxVpnEngineService"

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    .line 1965
    invoke-virtual {v11}, Ljava/lang/StringBuilder;->length()I

    move-result v3

    const/4 v5, 0x2

    sub-int/2addr v3, v5

    const/4 v5, 0x0

    invoke-virtual {v11, v5, v3}, Ljava/lang/StringBuilder;->subSequence(II)Ljava/lang/CharSequence;

    move-result-object v3

    invoke-interface {v3}, Ljava/lang/CharSequence;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v0, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v31

    iget v0, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1963
    move/from16 v32, v0

    invoke-static/range {v26 .. v32}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 1969
    :cond_258
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual/range {p1 .. p1}, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->getVendorName()Ljava/lang/String;

    move-result-object v3

    iget-object v5, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v5, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getDefaultNetworkInterface(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v0, v3, v15, v14, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;Ljava/util/List;Ljava/lang/String;)V

    .line 1972
    invoke-direct {v1, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->refreshDomainInHashMap(Ljava/lang/String;)V

    .line 1974
    const/4 v3, 0x1

    invoke-direct {v1, v4, v13, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateNotification(Ljava/lang/String;IZ)V
    :try_end_26e
    .catch Ljava/lang/Exception; {:try_start_b9 .. :try_end_26e} :catch_280

    .line 1980
    .end local v11    # "successPackages":Ljava/lang/StringBuilder;
    .end local v16    # "addPackagesToVpnValidation":I
    .end local v23    # "addAllPackage":Ljava/lang/String;
    .end local v25    # "pm":Landroid/content/pm/IPackageManager;
    nop

    .line 1982
    const-string v0, "Error occured while adding packages to vpn: The error code is 0"

    invoke-static {v9, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1983
    const/4 v0, 0x0

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v8, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1984
    invoke-virtual {v8, v0, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1986
    return-object v8

    .line 1975
    :catch_280
    move-exception v0

    goto :goto_293

    .end local v18    # "PARTIAL_PACKAGES_ADDED":I
    .end local v19    # "NO_PACKAGES_ADDED":I
    .end local v21    # "adminId":I
    .restart local v6    # "PARTIAL_PACKAGES_ADDED":I
    .restart local v7    # "NO_PACKAGES_ADDED":I
    .restart local v12    # "adminId":I
    :catch_282
    move-exception v0

    move/from16 v18, v6

    move/from16 v19, v7

    move/from16 v21, v12

    .end local v6    # "PARTIAL_PACKAGES_ADDED":I
    .end local v7    # "NO_PACKAGES_ADDED":I
    .end local v12    # "adminId":I
    .restart local v18    # "PARTIAL_PACKAGES_ADDED":I
    .restart local v19    # "NO_PACKAGES_ADDED":I
    .restart local v21    # "adminId":I
    goto :goto_293

    .end local v17    # "ALL_PACKAGES_ADDED":I
    .end local v18    # "PARTIAL_PACKAGES_ADDED":I
    .end local v19    # "NO_PACKAGES_ADDED":I
    .end local v21    # "adminId":I
    .local v5, "ALL_PACKAGES_ADDED":I
    .restart local v6    # "PARTIAL_PACKAGES_ADDED":I
    .restart local v7    # "NO_PACKAGES_ADDED":I
    .restart local v12    # "adminId":I
    :catch_28a
    move-exception v0

    move/from16 v17, v5

    move/from16 v18, v6

    move/from16 v19, v7

    move/from16 v21, v12

    .line 1976
    .end local v5    # "ALL_PACKAGES_ADDED":I
    .end local v6    # "PARTIAL_PACKAGES_ADDED":I
    .end local v7    # "NO_PACKAGES_ADDED":I
    .end local v12    # "adminId":I
    .local v0, "e":Ljava/lang/Exception;
    .restart local v17    # "ALL_PACKAGES_ADDED":I
    .restart local v18    # "PARTIAL_PACKAGES_ADDED":I
    .restart local v19    # "NO_PACKAGES_ADDED":I
    .restart local v21    # "adminId":I
    :goto_293
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Error occured while adding packages to vpn: exception occured: The error code is -1"

    invoke-virtual {v3, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v3, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v9, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1977
    const/4 v3, -0x1

    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v8, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1978
    const/4 v3, 0x2

    const/4 v5, 0x1

    invoke-virtual {v8, v5, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1979
    return-object v8
.end method

.method private addUIDListToExceptionList(Ljava/lang/String;IILjava/lang/String;)V
    .registers 11
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "cid"    # I
    .param p3, "uid"    # I
    .param p4, "packageName"    # Ljava/lang/String;

    .line 8030
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v0

    .line 8032
    .local v0, "blockToken":J
    const/4 v2, -0x2

    if-ne p3, v2, :cond_b

    .line 8033
    :try_start_7
    invoke-direct {p0, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->addContainerToExceptionList(Ljava/lang/String;I)V

    goto :goto_24

    .line 8035
    :cond_b
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-static {v2}, Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;->getInstance(Landroid/content/Context;)Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;

    move-result-object v2

    .line 8036
    .local v2, "mEntProvider":Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;
    if-eqz v2, :cond_24

    if-eqz p4, :cond_24

    .line 8037
    new-instance v3, Ljava/util/HashMap;

    invoke-direct {v3}, Ljava/util/HashMap;-><init>()V

    .line 8038
    .local v3, "packageUidMappings":Ljava/util/Map;, "Ljava/util/Map<Ljava/lang/Integer;Ljava/lang/String;>;"
    invoke-static {p3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v4

    invoke-interface {v3, v4, p4}, Ljava/util/Map;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;

    .line 8039
    invoke-virtual {v2, p1, v3}, Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;->addUIDListToExceptionList(Ljava/lang/String;Ljava/util/Map;)I
    :try_end_24
    .catch Ljava/lang/Exception; {:try_start_7 .. :try_end_24} :catch_2a
    .catchall {:try_start_7 .. :try_end_24} :catchall_28

    .line 8045
    .end local v2    # "mEntProvider":Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;
    .end local v3    # "packageUidMappings":Ljava/util/Map;, "Ljava/util/Map<Ljava/lang/Integer;Ljava/lang/String;>;"
    :cond_24
    :goto_24
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 8046
    goto :goto_4a

    .line 8045
    :catchall_28
    move-exception v2

    goto :goto_4b

    .line 8042
    :catch_2a
    move-exception v2

    .line 8043
    .local v2, "e":Ljava/lang/Exception;
    :try_start_2b
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_24

    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception at addUIDListToExceptionList API "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_49
    .catchall {:try_start_2b .. :try_end_49} :catchall_28

    goto :goto_24

    .line 8047
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_4a
    return-void

    .line 8045
    :goto_4b
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 8046
    throw v2
.end method

.method private addUidToExemptList(Ljava/lang/String;II)V
    .registers 12
    .param p1, "interfaceName"    # Ljava/lang/String;
    .param p2, "uidStart"    # I
    .param p3, "uidEnd"    # I

    .line 7395
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v1, "The following app added to the interface "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string/jumbo v1, "will not go through vpn since it was blacklisted "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    const-string v1, "KnoxVpnEngineService"

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7396
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getNetworkManagementService()Landroid/os/INetworkManagementService;

    move-result-object v0

    if-eqz v0, :cond_6e

    .line 7397
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v2

    .line 7399
    .local v2, "token":J
    const/4 v0, 0x3

    :try_start_2a
    invoke-virtual {p1, v0}, Ljava/lang/String;->substring(I)Ljava/lang/String;

    move-result-object v4

    invoke-static {v4}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I

    move-result v4

    .line 7400
    .local v4, "passedinterfaceID":I
    invoke-virtual {p1, v0}, Ljava/lang/String;->substring(I)Ljava/lang/String;

    move-result-object v0

    invoke-static {v0}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I

    move-result v0

    add-int/lit8 v0, v0, 0x65

    .line 7401
    .local v0, "netId":I
    new-instance v5, Ljava/util/ArrayList;

    invoke-direct {v5}, Ljava/util/ArrayList;-><init>()V

    .line 7402
    .local v5, "uidList":Ljava/util/List;, "Ljava/util/List<Landroid/net/UidRange;>;"
    new-instance v6, Landroid/net/UidRange;

    invoke-direct {v6, p2, p3}, Landroid/net/UidRange;-><init>(II)V

    invoke-interface {v5, v6}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 7403
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getNetworkManagementService()Landroid/os/INetworkManagementService;

    move-result-object v6

    invoke-interface {v5}, Ljava/util/List;->size()I

    move-result v7

    new-array v7, v7, [Landroid/net/UidRange;

    invoke-interface {v5, v7}, Ljava/util/List;->toArray([Ljava/lang/Object;)[Ljava/lang/Object;

    move-result-object v7

    check-cast v7, [Landroid/net/UidRange;

    invoke-interface {v6, v0, v7}, Landroid/os/INetworkManagementService;->addUidToExemptList(I[Landroid/net/UidRange;)V
    :try_end_5c
    .catch Ljava/lang/Exception; {:try_start_2a .. :try_end_5c} :catch_5f
    .catchall {:try_start_2a .. :try_end_5c} :catchall_5d

    .line 7408
    .end local v0    # "netId":I
    .end local v4    # "passedinterfaceID":I
    .end local v5    # "uidList":Ljava/util/List;, "Ljava/util/List<Landroid/net/UidRange;>;"
    goto :goto_66

    :catchall_5d
    move-exception v0

    goto :goto_6a

    .line 7404
    :catch_5f
    move-exception v0

    .line 7405
    .local v0, "e":Ljava/lang/Exception;
    :try_start_60
    const-string v4, "Exception occured while trying to add Uid From Vpn List "

    invoke-static {v1, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_65
    .catchall {:try_start_60 .. :try_end_65} :catchall_5d

    .line 7408
    nop

    .end local v0    # "e":Ljava/lang/Exception;
    :goto_66
    invoke-static {v2, v3}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7409
    goto :goto_6e

    .line 7408
    :goto_6a
    invoke-static {v2, v3}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7409
    throw v0

    .line 7411
    .end local v2    # "token":J
    :cond_6e
    :goto_6e
    return-void
.end method

.method private bindKnoxVpnInterface(Ljava/lang/String;I)Z
    .registers 22
    .param p1, "vendorNameWithCid"    # Ljava/lang/String;
    .param p2, "adminId"    # I

    .line 376
    move-object/from16 v1, p0

    move-object/from16 v2, p1

    move/from16 v3, p2

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Bind to Vpn Vendor Service : vendorName = "

    invoke-virtual {v0, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    const-string v4, "KnoxVpnEngineService"

    invoke-static {v4, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 378
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v5

    .line 379
    .local v5, "vendorName":Ljava/lang/String;
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v13

    .line 381
    .local v13, "containerId":I
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "bindKnoxVpnInterface is being called by the admin "

    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v4, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 383
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0, v13, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v14

    .line 384
    .local v14, "appId":I
    const/4 v15, 0x0

    if-gez v14, :cond_69

    .line 385
    const-string v0, "Bind to VPN Vendor is fail "

    invoke-static {v4, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 386
    const/4 v6, 0x3

    const/4 v7, 0x5

    const/4 v8, 0x0

    .line 387
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v9

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Bind to vpn failed. Could not find package "

    invoke-virtual {v0, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    .line 386
    const-string v10, "KnoxVpnEngineService"

    move v12, v13

    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 390
    return v15

    .line 393
    :cond_69
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v0, :cond_89

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "bindKnoxVpnInterface : user > "

    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v13}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v6, ", package name > "

    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v4, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 397
    :cond_89
    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVpnInterface(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v0

    if-eqz v0, :cond_94

    .line 398
    invoke-direct/range {p0 .. p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->sendBindSuccessIntent(Ljava/lang/String;I)V

    .line 399
    const/4 v0, 0x1

    return v0

    .line 403
    :cond_94
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnConnectionList:Ljava/util/HashMap;

    invoke-virtual {v0, v2}, Ljava/util/HashMap;->containsKey(Ljava/lang/Object;)Z

    move-result v0

    if-eqz v0, :cond_cb

    .line 404
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "unbinding previous service before binding again for the vpn client "

    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v4, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 406
    :try_start_b1
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnConnectionList:Ljava/util/HashMap;

    invoke-virtual {v6, v2}, Ljava/util/HashMap;->get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Landroid/content/ServiceConnection;

    invoke-virtual {v0, v6}, Landroid/content/Context;->unbindService(Landroid/content/ServiceConnection;)V
    :try_end_be
    .catch Ljava/lang/Exception; {:try_start_b1 .. :try_end_be} :catch_bf

    .line 409
    goto :goto_c6

    .line 407
    :catch_bf
    move-exception v0

    .line 408
    .local v0, "e":Ljava/lang/Exception;
    const-string/jumbo v6, "unbinding failed since the service is already unbinded or not existing"

    invoke-static {v4, v6}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 410
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_c6
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnConnectionList:Ljava/util/HashMap;

    invoke-virtual {v0, v2}, Ljava/util/HashMap;->remove(Ljava/lang/Object;)Ljava/lang/Object;

    .line 413
    :cond_cb
    const/4 v6, 0x0

    .line 414
    .local v6, "bindSuccess":Z
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v7, ".BIND_SERVICE_NEW"

    invoke-virtual {v0, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v12

    .line 415
    .local v12, "vendorAction":Ljava/lang/String;
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "Bind to Vpn Vendor Service : vendorAction = "

    invoke-virtual {v0, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v7, " container ID : "

    invoke-virtual {v0, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v13}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v4, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 416
    new-instance v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;

    invoke-direct {v0, v1, v13, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;-><init>(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;II)V

    move-object v11, v0

    .line 417
    .local v11, "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v16

    .line 419
    .local v16, "token":J
    :try_start_103
    new-instance v0, Landroid/content/Intent;

    invoke-direct {v0, v12}, Landroid/content/Intent;-><init>(Ljava/lang/String;)V

    .line 420
    .local v0, "intent":Landroid/content/Intent;
    iget-object v7, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v7}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;

    move-result-object v7

    .line 421
    .local v7, "pm":Landroid/content/pm/PackageManager;
    invoke-virtual {v7, v0, v15, v13}, Landroid/content/pm/PackageManager;->queryIntentServicesAsUser(Landroid/content/Intent;II)Ljava/util/List;

    move-result-object v8

    .line 422
    .local v8, "vendorServices":Ljava/util/List;, "Ljava/util/List<Landroid/content/pm/ResolveInfo;>;"
    invoke-interface {v8}, Ljava/util/List;->size()I

    move-result v9
    :try_end_116
    .catchall {:try_start_103 .. :try_end_116} :catchall_1e9

    if-lez v9, :cond_15d

    .line 423
    :try_start_118
    invoke-interface {v8}, Ljava/util/List;->iterator()Ljava/util/Iterator;

    move-result-object v9

    :goto_11c
    invoke-interface {v9}, Ljava/util/Iterator;->hasNext()Z

    move-result v10

    if-eqz v10, :cond_153

    invoke-interface {v9}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v10

    check-cast v10, Landroid/content/pm/ResolveInfo;

    .line 424
    .local v10, "resolveInfo":Landroid/content/pm/ResolveInfo;
    iget-object v15, v10, Landroid/content/pm/ResolveInfo;->serviceInfo:Landroid/content/pm/ServiceInfo;

    iget-object v15, v15, Landroid/content/pm/ServiceInfo;->packageName:Ljava/lang/String;

    invoke-virtual {v15, v5}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v15

    if-eqz v15, :cond_14c

    .line 425
    new-instance v15, Landroid/content/ComponentName;

    iget-object v3, v10, Landroid/content/pm/ResolveInfo;->serviceInfo:Landroid/content/pm/ServiceInfo;

    iget-object v3, v3, Landroid/content/pm/ServiceInfo;->packageName:Ljava/lang/String;
    :try_end_138
    .catchall {:try_start_118 .. :try_end_138} :catchall_156

    move/from16 v18, v6

    .end local v6    # "bindSuccess":Z
    .local v18, "bindSuccess":Z
    :try_start_13a
    iget-object v6, v10, Landroid/content/pm/ResolveInfo;->serviceInfo:Landroid/content/pm/ServiceInfo;

    iget-object v6, v6, Landroid/content/pm/ServiceInfo;->name:Ljava/lang/String;

    invoke-direct {v15, v3, v6}, Landroid/content/ComponentName;-><init>(Ljava/lang/String;Ljava/lang/String;)V

    invoke-virtual {v0, v15}, Landroid/content/Intent;->setComponent(Landroid/content/ComponentName;)Landroid/content/Intent;
    :try_end_144
    .catchall {:try_start_13a .. :try_end_144} :catchall_145

    goto :goto_14e

    .line 439
    .end local v0    # "intent":Landroid/content/Intent;
    .end local v7    # "pm":Landroid/content/pm/PackageManager;
    .end local v8    # "vendorServices":Ljava/util/List;, "Ljava/util/List<Landroid/content/pm/ResolveInfo;>;"
    .end local v10    # "resolveInfo":Landroid/content/pm/ResolveInfo;
    :catchall_145
    move-exception v0

    move-object v4, v11

    move-object v15, v12

    move/from16 v6, v18

    goto/16 :goto_1ee

    .line 424
    .end local v18    # "bindSuccess":Z
    .restart local v0    # "intent":Landroid/content/Intent;
    .restart local v6    # "bindSuccess":Z
    .restart local v7    # "pm":Landroid/content/pm/PackageManager;
    .restart local v8    # "vendorServices":Ljava/util/List;, "Ljava/util/List<Landroid/content/pm/ResolveInfo;>;"
    .restart local v10    # "resolveInfo":Landroid/content/pm/ResolveInfo;
    :cond_14c
    move/from16 v18, v6

    .line 430
    .end local v6    # "bindSuccess":Z
    .end local v10    # "resolveInfo":Landroid/content/pm/ResolveInfo;
    .restart local v18    # "bindSuccess":Z
    :goto_14e
    move/from16 v3, p2

    move/from16 v6, v18

    goto :goto_11c

    .line 423
    .end local v18    # "bindSuccess":Z
    .restart local v6    # "bindSuccess":Z
    :cond_153
    move/from16 v18, v6

    .end local v6    # "bindSuccess":Z
    .restart local v18    # "bindSuccess":Z
    goto :goto_15f

    .line 439
    .end local v0    # "intent":Landroid/content/Intent;
    .end local v7    # "pm":Landroid/content/pm/PackageManager;
    .end local v8    # "vendorServices":Ljava/util/List;, "Ljava/util/List<Landroid/content/pm/ResolveInfo;>;"
    .end local v18    # "bindSuccess":Z
    .restart local v6    # "bindSuccess":Z
    :catchall_156
    move-exception v0

    move/from16 v18, v6

    move-object v4, v11

    move-object v15, v12

    .end local v6    # "bindSuccess":Z
    .restart local v18    # "bindSuccess":Z
    goto/16 :goto_1ee

    .line 422
    .end local v18    # "bindSuccess":Z
    .restart local v0    # "intent":Landroid/content/Intent;
    .restart local v6    # "bindSuccess":Z
    .restart local v7    # "pm":Landroid/content/pm/PackageManager;
    .restart local v8    # "vendorServices":Ljava/util/List;, "Ljava/util/List<Landroid/content/pm/ResolveInfo;>;"
    :cond_15d
    move/from16 v18, v6

    .line 432
    .end local v6    # "bindSuccess":Z
    .restart local v18    # "bindSuccess":Z
    :goto_15f
    :try_start_15f
    invoke-virtual {v0, v5}, Landroid/content/Intent;->setPackage(Ljava/lang/String;)Landroid/content/Intent;

    .line 434
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    const v6, 0x5000001

    new-instance v9, Landroid/os/UserHandle;

    invoke-direct {v9, v13}, Landroid/os/UserHandle;-><init>(I)V

    invoke-virtual {v3, v0, v11, v6, v9}, Landroid/content/Context;->bindServiceAsUser(Landroid/content/Intent;Landroid/content/ServiceConnection;ILandroid/os/UserHandle;)Z

    move-result v3
    :try_end_170
    .catchall {:try_start_15f .. :try_end_170} :catchall_1e3

    .line 436
    .end local v18    # "bindSuccess":Z
    .local v3, "bindSuccess":Z
    if-eqz v3, :cond_17e

    .line 437
    :try_start_172
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnConnectionList:Ljava/util/HashMap;

    invoke-virtual {v6, v2, v11}, Ljava/util/HashMap;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
    :try_end_177
    .catchall {:try_start_172 .. :try_end_177} :catchall_178

    goto :goto_17e

    .line 439
    .end local v0    # "intent":Landroid/content/Intent;
    .end local v7    # "pm":Landroid/content/pm/PackageManager;
    .end local v8    # "vendorServices":Ljava/util/List;, "Ljava/util/List<Landroid/content/pm/ResolveInfo;>;"
    :catchall_178
    move-exception v0

    move v6, v3

    move-object v4, v11

    move-object v15, v12

    goto/16 :goto_1ee

    :cond_17e
    :goto_17e
    invoke-static/range {v16 .. v17}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 440
    nop

    .line 441
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Bind to Vpn Vendor Service : bindSuccess = "

    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v3}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v4, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 442
    const-string v0, "Bind to vpn vendor service "

    if-eqz v3, :cond_1bf

    .line 443
    const/4 v6, 0x5

    const/4 v7, 0x5

    const/4 v8, 0x1

    .line 444
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v9

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v0, " successfully"

    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    .line 443
    const-string v10, "KnoxVpnEngineService"

    move-object v4, v11

    .end local v11    # "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    .local v4, "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    move-object v11, v0

    move-object v15, v12

    .end local v12    # "vendorAction":Ljava/lang/String;
    .local v15, "vendorAction":Ljava/lang/String;
    move v12, v13

    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    goto :goto_1e2

    .line 448
    .end local v4    # "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    .end local v15    # "vendorAction":Ljava/lang/String;
    .restart local v11    # "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    .restart local v12    # "vendorAction":Ljava/lang/String;
    :cond_1bf
    move-object v4, v11

    move-object v15, v12

    .end local v11    # "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    .end local v12    # "vendorAction":Ljava/lang/String;
    .restart local v4    # "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    .restart local v15    # "vendorAction":Ljava/lang/String;
    const/4 v6, 0x3

    const/4 v7, 0x5

    const/4 v8, 0x0

    .line 449
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v9

    new-instance v10, Ljava/lang/StringBuilder;

    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v10, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v0, " failed"

    invoke-virtual {v10, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    .line 448
    const-string v10, "KnoxVpnEngineService"

    move v12, v13

    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 453
    :goto_1e2
    return v3

    .line 439
    .end local v3    # "bindSuccess":Z
    .end local v4    # "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    .end local v15    # "vendorAction":Ljava/lang/String;
    .restart local v11    # "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    .restart local v12    # "vendorAction":Ljava/lang/String;
    .restart local v18    # "bindSuccess":Z
    :catchall_1e3
    move-exception v0

    move-object v4, v11

    move-object v15, v12

    move/from16 v6, v18

    .end local v11    # "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    .end local v12    # "vendorAction":Ljava/lang/String;
    .restart local v4    # "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    .restart local v15    # "vendorAction":Ljava/lang/String;
    goto :goto_1ee

    .end local v4    # "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    .end local v15    # "vendorAction":Ljava/lang/String;
    .end local v18    # "bindSuccess":Z
    .restart local v6    # "bindSuccess":Z
    .restart local v11    # "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    .restart local v12    # "vendorAction":Ljava/lang/String;
    :catchall_1e9
    move-exception v0

    move/from16 v18, v6

    move-object v4, v11

    move-object v15, v12

    .end local v11    # "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    .end local v12    # "vendorAction":Ljava/lang/String;
    .restart local v4    # "vpnConnect":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnServiceConnection;
    .restart local v15    # "vendorAction":Ljava/lang/String;
    :goto_1ee
    invoke-static/range {v16 .. v17}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 440
    throw v0
.end method

.method private blockIncomingICMPPackets(Z)V
    .registers 6
    .param p1, "block"    # Z

    .line 9005
    const/4 v0, 0x0

    .line 9007
    .local v0, "activeInterfaceName":Ljava/lang/String;
    :try_start_1
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v1

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getActiveLinkProperty()Landroid/net/LinkProperties;

    move-result-object v1

    .line 9008
    .local v1, "activeLinkProperties":Landroid/net/LinkProperties;
    if-eqz v1, :cond_15

    .line 9009
    invoke-virtual {v1}, Landroid/net/LinkProperties;->getInterfaceName()Ljava/lang/String;

    move-result-object v2

    move-object v0, v2

    .line 9010
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v2, p1, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->blockIncomingICMPPackets(ZLjava/lang/String;)V
    :try_end_15
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_15} :catch_16

    .line 9014
    .end local v1    # "activeLinkProperties":Landroid/net/LinkProperties;
    :cond_15
    goto :goto_1e

    .line 9012
    :catch_16
    move-exception v1

    .line 9013
    .local v1, "e":Ljava/lang/Exception;
    const-string v2, "KnoxVpnEngineService"

    const-string v3, "Exception occured while trying to apply icmp firewall rules for user 0"

    invoke-static {v2, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 9015
    .end local v1    # "e":Ljava/lang/Exception;
    :goto_1e
    return-void
.end method

.method private checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;
    .registers 6
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;

    .line 7464
    new-instance v0, Ljava/util/ArrayList;

    const-string v1, "com.samsung.android.knox.permission.KNOX_VPN_GENERIC"

    filled-new-array {v1}, [Ljava/lang/String;

    move-result-object v1

    invoke-static {v1}, Ljava/util/Arrays;->asList([Ljava/lang/Object;)Ljava/util/List;

    move-result-object v1

    invoke-direct {v0, v1}, Ljava/util/ArrayList;-><init>(Ljava/util/Collection;)V

    .line 7466
    .local v0, "permissions":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    new-instance v1, Lcom/samsung/android/knox/ContextInfo;

    iget v2, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->adminId:I

    iget v3, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-direct {v1, v2, v3}, Lcom/samsung/android/knox/ContextInfo;-><init>(II)V

    .line 7467
    .local v1, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getEnterpriseDeviceManager()Lcom/samsung/android/knox/EnterpriseDeviceManager;

    move-result-object v2

    invoke-virtual {v2, v1, v0}, Lcom/samsung/android/knox/EnterpriseDeviceManager;->enforceActiveAdminPermissionByContext(Lcom/samsung/android/knox/ContextInfo;Ljava/util/List;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v2

    return-object v2
.end method

.method private checkExistsEmailPackageInProfiles(ILjava/util/HashMap;Ljava/util/HashSet;)V
    .registers 22
    .param p1, "action"    # I
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(I",
            "Ljava/util/HashMap<",
            "Ljava/lang/Integer;",
            "Ljava/lang/Boolean;",
            ">;",
            "Ljava/util/HashSet<",
            "Ljava/lang/Integer;",
            ">;)V"
        }
    .end annotation

    .line 8293
    .local p2, "uidList":Ljava/util/HashMap;, "Ljava/util/HashMap<Ljava/lang/Integer;Ljava/lang/Boolean;>;"
    .local p3, "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    move-object/from16 v0, p0

    new-instance v1, Ljava/util/ArrayList;

    invoke-direct {v1}, Ljava/util/ArrayList;-><init>()V

    .line 8294
    .local v1, "addAllList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/Integer;>;"
    new-instance v2, Ljava/util/HashMap;

    invoke-direct {v2}, Ljava/util/HashMap;-><init>()V

    .line 8295
    .local v2, "packageList":Ljava/util/HashMap;, "Ljava/util/HashMap<Ljava/lang/Integer;Ljava/lang/String;>;"
    rem-int/lit8 v3, p1, 0x2

    const/4 v5, 0x1

    if-nez v3, :cond_13

    const/4 v3, 0x0

    goto :goto_14

    :cond_13
    move v3, v5

    .line 8298
    .local v3, "isAddOrDel":Z
    :goto_14
    iget-object v6, v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v6

    invoke-interface {v6}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v6

    :goto_1e
    invoke-interface {v6}, Ljava/util/Iterator;->hasNext()Z

    move-result v7

    const-string v8, "KnoxVpnEngineService"

    if-eqz v7, :cond_101

    invoke-interface {v6}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v7

    check-cast v7, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 8299
    .local v7, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v7, :cond_fb

    .line 8300
    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v9

    invoke-interface {v9}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v9

    :goto_36
    invoke-interface {v9}, Ljava/util/Iterator;->hasNext()Z

    move-result v10

    if-eqz v10, :cond_f9

    invoke-interface {v9}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v10

    check-cast v10, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 8302
    .local v10, "p":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v11

    const/4 v12, -0x2

    if-ne v11, v12, :cond_ce

    .line 8303
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v11

    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v12

    invoke-virtual {v11, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v11

    .line 8305
    .local v11, "containerId":I
    const/4 v12, 0x0

    .line 8306
    .local v12, "isExempted":Z
    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v13

    if-ne v13, v5, :cond_c4

    .line 8307
    invoke-virtual/range {p3 .. p3}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v13

    :goto_60
    invoke-interface {v13}, Ljava/util/Iterator;->hasNext()Z

    move-result v14

    if-eqz v14, :cond_b6

    invoke-interface {v13}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v14

    check-cast v14, Ljava/lang/Integer;

    invoke-virtual {v14}, Ljava/lang/Integer;->intValue()I

    move-result v14

    .line 8308
    .local v14, "exemptedUid":I
    iget-object v15, v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v15}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;

    move-result-object v15

    invoke-virtual {v15, v14}, Landroid/content/pm/PackageManager;->getPackagesForUid(I)[Ljava/lang/String;

    move-result-object v15

    .line 8309
    .local v15, "exemptedPackages":[Ljava/lang/String;
    if-nez v15, :cond_7d

    .line 8310
    goto :goto_60

    .line 8311
    :cond_7d
    array-length v5, v15

    const/4 v4, 0x0

    :goto_7f
    if-ge v4, v5, :cond_af

    aget-object v0, v15, v4

    .line 8312
    .local v0, "exemptedPackage":Ljava/lang/String;
    sget-object v16, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->EMAIL_PACKAGE_LIST:[Ljava/lang/String;

    move/from16 v17, v5

    invoke-static/range {v16 .. v16}, Ljava/util/Arrays;->asList([Ljava/lang/Object;)Ljava/util/List;

    move-result-object v5

    invoke-interface {v5, v0}, Ljava/util/List;->contains(Ljava/lang/Object;)Z

    move-result v5

    if-eqz v5, :cond_a8

    .line 8313
    const/4 v4, 0x1

    .line 8314
    .end local v12    # "isExempted":Z
    .local v4, "isExempted":Z
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v12, "checkExistsEmailPackageInProfiles :: Email package is matched but exempted: "

    invoke-virtual {v5, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v8, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8315
    move v12, v4

    goto :goto_af

    .line 8311
    .end local v0    # "exemptedPackage":Ljava/lang/String;
    .end local v4    # "isExempted":Z
    .restart local v12    # "isExempted":Z
    :cond_a8
    add-int/lit8 v4, v4, 0x1

    move-object/from16 v0, p0

    move/from16 v5, v17

    goto :goto_7f

    .line 8318
    :cond_af
    :goto_af
    if-eqz v12, :cond_b2

    .line 8319
    goto :goto_b6

    .line 8320
    .end local v14    # "exemptedUid":I
    .end local v15    # "exemptedPackages":[Ljava/lang/String;
    :cond_b2
    const/4 v5, 0x1

    move-object/from16 v0, p0

    goto :goto_60

    .line 8321
    :cond_b6
    :goto_b6
    if-eqz v12, :cond_bd

    .line 8322
    const/4 v5, 0x1

    move-object/from16 v0, p0

    goto/16 :goto_36

    .line 8324
    :cond_bd
    invoke-static {v11}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v1, v0}, Ljava/util/ArrayList;->add(Ljava/lang/Object;)Z

    .line 8327
    :cond_c4
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v0

    const/4 v4, 0x0

    invoke-virtual {v0, v11, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->setProxyFlagForEmail(IZ)V

    .line 8328
    .end local v11    # "containerId":I
    .end local v12    # "isExempted":Z
    const/4 v5, 0x0

    goto :goto_f4

    .line 8330
    :cond_ce
    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v0

    const/4 v4, 0x1

    if-ne v0, v4, :cond_e4

    .line 8331
    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v0

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v2, v0, v4}, Ljava/util/HashMap;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;

    .line 8334
    :cond_e4
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v0

    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v4

    invoke-static {v4}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v4

    const/4 v5, 0x0

    invoke-virtual {v0, v4, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->setProxyFlagForEmail(IZ)V

    .line 8336
    .end local v10    # "p":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :goto_f4
    const/4 v5, 0x1

    move-object/from16 v0, p0

    goto/16 :goto_36

    .line 8300
    :cond_f9
    const/4 v5, 0x0

    goto :goto_fc

    .line 8299
    :cond_fb
    const/4 v5, 0x0

    .line 8338
    .end local v7    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :goto_fc
    const/4 v5, 0x1

    move-object/from16 v0, p0

    goto/16 :goto_1e

    .line 8341
    :cond_101
    if-nez v3, :cond_151

    .line 8342
    invoke-virtual/range {p2 .. p2}, Ljava/util/HashMap;->keySet()Ljava/util/Set;

    move-result-object v0

    invoke-interface {v0}, Ljava/util/Set;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_10b
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_14e

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Ljava/lang/Integer;

    invoke-virtual {v4}, Ljava/lang/Integer;->intValue()I

    move-result v4

    .line 8343
    .local v4, "uid":I
    invoke-static {v4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v5

    invoke-virtual {v2, v5}, Ljava/util/HashMap;->remove(Ljava/lang/Object;)Ljava/lang/Object;

    .line 8344
    invoke-static {v4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v5

    move-object/from16 v6, p2

    invoke-virtual {v6, v5}, Ljava/util/HashMap;->get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Ljava/lang/Boolean;

    invoke-virtual {v5}, Ljava/lang/Boolean;->booleanValue()Z

    move-result v5

    if-eqz v5, :cond_14d

    .line 8345
    const/4 v5, 0x0

    .local v5, "i":I
    :goto_135
    invoke-virtual {v1}, Ljava/util/ArrayList;->size()I

    move-result v7

    if-ge v5, v7, :cond_14d

    .line 8346
    invoke-virtual {v1, v5}, Ljava/util/ArrayList;->get(I)Ljava/lang/Object;

    move-result-object v7

    check-cast v7, Ljava/lang/Integer;

    invoke-virtual {v7}, Ljava/lang/Integer;->intValue()I

    move-result v7

    if-ne v7, v4, :cond_14a

    .line 8347
    invoke-virtual {v1, v5}, Ljava/util/ArrayList;->remove(I)Ljava/lang/Object;

    .line 8345
    :cond_14a
    add-int/lit8 v5, v5, 0x1

    goto :goto_135

    .line 8351
    .end local v4    # "uid":I
    .end local v5    # "i":I
    :cond_14d
    goto :goto_10b

    .line 8342
    :cond_14e
    move-object/from16 v6, p2

    goto :goto_153

    .line 8341
    :cond_151
    move-object/from16 v6, p2

    .line 8356
    :goto_153
    const/4 v0, 0x0

    .local v0, "i":I
    :goto_154
    invoke-virtual {v1}, Ljava/util/ArrayList;->size()I

    move-result v4

    if-ge v0, v4, :cond_16f

    .line 8357
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v4

    invoke-virtual {v1, v0}, Ljava/util/ArrayList;->get(I)Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Ljava/lang/Integer;

    invoke-virtual {v5}, Ljava/lang/Integer;->intValue()I

    move-result v5

    const/4 v7, 0x1

    invoke-virtual {v4, v5, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->setProxyFlagForEmail(IZ)V

    .line 8356
    add-int/lit8 v0, v0, 0x1

    goto :goto_154

    .line 8361
    .end local v0    # "i":I
    :cond_16f
    invoke-virtual {v2}, Ljava/util/HashMap;->keySet()Ljava/util/Set;

    move-result-object v0

    invoke-interface {v0}, Ljava/util/Set;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_177
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_1d2

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Ljava/lang/Integer;

    invoke-virtual {v4}, Ljava/lang/Integer;->intValue()I

    move-result v4

    .line 8363
    .restart local v4    # "uid":I
    sget-object v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->EMAIL_PACKAGE_LIST:[Ljava/lang/String;

    invoke-static {v5}, Ljava/util/Arrays;->asList([Ljava/lang/Object;)Ljava/util/List;

    move-result-object v5

    .line 8364
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v7

    invoke-static {v4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v9

    invoke-virtual {v2, v9}, Ljava/util/HashMap;->get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v9

    check-cast v9, Ljava/lang/String;

    invoke-virtual {v7, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v7

    .line 8363
    invoke-interface {v5, v7}, Ljava/util/List;->contains(Ljava/lang/Object;)Z

    move-result v5

    if-eqz v5, :cond_1d0

    .line 8365
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "checkExistsEmailPackageInProfiles :: Email package is matched : "

    invoke-virtual {v5, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-virtual {v2, v7}, Ljava/util/HashMap;->get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v7

    check-cast v7, Ljava/lang/String;

    invoke-virtual {v5, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v8, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8366
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v5

    invoke-static {v4}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v7

    const/4 v9, 0x1

    invoke-virtual {v5, v7, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->setProxyFlagForEmail(IZ)V

    goto :goto_1d1

    .line 8363
    :cond_1d0
    const/4 v9, 0x1

    .line 8368
    .end local v4    # "uid":I
    :goto_1d1
    goto :goto_177

    .line 8369
    :cond_1d2
    return-void
.end method

.method private checkIfLegacyUser(I)Z
    .registers 5
    .param p1, "userId"    # I

    .line 7471
    const/4 v0, 0x0

    .line 7473
    .local v0, "isLegacyUser":Z
    :try_start_1
    invoke-static {p1}, Lcom/android/server/enterprise/adapterlayer/PersonaManagerAdapter;->isValidKnoxId(I)Z

    move-result v1

    if-eqz v1, :cond_e

    .line 7474
    invoke-static {p1}, Lcom/android/server/enterprise/adapterlayer/PersonaManagerAdapter;->isLegacyContainer(I)Z

    move-result v1
    :try_end_b
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_b} :catch_f

    if-eqz v1, :cond_e

    .line 7475
    const/4 v0, 0x1

    .line 7480
    :cond_e
    goto :goto_10

    .line 7478
    :catch_f
    move-exception v1

    .line 7481
    :goto_10
    sget-boolean v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v1, :cond_32

    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string v2, "check to see userId type "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v2, " "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, v0}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    const-string v2, "KnoxVpnEngineService"

    invoke-static {v2, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7482
    :cond_32
    return v0
.end method

.method private checkIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Z
    .registers 7
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;

    .line 7511
    iget-object v0, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->vendorName:Ljava/lang/String;

    const-string v1, "com.android.settings"

    invoke-virtual {v1, v0}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v0

    const/4 v1, 0x1

    if-eqz v0, :cond_35

    .line 7512
    new-instance v0, Ljava/lang/Throwable;

    invoke-direct {v0}, Ljava/lang/Throwable;-><init>()V

    invoke-virtual {v0}, Ljava/lang/Throwable;->getStackTrace()[Ljava/lang/StackTraceElement;

    move-result-object v0

    .line 7513
    .local v0, "parentMethods":[Ljava/lang/StackTraceElement;
    const-string v2, "KnoxVpnEngineService"

    if-eqz v0, :cond_2e

    array-length v3, v0

    const/4 v4, 0x2

    if-le v3, v4, :cond_2e

    .line 7516
    aget-object v3, v0, v4

    invoke-virtual {v3}, Ljava/lang/StackTraceElement;->getMethodName()Ljava/lang/String;

    move-result-object v3

    .line 7517
    .local v3, "parentMethod":Ljava/lang/String;
    invoke-direct {p0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->isMethodAllowedForVendorSettings(Ljava/lang/String;)Z

    move-result v4

    if-eqz v4, :cond_2e

    .line 7518
    const-string v4, "checkIfVendorAllowed: settings vendor allowed"

    invoke-static {v2, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7519
    return v1

    .line 7522
    .end local v3    # "parentMethod":Ljava/lang/String;
    :cond_2e
    const-string v1, "checkIfVendorAllowed: settings vendor not allowed"

    invoke-static {v2, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7523
    const/4 v1, 0x0

    return v1

    .line 7525
    .end local v0    # "parentMethods":[Ljava/lang/StackTraceElement;
    :cond_35
    return v1
.end method

.method private checkToUpdateDb()V
    .registers 19

    .line 5659
    move-object/from16 v1, p0

    const-string/jumbo v0, "profileCount"

    const-string/jumbo v2, "profileName"

    const-string v3, "VpnProfileInfo"

    const-string v4, "KnoxVpnEngineService"

    const-string v5, "checkToUpdateDb"

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5661
    const/4 v5, 0x0

    .line 5662
    .local v5, "profileName":Ljava/lang/String;
    :try_start_12
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getProfileId()I

    move-result v6

    .line 5663
    .local v6, "profileId":I
    iget-object v7, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const/4 v8, 0x0

    invoke-virtual {v7, v3, v8, v8, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v7

    .line 5665
    .local v7, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    if-nez v6, :cond_89

    if-eqz v7, :cond_89

    invoke-virtual {v7}, Ljava/util/ArrayList;->size()I

    move-result v8

    if-lez v8, :cond_89

    .line 5666
    invoke-virtual {v7}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v8

    :goto_2d
    invoke-interface {v8}, Ljava/util/Iterator;->hasNext()Z

    move-result v9

    if-eqz v9, :cond_89

    invoke-interface {v8}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v9

    check-cast v9, Landroid/content/ContentValues;

    .line 5667
    .local v9, "cv":Landroid/content/ContentValues;
    invoke-virtual {v9, v2}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v10

    move-object v5, v10

    .line 5668
    if-eqz v5, :cond_80

    .line 5669
    filled-new-array {v2}, [Ljava/lang/String;

    move-result-object v10

    .line 5670
    .local v10, "columns":[Ljava/lang/String;
    const/4 v11, 0x1

    new-array v12, v11, [Ljava/lang/String;

    const/4 v13, 0x0

    aput-object v5, v12, v13

    .line 5671
    .local v12, "values":[Ljava/lang/String;
    const-string/jumbo v14, "profileId"

    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v15

    invoke-virtual {v9, v14, v15}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Integer;)V

    .line 5672
    iget-object v14, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    invoke-virtual {v14, v3, v10, v12, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->putDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;Landroid/content/ContentValues;)Z

    move-result v14

    .line 5675
    .local v14, "status":Z
    filled-new-array {v0}, [Ljava/lang/String;

    move-result-object v15

    .line 5676
    .local v15, "columns2":[Ljava/lang/String;
    new-array v11, v11, [Ljava/lang/String;

    invoke-static {v6}, Ljava/lang/String;->valueOf(I)Ljava/lang/String;

    move-result-object v16

    aput-object v16, v11, v13

    .line 5678
    .local v11, "values2":[Ljava/lang/String;
    add-int/lit8 v6, v6, 0x1

    .line 5679
    new-instance v13, Landroid/content/ContentValues;

    invoke-direct {v13}, Landroid/content/ContentValues;-><init>()V

    .line 5680
    .local v13, "cv2":Landroid/content/ContentValues;
    move-object/from16 v16, v2

    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v13, v0, v2}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Integer;)V

    .line 5681
    iget-object v2, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    move-object/from16 v17, v0

    const-string v0, "VpnAnalyticsTable"

    invoke-virtual {v2, v0, v15, v11, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->putDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;Landroid/content/ContentValues;)Z
    :try_end_7f
    .catch Ljava/lang/Exception; {:try_start_12 .. :try_end_7f} :catch_8a

    goto :goto_84

    .line 5668
    .end local v10    # "columns":[Ljava/lang/String;
    .end local v11    # "values2":[Ljava/lang/String;
    .end local v12    # "values":[Ljava/lang/String;
    .end local v13    # "cv2":Landroid/content/ContentValues;
    .end local v14    # "status":Z
    .end local v15    # "columns2":[Ljava/lang/String;
    :cond_80
    move-object/from16 v17, v0

    move-object/from16 v16, v2

    .line 5683
    .end local v9    # "cv":Landroid/content/ContentValues;
    :goto_84
    move-object/from16 v2, v16

    move-object/from16 v0, v17

    goto :goto_2d

    .line 5687
    .end local v5    # "profileName":Ljava/lang/String;
    .end local v6    # "profileId":I
    .end local v7    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    :cond_89
    goto :goto_a3

    .line 5685
    :catch_8a
    move-exception v0

    .line 5686
    .local v0, "e":Ljava/lang/Exception;
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "exception - "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v4, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 5688
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_a3
    return-void
.end method

.method private createProcessKillNotification(Ljava/lang/String;)V
    .registers 11
    .param p1, "profileName"    # Ljava/lang/String;

    .line 8606
    :try_start_0
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    const v1, 0x10405c5

    invoke-virtual {v0, v1}, Landroid/content/Context;->getString(I)Ljava/lang/String;

    move-result-object v0

    .line 8607
    .local v0, "title":Ljava/lang/String;
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    const v2, 0x10405c4

    invoke-virtual {v1, v2}, Landroid/content/Context;->getString(I)Ljava/lang/String;

    move-result-object v1

    .line 8608
    .local v1, "text":Ljava/lang/String;
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 8609
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v2, :cond_6b

    .line 8610
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v3

    invoke-static {v3}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v3

    .line 8611
    .local v3, "showNotificationAtUser":I
    new-instance v4, Landroid/app/Notification$Builder;

    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    sget-object v6, Lcom/android/internal/notification/SystemNotificationChannels;->VPN:Ljava/lang/String;

    invoke-direct {v4, v5, v6}, Landroid/app/Notification$Builder;-><init>(Landroid/content/Context;Ljava/lang/String;)V

    const v5, 0x1080027

    .line 8612
    invoke-virtual {v4, v5}, Landroid/app/Notification$Builder;->setSmallIcon(I)Landroid/app/Notification$Builder;

    move-result-object v4

    .line 8613
    invoke-virtual {v4, v0}, Landroid/app/Notification$Builder;->setContentTitle(Ljava/lang/CharSequence;)Landroid/app/Notification$Builder;

    move-result-object v4

    .line 8614
    invoke-virtual {v4, v1}, Landroid/app/Notification$Builder;->setContentText(Ljava/lang/CharSequence;)Landroid/app/Notification$Builder;

    move-result-object v4

    const/4 v5, 0x0

    .line 8615
    invoke-virtual {v4, v5}, Landroid/app/Notification$Builder;->setDefaults(I)Landroid/app/Notification$Builder;

    move-result-object v4

    const/4 v5, 0x2

    .line 8616
    invoke-virtual {v4, v5}, Landroid/app/Notification$Builder;->setPriority(I)Landroid/app/Notification$Builder;

    move-result-object v4

    const/4 v5, 0x1

    .line 8617
    invoke-virtual {v4, v5}, Landroid/app/Notification$Builder;->setAutoCancel(Z)Landroid/app/Notification$Builder;

    move-result-object v4

    new-instance v5, Landroid/app/Notification$BigTextStyle;

    invoke-direct {v5}, Landroid/app/Notification$BigTextStyle;-><init>()V

    .line 8618
    invoke-virtual {v5, v1}, Landroid/app/Notification$BigTextStyle;->bigText(Ljava/lang/CharSequence;)Landroid/app/Notification$BigTextStyle;

    move-result-object v5

    invoke-virtual {v4, v5}, Landroid/app/Notification$Builder;->setStyle(Landroid/app/Notification$Style;)Landroid/app/Notification$Builder;

    move-result-object v4

    .line 8619
    invoke-virtual {v4}, Landroid/app/Notification$Builder;->build()Landroid/app/Notification;

    move-result-object v4

    .line 8620
    .local v4, "notification":Landroid/app/Notification;
    invoke-virtual {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getNotificationManager()Landroid/app/NotificationManager;

    move-result-object v5

    const/4 v6, 0x0

    invoke-virtual {p1}, Ljava/lang/String;->hashCode()I

    move-result v7

    new-instance v8, Landroid/os/UserHandle;

    invoke-direct {v8, v3}, Landroid/os/UserHandle;-><init>(I)V

    invoke-virtual {v5, v6, v7, v4, v8}, Landroid/app/NotificationManager;->notifyAsUser(Ljava/lang/String;ILandroid/app/Notification;Landroid/os/UserHandle;)V
    :try_end_6b
    .catch Ljava/lang/Exception; {:try_start_0 .. :try_end_6b} :catch_6c

    .line 8624
    .end local v0    # "title":Ljava/lang/String;
    .end local v1    # "text":Ljava/lang/String;
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "showNotificationAtUser":I
    .end local v4    # "notification":Landroid/app/Notification;
    :cond_6b
    goto :goto_78

    .line 8622
    :catch_6c
    move-exception v0

    .line 8623
    .local v0, "e":Ljava/lang/Exception;
    sget-boolean v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v1, :cond_78

    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Exception occured while trying to create a notification to inform user about process restart "

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 8625
    .end local v0    # "e":Ljava/lang/Exception;
    :cond_78
    :goto_78
    return-void
.end method

.method private deleteUIDFromPackageData(Ljava/lang/String;)Z
    .registers 4
    .param p1, "packageName"    # Ljava/lang/String;

    .line 4806
    const-string v0, "KnoxVpnEngineService"

    const-string v1, "Inside deleteUIDFromPackageData"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4807
    const/4 v0, -0x1

    invoke-direct {p0, p1, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updatePackageData(Ljava/lang/String;I)Z

    move-result v0

    return v0
.end method

.method private getAMSInstance()Lcom/android/server/am/ActivityManagerService;
    .registers 2

    .line 519
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mAMS:Lcom/android/server/am/ActivityManagerService;

    if-nez v0, :cond_e

    .line 520
    const-string v0, "activity"

    invoke-static {v0}, Landroid/os/ServiceManager;->getService(Ljava/lang/String;)Landroid/os/IBinder;

    move-result-object v0

    check-cast v0, Lcom/android/server/am/ActivityManagerService;

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mAMS:Lcom/android/server/am/ActivityManagerService;

    .line 522
    :cond_e
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mAMS:Lcom/android/server/am/ActivityManagerService;

    return-object v0
.end method

.method private getActivate(Ljava/lang/String;)I
    .registers 6
    .param p1, "profileName"    # Ljava/lang/String;

    .line 7645
    const/4 v0, -0x1

    .line 7647
    .local v0, "temp":I
    :try_start_1
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v1

    .line 7648
    .local v1, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v1, :cond_b

    .line 7649
    const/4 v2, -0x1

    return v2

    .line 7651
    :cond_b
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v2
    :try_end_f
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_f} :catch_11

    move v0, v2

    .line 7655
    .end local v1    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    goto :goto_1a

    .line 7653
    :catch_11
    move-exception v1

    .line 7654
    .local v1, "e":Ljava/lang/Exception;
    const-string v2, "KnoxVpnEngineService"

    const-string/jumbo v3, "getActivate error"

    invoke-static {v2, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 7656
    .end local v1    # "e":Ljava/lang/Exception;
    :goto_1a
    return v0
.end method

.method private getActiveProfilesForVendor(Ljava/lang/String;)Ljava/util/List;
    .registers 12
    .param p1, "vendorName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Ljava/lang/String;",
            ")",
            "Ljava/util/List<",
            "Ljava/lang/String;",
            ">;"
        }
    .end annotation

    .line 3886
    const-string v0, "KnoxVpnEngineService"

    new-instance v1, Ljava/util/ArrayList;

    invoke-direct {v1}, Ljava/util/ArrayList;-><init>()V

    .line 3888
    .local v1, "activatedProfiles":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    if-eqz p1, :cond_73

    .line 3890
    :try_start_9
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v2

    invoke-interface {v2}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_13
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_73

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 3891
    .local v3, "p":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v4

    .line 3892
    .local v4, "vendorPkgName":Ljava/lang/String;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v5

    .line 3893
    .local v5, "activateState":I
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v6

    .line 3895
    .local v6, "persona_id":I
    invoke-virtual {v4, p1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v7

    if-eqz v7, :cond_58

    const/4 v7, 0x1

    if-ne v5, v7, :cond_58

    .line 3897
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->checkIfVpnProfileTableIsEmpty(Ljava/lang/String;)Z

    move-result v7

    if-nez v7, :cond_58

    .line 3898
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v7

    .line 3899
    .local v7, "profileName":Ljava/lang/String;
    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "profileName = "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v0, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3900
    invoke-interface {v1, v7}, Ljava/util/List;->add(Ljava/lang/Object;)Z
    :try_end_58
    .catch Ljava/lang/Exception; {:try_start_9 .. :try_end_58} :catch_59

    .line 3903
    .end local v3    # "p":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v4    # "vendorPkgName":Ljava/lang/String;
    .end local v5    # "activateState":I
    .end local v6    # "persona_id":I
    .end local v7    # "profileName":Ljava/lang/String;
    :cond_58
    goto :goto_13

    .line 3905
    :catch_59
    move-exception v2

    .line 3906
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Exception = "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_74

    .line 3907
    .end local v2    # "e":Ljava/lang/Exception;
    :cond_73
    nop

    .line 3908
    :goto_74
    return-object v1
.end method

.method private getAllPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 23
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "[",
            "Ljava/lang/String;",
            ">;"
        }
    .end annotation

    .line 2406
    move-object/from16 v1, p0

    move-object/from16 v2, p2

    const-string/jumbo v0, "packageName"

    const-string/jumbo v3, "packageUid"

    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    const-string v5, "KnoxVpnEngineService"

    if-eqz v4, :cond_25

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "get all packages : Profile : "

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v5, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2407
    :cond_25
    new-instance v4, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 2408
    .local v4, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<[Ljava/lang/String;>;"
    const/4 v6, 0x1

    const/4 v7, -0x1

    invoke-virtual {v4, v6, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 2409
    const/4 v8, 0x0

    invoke-virtual {v4, v8}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2411
    :try_start_33
    invoke-virtual/range {p1 .. p1}, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->getPersonaId()I

    move-result v8

    .line 2412
    .local v8, "containerId":I
    new-instance v9, Ljava/util/ArrayList;

    invoke-direct {v9}, Ljava/util/ArrayList;-><init>()V

    .line 2414
    .local v9, "packageList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    iget-object v10, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v11, "VpnPackageInfo"

    const-string/jumbo v12, "profileName"

    const-string/jumbo v13, "packageCid"

    filled-new-array {v12, v13}, [Ljava/lang/String;

    move-result-object v12

    const/4 v13, 0x2

    new-array v13, v13, [Ljava/lang/String;

    const/4 v14, 0x0

    aput-object v2, v13, v14

    .line 2420
    invoke-static {v8}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;

    move-result-object v15

    aput-object v15, v13, v6

    filled-new-array {v3, v0}, [Ljava/lang/String;

    move-result-object v6

    .line 2414
    invoke-virtual {v10, v11, v12, v13, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v6

    .line 2425
    .local v6, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    sget-boolean v10, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v10, :cond_65

    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->printProfileVpnMap()V

    .line 2427
    :cond_65
    if-eqz v6, :cond_12e

    invoke-virtual {v6}, Ljava/util/ArrayList;->size()I

    move-result v10

    if-lez v10, :cond_12e

    .line 2428
    invoke-virtual {v6}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v10

    :goto_71
    invoke-interface {v10}, Ljava/util/Iterator;->hasNext()Z

    move-result v11

    if-eqz v11, :cond_12e

    invoke-interface {v10}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v11

    check-cast v11, Landroid/content/ContentValues;

    .line 2429
    .local v11, "cv":Landroid/content/ContentValues;
    invoke-virtual {v11, v0}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v12

    .line 2430
    .local v12, "personifiedPackageName":Ljava/lang/String;
    new-instance v13, Ljava/lang/StringBuilder;

    invoke-direct {v13}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v15, "getAllPackages_personifiedPackageName::"

    invoke-virtual {v13, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v13

    invoke-static {v5, v13}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2431
    invoke-virtual {v11, v3}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v13

    invoke-virtual {v13}, Ljava/lang/Integer;->intValue()I

    move-result v13

    .line 2432
    .local v13, "uid":I
    new-instance v15, Ljava/lang/StringBuilder;

    invoke-direct {v15}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v14, "getAllPackages_uid::"

    invoke-virtual {v15, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v15, v13}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v15}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v14

    invoke-static {v5, v14}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2433
    iget-object v14, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v15, "ADD_ALL_PACKAGES"

    invoke-virtual {v14, v8, v15}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v14

    invoke-virtual {v12, v14}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v14

    if-eqz v14, :cond_c3

    .line 2434
    const/4 v14, 0x0

    goto :goto_71

    .line 2436
    :cond_c3
    if-ne v13, v7, :cond_d3

    .line 2437
    iget-object v14, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v14, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v14

    .line 2438
    .local v14, "regularPackageName":Ljava/lang/String;
    invoke-interface {v9, v14}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 2439
    move-object/from16 v16, v0

    move-object/from16 v17, v3

    .end local v14    # "regularPackageName":Ljava/lang/String;
    goto :goto_126

    .line 2440
    :cond_d3
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v14

    .line 2447
    .local v14, "blockToken":J
    iget-object v7, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v7}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;

    move-result-object v7

    invoke-virtual {v7, v13}, Landroid/content/pm/PackageManager;->getPackagesForUid(I)[Ljava/lang/String;

    move-result-object v7

    .line 2448
    .local v7, "packagesforUid":[Ljava/lang/String;
    move-object/from16 v16, v0

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    move-object/from16 v17, v3

    const-string/jumbo v3, "getAllPackages_packagesforUid[]::"

    invoke-virtual {v0, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v3}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;

    move-result-object v3

    invoke-virtual {v3, v13}, Landroid/content/pm/PackageManager;->getPackagesForUid(I)[Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v0, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    const-string v3, " uid::"

    invoke-virtual {v0, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v13}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v5, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2449
    invoke-static {v14, v15}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 2451
    if-eqz v7, :cond_126

    .line 2452
    array-length v0, v7

    const/4 v3, 0x0

    :goto_113
    if-ge v3, v0, :cond_126

    aget-object v18, v7, v3

    move-object/from16 v19, v18

    .line 2453
    .local v19, "pkg":Ljava/lang/String;
    move/from16 v18, v0

    move-object/from16 v0, v19

    .end local v19    # "pkg":Ljava/lang/String;
    .local v0, "pkg":Ljava/lang/String;
    invoke-interface {v9, v0}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 2452
    nop

    .end local v0    # "pkg":Ljava/lang/String;
    add-int/lit8 v3, v3, 0x1

    move/from16 v0, v18

    goto :goto_113

    .line 2457
    .end local v7    # "packagesforUid":[Ljava/lang/String;
    .end local v11    # "cv":Landroid/content/ContentValues;
    .end local v12    # "personifiedPackageName":Ljava/lang/String;
    .end local v13    # "uid":I
    .end local v14    # "blockToken":J
    :cond_126
    :goto_126
    move-object/from16 v0, v16

    move-object/from16 v3, v17

    const/4 v7, -0x1

    const/4 v14, 0x0

    goto/16 :goto_71

    .line 2460
    :cond_12e
    invoke-direct {v1, v2, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getPackageListNoInternetPermission(Ljava/lang/String;I)Ljava/util/List;

    move-result-object v0

    .line 2461
    .local v0, "packageListNoInternetPermission":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    invoke-interface {v0}, Ljava/util/List;->iterator()Ljava/util/Iterator;

    move-result-object v3

    :goto_136
    invoke-interface {v3}, Ljava/util/Iterator;->hasNext()Z

    move-result v7

    if-eqz v7, :cond_147

    invoke-interface {v3}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v7

    check-cast v7, Ljava/lang/String;

    .line 2462
    .local v7, "pkg":Ljava/lang/String;
    invoke-interface {v9, v7}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 2463
    nop

    .end local v7    # "pkg":Ljava/lang/String;
    goto :goto_136

    .line 2465
    :cond_147
    const/4 v3, 0x0

    new-array v7, v3, [Ljava/lang/String;

    invoke-interface {v9, v7}, Ljava/util/List;->toArray([Ljava/lang/Object;)[Ljava/lang/Object;

    move-result-object v3

    check-cast v3, [Ljava/lang/String;

    .line 2467
    .local v3, "finalPackageList":[Ljava/lang/String;
    invoke-virtual {v4, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2468
    const/4 v7, 0x0

    invoke-virtual {v4, v7, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_157
    .catch Ljava/lang/Exception; {:try_start_33 .. :try_end_157} :catch_158

    .line 2472
    .end local v0    # "packageListNoInternetPermission":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    .end local v3    # "finalPackageList":[Ljava/lang/String;
    .end local v6    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .end local v8    # "containerId":I
    .end local v9    # "packageList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    goto :goto_172

    .line 2470
    :catch_158
    move-exception v0

    .line 2471
    .local v0, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "get all packages : Exceptionin notify: "

    invoke-virtual {v3, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v3, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v5, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2473
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_172
    return-object v4
.end method

.method private getAllRangedPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 12
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "[",
            "Ljava/lang/String;",
            ">;"
        }
    .end annotation

    .line 2373
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    const-string v1, "KnoxVpnEngineService"

    if-eqz v0, :cond_1b

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "get all ranged packages : Profile : "

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2374
    :cond_1b
    new-instance v0, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 2375
    .local v0, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<[Ljava/lang/String;>;"
    const/4 v2, 0x1

    const/4 v3, -0x1

    invoke-virtual {v0, v2, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 2376
    const/4 v2, 0x0

    invoke-virtual {v0, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2379
    :try_start_29
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 2380
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    const/4 v3, -0x1

    .line 2381
    .local v3, "containerId":I
    if-eqz v2, :cond_88

    .line 2382
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v4

    invoke-interface {v4}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v4

    :goto_3a
    invoke-interface {v4}, Ljava/util/Iterator;->hasNext()Z

    move-result v5

    if-eqz v5, :cond_88

    invoke-interface {v4}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 2383
    .local v5, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v6, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v6

    if-eqz v6, :cond_87

    .line 2384
    const/4 v6, 0x1

    .line 2385
    .local v6, "isAddallExist":Z
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v8

    invoke-virtual {v7, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v7

    move v3, v7

    .line 2386
    sget-boolean v7, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v7, :cond_73

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "get all ranged packages : containerId "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v1, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2387
    :cond_73
    if-eqz v6, :cond_87

    iget v7, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    if-ne v3, v7, :cond_87

    .line 2388
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4, p2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUserPackageListForProfile(Ljava/lang/String;I)[Ljava/lang/String;

    move-result-object v4

    .line 2389
    .local v4, "packageList":[Ljava/lang/String;
    invoke-virtual {v0, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2390
    const/4 v7, 0x0

    invoke-virtual {v0, v7, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_86
    .catch Ljava/lang/Exception; {:try_start_29 .. :try_end_86} :catch_89

    .line 2391
    return-object v0

    .line 2394
    .end local v4    # "packageList":[Ljava/lang/String;
    .end local v5    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v6    # "isAddallExist":Z
    :cond_87
    goto :goto_3a

    .line 2398
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "containerId":I
    :cond_88
    goto :goto_a2

    .line 2396
    :catch_89
    move-exception v2

    .line 2397
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Error occured while fetching all packages of a profile: exception occured: The error code is -1"

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v1, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2399
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_a2
    return-object v0
.end method

.method private getConnectivityManagerService()Landroid/net/IConnectivityManager;
    .registers 5

    .line 474
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    const-string v1, "KnoxVpnEngineService"

    if-eqz v0, :cond_c

    const-string/jumbo v0, "getConnectionService is reached initially"

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 475
    :cond_c
    const-string v0, "connectivity"

    invoke-static {v0}, Landroid/os/ServiceManager;->getService(Ljava/lang/String;)Landroid/os/IBinder;

    move-result-object v0

    .line 476
    .local v0, "binder":Landroid/os/IBinder;
    if-eqz v0, :cond_39

    .line 477
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mConnectivityManagerService:Landroid/net/IConnectivityManager;

    if-nez v2, :cond_39

    .line 478
    invoke-static {v0}, Landroid/net/IConnectivityManager$Stub;->asInterface(Landroid/os/IBinder;)Landroid/net/IConnectivityManager;

    move-result-object v2

    iput-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mConnectivityManagerService:Landroid/net/IConnectivityManager;

    .line 479
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_39

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "getConnectionService value is"

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mConnectivityManagerService:Landroid/net/IConnectivityManager;

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 482
    :cond_39
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mConnectivityManagerService:Landroid/net/IConnectivityManager;

    return-object v1
.end method

.method private getEnterpriseDeviceManager()Lcom/samsung/android/knox/EnterpriseDeviceManager;
    .registers 3

    .line 577
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mEDM:Lcom/samsung/android/knox/EnterpriseDeviceManager;

    if-nez v0, :cond_c

    .line 578
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-static {v0}, Lcom/samsung/android/knox/EnterpriseDeviceManager;->getInstance(Landroid/content/Context;)Lcom/samsung/android/knox/EnterpriseDeviceManager;

    move-result-object v0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mEDM:Lcom/samsung/android/knox/EnterpriseDeviceManager;

    .line 580
    :cond_c
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mEDM:Lcom/samsung/android/knox/EnterpriseDeviceManager;

    if-eqz v0, :cond_11

    .line 584
    return-object v0

    .line 581
    :cond_11
    new-instance v0, Ljava/lang/SecurityException;

    const-string v1, "Admin cannot be verified"

    invoke-direct {v0, v1}, Ljava/lang/SecurityException;-><init>(Ljava/lang/String;)V

    .line 582
    .local v0, "exception":Ljava/lang/SecurityException;
    throw v0
.end method

.method private getEnterpriseDeviceManagerService()Lcom/samsung/android/knox/IEnterpriseDeviceManager;
    .registers 4

    .line 488
    const-string v0, "enterprise_policy"

    invoke-static {v0}, Landroid/os/ServiceManager;->getService(Ljava/lang/String;)Landroid/os/IBinder;

    move-result-object v0

    .line 489
    .local v0, "binder":Landroid/os/IBinder;
    if-eqz v0, :cond_2f

    .line 490
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mEnterpriseDeviceManagerService:Lcom/samsung/android/knox/IEnterpriseDeviceManager;

    if-nez v1, :cond_2f

    .line 491
    invoke-static {v0}, Lcom/samsung/android/knox/IEnterpriseDeviceManager$Stub;->asInterface(Landroid/os/IBinder;)Lcom/samsung/android/knox/IEnterpriseDeviceManager;

    move-result-object v1

    iput-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mEnterpriseDeviceManagerService:Lcom/samsung/android/knox/IEnterpriseDeviceManager;

    .line 492
    sget-boolean v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v1, :cond_2f

    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "getEnterpriseDeviceManagerService value is"

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mEnterpriseDeviceManagerService:Lcom/samsung/android/knox/IEnterpriseDeviceManager;

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    const-string v2, "KnoxVpnEngineService"

    invoke-static {v2, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 495
    :cond_2f
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mEnterpriseDeviceManagerService:Lcom/samsung/android/knox/IEnterpriseDeviceManager;

    return-object v1
.end method

.method private getKeyStore()Landroid/security/KeyStore;
    .registers 2

    .line 501
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKeyStore:Landroid/security/KeyStore;

    if-nez v0, :cond_a

    .line 502
    invoke-static {}, Landroid/security/KeyStore;->getInstance()Landroid/security/KeyStore;

    move-result-object v0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKeyStore:Landroid/security/KeyStore;

    .line 504
    :cond_a
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKeyStore:Landroid/security/KeyStore;

    return-object v0
.end method

.method private getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;
    .registers 2

    .line 510
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    if-nez v0, :cond_c

    .line 511
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-static {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getInstance(Landroid/content/Context;)Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    .line 513
    :cond_c
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    return-object v0
.end method

.method private getKnoxVpnPacProcessor()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;
    .registers 2

    .line 538
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnPacProcessor:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    if-nez v0, :cond_c

    .line 539
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-static {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->getInstance(Landroid/content/Context;)Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnPacProcessor:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    .line 541
    :cond_c
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnPacProcessor:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    return-object v0
.end method

.method private getNetworkManagementService()Landroid/os/INetworkManagementService;
    .registers 5

    .line 459
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    const-string v1, "KnoxVpnEngineService"

    if-eqz v0, :cond_c

    const-string/jumbo v0, "getNetworkManagementService is reached initially"

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 460
    :cond_c
    const-string/jumbo v0, "network_management"

    invoke-static {v0}, Landroid/os/ServiceManager;->getService(Ljava/lang/String;)Landroid/os/IBinder;

    move-result-object v0

    .line 461
    .local v0, "binder":Landroid/os/IBinder;
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_2c

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "getNetworkManagementService binder value is"

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 462
    :cond_2c
    if-eqz v0, :cond_53

    .line 463
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNetworkManagementService:Landroid/os/INetworkManagementService;

    if-nez v2, :cond_53

    .line 464
    invoke-static {v0}, Landroid/os/INetworkManagementService$Stub;->asInterface(Landroid/os/IBinder;)Landroid/os/INetworkManagementService;

    move-result-object v2

    iput-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNetworkManagementService:Landroid/os/INetworkManagementService;

    .line 465
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_53

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "getNetworkManagementService mNetworkManagementService value is"

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNetworkManagementService:Landroid/os/INetworkManagementService;

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 468
    :cond_53
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNetworkManagementService:Landroid/os/INetworkManagementService;

    return-object v1
.end method

.method private getNetworkPolicyManager()Landroid/net/NetworkPolicyManager;
    .registers 3

    .line 556
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNetworkPolicyManager:Landroid/net/NetworkPolicyManager;

    if-nez v0, :cond_11

    .line 557
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    const-string/jumbo v1, "netpolicy"

    invoke-virtual {v0, v1}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Landroid/net/NetworkPolicyManager;

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNetworkPolicyManager:Landroid/net/NetworkPolicyManager;

    .line 559
    :cond_11
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNetworkPolicyManager:Landroid/net/NetworkPolicyManager;

    return-object v0
.end method

.method private getPackageListNoInternetPermission(Ljava/lang/String;I)Ljava/util/List;
    .registers 16
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "userId"    # I
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Ljava/lang/String;",
            "I)",
            "Ljava/util/List<",
            "Ljava/lang/String;",
            ">;"
        }
    .end annotation

    .line 2522
    const-string/jumbo v0, "packageUid"

    new-instance v1, Ljava/util/ArrayList;

    invoke-direct {v1}, Ljava/util/ArrayList;-><init>()V

    .line 2524
    .local v1, "packageList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    :try_start_8
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string/jumbo v3, "vpnNoInternetPermission"

    const-string/jumbo v4, "profileName"

    filled-new-array {v4}, [Ljava/lang/String;

    move-result-object v4

    const/4 v5, 0x1

    new-array v5, v5, [Ljava/lang/String;

    const/4 v6, 0x0

    aput-object p1, v5, v6

    filled-new-array {v0}, [Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v2, v3, v4, v5, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v2

    .line 2532
    .local v2, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    if-eqz v2, :cond_6a

    invoke-virtual {v2}, Ljava/util/ArrayList;->size()I

    move-result v3

    if-lez v3, :cond_6a

    .line 2533
    invoke-virtual {v2}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v3

    :goto_2e
    invoke-interface {v3}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_6a

    invoke-interface {v3}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Landroid/content/ContentValues;

    .line 2534
    .local v4, "cv":Landroid/content/ContentValues;
    invoke-virtual {v4, v0}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v5

    invoke-virtual {v5}, Ljava/lang/Integer;->intValue()I

    move-result v5

    .line 2535
    .local v5, "uid":I
    const/4 v7, -0x1

    if-eq v5, v7, :cond_69

    invoke-static {v5}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v7

    if-ne v7, p2, :cond_69

    .line 2536
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v7

    .line 2537
    .local v7, "blockToken":J
    iget-object v9, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v9}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;

    move-result-object v9

    invoke-virtual {v9, v5}, Landroid/content/pm/PackageManager;->getPackagesForUid(I)[Ljava/lang/String;

    move-result-object v9

    .line 2538
    .local v9, "packagesforUid":[Ljava/lang/String;
    invoke-static {v7, v8}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 2539
    array-length v10, v9

    move v11, v6

    :goto_5e
    if-ge v11, v10, :cond_69

    aget-object v12, v9, v11

    .line 2540
    .local v12, "pkg":Ljava/lang/String;
    invoke-interface {v1, v12}, Ljava/util/List;->add(Ljava/lang/Object;)Z
    :try_end_65
    .catch Ljava/lang/Exception; {:try_start_8 .. :try_end_65} :catch_6b

    .line 2539
    nop

    .end local v12    # "pkg":Ljava/lang/String;
    add-int/lit8 v11, v11, 0x1

    goto :goto_5e

    .line 2543
    .end local v4    # "cv":Landroid/content/ContentValues;
    .end local v5    # "uid":I
    .end local v7    # "blockToken":J
    .end local v9    # "packagesforUid":[Ljava/lang/String;
    :cond_69
    goto :goto_2e

    .line 2547
    .end local v2    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    :cond_6a
    goto :goto_6c

    .line 2545
    :catch_6b
    move-exception v0

    .line 2548
    :goto_6c
    return-object v1
.end method

.method private getPersonaManager()Lcom/samsung/android/knox/SemPersonaManager;
    .registers 3

    .line 566
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mPersonaManager:Lcom/samsung/android/knox/SemPersonaManager;

    if-nez v0, :cond_11

    .line 567
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    .line 568
    const-string/jumbo v1, "persona"

    invoke-virtual {v0, v1}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Lcom/samsung/android/knox/SemPersonaManager;

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mPersonaManager:Lcom/samsung/android/knox/SemPersonaManager;

    .line 571
    :cond_11
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mPersonaManager:Lcom/samsung/android/knox/SemPersonaManager;

    return-object v0
.end method

.method private getPortForProfileName(Ljava/lang/String;)I
    .registers 6
    .param p1, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Throws;
        value = {
            Ljava/lang/IllegalArgumentException;
        }
    .end annotation

    .line 8696
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnPacProcessor()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v0

    invoke-virtual {v0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->getProxyPortForProfile(Ljava/lang/String;)I

    move-result v0

    .line 8697
    .local v0, "returnPort":I
    const/4 v1, -0x1

    if-eq v0, v1, :cond_1c

    .line 8699
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnPacProcessor()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v1

    const/4 v2, 0x0

    .line 8700
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v3

    invoke-virtual {v3, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getListOfUid(Ljava/lang/String;)Ljava/util/HashMap;

    move-result-object v3

    .line 8699
    invoke-virtual {v1, p1, v2, v0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->updatePermissionForAppsToaccessLocalHost(Ljava/lang/String;IILjava/util/HashMap;)V

    .line 8701
    return v0

    .line 8698
    :cond_1c
    new-instance v1, Ljava/lang/IllegalArgumentException;

    invoke-direct {v1}, Ljava/lang/IllegalArgumentException;-><init>()V

    throw v1
.end method

.method private getPowerManager()Landroid/os/PowerManager;
    .registers 3

    .line 547
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mPowerManager:Landroid/os/PowerManager;

    if-nez v0, :cond_11

    .line 548
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    const-string/jumbo v1, "power"

    invoke-virtual {v0, v1}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Landroid/os/PowerManager;

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mPowerManager:Landroid/os/PowerManager;

    .line 550
    :cond_11
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mPowerManager:Landroid/os/PowerManager;

    return-object v0
.end method

.method private getProfileNameForUid(I)Ljava/lang/String;
    .registers 7
    .param p1, "uid"    # I

    .line 8708
    const/4 v0, 0x0

    .line 8710
    .local v0, "returnProfileName":Ljava/lang/String;
    :try_start_1
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_b
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_2c

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 8711
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v3

    const/4 v4, 0x1

    if-eq v3, v4, :cond_1f

    goto :goto_2b

    .line 8713
    :cond_1f
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v3

    if-ne v3, p1, :cond_2b

    .line 8714
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v1
    :try_end_29
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_29} :catch_2d

    move-object v0, v1

    .line 8715
    return-object v0

    .line 8723
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_2b
    :goto_2b
    goto :goto_b

    .line 8726
    :cond_2c
    goto :goto_44

    .line 8724
    :catch_2d
    move-exception v1

    .line 8725
    .local v1, "e":Ljava/lang/Exception;
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception occured while trying to fetch profile name for the uid "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    const-string v3, "KnoxVpnEngineService"

    invoke-static {v3, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 8727
    .end local v1    # "e":Ljava/lang/Exception;
    :goto_44
    return-object v0
.end method

.method private getSharedUidPackges([Ljava/lang/String;I)[Ljava/lang/String;
    .registers 11
    .param p1, "packageList"    # [Ljava/lang/String;
    .param p2, "containerId"    # I

    .line 2479
    const/4 v0, 0x0

    if-eqz p1, :cond_40

    array-length v1, p1

    if-lez v1, :cond_40

    .line 2480
    const-string/jumbo v1, "package"

    invoke-static {v1}, Landroid/os/ServiceManager;->getService(Ljava/lang/String;)Landroid/os/IBinder;

    move-result-object v1

    invoke-static {v1}, Landroid/content/pm/IPackageManager$Stub;->asInterface(Landroid/os/IBinder;)Landroid/content/pm/IPackageManager;

    move-result-object v1

    .line 2481
    .local v1, "pm":Landroid/content/pm/IPackageManager;
    if-nez v1, :cond_14

    .line 2482
    return-object v0

    .line 2484
    :cond_14
    const/4 v0, 0x0

    .line 2485
    .local v0, "installedPackages":Ljava/util/List;, "Ljava/util/List<Landroid/content/pm/PackageInfo;>;"
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v2}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;

    move-result-object v2

    const/4 v3, 0x0

    invoke-virtual {v2, v3, p2}, Landroid/content/pm/PackageManager;->getInstalledPackagesAsUser(II)Ljava/util/List;

    move-result-object v0

    .line 2486
    new-instance v2, Ljava/util/HashSet;

    invoke-direct {v2}, Ljava/util/HashSet;-><init>()V

    .line 2487
    .local v2, "packageNameSet":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    array-length v4, p1

    move v5, v3

    :goto_27
    if-ge v5, v4, :cond_37

    aget-object v6, p1, v5

    .line 2488
    .local v6, "packageName":Ljava/lang/String;
    invoke-direct {p0, v6, p2, v1, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->_getSharedUidPackges(Ljava/lang/String;ILandroid/content/pm/IPackageManager;Ljava/util/List;)Ljava/util/Set;

    move-result-object v7

    .line 2489
    .local v7, "packagesSet":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    if-eqz v7, :cond_34

    invoke-interface {v2, v7}, Ljava/util/Set;->addAll(Ljava/util/Collection;)Z

    .line 2487
    .end local v6    # "packageName":Ljava/lang/String;
    .end local v7    # "packagesSet":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    :cond_34
    add-int/lit8 v5, v5, 0x1

    goto :goto_27

    .line 2491
    :cond_37
    new-array v3, v3, [Ljava/lang/String;

    invoke-interface {v2, v3}, Ljava/util/Set;->toArray([Ljava/lang/Object;)[Ljava/lang/Object;

    move-result-object v3

    check-cast v3, [Ljava/lang/String;

    return-object v3

    .line 2493
    .end local v0    # "installedPackages":Ljava/util/List;, "Ljava/util/List<Landroid/content/pm/PackageInfo;>;"
    .end local v1    # "pm":Landroid/content/pm/IPackageManager;
    .end local v2    # "packageNameSet":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    :cond_40
    return-object v0
.end method

.method private getUsbManager()Landroid/hardware/usb/UsbManager;
    .registers 3

    .line 588
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mUsbManager:Landroid/hardware/usb/UsbManager;

    if-nez v0, :cond_11

    .line 589
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    const-string/jumbo v1, "usb"

    invoke-virtual {v0, v1}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Landroid/hardware/usb/UsbManager;

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mUsbManager:Landroid/hardware/usb/UsbManager;

    .line 591
    :cond_11
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mUsbManager:Landroid/hardware/usb/UsbManager;

    return-object v0
.end method

.method private getVPNState(Ljava/lang/String;)I
    .registers 8
    .param p1, "profileName"    # Ljava/lang/String;

    .line 7732
    const-string v0, "KnoxVpnEngineService"

    const/4 v1, -0x1

    .line 7734
    .local v1, "state":I
    :try_start_3
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 7735
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v2, :cond_c

    .line 7736
    return v1

    .line 7739
    :cond_c
    invoke-virtual {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v3

    .line 7740
    .local v3, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v3, :cond_28

    .line 7741
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "getVPNState : Interface null for profile : "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 7742
    return v1

    .line 7745
    :cond_28
    invoke-interface {v3, p1}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getState(Ljava/lang/String;)I

    move-result v4

    move v1, v4

    .line 7746
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "State of vpn profile received from vpn vendor for profileName is = "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v5, " state = "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_49
    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_49} :catch_4b

    .line 7750
    nop

    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    goto :goto_65

    .line 7748
    :catch_4b
    move-exception v2

    .line 7749
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v4, "getVPNState : Failure at "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 7751
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_65
    return v1
.end method

.method private declared-synchronized getVPNTransitionState(Ljava/lang/String;)I
    .registers 8
    .param p1, "profileName"    # Ljava/lang/String;

    monitor-enter p0

    .line 7701
    const/4 v0, -0x1

    .line 7702
    .local v0, "iVPNCurActivateState":I
    const/4 v1, -0x1

    .line 7703
    .local v1, "iVpnConnectState":I
    const/4 v2, -0x1

    .line 7705
    .local v2, "temp":I
    :try_start_4
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVPNState(Ljava/lang/String;)I

    move-result v3
    :try_end_8
    .catchall {:try_start_4 .. :try_end_8} :catchall_3e

    move v1, v3

    .line 7706
    const/4 v3, -0x1

    if-gez v1, :cond_e

    .line 7707
    monitor-exit p0

    return v3

    .line 7708
    :cond_e
    const/4 v4, 0x5

    if-ge v4, v1, :cond_13

    .line 7709
    monitor-exit p0

    return v3

    .line 7711
    :cond_13
    move v2, v1

    .line 7714
    :try_start_14
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getActivate(Ljava/lang/String;)I

    move-result v4
    :try_end_18
    .catchall {:try_start_14 .. :try_end_18} :catchall_3e

    move v0, v4

    .line 7715
    if-gez v0, :cond_1d

    .line 7716
    monitor-exit p0

    return v3

    .line 7718
    :cond_1d
    if-nez v0, :cond_21

    .line 7719
    add-int/lit8 v2, v2, 0x64

    .line 7722
    :cond_21
    :try_start_21
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_3c

    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "getVPNTransitionState : VpnState : "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_3c
    .catchall {:try_start_21 .. :try_end_3c} :catchall_3e

    .line 7723
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_3c
    monitor-exit p0

    return v2

    .line 7700
    .end local v0    # "iVPNCurActivateState":I
    .end local v1    # "iVpnConnectState":I
    .end local v2    # "temp":I
    .end local p1    # "profileName":Ljava/lang/String;
    :catchall_3e
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method private getVirtualInterfaceType(Ljava/lang/String;)I
    .registers 4
    .param p1, "profileName"    # Ljava/lang/String;

    .line 8989
    const/4 v0, 0x0

    .line 8990
    .local v0, "interface_type":I
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v1

    .line 8991
    .local v1, "profileInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v1, :cond_d

    .line 8992
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v0

    .line 8994
    :cond_d
    return v0
.end method

.method private getVpnInfoPolicy()Lcom/samsung/android/knox/net/vpn/IVpnInfoPolicy;
    .registers 2

    .line 595
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnInfoPolicy:Lcom/samsung/android/knox/net/vpn/IVpnInfoPolicy;

    if-nez v0, :cond_11

    .line 596
    const-string/jumbo v0, "vpn_policy"

    invoke-static {v0}, Landroid/os/ServiceManager;->getService(Ljava/lang/String;)Landroid/os/IBinder;

    move-result-object v0

    invoke-static {v0}, Lcom/samsung/android/knox/net/vpn/IVpnInfoPolicy$Stub;->asInterface(Landroid/os/IBinder;)Lcom/samsung/android/knox/net/vpn/IVpnInfoPolicy;

    move-result-object v0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnInfoPolicy:Lcom/samsung/android/knox/net/vpn/IVpnInfoPolicy;

    .line 598
    :cond_11
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnInfoPolicy:Lcom/samsung/android/knox/net/vpn/IVpnInfoPolicy;

    return-object v0
.end method

.method private getVpnInterface(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .registers 6
    .param p1, "vendorName"    # Ljava/lang/String;

    .line 7589
    const/4 v0, 0x0

    .line 7591
    .local v0, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-eqz p1, :cond_2e

    .line 7592
    :try_start_3
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnInterfaceMap:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v1, p1}, Ljava/util/concurrent/ConcurrentHashMap;->get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v1

    .line 7593
    .local v1, "interfaceObject":Ljava/lang/Object;
    sget-object v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->NULL_OBJECT:Ljava/lang/Object;

    if-eq v1, v2, :cond_2e

    .line 7594
    move-object v2, v1

    check-cast v2, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :try_end_10
    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_10} :catch_12

    move-object v0, v2

    goto :goto_2e

    .line 7597
    .end local v1    # "interfaceObject":Ljava/lang/Object;
    :catch_12
    move-exception v1

    .line 7598
    .local v1, "e":Ljava/lang/Exception;
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception when retrieving Binder interface : "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v1}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    const-string v3, "KnoxVpnEngineService"

    invoke-static {v3, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_2f

    .line 7599
    .end local v1    # "e":Ljava/lang/Exception;
    :cond_2e
    :goto_2e
    nop

    .line 7600
    :goto_2f
    return-object v0
.end method

.method private handleActionAdminChanged(Landroid/os/Bundle;)V
    .registers 5
    .param p1, "map"    # Landroid/os/Bundle;

    .line 4847
    const-string v0, "android.intent.extra.user_handle"

    const/4 v1, -0x1

    invoke-virtual {p1, v0, v1}, Landroid/os/Bundle;->getInt(Ljava/lang/String;I)I

    move-result v0

    .line 4848
    .local v0, "personaId":I
    const-string v2, "android.intent.extra.UID"

    invoke-virtual {p1, v2, v1}, Landroid/os/Bundle;->getInt(Ljava/lang/String;I)I

    move-result v2

    .line 4849
    .local v2, "old_adminid":I
    if-eq v0, v1, :cond_14

    if-eq v2, v1, :cond_14

    .line 4850
    invoke-direct {p0, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->stopVpnConnectionAfterAdminRemoval(I)V

    .line 4852
    :cond_14
    return-void
.end method

.method private declared-synchronized handleActionEthernetChanged(Landroid/os/Bundle;)V
    .registers 27
    .param p1, "map"    # Landroid/os/Bundle;

    move-object/from16 v8, p0

    move-object/from16 v9, p1

    monitor-enter p0

    .line 5984
    :try_start_5
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v0
    :try_end_b
    .catchall {:try_start_5 .. :try_end_b} :catchall_2c1

    .line 5985
    .local v0, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    if-nez v0, :cond_f

    .line 5986
    monitor-exit p0

    return-void

    .line 5988
    :cond_f
    :try_start_f
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->size()I

    move-result v1

    if-lez v1, :cond_2be

    .line 5990
    const/4 v10, 0x0

    .line 5992
    .local v10, "defaultNetworkInterface":Ljava/lang/String;
    const/4 v1, 0x0

    .line 5993
    .local v1, "isUserVpnConfiguredForMainUser":Z
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v2

    invoke-interface {v2}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_27
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    const/4 v12, 0x3

    const/4 v13, 0x1

    if-eqz v3, :cond_85

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 5994
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v4

    .line 5995
    .local v4, "activateState":I
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v5

    invoke-interface {v5}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v5

    :goto_41
    invoke-interface {v5}, Ljava/util/Iterator;->hasNext()Z

    move-result v6

    if-eqz v6, :cond_80

    invoke-interface {v5}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 5996
    .local v6, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v7, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v7

    if-eqz v7, :cond_7e

    .line 5997
    if-ne v4, v13, :cond_7e

    .line 5998
    iget-object v7, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v14

    invoke-virtual {v7, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v7

    .line 5999
    .local v7, "cid":I
    if-nez v7, :cond_7e

    .line 6000
    sget-object v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->AID_EXEMPT_LIST:[Ljava/lang/Integer;

    array-length v14, v5

    const/4 v15, 0x0

    :goto_67
    if-ge v15, v14, :cond_7c

    aget-object v16, v5, v15

    invoke-virtual/range {v16 .. v16}, Ljava/lang/Integer;->intValue()I

    move-result v16

    move/from16 v17, v16

    .line 6001
    .local v17, "aidUid":I
    iget-object v11, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    move/from16 v13, v17

    .end local v17    # "aidUid":I
    .local v13, "aidUid":I
    invoke-virtual {v11, v13, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    .line 6000
    .end local v13    # "aidUid":I
    add-int/lit8 v15, v15, 0x1

    const/4 v13, 0x1

    goto :goto_67

    .line 6003
    :cond_7c
    const/4 v1, 0x1

    .line 6004
    goto :goto_80

    .line 6008
    .end local v6    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v7    # "cid":I
    :cond_7e
    const/4 v13, 0x1

    goto :goto_41

    .line 6009
    :cond_80
    :goto_80
    if-eqz v1, :cond_84

    .line 6010
    move v11, v1

    goto :goto_86

    .line 6011
    .end local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v4    # "activateState":I
    :cond_84
    goto :goto_27

    .line 5993
    :cond_85
    move v11, v1

    .line 6013
    .end local v1    # "isUserVpnConfiguredForMainUser":Z
    .local v11, "isUserVpnConfiguredForMainUser":Z
    :goto_86
    invoke-interface {v0}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v13

    :goto_8a
    invoke-interface {v13}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    const/16 v14, 0x3f8

    if-eqz v1, :cond_f8

    invoke-interface {v13}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-object v15, v1

    .line 6014
    .local v15, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v2

    const/4 v3, 0x1

    invoke-virtual {v1, v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeInputFilterDropRulesForInterface(ILjava/util/List;)V

    .line 6015
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuidListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v2

    const/4 v3, 0x0

    invoke-virtual {v1, v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeInputFilterDropRulesForInterface(ILjava/util/List;)V

    .line 6017
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isNativeVpnClient(Ljava/lang/String;)Z

    move-result v1

    if-eqz v1, :cond_cb

    .line 6018
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1, v14, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    goto :goto_d4

    .line 6020
    :cond_cb
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v2

    invoke-virtual {v1, v2, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    .line 6023
    :goto_d4
    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v1

    invoke-virtual {v1}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v14

    :goto_dc
    invoke-interface {v14}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_f7

    invoke-interface {v14}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Ljava/lang/Integer;

    invoke-virtual {v1}, Ljava/lang/Integer;->intValue()I

    move-result v4

    .line 6024
    .local v4, "uid":I
    const/4 v2, 0x0

    const/4 v3, 0x2

    const/4 v5, 0x3

    const/4 v6, 0x0

    const/4 v7, 0x0

    move-object/from16 v1, p0

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 6025
    .end local v4    # "uid":I
    goto :goto_dc

    .line 6026
    .end local v15    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_f7
    goto :goto_8a

    .line 6028
    :cond_f8
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdForExemptedUids()Ljava/util/HashSet;

    move-result-object v1

    move-object v13, v1

    .line 6029
    .local v13, "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    invoke-virtual {v13}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_103
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_121

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Ljava/lang/Integer;

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    .line 6030
    .local v2, "exemptedUserId":I
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v4, "com.android.providers.downloads"

    invoke-virtual {v3, v2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v3

    .line 6031
    .local v3, "downloadMangerUid":I
    iget-object v4, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForDownloadManagerUid(I)V

    .line 6032
    .end local v2    # "exemptedUserId":I
    .end local v3    # "downloadMangerUid":I
    goto :goto_103

    .line 6034
    :cond_121
    const-string/jumbo v1, "noConnectivity"

    invoke-virtual {v9, v1}, Landroid/os/Bundle;->getBoolean(Ljava/lang/String;)Z

    move-result v1

    move v15, v1

    .line 6035
    .local v15, "networkDown":Z
    if-eqz v15, :cond_134

    .line 6036
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Default Ethernet Network lost connectivity"

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_132
    .catchall {:try_start_f .. :try_end_132} :catchall_2c1

    .line 6037
    monitor-exit p0

    return-void

    .line 6040
    :cond_134
    :try_start_134
    const-string/jumbo v1, "state"

    invoke-virtual {v9, v1}, Landroid/os/Bundle;->getString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v1

    move-object v7, v1

    .line 6041
    .local v7, "networkState":Ljava/lang/String;
    const-string v1, "DISCONNECTED"

    invoke-virtual {v7, v1}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v1

    if-eqz v1, :cond_14d

    .line 6042
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Default Ethernet Network is disconnected"

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_14b
    .catchall {:try_start_134 .. :try_end_14b} :catchall_2c1

    .line 6043
    monitor-exit p0

    return-void

    .line 6046
    :cond_14d
    :try_start_14d
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v1

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getActiveNetworkInterface()Ljava/lang/String;

    move-result-object v1

    move-object v10, v1

    .line 6047
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Default Ethernet Network interface Name is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6049
    invoke-interface {v0}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v17

    :goto_170
    invoke-interface/range {v17 .. v17}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_298

    invoke-interface/range {v17 .. v17}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-object/from16 v19, v1

    .line 6050
    .local v19, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v1

    move v6, v1

    .line 6051
    .local v6, "activateState":I
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v1

    move-object/from16 v20, v1

    .line 6052
    .local v20, "ipChainName":Ljava/lang/String;
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_191
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_1e6

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 6053
    .local v2, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v3

    if-eqz v3, :cond_1df

    .line 6054
    const/4 v3, 0x1

    if-ne v6, v3, :cond_1dc

    .line 6055
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v3

    .line 6056
    .local v3, "cid":I
    if-nez v3, :cond_1d9

    .line 6057
    const/4 v1, 0x1

    invoke-direct {v8, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->blockIncomingICMPPackets(Z)V

    .line 6058
    sget-object v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->AID_EXEMPT_LIST:[Ljava/lang/Integer;

    array-length v4, v1

    const/4 v5, 0x0

    :goto_1bc
    if-ge v5, v4, :cond_1d6

    aget-object v21, v1, v5

    invoke-virtual/range {v21 .. v21}, Ljava/lang/Integer;->intValue()I

    move-result v21

    move/from16 v22, v21

    .line 6059
    .local v22, "aidUid":I
    iget-object v14, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    move-object/from16 v23, v0

    move/from16 v0, v22

    .end local v22    # "aidUid":I
    .local v0, "aidUid":I
    .local v23, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    invoke-virtual {v14, v0, v10, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    .line 6058
    .end local v0    # "aidUid":I
    add-int/lit8 v5, v5, 0x1

    move-object/from16 v0, v23

    const/16 v14, 0x3f8

    goto :goto_1bc

    .line 6061
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .local v0, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1d6
    move-object/from16 v23, v0

    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    goto :goto_1e8

    .line 6056
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1d9
    move-object/from16 v23, v0

    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    goto :goto_1e1

    .line 6054
    .end local v3    # "cid":I
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1dc
    move-object/from16 v23, v0

    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    goto :goto_1e1

    .line 6053
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1df
    move-object/from16 v23, v0

    .line 6065
    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .end local v2    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :goto_1e1
    move-object/from16 v0, v23

    const/16 v14, 0x3f8

    goto :goto_191

    .line 6052
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1e6
    move-object/from16 v23, v0

    .line 6066
    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :goto_1e8
    const/4 v0, 0x1

    if-ne v6, v0, :cond_287

    .line 6067
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v1

    invoke-virtual {v0, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v0

    .line 6068
    .local v0, "vpnClientPackageName":Ljava/lang/String;
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v2

    const/4 v3, 0x1

    invoke-virtual {v1, v0, v3, v2, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addInputFilterDropRulesForInterface(Ljava/lang/String;ILjava/util/List;Ljava/lang/String;)V

    .line 6069
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuidListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v2

    const/4 v14, 0x0

    invoke-virtual {v1, v0, v14, v2, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addInputFilterDropRulesForInterface(Ljava/lang/String;ILjava/util/List;Ljava/lang/String;)V

    .line 6071
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v1

    invoke-virtual {v8, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getChainingEnabledForProfile(I)I

    move-result v1

    const/4 v5, 0x1

    if-eq v1, v5, :cond_240

    .line 6072
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isNativeVpnClient(Ljava/lang/String;)Z

    move-result v1

    if-eqz v1, :cond_234

    .line 6073
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    const/16 v3, 0x3f8

    invoke-virtual {v1, v3, v10, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    goto :goto_242

    .line 6075
    :cond_234
    const/16 v3, 0x3f8

    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v2

    invoke-virtual {v1, v2, v10, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    goto :goto_242

    .line 6071
    :cond_240
    const/16 v3, 0x3f8

    .line 6079
    :goto_242
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v1

    invoke-virtual {v1}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v16

    :goto_24a
    invoke-interface/range {v16 .. v16}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_27e

    invoke-interface/range {v16 .. v16}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Ljava/lang/Integer;

    invoke-virtual {v1}, Ljava/lang/Integer;->intValue()I

    move-result v4

    .line 6080
    .restart local v4    # "uid":I
    const/4 v2, 0x1

    const/16 v18, 0x2

    const/16 v21, 0x3

    const/16 v22, 0x0

    move-object/from16 v1, p0

    move/from16 v24, v3

    move/from16 v3, v18

    move/from16 v18, v5

    move/from16 v5, v21

    move/from16 v21, v6

    .end local v6    # "activateState":I
    .local v21, "activateState":I
    move-object/from16 v6, v22

    move-object/from16 v22, v7

    .end local v7    # "networkState":Ljava/lang/String;
    .local v22, "networkState":Ljava/lang/String;
    move-object v7, v10

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 6081
    .end local v4    # "uid":I
    move/from16 v5, v18

    move/from16 v6, v21

    move-object/from16 v7, v22

    move/from16 v3, v24

    goto :goto_24a

    .line 6079
    .end local v21    # "activateState":I
    .end local v22    # "networkState":Ljava/lang/String;
    .restart local v6    # "activateState":I
    .restart local v7    # "networkState":Ljava/lang/String;
    :cond_27e
    move/from16 v24, v3

    move/from16 v18, v5

    move/from16 v21, v6

    move-object/from16 v22, v7

    .end local v6    # "activateState":I
    .end local v7    # "networkState":Ljava/lang/String;
    .restart local v21    # "activateState":I
    .restart local v22    # "networkState":Ljava/lang/String;
    goto :goto_290

    .line 6066
    .end local v0    # "vpnClientPackageName":Ljava/lang/String;
    .end local v21    # "activateState":I
    .end local v22    # "networkState":Ljava/lang/String;
    .restart local v6    # "activateState":I
    .restart local v7    # "networkState":Ljava/lang/String;
    :cond_287
    move/from16 v18, v0

    move/from16 v21, v6

    move-object/from16 v22, v7

    const/4 v14, 0x0

    const/16 v24, 0x3f8

    .line 6083
    .end local v6    # "activateState":I
    .end local v7    # "networkState":Ljava/lang/String;
    .end local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v20    # "ipChainName":Ljava/lang/String;
    .restart local v22    # "networkState":Ljava/lang/String;
    :goto_290
    move-object/from16 v7, v22

    move-object/from16 v0, v23

    move/from16 v14, v24

    goto/16 :goto_170

    .line 6085
    .end local v22    # "networkState":Ljava/lang/String;
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .local v0, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v7    # "networkState":Ljava/lang/String;
    :cond_298
    move-object/from16 v23, v0

    move-object/from16 v22, v7

    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .end local v7    # "networkState":Ljava/lang/String;
    .restart local v22    # "networkState":Ljava/lang/String;
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    invoke-virtual {v13}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_2a0
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_2c0

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Ljava/lang/Integer;

    invoke-virtual {v1}, Ljava/lang/Integer;->intValue()I

    move-result v1

    .line 6086
    .local v1, "exemptedUserId":I
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v3, "com.android.providers.downloads"

    invoke-virtual {v2, v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v2

    .line 6087
    .local v2, "downloadMangerUid":I
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v3, v2, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addExemptRulesForDownloadManagerUid(ILjava/lang/String;)V
    :try_end_2bd
    .catchall {:try_start_14d .. :try_end_2bd} :catchall_2c1

    .line 6088
    .end local v1    # "exemptedUserId":I
    .end local v2    # "downloadMangerUid":I
    goto :goto_2a0

    .line 5988
    .end local v10    # "defaultNetworkInterface":Ljava/lang/String;
    .end local v11    # "isUserVpnConfiguredForMainUser":Z
    .end local v13    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v15    # "networkDown":Z
    .end local v22    # "networkState":Ljava/lang/String;
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_2be
    move-object/from16 v23, v0

    .line 6092
    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_2c0
    goto :goto_2c9

    .line 6090
    :catchall_2c1
    move-exception v0

    .line 6091
    .local v0, "e":Ljava/lang/Throwable;
    :try_start_2c2
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Exception occured while trying to apply iptable rule for user 0 during connectivity change of ethernet network"

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_2c9
    .catchall {:try_start_2c2 .. :try_end_2c9} :catchall_2cb

    .line 6093
    .end local v0    # "e":Ljava/lang/Throwable;
    :goto_2c9
    monitor-exit p0

    return-void

    .line 5983
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .end local p1    # "map":Landroid/os/Bundle;
    :catchall_2cb
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method private declared-synchronized handleActionLockBootCompleted(I)V
    .registers 14
    .param p1, "userId"    # I

    monitor-enter p0

    .line 6857
    :try_start_1
    const-string v0, "KnoxVpnEngineService"

    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "handleActionLockBootCompleted: user id is "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6858
    if-nez p1, :cond_122

    .line 6859
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    if-eqz v0, :cond_122

    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v0

    invoke-interface {v0}, Ljava/util/Collection;->size()I

    move-result v0

    if-lez v0, :cond_122

    .line 6860
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v0

    invoke-interface {v0}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_34
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    const/4 v2, 0x1

    if-eqz v1, :cond_9f

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 6861
    .local v1, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyServer()Ljava/lang/String;

    move-result-object v3

    sget-object v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->DEFAULT_PROXY_SERVER:Ljava/lang/String;

    if-ne v3, v4, :cond_51

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPacurl()Landroid/net/Uri;

    move-result-object v3

    sget-object v4, Landroid/net/Uri;->EMPTY:Landroid/net/Uri;

    if-eq v3, v4, :cond_6f

    .line 6862
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_51
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v4

    const-string v5, "com.knox.vpn.proxyhandler"

    invoke-virtual {v3, v4, v5, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveSystemAppFromBatteryOptimization(Ljava/lang/String;Ljava/lang/String;Z)V

    .line 6864
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v5

    const/16 v6, 0x3ea

    invoke-static {v5, v6}, Landroid/os/UserHandle;->getUid(II)I

    move-result v5

    invoke-virtual {v3, v4, v5, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveSystemAppFromDataSaverWhitelist(Ljava/lang/String;IZ)V

    .line 6866
    :cond_6f
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbtetherAuth()I

    move-result v3

    if-ne v3, v2, :cond_80

    .line 6868
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v4

    const-string v5, "com.samsung.knox.vpn.tether.auth"

    invoke-virtual {v3, v4, v5, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveAppsFromBatteryOptimization(Ljava/lang/String;Ljava/lang/String;Z)V

    .line 6871
    :cond_80
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v3

    .line 6872
    .local v3, "vendorName":Ljava/lang/String;
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5, v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveAppsFromBatteryOptimization(Ljava/lang/String;Ljava/lang/String;Z)V

    .line 6874
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v5

    const-string v6, "com.android.vpndialogs"

    invoke-virtual {v4, v5, v6, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveAppsFromBatteryOptimization(Ljava/lang/String;Ljava/lang/String;Z)V

    .line 6875
    .end local v1    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "vendorName":Ljava/lang/String;
    goto :goto_34

    .line 6877
    :cond_9f
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v0

    invoke-interface {v0}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_a9
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_c2

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 6878
    .restart local v1    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVpnConnectionType()I

    move-result v3

    if-ne v3, v2, :cond_c1

    .line 6879
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mProcessManager:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;->registerProcessObserver()V

    .line 6880
    goto :goto_c2

    .line 6882
    .end local v1    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_c1
    goto :goto_a9

    .line 6884
    :cond_c2
    :goto_c2
    const/4 v0, 0x0

    .line 6885
    .local v0, "isUserVpnConfiguredForMainUser":Z
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_cd
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_122

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 6886
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v4

    .line 6887
    .local v4, "activateState":I
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v5

    invoke-interface {v5}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v5

    :goto_e5
    invoke-interface {v5}, Ljava/util/Iterator;->hasNext()Z

    move-result v6

    if-eqz v6, :cond_11e

    invoke-interface {v5}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 6888
    .local v6, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v7

    if-eqz v7, :cond_11d

    .line 6889
    if-ne v4, v2, :cond_11d

    .line 6890
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v8

    invoke-virtual {v7, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v7

    .line 6891
    .local v7, "cid":I
    if-nez v7, :cond_11d

    .line 6892
    sget-object v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->AID_EXEMPT_LIST:[Ljava/lang/Integer;

    array-length v8, v5

    const/4 v9, 0x0

    :goto_10b
    if-ge v9, v8, :cond_11b

    aget-object v10, v5, v9

    invoke-virtual {v10}, Ljava/lang/Integer;->intValue()I

    move-result v10

    .line 6893
    .local v10, "aidUid":I
    iget-object v11, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v11, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addExemptRulesForUid(I)V
    :try_end_118
    .catchall {:try_start_1 .. :try_end_118} :catchall_124

    .line 6892
    .end local v10    # "aidUid":I
    add-int/lit8 v9, v9, 0x1

    goto :goto_10b

    .line 6895
    :cond_11b
    const/4 v0, 0x1

    .line 6896
    goto :goto_11e

    .line 6900
    .end local v6    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v7    # "cid":I
    :cond_11d
    goto :goto_e5

    .line 6901
    :cond_11e
    :goto_11e
    if-eqz v0, :cond_121

    .line 6902
    goto :goto_122

    .line 6903
    .end local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v4    # "activateState":I
    :cond_121
    goto :goto_cd

    .line 6906
    .end local v0    # "isUserVpnConfiguredForMainUser":Z
    :cond_122
    :goto_122
    monitor-exit p0

    return-void

    .line 6856
    .end local p1    # "userId":I
    :catchall_124
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method private declared-synchronized handleActionMobileChanged(Landroid/os/Bundle;)V
    .registers 27
    .param p1, "map"    # Landroid/os/Bundle;

    move-object/from16 v8, p0

    move-object/from16 v9, p1

    monitor-enter p0

    .line 5868
    :try_start_5
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v0
    :try_end_b
    .catchall {:try_start_5 .. :try_end_b} :catchall_2c1

    .line 5869
    .local v0, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    if-nez v0, :cond_f

    .line 5870
    monitor-exit p0

    return-void

    .line 5872
    :cond_f
    :try_start_f
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->size()I

    move-result v1

    if-lez v1, :cond_2be

    .line 5874
    const/4 v10, 0x0

    .line 5876
    .local v10, "defaultNetworkInterface":Ljava/lang/String;
    const/4 v1, 0x0

    .line 5877
    .local v1, "isUserVpnConfiguredForMainUser":Z
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v2

    invoke-interface {v2}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_27
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    const/4 v12, 0x3

    const/4 v13, 0x1

    if-eqz v3, :cond_85

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 5878
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v4

    .line 5879
    .local v4, "activateState":I
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v5

    invoke-interface {v5}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v5

    :goto_41
    invoke-interface {v5}, Ljava/util/Iterator;->hasNext()Z

    move-result v6

    if-eqz v6, :cond_80

    invoke-interface {v5}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 5880
    .local v6, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v7, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v7

    if-eqz v7, :cond_7e

    .line 5881
    if-ne v4, v13, :cond_7e

    .line 5882
    iget-object v7, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v14

    invoke-virtual {v7, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v7

    .line 5883
    .local v7, "cid":I
    if-nez v7, :cond_7e

    .line 5884
    sget-object v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->AID_EXEMPT_LIST:[Ljava/lang/Integer;

    array-length v14, v5

    const/4 v15, 0x0

    :goto_67
    if-ge v15, v14, :cond_7c

    aget-object v16, v5, v15

    invoke-virtual/range {v16 .. v16}, Ljava/lang/Integer;->intValue()I

    move-result v16

    move/from16 v17, v16

    .line 5885
    .local v17, "aidUid":I
    iget-object v11, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    move/from16 v13, v17

    .end local v17    # "aidUid":I
    .local v13, "aidUid":I
    invoke-virtual {v11, v13, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    .line 5884
    .end local v13    # "aidUid":I
    add-int/lit8 v15, v15, 0x1

    const/4 v13, 0x1

    goto :goto_67

    .line 5887
    :cond_7c
    const/4 v1, 0x1

    .line 5888
    goto :goto_80

    .line 5892
    .end local v6    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v7    # "cid":I
    :cond_7e
    const/4 v13, 0x1

    goto :goto_41

    .line 5893
    :cond_80
    :goto_80
    if-eqz v1, :cond_84

    .line 5894
    move v11, v1

    goto :goto_86

    .line 5895
    .end local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v4    # "activateState":I
    :cond_84
    goto :goto_27

    .line 5877
    :cond_85
    move v11, v1

    .line 5897
    .end local v1    # "isUserVpnConfiguredForMainUser":Z
    .local v11, "isUserVpnConfiguredForMainUser":Z
    :goto_86
    invoke-interface {v0}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v13

    :goto_8a
    invoke-interface {v13}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    const/16 v14, 0x3f8

    if-eqz v1, :cond_f8

    invoke-interface {v13}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-object v15, v1

    .line 5898
    .local v15, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v2

    const/4 v3, 0x1

    invoke-virtual {v1, v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeInputFilterDropRulesForInterface(ILjava/util/List;)V

    .line 5899
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuidListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v2

    const/4 v3, 0x0

    invoke-virtual {v1, v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeInputFilterDropRulesForInterface(ILjava/util/List;)V

    .line 5901
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isNativeVpnClient(Ljava/lang/String;)Z

    move-result v1

    if-eqz v1, :cond_cb

    .line 5902
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1, v14, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    goto :goto_d4

    .line 5904
    :cond_cb
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v2

    invoke-virtual {v1, v2, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    .line 5907
    :goto_d4
    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v1

    invoke-virtual {v1}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v14

    :goto_dc
    invoke-interface {v14}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_f7

    invoke-interface {v14}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Ljava/lang/Integer;

    invoke-virtual {v1}, Ljava/lang/Integer;->intValue()I

    move-result v4

    .line 5908
    .local v4, "uid":I
    const/4 v2, 0x0

    const/4 v3, 0x2

    const/4 v5, 0x3

    const/4 v6, 0x0

    const/4 v7, 0x0

    move-object/from16 v1, p0

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 5909
    .end local v4    # "uid":I
    goto :goto_dc

    .line 5910
    .end local v15    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_f7
    goto :goto_8a

    .line 5912
    :cond_f8
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdForExemptedUids()Ljava/util/HashSet;

    move-result-object v1

    move-object v13, v1

    .line 5913
    .local v13, "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    invoke-virtual {v13}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_103
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_121

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Ljava/lang/Integer;

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    .line 5914
    .local v2, "exemptedUserId":I
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v4, "com.android.providers.downloads"

    invoke-virtual {v3, v2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v3

    .line 5915
    .local v3, "downloadMangerUid":I
    iget-object v4, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForDownloadManagerUid(I)V

    .line 5916
    .end local v2    # "exemptedUserId":I
    .end local v3    # "downloadMangerUid":I
    goto :goto_103

    .line 5918
    :cond_121
    const-string/jumbo v1, "noConnectivity"

    invoke-virtual {v9, v1}, Landroid/os/Bundle;->getBoolean(Ljava/lang/String;)Z

    move-result v1

    move v15, v1

    .line 5919
    .local v15, "networkDown":Z
    if-eqz v15, :cond_134

    .line 5920
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Default Mobile Network lost connectivity"

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_132
    .catchall {:try_start_f .. :try_end_132} :catchall_2c1

    .line 5921
    monitor-exit p0

    return-void

    .line 5924
    :cond_134
    :try_start_134
    const-string/jumbo v1, "state"

    invoke-virtual {v9, v1}, Landroid/os/Bundle;->getString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v1

    move-object v7, v1

    .line 5925
    .local v7, "networkState":Ljava/lang/String;
    const-string v1, "DISCONNECTED"

    invoke-virtual {v7, v1}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v1

    if-eqz v1, :cond_14d

    .line 5926
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Default Mobile Network is disconnected"

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_14b
    .catchall {:try_start_134 .. :try_end_14b} :catchall_2c1

    .line 5927
    monitor-exit p0

    return-void

    .line 5930
    :cond_14d
    :try_start_14d
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v1

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getActiveNetworkInterface()Ljava/lang/String;

    move-result-object v1

    move-object v10, v1

    .line 5931
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Default Mobile Network interface Name is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5933
    invoke-interface {v0}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v17

    :goto_170
    invoke-interface/range {v17 .. v17}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_298

    invoke-interface/range {v17 .. v17}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-object/from16 v19, v1

    .line 5934
    .local v19, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v1

    move v6, v1

    .line 5935
    .local v6, "activateState":I
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v1

    move-object/from16 v20, v1

    .line 5936
    .local v20, "ipChainName":Ljava/lang/String;
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_191
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_1e6

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 5937
    .local v2, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v3

    if-eqz v3, :cond_1df

    .line 5938
    const/4 v3, 0x1

    if-ne v6, v3, :cond_1dc

    .line 5939
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v3

    .line 5940
    .local v3, "cid":I
    if-nez v3, :cond_1d9

    .line 5941
    const/4 v1, 0x1

    invoke-direct {v8, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->blockIncomingICMPPackets(Z)V

    .line 5942
    sget-object v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->AID_EXEMPT_LIST:[Ljava/lang/Integer;

    array-length v4, v1

    const/4 v5, 0x0

    :goto_1bc
    if-ge v5, v4, :cond_1d6

    aget-object v21, v1, v5

    invoke-virtual/range {v21 .. v21}, Ljava/lang/Integer;->intValue()I

    move-result v21

    move/from16 v22, v21

    .line 5943
    .local v22, "aidUid":I
    iget-object v14, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    move-object/from16 v23, v0

    move/from16 v0, v22

    .end local v22    # "aidUid":I
    .local v0, "aidUid":I
    .local v23, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    invoke-virtual {v14, v0, v10, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    .line 5942
    .end local v0    # "aidUid":I
    add-int/lit8 v5, v5, 0x1

    move-object/from16 v0, v23

    const/16 v14, 0x3f8

    goto :goto_1bc

    .line 5945
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .local v0, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1d6
    move-object/from16 v23, v0

    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    goto :goto_1e8

    .line 5940
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1d9
    move-object/from16 v23, v0

    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    goto :goto_1e1

    .line 5938
    .end local v3    # "cid":I
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1dc
    move-object/from16 v23, v0

    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    goto :goto_1e1

    .line 5937
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1df
    move-object/from16 v23, v0

    .line 5949
    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .end local v2    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :goto_1e1
    move-object/from16 v0, v23

    const/16 v14, 0x3f8

    goto :goto_191

    .line 5936
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1e6
    move-object/from16 v23, v0

    .line 5950
    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :goto_1e8
    const/4 v0, 0x1

    if-ne v6, v0, :cond_287

    .line 5951
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v1

    invoke-virtual {v0, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v0

    .line 5952
    .local v0, "vpnClientPackageName":Ljava/lang/String;
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v2

    const/4 v3, 0x1

    invoke-virtual {v1, v0, v3, v2, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addInputFilterDropRulesForInterface(Ljava/lang/String;ILjava/util/List;Ljava/lang/String;)V

    .line 5953
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuidListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v2

    const/4 v14, 0x0

    invoke-virtual {v1, v0, v14, v2, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addInputFilterDropRulesForInterface(Ljava/lang/String;ILjava/util/List;Ljava/lang/String;)V

    .line 5955
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v1

    invoke-virtual {v8, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getChainingEnabledForProfile(I)I

    move-result v1

    const/4 v5, 0x1

    if-eq v1, v5, :cond_240

    .line 5956
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isNativeVpnClient(Ljava/lang/String;)Z

    move-result v1

    if-eqz v1, :cond_234

    .line 5957
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    const/16 v3, 0x3f8

    invoke-virtual {v1, v3, v10, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    goto :goto_242

    .line 5959
    :cond_234
    const/16 v3, 0x3f8

    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v2

    invoke-virtual {v1, v2, v10, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    goto :goto_242

    .line 5955
    :cond_240
    const/16 v3, 0x3f8

    .line 5963
    :goto_242
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v1

    invoke-virtual {v1}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v16

    :goto_24a
    invoke-interface/range {v16 .. v16}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_27e

    invoke-interface/range {v16 .. v16}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Ljava/lang/Integer;

    invoke-virtual {v1}, Ljava/lang/Integer;->intValue()I

    move-result v4

    .line 5964
    .restart local v4    # "uid":I
    const/4 v2, 0x1

    const/16 v18, 0x2

    const/16 v21, 0x3

    const/16 v22, 0x0

    move-object/from16 v1, p0

    move/from16 v24, v3

    move/from16 v3, v18

    move/from16 v18, v5

    move/from16 v5, v21

    move/from16 v21, v6

    .end local v6    # "activateState":I
    .local v21, "activateState":I
    move-object/from16 v6, v22

    move-object/from16 v22, v7

    .end local v7    # "networkState":Ljava/lang/String;
    .local v22, "networkState":Ljava/lang/String;
    move-object v7, v10

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 5965
    .end local v4    # "uid":I
    move/from16 v5, v18

    move/from16 v6, v21

    move-object/from16 v7, v22

    move/from16 v3, v24

    goto :goto_24a

    .line 5963
    .end local v21    # "activateState":I
    .end local v22    # "networkState":Ljava/lang/String;
    .restart local v6    # "activateState":I
    .restart local v7    # "networkState":Ljava/lang/String;
    :cond_27e
    move/from16 v24, v3

    move/from16 v18, v5

    move/from16 v21, v6

    move-object/from16 v22, v7

    .end local v6    # "activateState":I
    .end local v7    # "networkState":Ljava/lang/String;
    .restart local v21    # "activateState":I
    .restart local v22    # "networkState":Ljava/lang/String;
    goto :goto_290

    .line 5950
    .end local v0    # "vpnClientPackageName":Ljava/lang/String;
    .end local v21    # "activateState":I
    .end local v22    # "networkState":Ljava/lang/String;
    .restart local v6    # "activateState":I
    .restart local v7    # "networkState":Ljava/lang/String;
    :cond_287
    move/from16 v18, v0

    move/from16 v21, v6

    move-object/from16 v22, v7

    const/4 v14, 0x0

    const/16 v24, 0x3f8

    .line 5967
    .end local v6    # "activateState":I
    .end local v7    # "networkState":Ljava/lang/String;
    .end local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v20    # "ipChainName":Ljava/lang/String;
    .restart local v22    # "networkState":Ljava/lang/String;
    :goto_290
    move-object/from16 v7, v22

    move-object/from16 v0, v23

    move/from16 v14, v24

    goto/16 :goto_170

    .line 5969
    .end local v22    # "networkState":Ljava/lang/String;
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .local v0, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v7    # "networkState":Ljava/lang/String;
    :cond_298
    move-object/from16 v23, v0

    move-object/from16 v22, v7

    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .end local v7    # "networkState":Ljava/lang/String;
    .restart local v22    # "networkState":Ljava/lang/String;
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    invoke-virtual {v13}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_2a0
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_2c0

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Ljava/lang/Integer;

    invoke-virtual {v1}, Ljava/lang/Integer;->intValue()I

    move-result v1

    .line 5970
    .local v1, "exemptedUserId":I
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v3, "com.android.providers.downloads"

    invoke-virtual {v2, v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v2

    .line 5971
    .local v2, "downloadMangerUid":I
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v3, v2, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addExemptRulesForDownloadManagerUid(ILjava/lang/String;)V
    :try_end_2bd
    .catchall {:try_start_14d .. :try_end_2bd} :catchall_2c1

    .line 5972
    .end local v1    # "exemptedUserId":I
    .end local v2    # "downloadMangerUid":I
    goto :goto_2a0

    .line 5872
    .end local v10    # "defaultNetworkInterface":Ljava/lang/String;
    .end local v11    # "isUserVpnConfiguredForMainUser":Z
    .end local v13    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v15    # "networkDown":Z
    .end local v22    # "networkState":Ljava/lang/String;
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_2be
    move-object/from16 v23, v0

    .line 5976
    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_2c0
    goto :goto_2c9

    .line 5974
    :catchall_2c1
    move-exception v0

    .line 5975
    .local v0, "e":Ljava/lang/Throwable;
    :try_start_2c2
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Exception occured while trying to apply iptable rule for user 0 during connectivity change of mobile network"

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_2c9
    .catchall {:try_start_2c2 .. :try_end_2c9} :catchall_2cb

    .line 5977
    .end local v0    # "e":Ljava/lang/Throwable;
    :goto_2c9
    monitor-exit p0

    return-void

    .line 5867
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .end local p1    # "map":Landroid/os/Bundle;
    :catchall_2cb
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method private declared-synchronized handleActionPackageAdded(Landroid/os/Bundle;)V
    .registers 23
    .param p1, "map"    # Landroid/os/Bundle;

    move-object/from16 v8, p0

    move-object/from16 v9, p1

    monitor-enter p0

    .line 6522
    :try_start_5
    const-string v1, "KnoxVpnEngineService"

    const-string/jumbo v2, "vpn handle : Handle MSG package add"

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_d
    .catchall {:try_start_5 .. :try_end_d} :catchall_494

    .line 6523
    const/4 v1, -0x1

    .line 6524
    .local v1, "uid":I
    const/4 v2, 0x0

    .local v2, "packageName":Ljava/lang/String;
    const/4 v3, 0x0

    .line 6525
    .local v3, "originalPackageName":Ljava/lang/String;
    const/4 v4, 0x0

    .line 6526
    .local v4, "cid":I
    const/4 v5, 0x0

    .line 6528
    .local v5, "extraReplacing":Z
    :try_start_12
    const-string/jumbo v6, "uid"

    invoke-virtual {v9, v6}, Landroid/os/Bundle;->getInt(Ljava/lang/String;)I

    move-result v6
    :try_end_19
    .catch Ljava/lang/Exception; {:try_start_12 .. :try_end_19} :catch_470
    .catchall {:try_start_12 .. :try_end_19} :catchall_494

    move v10, v6

    .line 6529
    .end local v1    # "uid":I
    .local v10, "uid":I
    :try_start_1a
    const-string/jumbo v1, "package"

    invoke-virtual {v9, v1}, Landroid/os/Bundle;->getString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v1
    :try_end_21
    .catch Ljava/lang/Exception; {:try_start_1a .. :try_end_21} :catch_46c
    .catchall {:try_start_1a .. :try_end_21} :catchall_494

    move-object v11, v1

    .line 6530
    .end local v3    # "originalPackageName":Ljava/lang/String;
    .local v11, "originalPackageName":Ljava/lang/String;
    :try_start_22
    invoke-static {v10}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v1
    :try_end_26
    .catch Ljava/lang/Exception; {:try_start_22 .. :try_end_26} :catch_467
    .catchall {:try_start_22 .. :try_end_26} :catchall_494

    move v12, v1

    .line 6531
    .end local v4    # "cid":I
    .local v12, "cid":I
    :try_start_27
    const-string/jumbo v1, "new_install_or_update"

    invoke-virtual {v9, v1}, Landroid/os/Bundle;->getBoolean(Ljava/lang/String;)Z

    move-result v1
    :try_end_2e
    .catch Ljava/lang/Exception; {:try_start_27 .. :try_end_2e} :catch_461
    .catchall {:try_start_27 .. :try_end_2e} :catchall_494

    move v13, v1

    .line 6532
    .end local v5    # "extraReplacing":Z
    .local v13, "extraReplacing":Z
    :try_start_2f
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1, v12, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v1
    :try_end_35
    .catch Ljava/lang/Exception; {:try_start_2f .. :try_end_35} :catch_45a
    .catchall {:try_start_2f .. :try_end_35} :catchall_494

    move-object v14, v1

    .line 6533
    .end local v2    # "packageName":Ljava/lang/String;
    .local v14, "packageName":Ljava/lang/String;
    :try_start_36
    sget-boolean v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v1, :cond_59

    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "vpn handle : package added : package =  "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v3, " : uid = "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v10}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_59
    .catch Ljava/lang/Exception; {:try_start_36 .. :try_end_59} :catch_452
    .catchall {:try_start_36 .. :try_end_59} :catchall_494

    .line 6535
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_59
    if-nez v14, :cond_5d

    .line 6536
    monitor-exit p0

    return-void

    .line 6540
    .restart local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_5d
    :try_start_5d
    invoke-direct {v8, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->hasVpnInterface(Ljava/lang/String;)Z

    move-result v1

    if-eqz v1, :cond_89

    .line 6541
    sget-boolean v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v1, :cond_7e

    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "vpn handle : package added : calling bind package =  "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6542
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_7e
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getAdminIdFromPackageName(Ljava/lang/String;)I

    move-result v1

    .line 6543
    .local v1, "adminId":I
    invoke-direct {v8, v14, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->bindKnoxVpnInterface(Ljava/lang/String;I)Z
    :try_end_87
    .catch Ljava/lang/Exception; {:try_start_5d .. :try_end_87} :catch_452
    .catchall {:try_start_5d .. :try_end_87} :catchall_494

    .line 6544
    monitor-exit p0

    return-void

    .line 6547
    .end local v1    # "adminId":I
    :cond_89
    :try_start_89
    invoke-direct {v8, v12, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->isProxyServicePackage(ILjava/lang/String;)Z

    move-result v1

    if-eqz v1, :cond_112

    .line 6548
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Knox vpn proxy support package has been added in user "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v12}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6549
    if-eqz v13, :cond_110

    .line 6550
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Knox vpn proxy support package has been updated in user "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v12}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6551
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileNames()Ljava/util/Set;

    move-result-object v1

    .line 6552
    .local v1, "profileList":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    invoke-interface {v1}, Ljava/util/Set;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_c7
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_10e

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Ljava/lang/String;

    .line 6553
    .local v3, "pflName":Ljava/lang/String;
    iget-object v4, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v4, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v4

    .line 6554
    .local v4, "pflInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v4, :cond_109

    .line 6555
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPacurl()Landroid/net/Uri;

    move-result-object v5

    .line 6556
    .local v5, "pacUrl":Landroid/net/Uri;
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyServer()Ljava/lang/String;

    move-result-object v6

    .line 6557
    .local v6, "proxyServer":Ljava/lang/String;
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v7

    .line 6558
    .local v7, "interfaceName":Ljava/lang/String;
    sget-object v15, Landroid/net/Uri;->EMPTY:Landroid/net/Uri;

    if-ne v5, v15, :cond_f3

    sget-object v15, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->DEFAULT_PROXY_SERVER:Ljava/lang/String;

    if-eq v6, v15, :cond_f0

    goto :goto_f3

    :cond_f0
    move-object/from16 v16, v1

    goto :goto_10b

    .line 6560
    :cond_f3
    :goto_f3
    if-eqz v7, :cond_106

    .line 6561
    const-string v15, "KnoxVpnEngineService"

    move-object/from16 v16, v1

    .end local v1    # "profileList":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    .local v16, "profileList":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    const-string v1, "Binding again to pac service after package update"

    invoke-static {v15, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6562
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnPacProcessor()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v1

    invoke-virtual {v1, v3, v7, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->bindProxyService(Ljava/lang/String;Ljava/lang/String;Landroid/net/Uri;)V
    :try_end_105
    .catch Ljava/lang/Exception; {:try_start_89 .. :try_end_105} :catch_452
    .catchall {:try_start_89 .. :try_end_105} :catchall_494

    goto :goto_10b

    .line 6560
    .end local v16    # "profileList":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    .restart local v1    # "profileList":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    :cond_106
    move-object/from16 v16, v1

    .end local v1    # "profileList":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    .restart local v16    # "profileList":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    goto :goto_10b

    .line 6554
    .end local v5    # "pacUrl":Landroid/net/Uri;
    .end local v6    # "proxyServer":Ljava/lang/String;
    .end local v7    # "interfaceName":Ljava/lang/String;
    .end local v16    # "profileList":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    .restart local v1    # "profileList":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    :cond_109
    move-object/from16 v16, v1

    .line 6567
    .end local v1    # "profileList":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    .end local v3    # "pflName":Ljava/lang/String;
    .end local v4    # "pflInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v16    # "profileList":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    :goto_10b
    move-object/from16 v1, v16

    goto :goto_c7

    .line 6552
    .end local v16    # "profileList":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    .restart local v1    # "profileList":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    :cond_10e
    move-object/from16 v16, v1

    .line 6569
    .end local v1    # "profileList":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    :cond_110
    monitor-exit p0

    return-void

    .line 6572
    :cond_112
    :try_start_112
    const-string v1, "com.knox.vpn.proxyhandler"

    invoke-virtual {v11, v1}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v1

    if-eqz v1, :cond_132

    .line 6573
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Knox vpn proxy support package has been added on profile users "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v12}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_130
    .catch Ljava/lang/Exception; {:try_start_112 .. :try_end_130} :catch_452
    .catchall {:try_start_112 .. :try_end_130} :catchall_494

    .line 6574
    monitor-exit p0

    return-void

    .line 6577
    :cond_132
    :try_start_132
    const-string v1, "com.samsung.knox.vpn.tether.auth"

    invoke-virtual {v11, v1}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v1

    const/4 v2, 0x1

    if-eqz v1, :cond_1e2

    .line 6578
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-static {v10}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v3

    const-string v4, "com.samsung.knox.vpn.tether.auth"

    invoke-virtual {v1, v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->checkIfPlatformSigned(ILjava/lang/String;)Z

    move-result v1

    if-eqz v1, :cond_1e2

    .line 6579
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->getTetherAuthStatus()Z

    move-result v1

    if-eqz v1, :cond_15b

    .line 6580
    const-string v1, "KnoxVpnTetherAuthentication"

    const-string/jumbo v2, "usb tether auth application is installed and mutual authentication not needed"

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_159
    .catch Ljava/lang/Exception; {:try_start_132 .. :try_end_159} :catch_452
    .catchall {:try_start_132 .. :try_end_159} :catchall_494

    .line 6581
    monitor-exit p0

    return-void

    .line 6583
    :cond_15b
    :try_start_15b
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_165
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_1e2

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 6584
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbtetherAuth()I

    move-result v4

    if-ne v4, v2, :cond_1e0

    invoke-static {v10}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v4

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v5

    if-ne v4, v5, :cond_1e0

    .line 6585
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v1

    .line 6586
    .local v1, "profileName":Ljava/lang/String;
    iget-object v4, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v5, "com.samsung.knox.vpn.tether.auth"

    invoke-virtual {v4, v1, v5, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveAppsFromBatteryOptimization(Ljava/lang/String;Ljava/lang/String;Z)V

    .line 6587
    const-string v4, "KnoxVpnTetherAuthentication"

    const-string/jumbo v5, "usb tether auth application is installed, start bind to usb auth service"

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6588
    iget-object v4, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    invoke-static {v10}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v5

    invoke-virtual {v4, v1, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->bindTetherAuthService(Ljava/lang/String;I)V

    .line 6589
    iget-object v4, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getInterfaceNameForUsbtethering()Ljava/lang/String;

    move-result-object v4

    .line 6590
    .local v4, "usbTetheringIface":Ljava/lang/String;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v5

    .line 6591
    .local v5, "vpnInterface":Ljava/lang/String;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v6

    .line 6592
    .local v6, "activateState":I
    if-eqz v4, :cond_1e2

    .line 6593
    if-nez v5, :cond_1bf

    if-ne v6, v2, :cond_1bf

    .line 6594
    const-string v7, "KnoxVpnTetherAuthentication"

    const-string/jumbo v15, "usb tether auth application is installed, adding blocking rules since vpn is not up"

    invoke-static {v7, v15}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6595
    iget-object v7, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v7, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForDroppingTetherPackets(Ljava/lang/String;)V

    goto :goto_1e2

    .line 6596
    :cond_1bf
    if-eqz v5, :cond_1e2

    if-ne v6, v2, :cond_1e2

    .line 6597
    const-string v7, "KnoxVpnTetherAuthentication"

    const-string/jumbo v15, "usb tether auth application is installed, start mutual authentication"

    invoke-static {v7, v15}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6598
    iget-object v7, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesForDroppingTethePackets()V

    .line 6599
    iget-object v7, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getIpAddressForUsbTetheringInterface()Ljava/util/List;

    move-result-object v7

    .line 6600
    .local v7, "usbTetherIfaceAddr":Ljava/util/List;, "Ljava/util/List<Ljava/net/InetAddress;>;"
    iget-object v15, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v2

    invoke-virtual {v15, v2, v4, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->startTetherAuthProcess(ILjava/lang/String;Ljava/util/List;)V

    .line 6601
    .end local v7    # "usbTetherIfaceAddr":Ljava/util/List;, "Ljava/util/List<Ljava/net/InetAddress;>;"
    goto :goto_1e2

    .line 6605
    .end local v1    # "profileName":Ljava/lang/String;
    .end local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v4    # "usbTetheringIface":Ljava/lang/String;
    .end local v5    # "vpnInterface":Ljava/lang/String;
    .end local v6    # "activateState":I
    :cond_1e0
    const/4 v2, 0x1

    goto :goto_165

    .line 6609
    :cond_1e2
    :goto_1e2
    if-eqz v13, :cond_26e

    .line 6610
    const-string v1, "KnoxVpnEngineService"

    const-string/jumbo v2, "vpn handle : package added: package being updated"

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6611
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->checkIfUidHasInternetPermission(I)I

    move-result v1

    .line 6612
    .local v1, "result":I
    if-nez v1, :cond_243

    .line 6613
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getProfileNameForPermissionUpdatedApp(I)Ljava/lang/String;

    move-result-object v2

    .line 6614
    .local v2, "profileName":Ljava/lang/String;
    if-eqz v2, :cond_26b

    .line 6615
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "The app is being upgraded with internet permission, adding to vpn profile "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6617
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v3

    .line 6618
    .restart local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v3, :cond_239

    .line 6619
    new-instance v4, Ljava/util/ArrayList;

    invoke-direct {v4}, Ljava/util/ArrayList;-><init>()V

    .line 6620
    .local v4, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    invoke-static {v10}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v5

    invoke-interface {v4, v5}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 6621
    iget-object v5, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v7

    iget-object v15, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v15, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getDefaultNetworkInterface(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v15

    invoke-virtual {v5, v6, v7, v4, v15}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;Ljava/util/List;Ljava/lang/String;)V

    .line 6624
    .end local v4    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :cond_239
    invoke-direct {v8, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackagesFromPermissionCheckDb(I)V

    .line 6625
    invoke-direct {v8, v2, v11, v10, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->writePackageToDB(Ljava/lang/String;Ljava/lang/String;II)I

    .line 6627
    invoke-direct {v8, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->refreshDomainInHashMap(Ljava/lang/String;)V

    goto :goto_26b

    .line 6630
    .end local v2    # "profileName":Ljava/lang/String;
    .end local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_243
    const/4 v2, 0x1

    if-ne v1, v2, :cond_26b

    .line 6631
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getProfileOwningTheUid(I)Ljava/lang/String;

    move-result-object v2

    .line 6632
    .local v2, "profileOwningUid":Ljava/lang/String;
    if-eqz v2, :cond_26c

    .line 6633
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "The app is being downgraded without internet permission, removing from vpn profile "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6634
    invoke-direct {v8, v2, v11, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackageListByUid(Ljava/lang/String;Ljava/lang/String;I)V

    .line 6635
    invoke-direct {v8, v2, v11, v12, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->writePackagestoPermissionCheckDb(Ljava/lang/String;Ljava/lang/String;II)V
    :try_end_26a
    .catch Ljava/lang/Exception; {:try_start_15b .. :try_end_26a} :catch_452
    .catchall {:try_start_15b .. :try_end_26a} :catchall_494

    goto :goto_26c

    .line 6630
    .end local v2    # "profileOwningUid":Ljava/lang/String;
    :cond_26b
    :goto_26b
    nop

    .line 6638
    :cond_26c
    :goto_26c
    monitor-exit p0

    return-void

    .line 6642
    .end local v1    # "result":I
    :cond_26e
    :try_start_26e
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isWideVpnExists(I)Z

    move-result v1

    move v15, v1

    .line 6643
    .local v15, "isUserWideVpnExist":Z
    if-eqz v15, :cond_31b

    .line 6644
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "No action needed for package added use-case, since user-wide vpn is configured "

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6645
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v3, "ADD_ALL_PACKAGES"

    invoke-virtual {v2, v12, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getProfileOwningThePackage(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v1

    move-object v7, v1

    .line 6646
    .local v7, "profileOwningDeviceWideVpn":Ljava/lang/String;
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v1

    move-object/from16 v17, v1

    .line 6647
    .local v17, "profileOwningDeviceWideVpnInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v17, :cond_317

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v1

    const/4 v2, 0x1

    if-ne v1, v2, :cond_317

    .line 6648
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1, v7, v14, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateExemptedListToDatabase(Ljava/lang/String;Ljava/lang/String;I)Z

    move-result v1
    :try_end_2a4
    .catch Ljava/lang/Exception; {:try_start_26e .. :try_end_2a4} :catch_452
    .catchall {:try_start_26e .. :try_end_2a4} :catchall_494

    move/from16 v16, v1

    .line 6649
    .local v16, "isPackageAddedByAdmin":Z
    if-nez v16, :cond_2aa

    .line 6650
    monitor-exit p0

    return-void

    .line 6652
    .restart local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_2aa
    :try_start_2aa
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdForExemptedUids()Ljava/util/HashSet;

    move-result-object v1

    move-object v6, v1

    .line 6653
    .local v6, "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    invoke-static {v12}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v1

    invoke-virtual {v6, v1}, Ljava/util/HashSet;->contains(Ljava/lang/Object;)Z

    move-result v1

    if-nez v1, :cond_2ce

    .line 6654
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v2, "com.android.providers.downloads"

    invoke-virtual {v1, v12, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v1

    .line 6655
    .local v1, "downloadMangerUid":I
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getActiveNetworkInterface()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addExemptRulesForDownloadManagerUid(ILjava/lang/String;)V

    .line 6657
    .end local v1    # "downloadMangerUid":I
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_2ce
    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v1

    invoke-static {v10}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v1, v2}, Ljava/util/HashSet;->add(Ljava/lang/Object;)Z

    .line 6658
    const/4 v2, 0x1

    const/4 v3, 0x1

    const/4 v5, 0x0

    const/16 v18, 0x0

    const/16 v19, 0x0

    move-object/from16 v1, p0

    move v4, v10

    move-object/from16 v20, v6

    .end local v6    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .local v20, "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    move-object/from16 v6, v18

    move-object/from16 v18, v7

    .end local v7    # "profileOwningDeviceWideVpn":Ljava/lang/String;
    .local v18, "profileOwningDeviceWideVpn":Ljava/lang/String;
    move-object/from16 v7, v19

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 6659
    const/4 v2, 0x1

    const/4 v3, 0x2

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v5

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    .line 6660
    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v7

    .line 6659
    move-object/from16 v1, p0

    move v4, v10

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 6661
    const/4 v2, 0x1

    const/4 v3, 0x3

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v5

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    .line 6662
    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v7

    .line 6661
    move-object/from16 v1, p0

    move v4, v10

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V
    :try_end_316
    .catch Ljava/lang/Exception; {:try_start_2aa .. :try_end_316} :catch_452
    .catchall {:try_start_2aa .. :try_end_316} :catchall_494

    goto :goto_319

    .line 6647
    .end local v16    # "isPackageAddedByAdmin":Z
    .end local v18    # "profileOwningDeviceWideVpn":Ljava/lang/String;
    .end local v20    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v7    # "profileOwningDeviceWideVpn":Ljava/lang/String;
    :cond_317
    move-object/from16 v18, v7

    .line 6665
    .end local v7    # "profileOwningDeviceWideVpn":Ljava/lang/String;
    .restart local v18    # "profileOwningDeviceWideVpn":Ljava/lang/String;
    :goto_319
    monitor-exit p0

    return-void

    .line 6668
    .end local v17    # "profileOwningDeviceWideVpnInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v18    # "profileOwningDeviceWideVpn":Ljava/lang/String;
    :cond_31b
    :try_start_31b
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getProfileOwningThePackage(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v1

    .line 6669
    .local v1, "profile":Ljava/lang/String;
    if-eqz v1, :cond_450

    .line 6670
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 6671
    .local v2, "profileInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    const/4 v3, 0x0

    .line 6672
    .local v3, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    if-eqz v2, :cond_331

    .line 6673
    invoke-virtual {v2, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackage(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    move-result-object v4

    move-object v3, v4

    .line 6675
    :cond_331
    if-nez v3, :cond_33b

    .line 6676
    const-string v4, "KnoxVpnEngineService"

    const-string v5, "The application added might be an update to an existing one to the profile"

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_349

    .line 6677
    :cond_33b
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v4

    const/4 v5, -0x1

    if-ne v4, v5, :cond_445

    .line 6678
    const-string v4, "KnoxVpnEngineService"

    const-string v5, "The application added by admin but not present in the device till now has been installed"

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6683
    .end local v2    # "profileInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :goto_349
    nop

    .line 6687
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getProfileOwningTheUid(I)Ljava/lang/String;

    move-result-object v2

    .line 6688
    .local v2, "profileOwningUid":Ljava/lang/String;
    if-eqz v2, :cond_363

    if-eqz v1, :cond_363

    .line 6689
    invoke-virtual {v2, v1}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v3

    if-nez v3, :cond_363

    .line 6690
    const-string v3, "KnoxVpnEngineService"

    const-string v4, "Multiple profile exists with same uid, so cancelling adding further attempts"

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_361
    .catch Ljava/lang/Exception; {:try_start_31b .. :try_end_361} :catch_452
    .catchall {:try_start_31b .. :try_end_361} :catchall_494

    .line 6691
    monitor-exit p0

    return-void

    .line 6695
    :cond_363
    :try_start_363
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_37e

    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "vpn handle : package added : checking update package =  "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6697
    :cond_37e
    invoke-direct {v8, v14, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updatePackageData(Ljava/lang/String;I)Z

    move-result v3

    if-eqz v3, :cond_43f

    .line 6698
    const-string v3, "KnoxVpnEngineService"

    const-string/jumbo v4, "vpn handle : package add : Package found in DB with rule proceed with logic"

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_38c
    .catch Ljava/lang/Exception; {:try_start_363 .. :try_end_38c} :catch_452
    .catchall {:try_start_363 .. :try_end_38c} :catchall_494

    .line 6700
    const/4 v3, 0x0

    .line 6701
    .local v3, "profileName":Ljava/lang/String;
    const/4 v4, -0x1

    .line 6702
    .end local v10    # "uid":I
    .local v4, "uid":I
    :try_start_38e
    iget-object v5, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v6, "VpnPackageInfo"

    const-string/jumbo v7, "packageName"

    filled-new-array {v7}, [Ljava/lang/String;

    move-result-object v7

    move-object/from16 v17, v1

    const/4 v10, 0x1

    .end local v1    # "profile":Ljava/lang/String;
    .local v17, "profile":Ljava/lang/String;
    new-array v1, v10, [Ljava/lang/String;

    const/4 v10, 0x0

    aput-object v14, v1, v10

    const-string/jumbo v10, "profileName"

    move-object/from16 v18, v2

    .end local v2    # "profileOwningUid":Ljava/lang/String;
    .local v18, "profileOwningUid":Ljava/lang/String;
    const-string/jumbo v2, "packageUid"

    filled-new-array {v10, v2}, [Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v5, v6, v7, v1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v1
    :try_end_3b1
    .catch Ljava/lang/Exception; {:try_start_38e .. :try_end_3b1} :catch_437
    .catchall {:try_start_38e .. :try_end_3b1} :catchall_494

    .line 6710
    .local v1, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    if-eqz v1, :cond_3fe

    .line 6712
    :try_start_3b3
    const-string v2, "KnoxVpnEngineService"

    const-string/jumbo v5, "getting vpn object from database : Cursor not null"

    invoke-static {v2, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6713
    invoke-virtual {v1}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_3bf
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v5

    if-eqz v5, :cond_3e0

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Landroid/content/ContentValues;

    .line 6714
    .local v5, "cv":Landroid/content/ContentValues;
    const-string/jumbo v6, "profileName"

    invoke-virtual {v5, v6}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v6

    move-object v3, v6

    .line 6715
    const-string/jumbo v6, "packageUid"

    invoke-virtual {v5, v6}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v6

    invoke-virtual {v6}, Ljava/lang/Integer;->intValue()I

    move-result v6
    :try_end_3de
    .catch Ljava/lang/Exception; {:try_start_3b3 .. :try_end_3de} :catch_3e1
    .catchall {:try_start_3b3 .. :try_end_3de} :catchall_494

    move v4, v6

    .line 6716
    .end local v5    # "cv":Landroid/content/ContentValues;
    goto :goto_3bf

    .line 6719
    :cond_3e0
    goto :goto_3fe

    .line 6717
    :catch_3e1
    move-exception v0

    move-object v2, v0

    .line 6718
    .local v2, "e":Ljava/lang/Exception;
    :try_start_3e3
    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "getting vpn object from database : Exception: "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 6722
    .end local v2    # "e":Ljava/lang/Exception;
    :cond_3fe
    :goto_3fe
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 6723
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v2, :cond_409

    .line 6724
    invoke-virtual {v2, v14, v4, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->addPackageEntry(Ljava/lang/String;II)V

    .line 6727
    :cond_409
    new-instance v5, Ljava/util/ArrayList;

    invoke-direct {v5}, Ljava/util/ArrayList;-><init>()V

    .line 6728
    .local v5, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    invoke-static {v4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v6

    invoke-interface {v5, v6}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 6730
    iget-object v6, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v10

    move-object/from16 v19, v1

    .end local v1    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .local v19, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getDefaultNetworkInterface(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v1

    invoke-virtual {v6, v7, v10, v5, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;Ljava/util/List;Ljava/lang/String;)V

    .line 6732
    const/4 v1, 0x1

    invoke-virtual {v8, v3, v5, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnForPerApplication(Ljava/lang/String;Ljava/util/List;Z)I

    .line 6733
    sget-boolean v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v1, :cond_435

    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->printProfileVpnMap()V
    :try_end_435
    .catch Ljava/lang/Exception; {:try_start_3e3 .. :try_end_435} :catch_437
    .catchall {:try_start_3e3 .. :try_end_435} :catchall_494

    .line 6737
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "profileName":Ljava/lang/String;
    .end local v5    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v15    # "isUserWideVpnExist":Z
    .end local v17    # "profile":Ljava/lang/String;
    .end local v18    # "profileOwningUid":Ljava/lang/String;
    .end local v19    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    :cond_435
    move v10, v4

    goto :goto_443

    .line 6735
    :catch_437
    move-exception v0

    move-object v6, v0

    move v1, v4

    move-object v3, v11

    move v4, v12

    move v5, v13

    move-object v2, v14

    goto :goto_472

    .line 6697
    .end local v4    # "uid":I
    .local v1, "profile":Ljava/lang/String;
    .local v2, "profileOwningUid":Ljava/lang/String;
    .restart local v10    # "uid":I
    .restart local v15    # "isUserWideVpnExist":Z
    :cond_43f
    move-object/from16 v17, v1

    move-object/from16 v18, v2

    .line 6737
    .end local v1    # "profile":Ljava/lang/String;
    .end local v2    # "profileOwningUid":Ljava/lang/String;
    .end local v15    # "isUserWideVpnExist":Z
    :goto_443
    goto/16 :goto_492

    .line 6680
    .restart local v1    # "profile":Ljava/lang/String;
    .local v2, "profileInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .local v3, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .restart local v15    # "isUserWideVpnExist":Z
    :cond_445
    move-object/from16 v17, v1

    .end local v1    # "profile":Ljava/lang/String;
    .restart local v17    # "profile":Ljava/lang/String;
    :try_start_447
    const-string v1, "KnoxVpnEngineService"

    const-string v4, "The application added is already added to a vpn profile, so cancelling further calls"

    invoke-static {v1, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_44e
    .catch Ljava/lang/Exception; {:try_start_447 .. :try_end_44e} :catch_452
    .catchall {:try_start_447 .. :try_end_44e} :catchall_494

    .line 6681
    monitor-exit p0

    return-void

    .line 6684
    .end local v2    # "profileInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v17    # "profile":Ljava/lang/String;
    .restart local v1    # "profile":Ljava/lang/String;
    :cond_450
    monitor-exit p0

    return-void

    .line 6735
    .end local v1    # "profile":Ljava/lang/String;
    .end local v15    # "isUserWideVpnExist":Z
    :catch_452
    move-exception v0

    move-object v6, v0

    move v1, v10

    move-object v3, v11

    move v4, v12

    move v5, v13

    move-object v2, v14

    goto :goto_472

    .end local v14    # "packageName":Ljava/lang/String;
    .local v2, "packageName":Ljava/lang/String;
    :catch_45a
    move-exception v0

    move-object v6, v0

    move v1, v10

    move-object v3, v11

    move v4, v12

    move v5, v13

    goto :goto_472

    .end local v13    # "extraReplacing":Z
    .local v5, "extraReplacing":Z
    :catch_461
    move-exception v0

    move-object v6, v0

    move v1, v10

    move-object v3, v11

    move v4, v12

    goto :goto_472

    .end local v12    # "cid":I
    .local v4, "cid":I
    :catch_467
    move-exception v0

    move-object v6, v0

    move v1, v10

    move-object v3, v11

    goto :goto_472

    .end local v11    # "originalPackageName":Ljava/lang/String;
    .local v3, "originalPackageName":Ljava/lang/String;
    :catch_46c
    move-exception v0

    move-object v6, v0

    move v1, v10

    goto :goto_472

    .end local v10    # "uid":I
    .local v1, "uid":I
    :catch_470
    move-exception v0

    move-object v6, v0

    .line 6736
    .local v6, "e":Ljava/lang/Exception;
    :goto_472
    :try_start_472
    const-string v7, "KnoxVpnEngineService"

    new-instance v10, Ljava/lang/StringBuilder;

    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v11, "vpn handle : pakcage add : Exception:"

    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v6}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v11

    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v10

    invoke-static {v7, v10}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_48d
    .catchall {:try_start_472 .. :try_end_48d} :catchall_494

    move v10, v1

    move-object v14, v2

    move-object v11, v3

    move v12, v4

    move v13, v5

    .line 6738
    .end local v1    # "uid":I
    .end local v2    # "packageName":Ljava/lang/String;
    .end local v3    # "originalPackageName":Ljava/lang/String;
    .end local v4    # "cid":I
    .end local v5    # "extraReplacing":Z
    .end local v6    # "e":Ljava/lang/Exception;
    .restart local v10    # "uid":I
    .restart local v11    # "originalPackageName":Ljava/lang/String;
    .restart local v12    # "cid":I
    .restart local v13    # "extraReplacing":Z
    .restart local v14    # "packageName":Ljava/lang/String;
    :goto_492
    monitor-exit p0

    return-void

    .line 6521
    .end local v10    # "uid":I
    .end local v11    # "originalPackageName":Ljava/lang/String;
    .end local v12    # "cid":I
    .end local v13    # "extraReplacing":Z
    .end local v14    # "packageName":Ljava/lang/String;
    .end local p1    # "map":Landroid/os/Bundle;
    :catchall_494
    move-exception v0

    move-object v1, v0

    monitor-exit p0

    throw v1
.end method

.method private declared-synchronized handleActionUsbTethering(Landroid/os/Bundle;)V
    .registers 10
    .param p1, "map"    # Landroid/os/Bundle;

    monitor-enter p0

    .line 5566
    :try_start_1
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v0

    .line 5567
    .local v0, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    if-eqz v0, :cond_67

    invoke-interface {v0}, Ljava/util/Collection;->size()I

    move-result v1

    if-lez v1, :cond_67

    .line 5569
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_19
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_67

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 5570
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbTethering()I

    move-result v3

    const/4 v4, 0x1

    if-ne v3, v4, :cond_66

    .line 5571
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v1

    .line 5572
    .local v1, "vpnIface":Ljava/lang/String;
    const-string v3, "bundle_usb_status"

    invoke-virtual {p1, v3}, Landroid/os/Bundle;->getInt(Ljava/lang/String;)I

    move-result v3

    .line 5573
    .local v3, "usb_status":I
    if-nez v3, :cond_3f

    .line 5574
    if-eqz v1, :cond_67

    invoke-virtual {v1}, Ljava/lang/String;->isEmpty()Z

    move-result v4

    goto :goto_67

    .line 5576
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_3f
    if-ne v3, v4, :cond_67

    .line 5577
    if-eqz v1, :cond_52

    invoke-virtual {v1}, Ljava/lang/String;->isEmpty()Z

    move-result v5

    if-nez v5, :cond_52

    .line 5579
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v6

    invoke-virtual {v5, v6, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesForUsbTethering(ILjava/lang/String;)V

    .line 5581
    :cond_52
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbtetherAuth()I

    move-result v5

    .line 5582
    .local v5, "isUsbTetherAuthEnabled":I
    if-ne v5, v4, :cond_65

    .line 5583
    const-string v6, "KnoxVpnTetherAuthentication"

    const-string/jumbo v7, "usb tether auth process is going to be stopped after usb or usb tethering is disabled"

    invoke-static {v6, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5584
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    invoke-virtual {v6, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->stopTetheringAuthProcess(Z)V
    :try_end_65
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_65} :catch_6a
    .catchall {:try_start_1 .. :try_end_65} :catchall_68

    .line 5586
    .end local v5    # "isUsbTetherAuthEnabled":I
    :cond_65
    goto :goto_67

    .line 5589
    .end local v1    # "vpnIface":Ljava/lang/String;
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "usb_status":I
    :cond_66
    goto :goto_19

    .line 5593
    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_67
    :goto_67
    goto :goto_72

    .line 5565
    .end local p1    # "map":Landroid/os/Bundle;
    :catchall_68
    move-exception p1

    goto :goto_74

    .line 5591
    .restart local p1    # "map":Landroid/os/Bundle;
    :catch_6a
    move-exception v0

    .line 5592
    .local v0, "e":Ljava/lang/Exception;
    :try_start_6b
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Exception occured while trying to enable usb tethering after the usb cable is attached"

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_72
    .catchall {:try_start_6b .. :try_end_72} :catchall_68

    .line 5594
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_72
    monitor-exit p0

    return-void

    .line 5565
    .end local p1    # "map":Landroid/os/Bundle;
    :goto_74
    monitor-exit p0

    throw p1
.end method

.method private declared-synchronized handleActionUserRemoved(Landroid/os/Bundle;)V
    .registers 16
    .param p1, "map"    # Landroid/os/Bundle;

    monitor-enter p0

    .line 6911
    :try_start_1
    const-string v0, "android.intent.extra.user_handle"

    const/16 v1, -0x2710

    invoke-virtual {p1, v0, v1}, Landroid/os/Bundle;->getInt(Ljava/lang/String;I)I

    move-result v0

    .line 6912
    .local v0, "userId":I
    const/4 v1, -0x1

    .line 6913
    .local v1, "adminId":I
    const/4 v2, 0x0

    .line 6914
    .local v2, "profileName":Ljava/lang/String;
    const/4 v3, 0x0

    .line 6916
    .local v3, "transformedPackageName":Ljava/lang/String;
    const-string v4, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "handleActionUserRemoved : Got USERREMOVED intent : "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_23
    .catchall {:try_start_1 .. :try_end_23} :catchall_20d

    .line 6923
    :try_start_23
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v5, "com.android.providers.downloads"

    invoke-virtual {v4, v0, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v4

    .line 6924
    .local v4, "downloadMangerUid":I
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v5, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForDownloadManagerUid(I)V
    :try_end_30
    .catch Ljava/lang/Exception; {:try_start_23 .. :try_end_30} :catch_31
    .catchall {:try_start_23 .. :try_end_30} :catchall_20d

    .line 6927
    .end local v4    # "downloadMangerUid":I
    goto :goto_32

    .line 6925
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :catch_31
    move-exception v4

    .line 6930
    :goto_32
    :try_start_32
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const/16 v5, 0x3ea

    invoke-static {v0, v5}, Landroid/os/UserHandle;->getUid(II)I

    move-result v5

    const/4 v6, 0x0

    invoke-virtual {v4, v2, v5, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveSystemAppFromDataSaverWhitelist(Ljava/lang/String;IZ)V

    .line 6932
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mIgnoreConnectCheckForChaining:Ljava/util/concurrent/ConcurrentHashMap;

    if-eqz v4, :cond_57

    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mIgnoreConnectCheckForChaining:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/util/concurrent/ConcurrentHashMap;->containsKey(Ljava/lang/Object;)Z

    move-result v4

    if-eqz v4, :cond_57

    .line 6933
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mIgnoreConnectCheckForChaining:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/util/concurrent/ConcurrentHashMap;->remove(Ljava/lang/Object;)Ljava/lang/Object;
    :try_end_57
    .catchall {:try_start_32 .. :try_end_57} :catchall_20d

    .line 6938
    :cond_57
    const/4 v4, 0x0

    const/4 v5, 0x1

    :try_start_59
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v8, "VpnProfileInfo"

    const-string/jumbo v9, "personaId"

    filled-new-array {v9}, [Ljava/lang/String;

    move-result-object v9

    new-array v10, v5, [Ljava/lang/String;

    .line 6939
    invoke-static {v0}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;

    move-result-object v11

    aput-object v11, v10, v6

    .line 6938
    invoke-virtual {v7, v8, v9, v10, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v7

    .line 6940
    .local v7, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    sget-boolean v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v8, :cond_8f

    const-string v8, "KnoxVpnEngineService"

    new-instance v9, Ljava/lang/StringBuilder;

    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v10, "handleActionUserRemoved : #1 cvList.size() : "

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/util/ArrayList;->size()I

    move-result v10

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v9

    invoke-static {v8, v9}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6941
    :cond_8f
    if-eqz v7, :cond_f0

    .line 6942
    invoke-virtual {v7}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v8

    :goto_95
    invoke-interface {v8}, Ljava/util/Iterator;->hasNext()Z

    move-result v9

    if-eqz v9, :cond_f0

    invoke-interface {v8}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v9

    check-cast v9, Landroid/content/ContentValues;

    .line 6943
    .local v9, "cv":Landroid/content/ContentValues;
    const-string v10, "adminUid"

    invoke-virtual {v9, v10}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v10

    invoke-virtual {v10}, Ljava/lang/Integer;->intValue()I

    move-result v10

    move v1, v10

    .line 6944
    const-string/jumbo v10, "profileName"

    invoke-virtual {v9, v10}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v10

    move-object v2, v10

    .line 6945
    sget-boolean v10, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v10, :cond_cf

    const-string v10, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v12, "handleActionUserRemoved : profileName = "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    invoke-static {v10, v11}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6947
    :cond_cf
    iget-object v10, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v10, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v10

    .line 6948
    .local v10, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v10, :cond_ef

    .line 6949
    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v11

    invoke-static {v11}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v11

    .line 6950
    .local v11, "vendorUserId":I
    if-ne v11, v0, :cond_ef

    .line 6951
    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v12

    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v13

    invoke-direct {p0, v2, v12, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeProfileFromKeyStore(Ljava/lang/String;ILjava/lang/String;)V

    .line 6952
    invoke-direct {p0, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeProfileFromHashMapAndDB(Ljava/lang/String;)V
    :try_end_ef
    .catch Ljava/lang/Exception; {:try_start_59 .. :try_end_ef} :catch_f1
    .catchall {:try_start_59 .. :try_end_ef} :catchall_20d

    .line 6955
    .end local v9    # "cv":Landroid/content/ContentValues;
    .end local v10    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v11    # "vendorUserId":I
    :cond_ef
    goto :goto_95

    .line 6959
    .end local v7    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    :cond_f0
    goto :goto_10d

    .line 6957
    :catch_f1
    move-exception v7

    .line 6958
    .local v7, "e":Ljava/lang/Exception;
    :try_start_f2
    const-string v8, "KnoxVpnEngineService"

    new-instance v9, Ljava/lang/StringBuilder;

    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v10, "handleActionUserRemoved : Exception : "

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v7}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v10

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v9

    invoke-static {v8, v9}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_10d
    .catchall {:try_start_f2 .. :try_end_10d} :catchall_20d

    .line 6962
    .end local v7    # "e":Ljava/lang/Exception;
    :goto_10d
    :try_start_10d
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v8, "VpnPackageInfo"

    const-string/jumbo v9, "packageCid"

    filled-new-array {v9}, [Ljava/lang/String;

    move-result-object v9

    new-array v10, v5, [Ljava/lang/String;

    .line 6963
    invoke-static {v0}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;

    move-result-object v11

    aput-object v11, v10, v6

    .line 6962
    invoke-virtual {v7, v8, v9, v10, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v4

    .line 6964
    .local v4, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    sget-boolean v7, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v7, :cond_143

    const-string v7, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "handleActionUserRemoved : #3 cvList.size() : "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/util/ArrayList;->size()I

    move-result v9

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v7, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6965
    :cond_143
    if-eqz v4, :cond_1ee

    .line 6966
    invoke-virtual {v4}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v7

    :goto_149
    invoke-interface {v7}, Ljava/util/Iterator;->hasNext()Z

    move-result v8

    if-eqz v8, :cond_1ee

    invoke-interface {v7}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v8

    check-cast v8, Landroid/content/ContentValues;

    .line 6967
    .local v8, "cv":Landroid/content/ContentValues;
    const-string/jumbo v9, "profileName"

    invoke-virtual {v8, v9}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v9

    move-object v2, v9

    .line 6968
    const-string/jumbo v9, "packageName"

    invoke-virtual {v8, v9}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v9

    move-object v3, v9

    .line 6970
    iget-object v9, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v9, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v9

    .line 6971
    .local v9, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v9, :cond_1ec

    .line 6972
    invoke-virtual {v9}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getAdminId()I

    move-result v10

    move v1, v10

    .line 6973
    sget-boolean v10, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v10, :cond_19d

    const-string v10, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v12, "handleActionUserRemoved : profileName = "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v12, " adminId = "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v12, " transformedPackageName = "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    invoke-static {v10, v11}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6974
    :cond_19d
    sget-boolean v10, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v10, :cond_1c2

    const-string v10, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v12, "handleActionUserRemoved : package = "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v12, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v9}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v13

    invoke-virtual {v12, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v12

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    invoke-static {v10, v11}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6975
    :cond_1c2
    new-instance v10, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;

    iget-object v11, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v9}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v12

    invoke-virtual {v11, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v11

    invoke-direct {v10, v1, v0, v11}, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;-><init>(IILjava/lang/String;)V

    .line 6976
    .local v10, "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v11

    invoke-virtual {v11, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->checkIfAddAllPackage(Ljava/lang/String;)Z

    move-result v11

    if-eqz v11, :cond_1df

    .line 6977
    invoke-virtual {p0, v10, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeAllPackagesFromVpn(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    goto :goto_1ec

    .line 6979
    :cond_1df
    new-array v11, v5, [Ljava/lang/String;

    iget-object v12, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v12, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v12

    aput-object v12, v11, v6

    .line 6980
    .local v11, "regularPackageNames":[Ljava/lang/String;
    invoke-virtual {p0, v10, v11, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackagesFromVpn(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;[Ljava/lang/String;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    :try_end_1ec
    .catch Ljava/lang/Exception; {:try_start_10d .. :try_end_1ec} :catch_1ef
    .catchall {:try_start_10d .. :try_end_1ec} :catchall_20d

    .line 6983
    .end local v8    # "cv":Landroid/content/ContentValues;
    .end local v9    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v10    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local v11    # "regularPackageNames":[Ljava/lang/String;
    :cond_1ec
    :goto_1ec
    goto/16 :goto_149

    .line 6987
    .end local v4    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    :cond_1ee
    goto :goto_20b

    .line 6985
    :catch_1ef
    move-exception v4

    .line 6986
    .local v4, "e":Ljava/lang/Exception;
    :try_start_1f0
    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "handleActionUserRemoved : Exception : "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v4}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_20b
    .catchall {:try_start_1f0 .. :try_end_20b} :catchall_20d

    .line 6988
    .end local v4    # "e":Ljava/lang/Exception;
    :goto_20b
    monitor-exit p0

    return-void

    .line 6910
    .end local v0    # "userId":I
    .end local v1    # "adminId":I
    .end local v2    # "profileName":Ljava/lang/String;
    .end local v3    # "transformedPackageName":Ljava/lang/String;
    .end local p1    # "map":Landroid/os/Bundle;
    :catchall_20d
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method private declared-synchronized handleActionWifiChanged(Landroid/os/Bundle;)V
    .registers 27
    .param p1, "map"    # Landroid/os/Bundle;

    move-object/from16 v8, p0

    move-object/from16 v9, p1

    monitor-enter p0

    .line 5754
    :try_start_5
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v0
    :try_end_b
    .catchall {:try_start_5 .. :try_end_b} :catchall_2bb

    .line 5755
    .local v0, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    if-nez v0, :cond_f

    .line 5756
    monitor-exit p0

    return-void

    .line 5757
    :cond_f
    :try_start_f
    invoke-interface {v0}, Ljava/util/Collection;->size()I

    move-result v1

    if-lez v1, :cond_2b8

    .line 5759
    const/4 v10, 0x0

    .line 5761
    .local v10, "defaultNetworkInterface":Ljava/lang/String;
    const/4 v1, 0x0

    .line 5762
    .local v1, "isUserVpnConfiguredForMainUser":Z
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v2

    invoke-interface {v2}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_21
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    const/4 v12, 0x3

    const/4 v13, 0x1

    if-eqz v3, :cond_7f

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 5763
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v4

    .line 5764
    .local v4, "activateState":I
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v5

    invoke-interface {v5}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v5

    :goto_3b
    invoke-interface {v5}, Ljava/util/Iterator;->hasNext()Z

    move-result v6

    if-eqz v6, :cond_7a

    invoke-interface {v5}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 5765
    .local v6, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v7, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v7

    if-eqz v7, :cond_78

    .line 5766
    if-ne v4, v13, :cond_78

    .line 5767
    iget-object v7, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v14

    invoke-virtual {v7, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v7

    .line 5768
    .local v7, "cid":I
    if-nez v7, :cond_78

    .line 5769
    sget-object v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->AID_EXEMPT_LIST:[Ljava/lang/Integer;

    array-length v14, v5

    const/4 v15, 0x0

    :goto_61
    if-ge v15, v14, :cond_76

    aget-object v16, v5, v15

    invoke-virtual/range {v16 .. v16}, Ljava/lang/Integer;->intValue()I

    move-result v16

    move/from16 v17, v16

    .line 5770
    .local v17, "aidUid":I
    iget-object v11, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    move/from16 v13, v17

    .end local v17    # "aidUid":I
    .local v13, "aidUid":I
    invoke-virtual {v11, v13, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    .line 5769
    .end local v13    # "aidUid":I
    add-int/lit8 v15, v15, 0x1

    const/4 v13, 0x1

    goto :goto_61

    .line 5772
    :cond_76
    const/4 v1, 0x1

    .line 5773
    goto :goto_7a

    .line 5777
    .end local v6    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v7    # "cid":I
    :cond_78
    const/4 v13, 0x1

    goto :goto_3b

    .line 5778
    :cond_7a
    :goto_7a
    if-eqz v1, :cond_7e

    .line 5779
    move v11, v1

    goto :goto_80

    .line 5780
    .end local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v4    # "activateState":I
    :cond_7e
    goto :goto_21

    .line 5762
    :cond_7f
    move v11, v1

    .line 5782
    .end local v1    # "isUserVpnConfiguredForMainUser":Z
    .local v11, "isUserVpnConfiguredForMainUser":Z
    :goto_80
    invoke-interface {v0}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v13

    :goto_84
    invoke-interface {v13}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    const/16 v14, 0x3f8

    if-eqz v1, :cond_f2

    invoke-interface {v13}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-object v15, v1

    .line 5783
    .local v15, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v2

    const/4 v3, 0x1

    invoke-virtual {v1, v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeInputFilterDropRulesForInterface(ILjava/util/List;)V

    .line 5784
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuidListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v2

    const/4 v3, 0x0

    invoke-virtual {v1, v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeInputFilterDropRulesForInterface(ILjava/util/List;)V

    .line 5786
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isNativeVpnClient(Ljava/lang/String;)Z

    move-result v1

    if-eqz v1, :cond_c5

    .line 5787
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1, v14, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    goto :goto_ce

    .line 5789
    :cond_c5
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v2

    invoke-virtual {v1, v2, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    .line 5792
    :goto_ce
    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v1

    invoke-virtual {v1}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v14

    :goto_d6
    invoke-interface {v14}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_f1

    invoke-interface {v14}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Ljava/lang/Integer;

    invoke-virtual {v1}, Ljava/lang/Integer;->intValue()I

    move-result v4

    .line 5793
    .local v4, "uid":I
    const/4 v2, 0x0

    const/4 v3, 0x2

    const/4 v5, 0x3

    const/4 v6, 0x0

    const/4 v7, 0x0

    move-object/from16 v1, p0

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 5794
    .end local v4    # "uid":I
    goto :goto_d6

    .line 5795
    .end local v15    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_f1
    goto :goto_84

    .line 5797
    :cond_f2
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdForExemptedUids()Ljava/util/HashSet;

    move-result-object v1

    move-object v13, v1

    .line 5798
    .local v13, "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    invoke-virtual {v13}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_fd
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_11b

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Ljava/lang/Integer;

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    .line 5799
    .local v2, "exemptedUserId":I
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v4, "com.android.providers.downloads"

    invoke-virtual {v3, v2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v3

    .line 5800
    .local v3, "downloadMangerUid":I
    iget-object v4, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForDownloadManagerUid(I)V

    .line 5801
    .end local v2    # "exemptedUserId":I
    .end local v3    # "downloadMangerUid":I
    goto :goto_fd

    .line 5803
    :cond_11b
    const-string/jumbo v1, "noConnectivity"

    invoke-virtual {v9, v1}, Landroid/os/Bundle;->getBoolean(Ljava/lang/String;)Z

    move-result v1

    move v15, v1

    .line 5804
    .local v15, "networkDown":Z
    if-eqz v15, :cond_12e

    .line 5805
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Default Wifi Network lost connectivity"

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_12c
    .catchall {:try_start_f .. :try_end_12c} :catchall_2bb

    .line 5806
    monitor-exit p0

    return-void

    .line 5809
    :cond_12e
    :try_start_12e
    const-string/jumbo v1, "state"

    invoke-virtual {v9, v1}, Landroid/os/Bundle;->getString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v1

    move-object v7, v1

    .line 5810
    .local v7, "networkState":Ljava/lang/String;
    const-string v1, "DISCONNECTED"

    invoke-virtual {v7, v1}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v1

    if-eqz v1, :cond_147

    .line 5811
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Default Wifi Network is disconnected"

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_145
    .catchall {:try_start_12e .. :try_end_145} :catchall_2bb

    .line 5812
    monitor-exit p0

    return-void

    .line 5815
    :cond_147
    :try_start_147
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v1

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getActiveNetworkInterface()Ljava/lang/String;

    move-result-object v1

    move-object v10, v1

    .line 5816
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Default Wifi Network interface Name is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5818
    invoke-interface {v0}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v17

    :goto_16a
    invoke-interface/range {v17 .. v17}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_292

    invoke-interface/range {v17 .. v17}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-object/from16 v19, v1

    .line 5819
    .local v19, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v1

    move v6, v1

    .line 5820
    .local v6, "activateState":I
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v1

    move-object/from16 v20, v1

    .line 5821
    .local v20, "ipChainName":Ljava/lang/String;
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_18b
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_1e0

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 5822
    .local v2, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v3

    if-eqz v3, :cond_1d9

    .line 5823
    const/4 v3, 0x1

    if-ne v6, v3, :cond_1d6

    .line 5824
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v3

    .line 5825
    .local v3, "cid":I
    if-nez v3, :cond_1d3

    .line 5826
    const/4 v1, 0x1

    invoke-direct {v8, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->blockIncomingICMPPackets(Z)V

    .line 5827
    sget-object v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->AID_EXEMPT_LIST:[Ljava/lang/Integer;

    array-length v4, v1

    const/4 v5, 0x0

    :goto_1b6
    if-ge v5, v4, :cond_1d0

    aget-object v21, v1, v5

    invoke-virtual/range {v21 .. v21}, Ljava/lang/Integer;->intValue()I

    move-result v21

    move/from16 v22, v21

    .line 5828
    .local v22, "aidUid":I
    iget-object v14, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    move-object/from16 v23, v0

    move/from16 v0, v22

    .end local v22    # "aidUid":I
    .local v0, "aidUid":I
    .local v23, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    invoke-virtual {v14, v0, v10, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    .line 5827
    .end local v0    # "aidUid":I
    add-int/lit8 v5, v5, 0x1

    move-object/from16 v0, v23

    const/16 v14, 0x3f8

    goto :goto_1b6

    .line 5830
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .local v0, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1d0
    move-object/from16 v23, v0

    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    goto :goto_1e2

    .line 5825
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1d3
    move-object/from16 v23, v0

    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    goto :goto_1db

    .line 5823
    .end local v3    # "cid":I
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1d6
    move-object/from16 v23, v0

    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    goto :goto_1db

    .line 5822
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1d9
    move-object/from16 v23, v0

    .line 5834
    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .end local v2    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :goto_1db
    move-object/from16 v0, v23

    const/16 v14, 0x3f8

    goto :goto_18b

    .line 5821
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_1e0
    move-object/from16 v23, v0

    .line 5835
    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :goto_1e2
    const/4 v0, 0x1

    if-ne v6, v0, :cond_281

    .line 5836
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v1

    invoke-virtual {v0, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v0

    .line 5837
    .local v0, "vpnClientPackageName":Ljava/lang/String;
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v2

    const/4 v3, 0x1

    invoke-virtual {v1, v0, v3, v2, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addInputFilterDropRulesForInterface(Ljava/lang/String;ILjava/util/List;Ljava/lang/String;)V

    .line 5838
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuidListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v2

    const/4 v14, 0x0

    invoke-virtual {v1, v0, v14, v2, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addInputFilterDropRulesForInterface(Ljava/lang/String;ILjava/util/List;Ljava/lang/String;)V

    .line 5840
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v1

    invoke-virtual {v8, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getChainingEnabledForProfile(I)I

    move-result v1

    const/4 v5, 0x1

    if-eq v1, v5, :cond_23a

    .line 5841
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isNativeVpnClient(Ljava/lang/String;)Z

    move-result v1

    if-eqz v1, :cond_22e

    .line 5842
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    const/16 v3, 0x3f8

    invoke-virtual {v1, v3, v10, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    goto :goto_23c

    .line 5844
    :cond_22e
    const/16 v3, 0x3f8

    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v2

    invoke-virtual {v1, v2, v10, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    goto :goto_23c

    .line 5840
    :cond_23a
    const/16 v3, 0x3f8

    .line 5848
    :goto_23c
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v1

    invoke-virtual {v1}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v16

    :goto_244
    invoke-interface/range {v16 .. v16}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_278

    invoke-interface/range {v16 .. v16}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Ljava/lang/Integer;

    invoke-virtual {v1}, Ljava/lang/Integer;->intValue()I

    move-result v4

    .line 5849
    .restart local v4    # "uid":I
    const/4 v2, 0x1

    const/16 v18, 0x2

    const/16 v21, 0x3

    const/16 v22, 0x0

    move-object/from16 v1, p0

    move/from16 v24, v3

    move/from16 v3, v18

    move/from16 v18, v5

    move/from16 v5, v21

    move/from16 v21, v6

    .end local v6    # "activateState":I
    .local v21, "activateState":I
    move-object/from16 v6, v22

    move-object/from16 v22, v7

    .end local v7    # "networkState":Ljava/lang/String;
    .local v22, "networkState":Ljava/lang/String;
    move-object v7, v10

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 5850
    .end local v4    # "uid":I
    move/from16 v5, v18

    move/from16 v6, v21

    move-object/from16 v7, v22

    move/from16 v3, v24

    goto :goto_244

    .line 5848
    .end local v21    # "activateState":I
    .end local v22    # "networkState":Ljava/lang/String;
    .restart local v6    # "activateState":I
    .restart local v7    # "networkState":Ljava/lang/String;
    :cond_278
    move/from16 v24, v3

    move/from16 v18, v5

    move/from16 v21, v6

    move-object/from16 v22, v7

    .end local v6    # "activateState":I
    .end local v7    # "networkState":Ljava/lang/String;
    .restart local v21    # "activateState":I
    .restart local v22    # "networkState":Ljava/lang/String;
    goto :goto_28a

    .line 5835
    .end local v0    # "vpnClientPackageName":Ljava/lang/String;
    .end local v21    # "activateState":I
    .end local v22    # "networkState":Ljava/lang/String;
    .restart local v6    # "activateState":I
    .restart local v7    # "networkState":Ljava/lang/String;
    :cond_281
    move/from16 v18, v0

    move/from16 v21, v6

    move-object/from16 v22, v7

    const/4 v14, 0x0

    const/16 v24, 0x3f8

    .line 5852
    .end local v6    # "activateState":I
    .end local v7    # "networkState":Ljava/lang/String;
    .end local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v20    # "ipChainName":Ljava/lang/String;
    .restart local v22    # "networkState":Ljava/lang/String;
    :goto_28a
    move-object/from16 v7, v22

    move-object/from16 v0, v23

    move/from16 v14, v24

    goto/16 :goto_16a

    .line 5854
    .end local v22    # "networkState":Ljava/lang/String;
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .local v0, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v7    # "networkState":Ljava/lang/String;
    :cond_292
    move-object/from16 v23, v0

    move-object/from16 v22, v7

    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .end local v7    # "networkState":Ljava/lang/String;
    .restart local v22    # "networkState":Ljava/lang/String;
    .restart local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    invoke-virtual {v13}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_29a
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_2ba

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Ljava/lang/Integer;

    invoke-virtual {v1}, Ljava/lang/Integer;->intValue()I

    move-result v1

    .line 5855
    .local v1, "exemptedUserId":I
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v3, "com.android.providers.downloads"

    invoke-virtual {v2, v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v2

    .line 5856
    .local v2, "downloadMangerUid":I
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v3, v2, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addExemptRulesForDownloadManagerUid(ILjava/lang/String;)V
    :try_end_2b7
    .catchall {:try_start_147 .. :try_end_2b7} :catchall_2bb

    .line 5857
    .end local v1    # "exemptedUserId":I
    .end local v2    # "downloadMangerUid":I
    goto :goto_29a

    .line 5757
    .end local v10    # "defaultNetworkInterface":Ljava/lang/String;
    .end local v11    # "isUserVpnConfiguredForMainUser":Z
    .end local v13    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v15    # "networkDown":Z
    .end local v22    # "networkState":Ljava/lang/String;
    .end local v23    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .restart local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_2b8
    move-object/from16 v23, v0

    .line 5861
    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_2ba
    goto :goto_2c3

    .line 5859
    :catchall_2bb
    move-exception v0

    .line 5860
    .local v0, "e":Ljava/lang/Throwable;
    :try_start_2bc
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Exception occured while trying to apply iptable rule for user 0 during connectivity change of wifi network"

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_2c3
    .catchall {:try_start_2bc .. :try_end_2c3} :catchall_2c5

    .line 5862
    .end local v0    # "e":Ljava/lang/Throwable;
    :goto_2c3
    monitor-exit p0

    return-void

    .line 5753
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .end local p1    # "map":Landroid/os/Bundle;
    :catchall_2c5
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method private declared-synchronized handleCaptivePortal(Landroid/os/Bundle;)V
    .registers 14
    .param p1, "map"    # Landroid/os/Bundle;

    monitor-enter p0

    .line 5694
    :try_start_1
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v0
    :try_end_7
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_7} :catch_bb
    .catchall {:try_start_1 .. :try_end_7} :catchall_b9

    .line 5695
    .local v0, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    if-nez v0, :cond_b

    .line 5696
    monitor-exit p0

    return-void

    .line 5697
    :cond_b
    :try_start_b
    invoke-interface {v0}, Ljava/util/Collection;->size()I

    move-result v1

    if-lez v1, :cond_b8

    .line 5698
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v2, "com.google.android.captiveportallogin"

    const/4 v3, 0x0

    invoke-virtual {v1, v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v1

    .line 5699
    .local v1, "captivePortalUid":I
    const/4 v2, 0x0

    .line 5700
    .local v2, "isExempted":Z
    const/4 v4, -0x1

    if-eq v1, v4, :cond_25

    .line 5701
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->checKIfUidIsExempted(I)Z

    move-result v4

    move v2, v4

    .line 5703
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_25
    if-eqz v2, :cond_b8

    .line 5704
    const-string v4, "captive"

    invoke-virtual {p1, v4}, Landroid/os/Bundle;->getInt(Ljava/lang/String;)I

    move-result v4

    const/4 v5, 0x3

    const/16 v6, 0x431

    const/16 v7, 0x3e8

    if-nez v4, :cond_72

    .line 5705
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->isCaptivePortalSignInState()Z

    move-result v4

    if-nez v4, :cond_b8

    .line 5706
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesToDropIpv6SystemQueries(I)V

    .line 5707
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesToDropIpv6SystemQueries(I)V

    .line 5708
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesToDropIpv6SystemQueries(I)V

    .line 5709
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesToExemptCaptivePortalQueries(I)V

    .line 5710
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesToExemptCaptivePortalQueries(I)V

    .line 5711
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesToExemptCaptivePortalQueries(I)V

    .line 5712
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getActiveNetworkInterface()Ljava/lang/String;

    move-result-object v4

    .line 5713
    .local v4, "defaultInterface":Ljava/lang/String;
    sget-object v6, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->AID_EXEMPT_LIST:[Ljava/lang/Integer;

    array-length v7, v6

    :goto_61
    if-ge v3, v7, :cond_71

    aget-object v8, v6, v3

    invoke-virtual {v8}, Ljava/lang/Integer;->intValue()I

    move-result v8

    .line 5714
    .local v8, "aidUid":I
    iget-object v9, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v9, v8, v4, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    .line 5713
    .end local v8    # "aidUid":I
    add-int/lit8 v3, v3, 0x1

    goto :goto_61

    .line 5715
    .end local v4    # "defaultInterface":Ljava/lang/String;
    :cond_71
    goto :goto_b8

    .line 5716
    :cond_72
    const-string v4, "captive"

    invoke-virtual {p1, v4}, Landroid/os/Bundle;->getInt(Ljava/lang/String;)I

    move-result v4

    const/4 v8, 0x1

    if-ne v4, v8, :cond_b8

    .line 5717
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->insertRulesToDropIpv6SystemQueries(I)V

    .line 5718
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->insertRulesToDropIpv6SystemQueries(I)V

    .line 5719
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->insertRulesToDropIpv6SystemQueries(I)V

    .line 5720
    sget-object v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->AID_EXEMPT_LIST:[Ljava/lang/Integer;

    array-length v8, v4

    :goto_8d
    if-ge v3, v8, :cond_a0

    aget-object v9, v4, v3

    invoke-virtual {v9}, Ljava/lang/Integer;->intValue()I

    move-result v9

    .line 5721
    .local v9, "aidUid":I
    iget-object v10, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    const-string/jumbo v11, "wlan0"

    invoke-virtual {v10, v9, v11, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    .line 5720
    .end local v9    # "aidUid":I
    add-int/lit8 v3, v3, 0x1

    goto :goto_8d

    .line 5722
    :cond_a0
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    const-string/jumbo v4, "wlan0"

    invoke-virtual {v3, v4, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesToExemptCaptivePortalQueries(Ljava/lang/String;I)V

    .line 5723
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    const-string/jumbo v4, "wlan0"

    invoke-virtual {v3, v4, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesToExemptCaptivePortalQueries(Ljava/lang/String;I)V

    .line 5724
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    const-string/jumbo v4, "wlan0"

    invoke-virtual {v3, v4, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesToExemptCaptivePortalQueries(Ljava/lang/String;I)V
    :try_end_b8
    .catch Ljava/lang/Exception; {:try_start_b .. :try_end_b8} :catch_bb
    .catchall {:try_start_b .. :try_end_b8} :catchall_b9

    .line 5730
    .end local v0    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    .end local v1    # "captivePortalUid":I
    .end local v2    # "isExempted":Z
    :cond_b8
    :goto_b8
    goto :goto_c3

    .line 5693
    .end local p1    # "map":Landroid/os/Bundle;
    :catchall_b9
    move-exception p1

    goto :goto_c5

    .line 5728
    .restart local p1    # "map":Landroid/os/Bundle;
    :catch_bb
    move-exception v0

    .line 5729
    .local v0, "e":Ljava/lang/Exception;
    :try_start_bc
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Exception occured while handling captive portal firewall rules"

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_c3
    .catchall {:try_start_bc .. :try_end_c3} :catchall_b9

    .line 5731
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_c3
    monitor-exit p0

    return-void

    .line 5693
    .end local p1    # "map":Landroid/os/Bundle;
    :goto_c5
    monitor-exit p0

    throw p1
.end method

.method private handleChainingScenarioForStartConnection(Ljava/lang/String;)V
    .registers 10
    .param p1, "profileName"    # Ljava/lang/String;

    .line 7922
    const-string v0, "KnoxVpnEngineService"

    :try_start_2
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->checkIfProfileHasChainingFeature(Ljava/lang/String;)I

    move-result v1

    .line 7923
    .local v1, "chaining_enabled":I
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "handleChainingScenarioForStartConnection: chaining_enabled value is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7924
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 7925
    .local v2, "profileInforOuterProfile":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v2, :cond_3b

    .line 7926
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v4, "handleChainingScenarioForStartConnection: profile in outerProfile is "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7927
    return-void

    .line 7929
    :cond_3b
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v3

    .line 7930
    .local v3, "userIdOfOuterProfile":I
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "handleChainingScenarioForStartConnection: userIdOfOuterProfile value is "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7931
    if-nez v1, :cond_87

    .line 7932
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v4

    invoke-interface {v4}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v4

    :goto_60
    invoke-interface {v4}, Ljava/util/Iterator;->hasNext()Z

    move-result v5

    if-eqz v5, :cond_87

    invoke-interface {v4}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 7933
    .local v5, "profileInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getChainingEnabled()I

    move-result v6

    const/4 v7, 0x1

    if-ne v6, v7, :cond_86

    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v6

    if-ne v6, v3, :cond_86

    .line 7934
    const-string/jumbo v6, "handleChainingScenarioForStartConnection: chained profile is going to be started"

    invoke-static {v0, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7935
    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v6

    invoke-direct {p0, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startChainedProfile(Ljava/lang/String;)V
    :try_end_86
    .catch Ljava/lang/Exception; {:try_start_2 .. :try_end_86} :catch_88

    .line 7937
    .end local v5    # "profileInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_86
    goto :goto_60

    .line 7941
    .end local v1    # "chaining_enabled":I
    .end local v2    # "profileInforOuterProfile":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "userIdOfOuterProfile":I
    :cond_87
    goto :goto_a1

    .line 7939
    :catch_88
    move-exception v1

    .line 7940
    .local v1, "e":Ljava/lang/Exception;
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception at handleChainingScenarioForStartConnection API "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v1}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 7942
    .end local v1    # "e":Ljava/lang/Exception;
    :goto_a1
    return-void
.end method

.method private handleChainingScenarioForStopConnection(Ljava/lang/String;)V
    .registers 19
    .param p1, "profileName"    # Ljava/lang/String;

    .line 7949
    move-object/from16 v1, p0

    move-object/from16 v2, p1

    const-string v3, "KnoxVpnEngineService"

    :try_start_6
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->checkIfProfileHasChainingFeature(Ljava/lang/String;)I

    move-result v0

    move v4, v0

    .line 7950
    .local v4, "chaining_enabled":I
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "handleChainingScenarioForStopConnection: chaining_enabled value is "

    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v3, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7951
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0

    move-object v5, v0

    .line 7952
    .local v5, "profileInforOuterProfile":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v5, :cond_41

    .line 7953
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "handleChainingScenarioForStopConnection: profile in outerProfile is "

    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v3, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7954
    return-void

    .line 7956
    :cond_41
    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v0

    move v13, v0

    .line 7957
    .local v13, "userIdOfOuterProfile":I
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "handleChainingScenarioForStopConnection: userIdOfOuterProfile value is "

    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v13}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v3, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7958
    if-nez v4, :cond_132

    .line 7959
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v0

    invoke-interface {v0}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v14

    :goto_67
    invoke-interface {v14}, Ljava/util/Iterator;->hasNext()Z

    move-result v0

    if-eqz v0, :cond_132

    invoke-interface {v14}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-object v15, v0

    .line 7960
    .local v15, "profileInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getChainingEnabled()I

    move-result v0

    const/4 v6, 0x1

    if-ne v0, v6, :cond_130

    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v0

    if-ne v0, v13, :cond_130

    .line 7961
    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v0

    invoke-virtual {v1, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v0

    move-object v12, v0

    .line 7962
    .local v12, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "handleChainingScenarioForStopConnection: stop connection is called for profile "

    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v3, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_a3
    .catch Ljava/lang/Exception; {:try_start_6 .. :try_end_a3} :catch_133

    .line 7963
    if-eqz v12, :cond_12e

    .line 7965
    :try_start_a5
    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v0

    invoke-interface {v12, v0}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->stopConnection(Ljava/lang/String;)I

    move-result v0

    .line 7966
    .local v0, "stopStatus":I
    if-eqz v0, :cond_d0

    .line 7967
    const/4 v6, 0x3

    const/4 v7, 0x5

    .line 7968
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v9

    const-string v10, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string v8, "Error occurred trying to stop vpn connection from profile "

    invoke-virtual {v11, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11
    :try_end_c8
    .catch Ljava/lang/Exception; {:try_start_a5 .. :try_end_c8} :catch_f3

    .line 7967
    const/4 v8, 0x0

    move-object/from16 v16, v12

    .end local v12    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .local v16, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    move v12, v13

    :try_start_cc
    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    goto :goto_f0

    .line 7972
    .end local v16    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .restart local v12    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :cond_d0
    move-object/from16 v16, v12

    .end local v12    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .restart local v16    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    const/4 v6, 0x5

    const/4 v7, 0x5

    const/4 v8, 0x1

    .line 7973
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v9

    const-string v10, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string v12, "Connection with vpn vendor service stopped for profile "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    .line 7972
    move v12, v13

    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_f0
    .catch Ljava/lang/Exception; {:try_start_cc .. :try_end_f0} :catch_f1

    .line 7983
    .end local v0    # "stopStatus":I
    :goto_f0
    goto :goto_130

    .line 7977
    :catch_f1
    move-exception v0

    goto :goto_f6

    .end local v16    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .restart local v12    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :catch_f3
    move-exception v0

    move-object/from16 v16, v12

    .line 7978
    .end local v12    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .local v0, "e":Ljava/lang/Exception;
    .restart local v16    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :goto_f6
    const/4 v6, 0x3

    const/4 v7, 0x5

    const/4 v8, 0x0

    .line 7979
    :try_start_f9
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v9

    const-string v10, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string v12, "Exception stopping connection for profile "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    .line 7978
    move v12, v13

    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 7982
    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "handleChainingScenarioForStopConnection : Exception : "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v3, v6}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_12d
    .catch Ljava/lang/Exception; {:try_start_f9 .. :try_end_12d} :catch_133

    goto :goto_130

    .line 7963
    .end local v0    # "e":Ljava/lang/Exception;
    .end local v16    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .restart local v12    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :cond_12e
    move-object/from16 v16, v12

    .line 7986
    .end local v12    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v15    # "profileInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_130
    :goto_130
    goto/16 :goto_67

    .line 7990
    .end local v4    # "chaining_enabled":I
    .end local v5    # "profileInforOuterProfile":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v13    # "userIdOfOuterProfile":I
    :cond_132
    goto :goto_14c

    .line 7988
    :catch_133
    move-exception v0

    .line 7989
    .restart local v0    # "e":Ljava/lang/Exception;
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception at handleChainingScenario API "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 7991
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_14c
    return-void
.end method

.method private declared-synchronized handleConnectivityAction(Landroid/os/Bundle;)V
    .registers 6
    .param p1, "map"    # Landroid/os/Bundle;

    monitor-enter p0

    .line 6098
    :try_start_1
    const-string/jumbo v0, "noConnectivity"

    invoke-virtual {p1, v0}, Landroid/os/Bundle;->getBoolean(Ljava/lang/String;)Z

    move-result v0

    .line 6099
    .local v0, "networkDown":Z
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "vpn handle : connectivity action : Handle MSG CONNECTIVITY_ACTION. networkDown = "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v0}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6100
    if-nez v0, :cond_24

    .line 6101
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->runAllVpnService()V
    :try_end_24
    .catchall {:try_start_1 .. :try_end_24} :catchall_26

    .line 6103
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_24
    monitor-exit p0

    return-void

    .line 6097
    .end local v0    # "networkDown":Z
    .end local p1    # "map":Landroid/os/Bundle;
    :catchall_26
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method private handleKnoxVpnBuildUpdate()V
    .registers 6

    .line 5642
    const-string/jumbo v0, "persist.sys.knoxvpn.date"

    const-string v1, "NONE"

    :try_start_5
    const-string/jumbo v2, "ro.build.date"

    invoke-static {v2, v1}, Landroid/os/SystemProperties;->get(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;

    move-result-object v2

    .line 5643
    .local v2, "currentBuild":Ljava/lang/String;
    invoke-static {v0, v1}, Landroid/os/SystemProperties;->get(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;

    move-result-object v1

    .line 5646
    .local v1, "oldBuild":Ljava/lang/String;
    invoke-virtual {v2, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v3

    const/4 v4, 0x1

    if-eq v3, v4, :cond_29

    .line 5647
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_23

    const-string v3, "KnoxVpnEngineService"

    const-string/jumbo v4, "handleKnoxVpnBuildUpdate - updated"

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5648
    :cond_23
    invoke-static {v0, v2}, Landroid/os/SystemProperties;->set(Ljava/lang/String;Ljava/lang/String;)V

    .line 5649
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkToUpdateDb()V
    :try_end_29
    .catch Ljava/lang/Exception; {:try_start_5 .. :try_end_29} :catch_2a

    .line 5653
    .end local v1    # "oldBuild":Ljava/lang/String;
    .end local v2    # "currentBuild":Ljava/lang/String;
    :cond_29
    goto :goto_2e

    .line 5651
    :catch_2a
    move-exception v0

    .line 5652
    .local v0, "e":Ljava/lang/Exception;
    invoke-virtual {v0}, Ljava/lang/Exception;->printStackTrace()V

    .line 5654
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_2e
    return-void
.end method

.method private handleUserScreenUnlock()V
    .registers 2

    .line 5599
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnPacProcessor()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v0

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->handleScreenunlock()V

    .line 5600
    return-void
.end method

.method private declared-synchronized handleVpnInterfaceState(Landroid/os/Bundle;)V
    .registers 16
    .param p1, "map"    # Landroid/os/Bundle;

    monitor-enter p0

    .line 6402
    :try_start_1
    const-string v0, "com.samsung.android.knox.intent.extra.ACTION_INTERNAL"

    invoke-virtual {p1, v0}, Landroid/os/Bundle;->getString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v0

    .line 6403
    .local v0, "action":Ljava/lang/String;
    const/4 v1, 0x1

    if-eqz v0, :cond_8d

    const-string/jumbo v2, "pac_info"

    invoke-virtual {v0, v2}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v2

    if-eqz v2, :cond_8d

    .line 6404
    const-string v2, "com.samsung.android.knox.intent.extra.PROFILE_NAME_INTERNAL"

    invoke-virtual {p1, v2}, Landroid/os/Bundle;->getString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v2

    .line 6405
    .local v2, "profileName":Ljava/lang/String;
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v3
    :try_end_1f
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_1f} :catch_15c
    .catchall {:try_start_1 .. :try_end_1f} :catchall_15a

    .line 6406
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v3, :cond_23

    .line 6407
    monitor-exit p0

    return-void

    .line 6409
    :cond_23
    :try_start_23
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v4
    :try_end_27
    .catch Ljava/lang/Exception; {:try_start_23 .. :try_end_27} :catch_15c
    .catchall {:try_start_23 .. :try_end_27} :catchall_15a

    if-nez v4, :cond_2b

    .line 6410
    monitor-exit p0

    return-void

    .line 6412
    :cond_2b
    :try_start_2b
    const-string v4, "com.samsung.android.knox.intent.extra.STATE_INTERNAL"

    invoke-virtual {p1, v4}, Landroid/os/Bundle;->getInt(Ljava/lang/String;)I

    move-result v4

    .line 6413
    .local v4, "state":I
    const/4 v5, 0x0

    if-eqz v4, :cond_78

    if-eq v4, v1, :cond_65

    const/4 v6, 0x3

    if-eq v4, v6, :cond_3a

    goto :goto_8b

    .line 6423
    :cond_3a
    const-string v6, "KnoxVpnEngineService"

    const-string v7, "The proxy server port has been killed, removing the rules"

    invoke-static {v6, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6424
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v6

    invoke-virtual {v6, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getListOfUid(Ljava/lang/String;)Ljava/util/HashMap;

    move-result-object v6

    invoke-direct {p0, v5, v2, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 6425
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v5

    if-ne v5, v1, :cond_8b

    .line 6426
    const-string v5, "KnoxVpnEngineService"

    const-string v6, "The proxy server port has been killed, adding the rules again"

    invoke-static {v5, v6}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 6427
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v5

    invoke-virtual {v5, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getListOfUid(Ljava/lang/String;)Ljava/util/HashMap;

    move-result-object v5

    invoke-direct {p0, v1, v2, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    goto :goto_8b

    .line 6419
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_65
    const-string v5, "KnoxVpnEngineService"

    const-string v6, "The PAC Service has been connected successfully,adding rules"

    invoke-static {v5, v6}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 6420
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v5

    invoke-virtual {v5, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getListOfUid(Ljava/lang/String;)Ljava/util/HashMap;

    move-result-object v5

    invoke-direct {p0, v1, v2, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 6421
    goto :goto_8b

    .line 6415
    :cond_78
    const-string v1, "KnoxVpnEngineService"

    const-string v6, "The PAC Service has been disconnected for unknown reason,removing rules"

    invoke-static {v1, v6}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 6416
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v1

    invoke-virtual {v1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getListOfUid(Ljava/lang/String;)Ljava/util/HashMap;

    move-result-object v1

    invoke-direct {p0, v5, v2, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 6417
    nop

    .line 6433
    .end local v2    # "profileName":Ljava/lang/String;
    .end local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v4    # "state":I
    :cond_8b
    :goto_8b
    goto/16 :goto_159

    :cond_8d
    if-eqz v0, :cond_be

    const-string v2, "VpnUtils_info"

    invoke-virtual {v0, v2}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v2

    if-eqz v2, :cond_be

    .line 6434
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v2, "com.samsung.sVpn"

    invoke-virtual {v1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->profileListForClient(Ljava/lang/String;)Ljava/util/List;

    move-result-object v1

    .line 6435
    .local v1, "profileListForUid":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    invoke-interface {v1}, Ljava/util/List;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_a3
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_bc

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Ljava/lang/String;

    .line 6436
    .local v3, "profile":Ljava/lang/String;
    invoke-direct {p0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeProfileFromHashMapAndDB(Ljava/lang/String;)V

    .line 6437
    invoke-virtual {p0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v4

    .line 6438
    .local v4, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-eqz v4, :cond_bb

    .line 6439
    invoke-interface {v4, v3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->removeConnection(Ljava/lang/String;)I

    .line 6440
    .end local v3    # "profile":Ljava/lang/String;
    .end local v4    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :cond_bb
    goto :goto_a3

    .line 6435
    .end local v1    # "profileListForUid":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    :cond_bc
    goto/16 :goto_158

    .line 6441
    :cond_be
    if-eqz v0, :cond_158

    const-string/jumbo v2, "tethering_info"

    invoke-virtual {v0, v2}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v2

    if-eqz v2, :cond_158

    .line 6442
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v2

    .line 6443
    .local v2, "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    if-eqz v2, :cond_159

    invoke-interface {v2}, Ljava/util/Collection;->size()I

    move-result v3

    if-lez v3, :cond_159

    .line 6445
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v3

    invoke-interface {v3}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v3

    :goto_e1
    invoke-interface {v3}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_159

    invoke-interface {v3}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 6446
    .local v4, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbTethering()I

    move-result v5

    if-ne v5, v1, :cond_157

    .line 6447
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v3

    .line 6448
    .local v3, "activateState":I
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v5

    .line 6449
    .local v5, "vpnIface":Ljava/lang/String;
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getInterfaceNameForUsbtethering()Ljava/lang/String;

    move-result-object v6

    move-object v12, v6

    .line 6450
    .local v12, "usbTetheringIface":Ljava/lang/String;
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbtetherAuth()I

    move-result v6

    move v13, v6

    .line 6451
    .local v13, "isUsbTetherAuthEnabled":I
    if-nez v12, :cond_10a

    goto :goto_159

    .line 6452
    :cond_10a
    if-ne v3, v1, :cond_148

    if-eqz v5, :cond_148

    invoke-virtual {v5}, Ljava/lang/String;->isEmpty()Z

    move-result v6

    if-nez v6, :cond_148

    .line 6453
    if-ne v13, v1, :cond_12e

    .line 6454
    const-string v1, "KnoxVpnTetherAuthentication"

    const-string/jumbo v6, "usb tether auth process is started after usb is plugged"

    invoke-static {v1, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6455
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getIpAddressForUsbTetheringInterface()Ljava/util/List;

    move-result-object v1

    .line 6456
    .local v1, "usbTetherIfaceAddr":Ljava/util/List;, "Ljava/util/List<Ljava/net/InetAddress;>;"
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v7

    invoke-virtual {v6, v7, v12, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->startTetherAuthProcess(ILjava/lang/String;Ljava/util/List;)V

    .line 6457
    .end local v1    # "usbTetherIfaceAddr":Ljava/util/List;, "Ljava/util/List<Ljava/net/InetAddress;>;"
    goto :goto_159

    .line 6459
    :cond_12e
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getConnectivityManagerService()Landroid/net/IConnectivityManager;

    move-result-object v1

    invoke-interface {v1, v5}, Landroid/net/IConnectivityManager;->getDnsServerListForInterface(Ljava/lang/String;)[Ljava/lang/String;

    move-result-object v9

    .line 6460
    .local v9, "vpnIfaceDnsServerList":[Ljava/lang/String;
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getNetworkPartWithMask(Ljava/lang/String;)Ljava/util/List;

    move-result-object v11

    .line 6461
    .local v11, "networkPartList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v8

    move-object v7, v5

    move-object v10, v12

    invoke-virtual/range {v6 .. v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForUsbTethering(Ljava/lang/String;I[Ljava/lang/String;Ljava/lang/String;Ljava/util/List;)V

    .line 6462
    .end local v9    # "vpnIfaceDnsServerList":[Ljava/lang/String;
    .end local v11    # "networkPartList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    goto :goto_159

    .line 6463
    :cond_148
    if-ne v3, v1, :cond_159

    .line 6465
    const-string v1, "KnoxVpnEngineService"

    const-string v6, "Applying rules to drop tether packets since vpn is not connected, but still in activated state when the usb is plugged"

    invoke-static {v1, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6466
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForDroppingTetherPackets(Ljava/lang/String;)V
    :try_end_156
    .catch Ljava/lang/Exception; {:try_start_2b .. :try_end_156} :catch_15c
    .catchall {:try_start_2b .. :try_end_156} :catchall_15a

    goto :goto_159

    .line 6470
    .end local v3    # "activateState":I
    .end local v4    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v5    # "vpnIface":Ljava/lang/String;
    .end local v12    # "usbTetheringIface":Ljava/lang/String;
    .end local v13    # "isUsbTetherAuthEnabled":I
    :cond_157
    goto :goto_e1

    .line 6441
    .end local v2    # "vpnProfileEntries":Ljava/util/Collection;, "Ljava/util/Collection<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;>;"
    :cond_158
    :goto_158
    nop

    .line 6475
    .end local v0    # "action":Ljava/lang/String;
    :cond_159
    :goto_159
    goto :goto_178

    .line 6401
    .end local p1    # "map":Landroid/os/Bundle;
    :catchall_15a
    move-exception p1

    goto :goto_17a

    .line 6473
    .restart local p1    # "map":Landroid/os/Bundle;
    :catch_15c
    move-exception v0

    .line 6474
    .local v0, "e":Ljava/lang/Exception;
    :try_start_15d
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "handleVpnInterfaceState : Exception : "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_178
    .catchall {:try_start_15d .. :try_end_178} :catchall_15a

    .line 6476
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_178
    monitor-exit p0

    return-void

    .line 6401
    .end local p1    # "map":Landroid/os/Bundle;
    :goto_17a
    monitor-exit p0

    throw p1
.end method

.method private hasVpnInterface(Ljava/lang/String;)Z
    .registers 3
    .param p1, "vendorName"    # Ljava/lang/String;

    .line 7616
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnInterfaceMap:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v0, p1}, Ljava/util/concurrent/ConcurrentHashMap;->containsKey(Ljava/lang/Object;)Z

    move-result v0

    if-eqz v0, :cond_a

    .line 7617
    const/4 v0, 0x1

    return v0

    .line 7619
    :cond_a
    const/4 v0, 0x0

    return v0
.end method

.method private implementsVpnService(Ljava/lang/String;I)Z
    .registers 10
    .param p1, "packageName"    # Ljava/lang/String;
    .param p2, "containerId"    # I

    .line 8801
    const-string v0, "KnoxVpnEngineService"

    const/4 v1, 0x0

    .line 8803
    .local v1, "supportsKnox":Z
    :try_start_3
    new-instance v2, Landroid/content/Intent;

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v3, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v4, ".BIND_SERVICE_NEW"

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-direct {v2, v3}, Landroid/content/Intent;-><init>(Ljava/lang/String;)V

    .line 8804
    .local v2, "intent":Landroid/content/Intent;
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v3}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;

    move-result-object v3

    const/4 v4, 0x0

    invoke-virtual {v3, v2, v4, p2}, Landroid/content/pm/PackageManager;->queryIntentServicesAsUser(Landroid/content/Intent;II)Ljava/util/List;

    move-result-object v3

    .line 8805
    .local v3, "vendorServices":Ljava/util/List;, "Ljava/util/List<Landroid/content/pm/ResolveInfo;>;"
    invoke-interface {v3}, Ljava/util/List;->size()I

    move-result v4

    if-lez v4, :cond_47

    .line 8806
    invoke-interface {v3}, Ljava/util/List;->iterator()Ljava/util/Iterator;

    move-result-object v4

    :goto_2e
    invoke-interface {v4}, Ljava/util/Iterator;->hasNext()Z

    move-result v5

    if-eqz v5, :cond_47

    invoke-interface {v4}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Landroid/content/pm/ResolveInfo;

    .line 8807
    .local v5, "resolveInfo":Landroid/content/pm/ResolveInfo;
    iget-object v6, v5, Landroid/content/pm/ResolveInfo;->serviceInfo:Landroid/content/pm/ServiceInfo;

    iget-object v6, v6, Landroid/content/pm/ServiceInfo;->packageName:Ljava/lang/String;

    invoke-virtual {v6, p1}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v6
    :try_end_42
    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_42} :catch_48

    if-eqz v6, :cond_46

    .line 8808
    const/4 v1, 0x1

    .line 8809
    goto :goto_47

    .line 8811
    .end local v5    # "resolveInfo":Landroid/content/pm/ResolveInfo;
    :cond_46
    goto :goto_2e

    .line 8815
    .end local v2    # "intent":Landroid/content/Intent;
    .end local v3    # "vendorServices":Ljava/util/List;, "Ljava/util/List<Landroid/content/pm/ResolveInfo;>;"
    :cond_47
    :goto_47
    goto :goto_61

    .line 8813
    :catch_48
    move-exception v2

    .line 8814
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Exception at implementsVpnService "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 8816
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_61
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_7a

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "implementsVpnService : supportsKnox value is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v1}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8817
    :cond_7a
    return v1
.end method

.method private initializeHandlerThread()V
    .registers 4

    .line 355
    new-instance v0, Landroid/os/HandlerThread;

    const-string v1, "KnoxVpnHandler"

    const/16 v2, 0xa

    invoke-direct {v0, v1, v2}, Landroid/os/HandlerThread;-><init>(Ljava/lang/String;I)V

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandlerThread:Landroid/os/HandlerThread;

    .line 356
    invoke-virtual {v0}, Landroid/os/HandlerThread;->start()V

    .line 357
    new-instance v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandlerThread:Landroid/os/HandlerThread;

    invoke-virtual {v1}, Landroid/os/HandlerThread;->getLooper()Landroid/os/Looper;

    move-result-object v1

    invoke-direct {v0, p0, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;-><init>(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Landroid/os/Looper;)V

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    .line 358
    return-void
.end method

.method private declared-synchronized initializeHashtable()V
    .registers 33

    move-object/from16 v1, p0

    monitor-enter p0

    .line 4209
    :try_start_3
    const-string v2, "KnoxVpnEngineService"

    const-string/jumbo v3, "initializeHashtable "

    invoke-static {v2, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_b
    .catchall {:try_start_3 .. :try_end_b} :catchall_481

    .line 4212
    const/4 v2, 0x0

    :try_start_c
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v4, "VpnProfileInfo"

    invoke-virtual {v3, v4, v2, v2, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v3

    .line 4215
    .local v3, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    const/4 v4, 0x0

    .line 4216
    .local v4, "profileName":Ljava/lang/String;
    const/4 v5, 0x0

    .line 4217
    .local v5, "vendorNameWithCid":Ljava/lang/String;
    const/4 v6, 0x0

    .line 4218
    .local v6, "protocolType":Ljava/lang/String;
    const/4 v7, -0x1

    .line 4219
    .local v7, "adminId":I
    const/4 v8, 0x0

    .line 4220
    .local v8, "personaId":I
    const/4 v9, -0x1

    .line 4221
    .local v9, "profileId":I
    const/4 v10, -0x1

    .line 4222
    .local v10, "routeType":I
    const/4 v11, 0x0

    .line 4223
    .local v11, "activateState":I
    const/4 v12, -0x1

    .line 4224
    .local v12, "vpnConnectionType":I
    const/4 v13, 0x0

    .line 4225
    .local v13, "uidPidState":I
    const/4 v14, 0x0

    .line 4226
    .local v14, "chainingEnabled":I
    sget-object v15, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->DEFAULT_PROXY_SERVER:Ljava/lang/String;

    .line 4227
    .local v15, "proxyServer":Ljava/lang/String;
    const/16 v16, -0x1

    .line 4228
    .local v16, "proxyPort":I
    sget-object v17, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->DEFAULT_PAC_URL:Ljava/lang/String;

    .line 4229
    .local v17, "pacurl":Ljava/lang/String;
    const/16 v18, 0x0

    .line 4230
    .local v18, "proxy_auth":I
    const/16 v19, 0x0

    .line 4231
    .local v19, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    const/16 v20, 0x0

    .line 4232
    .local v20, "ipChainName":Ljava/lang/String;
    const/16 v21, 0x0

    .line 4233
    .local v21, "usb_tethering":I
    const/16 v22, 0x0

    .line 4234
    .local v22, "isUsbTetherAuthEnabled":I
    if-eqz v3, :cond_305

    invoke-virtual {v3}, Ljava/util/ArrayList;->size()I

    move-result v23

    if-lez v23, :cond_305

    .line 4236
    sget-boolean v23, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v23, :cond_46

    const-string v2, "KnoxVpnEngineService"

    move-object/from16 v24, v4

    .end local v4    # "profileName":Ljava/lang/String;
    .local v24, "profileName":Ljava/lang/String;
    const-string/jumbo v4, "initializeHashtable : VPN INFO: New Framework is enabled. Set the system property"

    invoke-static {v2, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_48

    .end local v24    # "profileName":Ljava/lang/String;
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .restart local v4    # "profileName":Ljava/lang/String;
    :cond_46
    move-object/from16 v24, v4

    .line 4237
    .end local v4    # "profileName":Ljava/lang/String;
    .restart local v24    # "profileName":Ljava/lang/String;
    :goto_48
    const-string/jumbo v2, "net.vpn.framework"

    const-string v4, "2.0"

    invoke-static {v2, v4}, Landroid/os/SystemProperties;->set(Ljava/lang/String;Ljava/lang/String;)V

    .line 4238
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_5c

    const-string v2, "KnoxVpnEngineService"

    const-string/jumbo v4, "initializeHashtable : Cursor not null"

    invoke-static {v2, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4239
    :cond_5c
    invoke-virtual {v3}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v2

    move-object/from16 v4, v24

    .end local v24    # "profileName":Ljava/lang/String;
    .restart local v4    # "profileName":Ljava/lang/String;
    :goto_62
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v24

    if-eqz v24, :cond_2fc

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v24

    check-cast v24, Landroid/content/ContentValues;

    move-object/from16 v25, v24

    .line 4240
    .local v25, "cv":Landroid/content/ContentValues;
    move-object/from16 v26, v2

    const-string/jumbo v2, "profileName"

    move-object/from16 v27, v3

    move-object/from16 v3, v25

    .end local v25    # "cv":Landroid/content/ContentValues;
    .local v3, "cv":Landroid/content/ContentValues;
    .local v27, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v2

    move-object v4, v2

    .line 4241
    const-string v2, "defaultRoute"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    move v10, v2

    .line 4242
    const-string v2, "adminUid"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    move v7, v2

    .line 4243
    const-string/jumbo v2, "personaId"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    move v8, v2

    .line 4244
    const-string/jumbo v2, "vendorName"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v2
    :try_end_a7
    .catch Ljava/lang/Exception; {:try_start_c .. :try_end_a7} :catch_30a
    .catchall {:try_start_c .. :try_end_a7} :catchall_481

    move-object v5, v2

    .line 4247
    :try_start_a8
    const-string/jumbo v2, "profileId"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2
    :try_end_b3
    .catch Ljava/lang/Exception; {:try_start_a8 .. :try_end_b3} :catch_b9
    .catchall {:try_start_a8 .. :try_end_b3} :catchall_481

    .line 4250
    .end local v9    # "profileId":I
    .local v2, "profileId":I
    move v9, v2

    move-object/from16 v24, v6

    move/from16 v28, v11

    goto :goto_de

    .line 4248
    .end local v2    # "profileId":I
    .restart local v9    # "profileId":I
    :catch_b9
    move-exception v0

    move-object v2, v0

    .line 4249
    .local v2, "e":Ljava/lang/Exception;
    move-object/from16 v24, v6

    .end local v6    # "protocolType":Ljava/lang/String;
    .local v24, "protocolType":Ljava/lang/String;
    :try_start_bd
    const-string v6, "KnoxVpnEngineService"

    move/from16 v25, v9

    .end local v9    # "profileId":I
    .local v25, "profileId":I
    new-instance v9, Ljava/lang/StringBuilder;

    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V

    move/from16 v28, v11

    .end local v11    # "activateState":I
    .local v28, "activateState":I
    const-string/jumbo v11, "profileID exception when DB migration on OS upgrade"

    invoke-virtual {v9, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v11

    invoke-virtual {v9, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v9

    invoke-static {v6, v9}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    move/from16 v9, v25

    .line 4251
    .end local v2    # "e":Ljava/lang/Exception;
    .end local v25    # "profileId":I
    .restart local v9    # "profileId":I
    :goto_de
    const-string/jumbo v2, "protocolType"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v2

    move-object v6, v2

    .line 4252
    .end local v24    # "protocolType":Ljava/lang/String;
    .restart local v6    # "protocolType":Ljava/lang/String;
    const-string v2, "activateState"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    move v11, v2

    .line 4253
    .end local v28    # "activateState":I
    .restart local v11    # "activateState":I
    const-string/jumbo v2, "vpnConnectionType"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    move v12, v2

    .line 4254
    const-string v2, "chainingEnabled"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    move v14, v2

    .line 4255
    const-string/jumbo v2, "uidPidSearch"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    move v13, v2

    .line 4256
    const-string/jumbo v2, "proxyServer"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v2

    move-object v15, v2

    .line 4257
    const-string/jumbo v2, "proxyPort"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    .line 4258
    .end local v16    # "proxyPort":I
    .local v2, "proxyPort":I
    move/from16 v16, v2

    .end local v2    # "proxyPort":I
    .restart local v16    # "proxyPort":I
    const-string/jumbo v2, "pacurl"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v2

    .line 4259
    .end local v17    # "pacurl":Ljava/lang/String;
    .local v2, "pacurl":Ljava/lang/String;
    move-object/from16 v17, v2

    .end local v2    # "pacurl":Ljava/lang/String;
    .restart local v17    # "pacurl":Ljava/lang/String;
    const-string/jumbo v2, "proxyAuth"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    .line 4260
    .end local v18    # "proxy_auth":I
    .local v2, "proxy_auth":I
    move/from16 v18, v2

    .end local v2    # "proxy_auth":I
    .restart local v18    # "proxy_auth":I
    const-string/jumbo v2, "vpnIpChainName"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v2

    .line 4261
    .end local v20    # "ipChainName":Ljava/lang/String;
    .local v2, "ipChainName":Ljava/lang/String;
    move-object/from16 v20, v2

    .end local v2    # "ipChainName":Ljava/lang/String;
    .restart local v20    # "ipChainName":Ljava/lang/String;
    const-string/jumbo v2, "usbTethering"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    .line 4262
    .end local v21    # "usb_tethering":I
    .local v2, "usb_tethering":I
    move/from16 v21, v2

    .end local v2    # "usb_tethering":I
    .restart local v21    # "usb_tethering":I
    const-string/jumbo v2, "usbTetheringAuth"

    invoke-virtual {v3, v2}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    .line 4263
    .end local v22    # "isUsbTetherAuthEnabled":I
    .local v2, "isUsbTetherAuthEnabled":I
    sget-boolean v22, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v22, :cond_1a2

    move-object/from16 v29, v3

    .end local v3    # "cv":Landroid/content/ContentValues;
    .local v29, "cv":Landroid/content/ContentValues;
    const-string v3, "KnoxVpnEngineService"

    move/from16 v22, v2

    .end local v2    # "isUsbTetherAuthEnabled":I
    .restart local v22    # "isUsbTetherAuthEnabled":I
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    move-object/from16 v24, v15

    .end local v15    # "proxyServer":Ljava/lang/String;
    .local v24, "proxyServer":Ljava/lang/String;
    const-string/jumbo v15, "initializeHashtable : adminId :"

    invoke-virtual {v2, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v7}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v15, " Profile :"

    invoke-virtual {v2, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v15, " vendorName :"

    invoke-virtual {v2, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v15, ", vpnConnectionType: "

    invoke-virtual {v2, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v12}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v15, ", chainingEnabled: "

    invoke-virtual {v2, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v14}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v3, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_1a8

    .end local v22    # "isUsbTetherAuthEnabled":I
    .end local v24    # "proxyServer":Ljava/lang/String;
    .end local v29    # "cv":Landroid/content/ContentValues;
    .restart local v2    # "isUsbTetherAuthEnabled":I
    .restart local v3    # "cv":Landroid/content/ContentValues;
    .restart local v15    # "proxyServer":Ljava/lang/String;
    :cond_1a2
    move/from16 v22, v2

    move-object/from16 v29, v3

    move-object/from16 v24, v15

    .line 4265
    .end local v2    # "isUsbTetherAuthEnabled":I
    .end local v3    # "cv":Landroid/content/ContentValues;
    .end local v15    # "proxyServer":Ljava/lang/String;
    .restart local v22    # "isUsbTetherAuthEnabled":I
    .restart local v24    # "proxyServer":Ljava/lang/String;
    .restart local v29    # "cv":Landroid/content/ContentValues;
    :goto_1a8
    if-eqz v4, :cond_2dc

    .line 4267
    iget-object v2, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->containsProfileEntry(Ljava/lang/String;)Z

    move-result v2

    if-nez v2, :cond_1c2

    .line 4268
    new-instance v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    invoke-direct {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;-><init>()V

    .line 4269
    .end local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    const/4 v3, 0x0

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setInterfaceName(Ljava/lang/String;)V

    .line 4270
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v3, v4, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->addProfileEntry(Ljava/lang/String;Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-object/from16 v19, v2

    .line 4273
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_1c2
    iget-object v2, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 4274
    .end local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v2, :cond_1e0

    .line 4275
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_1d6

    const-string v3, "KnoxVpnEngineService"

    const-string/jumbo v15, "initializeHashtable :  profileName is not exist in vpnConfig"

    invoke-static {v3, v15}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4239
    .end local v29    # "cv":Landroid/content/ContentValues;
    :cond_1d6
    move-object/from16 v19, v2

    move-object/from16 v15, v24

    move-object/from16 v2, v26

    move-object/from16 v3, v27

    goto/16 :goto_62

    .line 4279
    .restart local v29    # "cv":Landroid/content/ContentValues;
    :cond_1e0
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_1ec

    const-string v3, "KnoxVpnEngineService"

    const-string/jumbo v15, "initializeHashtable :  ProfileName found in map. Add to the list."

    invoke-static {v3, v15}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4280
    :cond_1ec
    invoke-virtual {v2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setProfileName(Ljava/lang/String;)V

    .line 4282
    invoke-virtual {v2, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setRouteType(I)V

    .line 4283
    invoke-virtual {v2, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setAdminId(I)V

    .line 4284
    invoke-virtual {v2, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setPersonaId(I)V

    .line 4285
    invoke-virtual {v2, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setVendorPkgName(Ljava/lang/String;)V

    .line 4286
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUidForPackageName(Ljava/lang/String;)I

    move-result v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setVendorUid(I)V

    .line 4287
    invoke-virtual {v2, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setProfileId(I)V

    .line 4288
    invoke-virtual {v2, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setProtocolType(Ljava/lang/String;)V

    .line 4289
    invoke-virtual {v2, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setActivateState(I)V

    .line 4290
    invoke-virtual {v2, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setUidPidSearchEnabled(I)V

    .line 4291
    invoke-virtual {v2, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setVpnConnectionType(I)V

    .line 4292
    invoke-virtual {v2, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setChainingEnabled(I)V

    .line 4293
    move-object/from16 v3, v24

    .end local v24    # "proxyServer":Ljava/lang/String;
    .local v3, "proxyServer":Ljava/lang/String;
    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setProxyServer(Ljava/lang/String;)V

    .line 4294
    move/from16 v15, v16

    .end local v16    # "proxyPort":I
    .local v15, "proxyPort":I
    invoke-virtual {v2, v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setProxyPort(I)V

    .line 4295
    move-object/from16 v24, v3

    .end local v3    # "proxyServer":Ljava/lang/String;
    .restart local v24    # "proxyServer":Ljava/lang/String;
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-object/from16 v30, v5

    .end local v5    # "vendorNameWithCid":Ljava/lang/String;
    .local v30, "vendorNameWithCid":Ljava/lang/String;
    const-string/jumbo v5, "proxy-username"

    invoke-virtual {v3, v4, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->retrieveProfileCredentials(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setProxyUsername(Ljava/lang/String;)V

    .line 4296
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string/jumbo v5, "proxy-password"

    invoke-virtual {v3, v4, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->retrieveProfileCredentials(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setProxyPassword(Ljava/lang/String;)V

    .line 4297
    move-object/from16 v3, v17

    .end local v17    # "pacurl":Ljava/lang/String;
    .local v3, "pacurl":Ljava/lang/String;
    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setPacurl(Ljava/lang/String;)V

    .line 4298
    move/from16 v5, v18

    .end local v18    # "proxy_auth":I
    .local v5, "proxy_auth":I
    invoke-virtual {v2, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setPacAuthRequired(I)V

    .line 4299
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyUsername()Ljava/lang/String;

    move-result-object v16

    move-object/from16 v17, v3

    .end local v3    # "pacurl":Ljava/lang/String;
    .restart local v17    # "pacurl":Ljava/lang/String;
    const/4 v3, 0x1

    if-eqz v16, :cond_258

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyPassword()Ljava/lang/String;

    move-result-object v16

    if-eqz v16, :cond_258

    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->proxyCredentialsPreDefined(Z)V

    .line 4300
    :cond_258
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getExemptedListFromDatabase(Ljava/lang/String;)V

    .line 4302
    if-eqz v20, :cond_27c

    invoke-virtual/range {v20 .. v20}, Ljava/lang/String;->isEmpty()Z

    move-result v3

    if-nez v3, :cond_27c

    invoke-virtual/range {v20 .. v20}, Ljava/lang/String;->length()I

    move-result v3

    if-gtz v3, :cond_26e

    move-object/from16 v3, v20

    goto :goto_27e

    .line 4309
    :cond_26e
    move-object/from16 v3, v20

    .end local v20    # "ipChainName":Ljava/lang/String;
    .local v3, "ipChainName":Ljava/lang/String;
    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setIpChainName(Ljava/lang/String;)V

    move-object/from16 v20, v3

    move/from16 v18, v5

    move-object/from16 v25, v6

    move/from16 v31, v7

    goto :goto_2b8

    .line 4302
    .end local v3    # "ipChainName":Ljava/lang/String;
    .restart local v20    # "ipChainName":Ljava/lang/String;
    :cond_27c
    move-object/from16 v3, v20

    .line 4304
    .end local v20    # "ipChainName":Ljava/lang/String;
    .restart local v3    # "ipChainName":Ljava/lang/String;
    :goto_27e
    move-object/from16 v20, v3

    .end local v3    # "ipChainName":Ljava/lang/String;
    .restart local v20    # "ipChainName":Ljava/lang/String;
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getIpChainNameAfterUpgrade(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v3

    .line 4305
    .local v3, "upgradedIpChainName":Ljava/lang/String;
    move/from16 v18, v5

    .end local v5    # "proxy_auth":I
    .restart local v18    # "proxy_auth":I
    const-string v5, "KnoxVpnEngineService"

    move-object/from16 v25, v6

    .end local v6    # "protocolType":Ljava/lang/String;
    .local v25, "protocolType":Ljava/lang/String;
    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    move/from16 v31, v7

    .end local v7    # "adminId":I
    .local v31, "adminId":I
    const-string v7, "IPChain name is being set as "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v7, " for profile "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v7, " after device upgrade from O to P"

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4306
    iget-object v5, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v5, v4, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateIpChainNameForProfile(Ljava/lang/String;Ljava/lang/String;)V

    .line 4307
    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setIpChainName(Ljava/lang/String;)V

    .line 4308
    .end local v3    # "upgradedIpChainName":Ljava/lang/String;
    nop

    .line 4311
    :goto_2b8
    move/from16 v3, v21

    .end local v21    # "usb_tethering":I
    .local v3, "usb_tethering":I
    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setUsbTethering(I)V

    .line 4312
    move/from16 v5, v22

    .end local v22    # "isUsbTetherAuthEnabled":I
    .local v5, "isUsbTetherAuthEnabled":I
    invoke-virtual {v2, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setUsbTetherAuth(I)V

    .line 4313
    const/4 v6, 0x1

    if-ne v3, v6, :cond_2d0

    .line 4314
    iget-object v7, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->registerNetdTetherEventListener(Z)V

    .line 4315
    iget-object v7, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->enableKnoxVpnFlagForTether(Z)V

    goto :goto_2d6

    .line 4317
    :cond_2d0
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const/4 v7, 0x0

    invoke-virtual {v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->enableKnoxVpnFlagForTether(Z)V

    .line 4320
    :goto_2d6
    invoke-direct {v1, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->refreshDomainInHashMap(Ljava/lang/String;)V
    :try_end_2d9
    .catch Ljava/lang/Exception; {:try_start_bd .. :try_end_2d9} :catch_30a
    .catchall {:try_start_bd .. :try_end_2d9} :catchall_481

    move-object/from16 v19, v2

    goto :goto_2e8

    .line 4265
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "usb_tethering":I
    .end local v15    # "proxyPort":I
    .end local v25    # "protocolType":Ljava/lang/String;
    .end local v30    # "vendorNameWithCid":Ljava/lang/String;
    .end local v31    # "adminId":I
    .local v5, "vendorNameWithCid":Ljava/lang/String;
    .restart local v6    # "protocolType":Ljava/lang/String;
    .restart local v7    # "adminId":I
    .restart local v16    # "proxyPort":I
    .restart local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v21    # "usb_tethering":I
    .restart local v22    # "isUsbTetherAuthEnabled":I
    :cond_2dc
    move-object/from16 v30, v5

    move-object/from16 v25, v6

    move/from16 v31, v7

    move/from16 v15, v16

    move/from16 v3, v21

    move/from16 v5, v22

    .line 4322
    .end local v6    # "protocolType":Ljava/lang/String;
    .end local v7    # "adminId":I
    .end local v16    # "proxyPort":I
    .end local v21    # "usb_tethering":I
    .end local v22    # "isUsbTetherAuthEnabled":I
    .end local v29    # "cv":Landroid/content/ContentValues;
    .restart local v3    # "usb_tethering":I
    .local v5, "isUsbTetherAuthEnabled":I
    .restart local v15    # "proxyPort":I
    .restart local v25    # "protocolType":Ljava/lang/String;
    .restart local v30    # "vendorNameWithCid":Ljava/lang/String;
    .restart local v31    # "adminId":I
    :goto_2e8
    move/from16 v21, v3

    move/from16 v22, v5

    move/from16 v16, v15

    move-object/from16 v15, v24

    move-object/from16 v6, v25

    move-object/from16 v2, v26

    move-object/from16 v3, v27

    move-object/from16 v5, v30

    move/from16 v7, v31

    goto/16 :goto_62

    .line 4239
    .end local v24    # "proxyServer":Ljava/lang/String;
    .end local v25    # "protocolType":Ljava/lang/String;
    .end local v27    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .end local v30    # "vendorNameWithCid":Ljava/lang/String;
    .end local v31    # "adminId":I
    .local v3, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .local v5, "vendorNameWithCid":Ljava/lang/String;
    .restart local v6    # "protocolType":Ljava/lang/String;
    .restart local v7    # "adminId":I
    .local v15, "proxyServer":Ljava/lang/String;
    .restart local v16    # "proxyPort":I
    .restart local v21    # "usb_tethering":I
    .restart local v22    # "isUsbTetherAuthEnabled":I
    :cond_2fc
    move-object/from16 v27, v3

    move-object/from16 v24, v6

    move/from16 v25, v9

    move/from16 v28, v11

    .end local v3    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .end local v6    # "protocolType":Ljava/lang/String;
    .end local v9    # "profileId":I
    .end local v11    # "activateState":I
    .local v24, "protocolType":Ljava/lang/String;
    .local v25, "profileId":I
    .restart local v27    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .restart local v28    # "activateState":I
    goto :goto_309

    .line 4234
    .end local v24    # "protocolType":Ljava/lang/String;
    .end local v25    # "profileId":I
    .end local v27    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .end local v28    # "activateState":I
    .restart local v3    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .restart local v6    # "protocolType":Ljava/lang/String;
    .restart local v9    # "profileId":I
    .restart local v11    # "activateState":I
    :cond_305
    move-object/from16 v27, v3

    move-object/from16 v24, v4

    .line 4326
    .end local v3    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .end local v4    # "profileName":Ljava/lang/String;
    .end local v5    # "vendorNameWithCid":Ljava/lang/String;
    .end local v6    # "protocolType":Ljava/lang/String;
    .end local v7    # "adminId":I
    .end local v8    # "personaId":I
    .end local v9    # "profileId":I
    .end local v10    # "routeType":I
    .end local v11    # "activateState":I
    .end local v12    # "vpnConnectionType":I
    .end local v13    # "uidPidState":I
    .end local v14    # "chainingEnabled":I
    .end local v15    # "proxyServer":Ljava/lang/String;
    .end local v16    # "proxyPort":I
    .end local v17    # "pacurl":Ljava/lang/String;
    .end local v18    # "proxy_auth":I
    .end local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v20    # "ipChainName":Ljava/lang/String;
    .end local v21    # "usb_tethering":I
    .end local v22    # "isUsbTetherAuthEnabled":I
    :goto_309
    goto :goto_327

    .line 4324
    :catch_30a
    move-exception v0

    move-object v2, v0

    .line 4325
    .local v2, "e":Ljava/lang/Exception;
    :try_start_30c
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "init :  Exception when reading Profile DB:"

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_327
    .catchall {:try_start_30c .. :try_end_327} :catchall_481

    .line 4331
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_327
    :try_start_327
    iget-object v2, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v3, "VpnPackageInfo"

    const/4 v4, 0x0

    invoke-virtual {v2, v3, v4, v4, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v2

    .line 4333
    .local v2, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    const/4 v3, 0x0

    .local v3, "packageName":Ljava/lang/String;
    const/4 v4, 0x0

    .line 4334
    .restart local v4    # "profileName":Ljava/lang/String;
    const/4 v5, 0x0

    .line 4335
    .local v5, "originalPackageName":Ljava/lang/String;
    const/4 v6, -0x1

    .local v6, "uid":I
    const/4 v7, 0x0

    .line 4336
    .local v7, "cid":I
    const/4 v8, 0x0

    .line 4337
    .local v8, "p":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    const/4 v9, 0x0

    .line 4338
    .local v9, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v2, :cond_45a

    .line 4339
    sget-boolean v10, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v10, :cond_345

    const-string v10, "KnoxVpnEngineService"

    const-string/jumbo v11, "initializeHashtable : step#2 : Cursor not null"

    invoke-static {v10, v11}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4340
    :cond_345
    invoke-virtual {v2}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v10

    :goto_349
    invoke-interface {v10}, Ljava/util/Iterator;->hasNext()Z

    move-result v11

    if-eqz v11, :cond_45a

    invoke-interface {v10}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v11

    check-cast v11, Landroid/content/ContentValues;

    .line 4341
    .local v11, "cv":Landroid/content/ContentValues;
    const-string/jumbo v12, "profileName"

    invoke-virtual {v11, v12}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v12

    move-object v4, v12

    .line 4342
    const-string/jumbo v12, "packageName"

    invoke-virtual {v11, v12}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v12

    move-object v3, v12

    .line 4343
    const-string/jumbo v12, "packageUid"

    invoke-virtual {v11, v12}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v12

    invoke-virtual {v12}, Ljava/lang/Integer;->intValue()I

    move-result v12

    move v6, v12

    .line 4344
    const-string/jumbo v12, "packageCid"

    invoke-virtual {v11, v12}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v12

    invoke-virtual {v12}, Ljava/lang/Integer;->intValue()I

    move-result v12

    move v7, v12

    .line 4346
    sget-boolean v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v12, :cond_3b0

    const-string v12, "KnoxVpnEngineService"

    new-instance v13, Ljava/lang/StringBuilder;

    invoke-direct {v13}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v14, "initializeHashtable :  Cid : "

    invoke-virtual {v13, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13, v7}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v14, "Uid:"

    invoke-virtual {v13, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v14, " Profile:"

    invoke-virtual {v13, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v14, " packageName:"

    invoke-virtual {v13, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v13

    invoke-static {v12, v13}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4347
    :cond_3b0
    const/4 v12, -0x2

    if-ne v6, v12, :cond_3cf

    .line 4348
    iget-object v12, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v13, "ADD_ALL_PACKAGES"

    invoke-virtual {v12, v7, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v12

    invoke-virtual {v3, v12}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v12

    if-eqz v12, :cond_458

    .line 4349
    iget-object v12, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v12, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v12

    move-object v9, v12

    .line 4350
    if-eqz v9, :cond_458

    .line 4351
    invoke-virtual {v9, v3, v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->addPackageEntry(Ljava/lang/String;II)V

    goto/16 :goto_458

    .line 4354
    :cond_3cf
    const/4 v12, -0x1

    if-le v6, v12, :cond_3f6

    .line 4355
    iget-object v12, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v12, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v12

    move-object v9, v12

    .line 4356
    if-eqz v9, :cond_458

    .line 4358
    invoke-virtual {v9}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v12

    .line 4360
    .local v12, "personaId":I
    iget-object v13, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v13, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v13

    move-object v5, v13

    .line 4361
    iget-object v13, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v13, v5, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageInstalled(Ljava/lang/String;I)Z

    move-result v13

    if-eqz v13, :cond_3f2

    .line 4362
    invoke-virtual {v9, v3, v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->addPackageEntry(Ljava/lang/String;II)V

    goto :goto_3f5

    .line 4365
    :cond_3f2
    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->deleteUIDFromPackageData(Ljava/lang/String;)Z

    .line 4367
    .end local v12    # "personaId":I
    :goto_3f5
    goto :goto_458

    .line 4369
    :cond_3f6
    iget-object v13, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v13, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v13

    move-object v5, v13

    .line 4370
    iget-object v13, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v13, v7, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v13

    move v6, v13

    .line 4371
    sget-boolean v13, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v13, :cond_41f

    const-string v13, "KnoxVpnEngineService"

    new-instance v14, Ljava/lang/StringBuilder;

    invoke-direct {v14}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v15, "initializeHashtable : originalPackageName : "

    invoke-virtual {v14, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v14, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v14}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v14

    invoke-static {v13, v14}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4372
    :cond_41f
    sget-boolean v13, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v13, :cond_43a

    const-string v13, "KnoxVpnEngineService"

    new-instance v14, Ljava/lang/StringBuilder;

    invoke-direct {v14}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v15, "initializeHashtable : uid : "

    invoke-virtual {v14, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v14, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v14}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v14

    invoke-static {v13, v14}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4373
    :cond_43a
    if-le v6, v12, :cond_458

    .line 4374
    iget-object v12, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v12, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v12

    move-object v9, v12

    .line 4376
    if-eqz v9, :cond_458

    .line 4377
    invoke-virtual {v9}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v12

    .line 4380
    .restart local v12    # "personaId":I
    iget-object v13, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v13, v5, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageInstalled(Ljava/lang/String;I)Z

    move-result v13

    if-eqz v13, :cond_455

    .line 4381
    invoke-virtual {v9, v3, v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->addPackageEntry(Ljava/lang/String;II)V

    goto :goto_458

    .line 4384
    :cond_455
    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->deleteUIDFromPackageData(Ljava/lang/String;)Z
    :try_end_458
    .catch Ljava/lang/Exception; {:try_start_327 .. :try_end_458} :catch_45b
    .catchall {:try_start_327 .. :try_end_458} :catchall_481

    .line 4389
    .end local v11    # "cv":Landroid/content/ContentValues;
    .end local v12    # "personaId":I
    :cond_458
    :goto_458
    goto/16 :goto_349

    .line 4393
    .end local v2    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .end local v3    # "packageName":Ljava/lang/String;
    .end local v4    # "profileName":Ljava/lang/String;
    .end local v5    # "originalPackageName":Ljava/lang/String;
    .end local v6    # "uid":I
    .end local v7    # "cid":I
    .end local v8    # "p":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v9    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_45a
    goto :goto_478

    .line 4391
    :catch_45b
    move-exception v0

    move-object v2, v0

    .line 4392
    .local v2, "e":Ljava/lang/Exception;
    :try_start_45d
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "init2 :  Exception when reading package DB:"

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 4394
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_478
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_47f

    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->printProfileVpnMap()V
    :try_end_47f
    .catchall {:try_start_45d .. :try_end_47f} :catchall_481

    .line 4395
    :cond_47f
    monitor-exit p0

    return-void

    .line 4208
    :catchall_481
    move-exception v0

    move-object v2, v0

    monitor-exit p0

    throw v2
.end method

.method private declared-synchronized initializeVpnVendorForUserAfterBootComplete(I)V
    .registers 11
    .param p1, "containerId"    # I

    monitor-enter p0

    .line 4164
    :try_start_1
    const-string v0, "KnoxVpnEngineService"

    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "initializeVpnVendorForUserAfterBootComplete "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4165
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v0

    invoke-interface {v0}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_22
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_4c

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 4166
    .local v1, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbtetherAuth()I

    move-result v2

    const/4 v3, 0x1

    if-ne v2, v3, :cond_4b

    .line 4167
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v2

    .line 4168
    .local v2, "installedUsrId":I
    if-ne v2, p1, :cond_4b

    .line 4169
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v0

    .line 4170
    .local v0, "profileName":Ljava/lang/String;
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getTetherAuthDetailsFromDatabase(Ljava/lang/String;)Landroid/os/Bundle;

    move-result-object v3

    .line 4171
    .local v3, "authDetails":Landroid/os/Bundle;
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    invoke-virtual {v4, v0, v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->bindTetherAuthService(Ljava/lang/String;ILandroid/os/Bundle;)V

    .line 4172
    goto :goto_4c

    .line 4175
    .end local v0    # "profileName":Ljava/lang/String;
    .end local v1    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v2    # "installedUsrId":I
    .end local v3    # "authDetails":Landroid/os/Bundle;
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_4b
    goto :goto_22

    .line 4176
    :cond_4c
    :goto_4c
    new-instance v0, Ljava/util/ArrayList;

    invoke-direct {v0}, Ljava/util/ArrayList;-><init>()V

    .line 4177
    .local v0, "vendorList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_5b
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_da

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 4178
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    .line 4179
    .local v3, "profileName":Ljava/lang/String;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v4

    .line 4180
    .local v4, "cid":I
    sget-boolean v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v5, :cond_92

    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "initializeVpnVendorForUserAfterBootComplete : ProfileName: "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v7, " , cid = "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4181
    :cond_92
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v5

    .line 4182
    .local v5, "vendorNameWithCid":Ljava/lang/String;
    sget-boolean v6, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v6, :cond_b1

    const-string v6, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "initializeVpnVendorForUserAfterBootComplete : Checking vendor : "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v6, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4183
    :cond_b1
    if-ne v4, p1, :cond_d9

    if-eqz v5, :cond_d9

    invoke-virtual {v0, v5}, Ljava/util/ArrayList;->contains(Ljava/lang/Object;)Z

    move-result v6

    if-nez v6, :cond_d9

    .line 4184
    sget-boolean v6, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v6, :cond_d6

    const-string v6, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "initializeVpnVendorForUserAfterBootComplete : Adding vendor : "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v6, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4185
    :cond_d6
    invoke-virtual {v0, v5}, Ljava/util/ArrayList;->add(Ljava/lang/Object;)Z

    .line 4187
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "profileName":Ljava/lang/String;
    .end local v4    # "cid":I
    .end local v5    # "vendorNameWithCid":Ljava/lang/String;
    :cond_d9
    goto :goto_5b

    .line 4189
    :cond_da
    invoke-virtual {v0}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_de
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_11b

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Ljava/lang/String;

    .line 4190
    .local v2, "vendorNameWithCid":Ljava/lang/String;
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnConnectionList:Ljava/util/HashMap;

    invoke-virtual {v3, v2}, Ljava/util/HashMap;->containsKey(Ljava/lang/Object;)Z

    move-result v3

    if-eqz v3, :cond_fa

    .line 4191
    invoke-direct {p0, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVpnInterface(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v3

    .line 4194
    .local v3, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    invoke-direct {p0, v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnConnectionForBindedClient(Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;)V

    .line 4195
    .end local v3    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    goto :goto_11a

    .line 4196
    :cond_fa
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "initializeVpnVendorForUserAfterBootComplete : Binding to vendor : "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4197
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getAdminIdFromPackageName(Ljava/lang/String;)I

    move-result v3

    .line 4198
    .local v3, "adminId":I
    invoke-direct {p0, v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->bindKnoxVpnInterface(Ljava/lang/String;I)Z
    :try_end_11a
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_11a} :catch_11e
    .catchall {:try_start_1 .. :try_end_11a} :catchall_11c

    .line 4200
    .end local v2    # "vendorNameWithCid":Ljava/lang/String;
    .end local v3    # "adminId":I
    :goto_11a
    goto :goto_de

    .line 4203
    .end local v0    # "vendorList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    :cond_11b
    goto :goto_13a

    .line 4163
    .end local p1    # "containerId":I
    :catchall_11c
    move-exception p1

    goto :goto_13c

    .line 4201
    .restart local p1    # "containerId":I
    :catch_11e
    move-exception v0

    .line 4202
    .local v0, "e":Ljava/lang/Exception;
    :try_start_11f
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "initializeVpnVendorForUserAfterBootComplete : Exception: "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_13a
    .catchall {:try_start_11f .. :try_end_13a} :catchall_11c

    .line 4204
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_13a
    monitor-exit p0

    return-void

    .line 4163
    .end local p1    # "containerId":I
    :goto_13c
    monitor-exit p0

    throw p1
.end method

.method private declared-synchronized initializeVpnVendorForUserAfterLockBootComplete(I)V
    .registers 11
    .param p1, "containerId"    # I

    monitor-enter p0

    .line 4132
    :try_start_1
    const-string v0, "KnoxVpnEngineService"

    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "initializeVpnVendorForUserAfterLockBootComplete "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4133
    new-instance v0, Ljava/util/ArrayList;

    invoke-direct {v0}, Ljava/util/ArrayList;-><init>()V

    .line 4134
    .local v0, "vendorList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_27
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_a6

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 4135
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    .line 4136
    .local v3, "profileName":Ljava/lang/String;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v4

    .line 4137
    .local v4, "cid":I
    sget-boolean v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v5, :cond_5e

    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "initializeVpnVendorForUserAfterLockBootComplete : ProfileName: "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v7, " , cid = "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4138
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_5e
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v5

    .line 4139
    .local v5, "vendorNameWithCid":Ljava/lang/String;
    sget-boolean v6, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v6, :cond_7d

    const-string v6, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "initializeVpnVendorForUserAfterLockBootComplete : Checking vendor : "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v6, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4140
    :cond_7d
    if-ne v4, p1, :cond_a5

    if-eqz v5, :cond_a5

    invoke-virtual {v0, v5}, Ljava/util/ArrayList;->contains(Ljava/lang/Object;)Z

    move-result v6

    if-nez v6, :cond_a5

    .line 4141
    sget-boolean v6, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v6, :cond_a2

    const-string v6, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "initializeVpnVendorForUserAfterLockBootComplete : Adding vendor : "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v6, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4142
    :cond_a2
    invoke-virtual {v0, v5}, Ljava/util/ArrayList;->add(Ljava/lang/Object;)Z

    .line 4144
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "profileName":Ljava/lang/String;
    .end local v4    # "cid":I
    .end local v5    # "vendorNameWithCid":Ljava/lang/String;
    :cond_a5
    goto :goto_27

    .line 4146
    :cond_a6
    invoke-virtual {v0}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_aa
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_f7

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Ljava/lang/String;

    .line 4147
    .local v2, "vendorNameWithCid":Ljava/lang/String;
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnConnectionList:Ljava/util/HashMap;

    invoke-virtual {v3, v2}, Ljava/util/HashMap;->containsKey(Ljava/lang/Object;)Z

    move-result v3

    if-eqz v3, :cond_d6

    .line 4148
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "initializeVpnVendorForUserAfterLockBootComplete: skip binding for "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_f6

    .line 4150
    :cond_d6
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "initializeVpnVendorForUserAfterLockBootComplete : Binding to vendor : "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4151
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getAdminIdFromPackageName(Ljava/lang/String;)I

    move-result v3

    .line 4152
    .local v3, "adminId":I
    invoke-direct {p0, v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->bindKnoxVpnInterface(Ljava/lang/String;I)Z
    :try_end_f6
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_f6} :catch_fa
    .catchall {:try_start_1 .. :try_end_f6} :catchall_f8

    .line 4154
    .end local v2    # "vendorNameWithCid":Ljava/lang/String;
    .end local v3    # "adminId":I
    :goto_f6
    goto :goto_aa

    .line 4157
    .end local v0    # "vendorList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    :cond_f7
    goto :goto_116

    .line 4131
    .end local p1    # "containerId":I
    :catchall_f8
    move-exception p1

    goto :goto_118

    .line 4155
    .restart local p1    # "containerId":I
    :catch_fa
    move-exception v0

    .line 4156
    .local v0, "e":Ljava/lang/Exception;
    :try_start_fb
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "initializeVpnVendorForUserAfterLockBootComplete : Exception: "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_116
    .catchall {:try_start_fb .. :try_end_116} :catchall_f8

    .line 4158
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_116
    monitor-exit p0

    return-void

    .line 4131
    .end local p1    # "containerId":I
    :goto_118
    monitor-exit p0

    throw p1
.end method

.method private isCaptivePortalSignInState()Z
    .registers 5

    .line 5736
    const/4 v0, 0x0

    .line 5738
    .local v0, "isSignInState":Z
    :try_start_1
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getConnectivityManagerService()Landroid/net/IConnectivityManager;

    move-result-object v1

    invoke-interface {v1}, Landroid/net/IConnectivityManager;->getActiveNetwork()Landroid/net/Network;

    move-result-object v1

    .line 5739
    .local v1, "network":Landroid/net/Network;
    if-nez v1, :cond_d

    .line 5740
    const/4 v2, 0x0

    return v2

    .line 5741
    :cond_d
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getConnectivityManagerService()Landroid/net/IConnectivityManager;

    move-result-object v2

    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v3}, Landroid/content/Context;->getOpPackageName()Ljava/lang/String;

    move-result-object v3

    invoke-interface {v2, v1, v3}, Landroid/net/IConnectivityManager;->getNetworkCapabilities(Landroid/net/Network;Ljava/lang/String;)Landroid/net/NetworkCapabilities;

    move-result-object v2

    .line 5742
    .local v2, "capabilities":Landroid/net/NetworkCapabilities;
    if-eqz v2, :cond_24

    .line 5743
    const/16 v3, 0x11

    invoke-virtual {v2, v3}, Landroid/net/NetworkCapabilities;->hasCapability(I)Z

    move-result v3
    :try_end_23
    .catch Landroid/os/RemoteException; {:try_start_1 .. :try_end_23} :catch_25

    move v0, v3

    .line 5746
    .end local v1    # "network":Landroid/net/Network;
    .end local v2    # "capabilities":Landroid/net/NetworkCapabilities;
    :cond_24
    goto :goto_2d

    .line 5744
    :catch_25
    move-exception v1

    .line 5745
    .local v1, "e":Landroid/os/RemoteException;
    const-string v2, "KnoxVpnEngineService"

    const-string v3, "Exception occurred while checking captive portal state"

    invoke-static {v2, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 5747
    .end local v1    # "e":Landroid/os/RemoteException;
    :goto_2d
    return v0
.end method

.method private isMethodAllowedForVendorSettings(Ljava/lang/String;)Z
    .registers 8
    .param p1, "methodName"    # Ljava/lang/String;

    .line 7535
    sget-object v0, Lcom/samsung/android/knox/net/vpn/KnoxVpnPolicyConstants;->ALLOWED_METHODS_VENDOR_SETTINGS:[Ljava/lang/String;

    array-length v1, v0

    const/4 v2, 0x0

    move v3, v2

    :goto_5
    if-ge v3, v1, :cond_14

    aget-object v4, v0, v3

    .line 7536
    .local v4, "allowedMethod":Ljava/lang/String;
    invoke-virtual {v4, p1}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v5

    if-eqz v5, :cond_11

    .line 7537
    const/4 v0, 0x1

    return v0

    .line 7535
    .end local v4    # "allowedMethod":Ljava/lang/String;
    :cond_11
    add-int/lit8 v3, v3, 0x1

    goto :goto_5

    .line 7540
    :cond_14
    return v2
.end method

.method private isNetworkConnected()Z
    .registers 8

    .line 4069
    const-string v0, "KnoxVpnEngineService"

    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v1

    .line 4071
    .local v1, "token":J
    const/4 v3, 0x0

    :try_start_7
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getConnectivityManagerService()Landroid/net/IConnectivityManager;

    move-result-object v4

    invoke-interface {v4}, Landroid/net/IConnectivityManager;->getActiveNetworkInfo()Landroid/net/NetworkInfo;

    move-result-object v4

    .line 4072
    .local v4, "activeNetwork":Landroid/net/NetworkInfo;
    if-eqz v4, :cond_21

    invoke-virtual {v4}, Landroid/net/NetworkInfo;->isConnected()Z

    move-result v5

    if-eqz v5, :cond_21

    .line 4073
    const-string v5, "check network connection : returns true"

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_1c
    .catch Ljava/lang/Exception; {:try_start_7 .. :try_end_1c} :catch_2d
    .catchall {:try_start_7 .. :try_end_1c} :catchall_2b

    .line 4074
    const/4 v0, 0x1

    .line 4084
    invoke-static {v1, v2}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 4074
    return v0

    .line 4076
    :cond_21
    :try_start_21
    const-string v5, "check network connection : returns false"

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_26
    .catch Ljava/lang/Exception; {:try_start_21 .. :try_end_26} :catch_2d
    .catchall {:try_start_21 .. :try_end_26} :catchall_2b

    .line 4077
    nop

    .line 4084
    invoke-static {v1, v2}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 4077
    return v3

    .line 4084
    .end local v4    # "activeNetwork":Landroid/net/NetworkInfo;
    :catchall_2b
    move-exception v0

    goto :goto_4b

    .line 4079
    :catch_2d
    move-exception v4

    .line 4081
    .local v4, "e":Ljava/lang/Exception;
    :try_start_2e
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception: "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v4}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v0, v5}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_46
    .catchall {:try_start_2e .. :try_end_46} :catchall_2b

    .line 4082
    nop

    .line 4084
    invoke-static {v1, v2}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 4082
    return v3

    .line 4084
    .end local v4    # "e":Ljava/lang/Exception;
    :goto_4b
    invoke-static {v1, v2}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 4085
    throw v0
.end method

.method private isProxyServicePackage(ILjava/lang/String;)Z
    .registers 6
    .param p1, "userId"    # I
    .param p2, "packageName"    # Ljava/lang/String;

    .line 7626
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    .line 7627
    const/4 v1, 0x0

    const-string v2, "com.knox.vpn.proxyhandler"

    invoke-virtual {v0, v1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v0

    .line 7626
    invoke-virtual {p2, v0}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v0

    if-eqz v0, :cond_11

    .line 7628
    const/4 v0, 0x1

    return v0

    .line 7630
    :cond_11
    return v1
.end method

.method private killRunningProcessToApplyProxy(Ljava/lang/String;Ljava/util/HashMap;Ljava/util/HashSet;)V
    .registers 21
    .param p1, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Ljava/lang/String;",
            "Ljava/util/HashMap<",
            "Ljava/lang/Integer;",
            "Ljava/lang/Boolean;",
            ">;",
            "Ljava/util/HashSet<",
            "Ljava/lang/Integer;",
            ">;)V"
        }
    .end annotation

    .line 8556
    .local p2, "uidList":Ljava/util/HashMap;, "Ljava/util/HashMap<Ljava/lang/Integer;Ljava/lang/Boolean;>;"
    .local p3, "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    move-object/from16 v1, p0

    move-object/from16 v2, p2

    const-string v3, "KnoxVpnEngineService"

    if-nez v2, :cond_12

    .line 8557
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v0, :cond_11

    const-string v0, "Proxy config has been applied : null"

    invoke-static {v3, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8558
    :cond_11
    return-void

    .line 8560
    :cond_12
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v4

    .line 8561
    .local v4, "clearToken":J
    const/4 v6, 0x0

    .line 8563
    .local v6, "showNotification":Z
    :try_start_17
    invoke-virtual/range {p2 .. p2}, Ljava/util/HashMap;->keySet()Ljava/util/Set;

    move-result-object v0

    invoke-interface {v0}, Ljava/util/Set;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_1f
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v7

    if-eqz v7, :cond_141

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v7

    check-cast v7, Ljava/lang/Integer;

    .line 8564
    .local v7, "uid":Ljava/lang/Integer;
    invoke-virtual {v2, v7}, Ljava/util/HashMap;->get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v8

    check-cast v8, Ljava/lang/Boolean;

    invoke-virtual {v8}, Ljava/lang/Boolean;->booleanValue()Z

    move-result v8
    :try_end_35
    .catch Ljava/lang/Exception; {:try_start_17 .. :try_end_35} :catch_154
    .catchall {:try_start_17 .. :try_end_35} :catchall_150

    const-string/jumbo v9, "whose uid is "

    if-eqz v8, :cond_cd

    .line 8565
    :try_start_3a
    sget-object v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->APPS_TO_RESTART_PROXY:[Ljava/lang/String;

    array-length v11, v8

    const/4 v12, 0x0

    :goto_3e
    if-ge v12, v11, :cond_c8

    aget-object v13, v8, v12

    .line 8566
    .local v13, "packageName":Ljava/lang/String;
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v14

    invoke-virtual {v7}, Ljava/lang/Integer;->intValue()I

    move-result v15

    invoke-virtual {v14, v15, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v14

    .line 8567
    .local v14, "appUid":I
    invoke-static {v14}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v15
    :try_end_52
    .catch Ljava/lang/Exception; {:try_start_3a .. :try_end_52} :catch_154
    .catchall {:try_start_3a .. :try_end_52} :catchall_150

    move-object/from16 v10, p3

    :try_start_54
    invoke-virtual {v10, v15}, Ljava/util/HashSet;->contains(Ljava/lang/Object;)Z

    move-result v15

    if-eqz v15, :cond_77

    .line 8568
    new-instance v15, Ljava/lang/StringBuilder;

    invoke-direct {v15}, Ljava/lang/StringBuilder;-><init>()V

    move-object/from16 v16, v0

    const-string v0, "The following app uid "

    invoke-virtual {v15, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v15, v14}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string/jumbo v0, "is not going to be restarted since it is added to exempt list"

    invoke-virtual {v15, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v15}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v3, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8569
    goto :goto_c0

    .line 8571
    :cond_77
    move-object/from16 v16, v0

    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v0}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;

    move-result-object v0

    const/4 v15, 0x0

    invoke-virtual {v0, v13, v15}, Landroid/content/pm/PackageManager;->getApplicationInfo(Ljava/lang/String;I)Landroid/content/pm/ApplicationInfo;

    move-result-object v0

    .line 8572
    .local v0, "appInfo":Landroid/content/pm/ApplicationInfo;
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getAMSInstance()Lcom/android/server/am/ActivityManagerService;

    move-result-object v15

    iget-object v2, v0, Landroid/content/pm/ApplicationInfo;->processName:Ljava/lang/String;

    invoke-virtual {v15, v2, v14}, Lcom/android/server/am/ActivityManagerService;->checkIfProcessIsRunning(Ljava/lang/String;I)Z

    move-result v2

    if-eqz v2, :cond_b5

    .line 8573
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v15, "Proxy config has been applied for the entire user, going to restart the app "

    invoke-virtual {v2, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v14}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v3, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8574
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getAMSInstance()Lcom/android/server/am/ActivityManagerService;

    move-result-object v2

    iget-object v15, v0, Landroid/content/pm/ApplicationInfo;->processName:Ljava/lang/String;

    invoke-virtual {v2, v15, v14}, Lcom/android/server/am/ActivityManagerService;->killApplicationProcess(Ljava/lang/String;I)V

    .line 8575
    const/4 v2, 0x1

    move v6, v2

    .line 8577
    :cond_b5
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getAMSInstance()Lcom/android/server/am/ActivityManagerService;

    move-result-object v2

    invoke-virtual {v7}, Ljava/lang/Integer;->intValue()I

    move-result v15

    invoke-virtual {v2, v13, v15}, Lcom/android/server/am/ActivityManagerService;->killBackgroundProcesses(Ljava/lang/String;I)V

    .line 8565
    .end local v0    # "appInfo":Landroid/content/pm/ApplicationInfo;
    .end local v13    # "packageName":Ljava/lang/String;
    .end local v14    # "appUid":I
    :goto_c0
    add-int/lit8 v12, v12, 0x1

    move-object/from16 v2, p2

    move-object/from16 v0, v16

    goto/16 :goto_3e

    :cond_c8
    move-object/from16 v10, p3

    move-object/from16 v16, v0

    goto :goto_13b

    .line 8580
    :cond_cd
    move-object/from16 v10, p3

    move-object/from16 v16, v0

    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v0

    invoke-virtual {v7}, Ljava/lang/Integer;->intValue()I

    move-result v2

    invoke-virtual {v0, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPackageNameForUid(I)Ljava/lang/String;

    move-result-object v0

    .line 8581
    .local v0, "packageName":Ljava/lang/String;
    sget-object v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->APPS_TO_RESTART_PROXY:[Ljava/lang/String;

    invoke-static {v2}, Ljava/util/Arrays;->asList([Ljava/lang/Object;)Ljava/util/List;

    move-result-object v2

    invoke-interface {v2, v0}, Ljava/util/List;->contains(Ljava/lang/Object;)Z

    move-result v2

    if-eqz v2, :cond_13b

    .line 8582
    iget-object v2, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v2}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;

    move-result-object v2

    const/4 v8, 0x0

    invoke-virtual {v2, v0, v8}, Landroid/content/pm/PackageManager;->getApplicationInfo(Ljava/lang/String;I)Landroid/content/pm/ApplicationInfo;

    move-result-object v2

    .line 8583
    .local v2, "appInfo":Landroid/content/pm/ApplicationInfo;
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getAMSInstance()Lcom/android/server/am/ActivityManagerService;

    move-result-object v8

    iget-object v11, v2, Landroid/content/pm/ApplicationInfo;->processName:Ljava/lang/String;

    invoke-virtual {v7}, Ljava/lang/Integer;->intValue()I

    move-result v12

    invoke-virtual {v8, v11, v12}, Lcom/android/server/am/ActivityManagerService;->checkIfProcessIsRunning(Ljava/lang/String;I)Z

    move-result v8

    if-eqz v8, :cond_12c

    .line 8584
    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v11, "Proxy config has been applied, going to restart the app "

    invoke-virtual {v8, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v3, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8585
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getAMSInstance()Lcom/android/server/am/ActivityManagerService;

    move-result-object v8

    iget-object v9, v2, Landroid/content/pm/ApplicationInfo;->processName:Ljava/lang/String;

    invoke-virtual {v7}, Ljava/lang/Integer;->intValue()I

    move-result v11

    invoke-virtual {v8, v9, v11}, Lcom/android/server/am/ActivityManagerService;->killApplicationProcess(Ljava/lang/String;I)V

    .line 8586
    const/4 v6, 0x1

    .line 8588
    :cond_12c
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getAMSInstance()Lcom/android/server/am/ActivityManagerService;

    move-result-object v8

    invoke-virtual {v7}, Ljava/lang/Integer;->intValue()I

    move-result v9

    invoke-static {v9}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v9

    invoke-virtual {v8, v0, v9}, Lcom/android/server/am/ActivityManagerService;->killBackgroundProcesses(Ljava/lang/String;I)V

    .line 8591
    .end local v0    # "packageName":Ljava/lang/String;
    .end local v2    # "appInfo":Landroid/content/pm/ApplicationInfo;
    .end local v7    # "uid":Ljava/lang/Integer;
    :cond_13b
    :goto_13b
    move-object/from16 v2, p2

    move-object/from16 v0, v16

    goto/16 :goto_1f

    .line 8592
    :cond_141
    move-object/from16 v10, p3

    if-eqz v6, :cond_14b

    .line 8593
    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->createProcessKillNotification(Ljava/lang/String;)V
    :try_end_148
    .catch Ljava/lang/Exception; {:try_start_54 .. :try_end_148} :catch_149
    .catchall {:try_start_54 .. :try_end_148} :catchall_172

    goto :goto_14b

    .line 8595
    :catch_149
    move-exception v0

    goto :goto_157

    .line 8598
    :cond_14b
    :goto_14b
    nop

    :goto_14c
    invoke-static {v4, v5}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 8599
    goto :goto_171

    .line 8598
    :catchall_150
    move-exception v0

    move-object/from16 v10, p3

    goto :goto_173

    .line 8595
    :catch_154
    move-exception v0

    move-object/from16 v10, p3

    .line 8596
    .local v0, "e":Ljava/lang/Exception;
    :goto_157
    :try_start_157
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "Exception occured while trying to kill application process to enable proxy "

    invoke-virtual {v2, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v2, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v3, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_16f
    .catchall {:try_start_157 .. :try_end_16f} :catchall_172

    .line 8598
    nop

    .end local v0    # "e":Ljava/lang/Exception;
    goto :goto_14c

    .line 8600
    :goto_171
    return-void

    .line 8598
    :catchall_172
    move-exception v0

    :goto_173
    invoke-static {v4, v5}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 8599
    throw v0
.end method

.method private logVpnVendor(Landroid/content/ComponentName;)V
    .registers 19
    .param p1, "cpName"    # Landroid/content/ComponentName;

    .line 9271
    move-object/from16 v1, p0

    const-string/jumbo v0, "packageName"

    const-string v2, "KnoxVpnEngineService"

    const-string/jumbo v3, "vpnVendor"

    if-nez p1, :cond_d

    .line 9272
    return-void

    .line 9274
    :cond_d
    :try_start_d
    invoke-virtual/range {p1 .. p1}, Landroid/content/ComponentName;->getPackageName()Ljava/lang/String;

    move-result-object v4

    .line 9275
    .local v4, "packageName":Ljava/lang/String;
    invoke-virtual/range {p1 .. p1}, Landroid/content/ComponentName;->getClassName()Ljava/lang/String;

    move-result-object v5

    .line 9276
    .local v5, "serviceName":Ljava/lang/String;
    invoke-static {v4}, Landroid/text/TextUtils;->isEmpty(Ljava/lang/CharSequence;)Z

    move-result v6

    if-nez v6, :cond_d0

    invoke-static {v5}, Landroid/text/TextUtils;->isEmpty(Ljava/lang/CharSequence;)Z

    move-result v6

    if-eqz v6, :cond_23

    goto/16 :goto_d0

    .line 9279
    :cond_23
    sget-boolean v6, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v6, :cond_43

    .line 9280
    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "VPN service name "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v7, " pkgname "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v2, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 9283
    :cond_43
    const/4 v6, 0x1

    .line 9285
    .local v6, "namespace":I
    const-string v7, "com.samsung.android.knox.net.vpn.KnoxONSVpnService"

    invoke-virtual {v7, v5}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v7

    if-eqz v7, :cond_4d

    .line 9286
    const/4 v6, 0x2

    .line 9289
    :cond_4d
    const/4 v7, 0x0

    .line 9290
    .local v7, "bitmask":I
    const/4 v8, 0x0

    .line 9291
    .local v8, "shouldLog":Z
    filled-new-array {v0}, [Ljava/lang/String;

    move-result-object v9

    .line 9292
    .local v9, "columns":[Ljava/lang/String;
    const/4 v10, 0x1

    new-array v11, v10, [Ljava/lang/String;

    const/4 v12, 0x0

    aput-object v4, v11, v12

    .line 9293
    .local v11, "values":[Ljava/lang/String;
    iget-object v13, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const/4 v14, 0x0

    invoke-virtual {v13, v3, v9, v11, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v13
    :try_end_60
    .catch Ljava/lang/Exception; {:try_start_d .. :try_end_60} :catch_d1

    .line 9295
    .local v13, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    const-string/jumbo v15, "namespace"

    if-eqz v13, :cond_91

    :try_start_65
    invoke-virtual {v13}, Ljava/util/ArrayList;->isEmpty()Z

    move-result v16

    if-eqz v16, :cond_6c

    goto :goto_91

    .line 9302
    :cond_6c
    invoke-virtual {v13, v12}, Ljava/util/ArrayList;->get(I)Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Landroid/content/ContentValues;
    :try_end_72
    .catch Ljava/lang/Exception; {:try_start_65 .. :try_end_72} :catch_d1

    move-object v12, v0

    .line 9304
    .local v12, "cv":Landroid/content/ContentValues;
    :try_start_73
    invoke-virtual {v12, v15}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v0}, Ljava/lang/Integer;->intValue()I

    move-result v0
    :try_end_7b
    .catch Ljava/lang/NumberFormatException; {:try_start_73 .. :try_end_7b} :catch_7d
    .catch Ljava/lang/Exception; {:try_start_73 .. :try_end_7b} :catch_d1

    move v7, v0

    .line 9306
    goto :goto_7e

    .line 9305
    :catch_7d
    move-exception v0

    .line 9307
    :goto_7e
    and-int v0, v7, v6

    if-nez v0, :cond_a7

    .line 9308
    or-int/2addr v7, v6

    .line 9309
    :try_start_83
    invoke-static {v7}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v15, v0}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Integer;)V

    .line 9310
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    invoke-virtual {v0, v3, v9, v11, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->putDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;Landroid/content/ContentValues;)Z

    .line 9311
    const/4 v8, 0x1

    goto :goto_a7

    .line 9296
    .end local v12    # "cv":Landroid/content/ContentValues;
    :cond_91
    :goto_91
    new-instance v12, Landroid/content/ContentValues;

    invoke-direct {v12}, Landroid/content/ContentValues;-><init>()V

    .line 9297
    .restart local v12    # "cv":Landroid/content/ContentValues;
    invoke-virtual {v12, v0, v4}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/String;)V

    .line 9298
    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v15, v0}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Integer;)V

    .line 9299
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    invoke-virtual {v0, v3, v14, v14, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->putDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;Landroid/content/ContentValues;)Z

    .line 9300
    const/4 v8, 0x1

    .line 9301
    .end local v12    # "cv":Landroid/content/ContentValues;
    nop

    .line 9314
    :cond_a7
    :goto_a7
    if-eqz v8, :cond_cf

    .line 9315
    new-instance v0, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v3, "KNOX_VPN"

    const-string v12, "API:logVpnVendor"

    invoke-direct {v0, v3, v10, v12}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 9316
    const-string/jumbo v3, "vndrPkgN"

    invoke-virtual {v0, v3, v4}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;Ljava/lang/String;)V

    .line 9317
    const-string v0, "New"

    .line 9318
    .local v0, "namespaceStr":Ljava/lang/String;
    and-int/lit8 v3, v6, 0x1

    if-eqz v3, :cond_c3

    .line 9319
    const-string v3, "Old"

    move-object v0, v3

    .line 9320
    :cond_c3
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v10, "NS"

    invoke-virtual {v3, v10, v0}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;Ljava/lang/String;)V

    .line 9321
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v3}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_cf
    .catch Ljava/lang/Exception; {:try_start_83 .. :try_end_cf} :catch_d1

    .line 9325
    .end local v0    # "namespaceStr":Ljava/lang/String;
    .end local v4    # "packageName":Ljava/lang/String;
    .end local v5    # "serviceName":Ljava/lang/String;
    .end local v6    # "namespace":I
    .end local v7    # "bitmask":I
    .end local v8    # "shouldLog":Z
    .end local v9    # "columns":[Ljava/lang/String;
    .end local v11    # "values":[Ljava/lang/String;
    .end local v13    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    :cond_cf
    goto :goto_ea

    .line 9277
    .restart local v4    # "packageName":Ljava/lang/String;
    .restart local v5    # "serviceName":Ljava/lang/String;
    :cond_d0
    :goto_d0
    return-void

    .line 9323
    .end local v4    # "packageName":Ljava/lang/String;
    .end local v5    # "serviceName":Ljava/lang/String;
    :catch_d1
    move-exception v0

    .line 9324
    .local v0, "ex":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "failed to log vendor namespace "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/Exception;->getMessage()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v2, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 9326
    .end local v0    # "ex":Ljava/lang/Exception;
    :goto_ea
    return-void
.end method

.method private migrateForAddall(Ljava/lang/String;I)Z
    .registers 8
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "personaId"    # I

    .line 8105
    new-instance v0, Landroid/content/ContentValues;

    invoke-direct {v0}, Landroid/content/ContentValues;-><init>()V

    .line 8106
    .local v0, "cv":Landroid/content/ContentValues;
    const/4 v1, 0x0

    .line 8108
    .local v1, "status":Z
    nop

    .line 8109
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v3, "ADD_ALL_PACKAGES"

    invoke-virtual {v2, p2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v2

    const-string/jumbo v3, "packageName"

    invoke-virtual {v0, v3, v2}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/String;)V

    .line 8110
    const-string/jumbo v2, "profileName"

    invoke-virtual {v0, v2, p1}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/String;)V

    .line 8111
    const/4 v2, -0x2

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    const-string/jumbo v3, "packageUid"

    invoke-virtual {v0, v3, v2}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Integer;)V

    .line 8112
    invoke-static {p2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    const-string/jumbo v3, "packageCid"

    invoke-virtual {v0, v3, v2}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Integer;)V

    .line 8115
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v3, "VpnPackageInfo"

    const/4 v4, 0x0

    invoke-virtual {v2, v3, v4, v4, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->putDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;Landroid/content/ContentValues;)Z

    move-result v1

    .line 8116
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "migration forAddall status : "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v1}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    const-string v3, "KnoxVpnEngineService"

    invoke-static {v3, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8118
    return v1
.end method

.method private printProfileVpnMap()V
    .registers 12

    .line 4091
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v0, :cond_141

    .line 4092
    const-string v0, "KnoxVpnEngineService"

    const-string v1, "********************Printing profile map ********************"

    invoke-static {v0, v1}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 4094
    :try_start_b
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileCount()I

    move-result v1

    .line 4095
    .local v1, "profileCount":I
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "No of profiles: "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 4096
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v2

    invoke-interface {v2}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_2f
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_11c

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 4097
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v3, :cond_10f

    .line 4098
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v4

    .line 4099
    .local v4, "profileName":Ljava/lang/String;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v5

    .line 4101
    .local v5, "interfaceName":Ljava/lang/String;
    invoke-direct {p0, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVPNTransitionState(Ljava/lang/String;)I

    move-result v6

    .line 4102
    .local v6, "state":I
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "{ProfileName = "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v8, ": ["

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v0, v7}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 4103
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "iface:"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v8, " ; personaId: "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v8, " ; adminId: "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getAdminId()I

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v0, v7}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 4106
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "state: "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v0, v7}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 4107
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string v8, "activated:"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v8

    if-nez v8, :cond_b8

    .line 4108
    const-string v8, "false "

    goto :goto_bb

    :cond_b8
    const-string/jumbo v8, "true "

    :goto_bb
    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    .line 4107
    invoke-static {v0, v7}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 4109
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v7

    invoke-interface {v7}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v7

    :goto_cd
    invoke-interface {v7}, Ljava/util/Iterator;->hasNext()Z

    move-result v8

    if-eqz v8, :cond_10e

    invoke-interface {v7}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v8

    check-cast v8, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 4110
    .local v8, "p":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    new-instance v9, Ljava/lang/StringBuilder;

    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v10, "{ uid:"

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    .line 4111
    invoke-virtual {v8}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v10

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v10, ", packageName:"

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    .line 4112
    invoke-virtual {v8}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v10

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v10, ", profileName:"

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string/jumbo v10, "}},"

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v9

    .line 4110
    invoke-static {v0, v9}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 4114
    nop

    .end local v8    # "p":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    goto :goto_cd

    .line 4115
    .end local v4    # "profileName":Ljava/lang/String;
    .end local v5    # "interfaceName":Ljava/lang/String;
    .end local v6    # "state":I
    :cond_10e
    goto :goto_114

    .line 4116
    :cond_10f
    const-string v4, "VpnProfileInfo contains NULL object."

    invoke-static {v0, v4}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 4118
    :goto_114
    const-string v4, "]},"

    invoke-static {v0, v4}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 4119
    nop

    .end local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    goto/16 :goto_2f

    .line 4120
    :cond_11c
    const-string v2, "] "

    invoke-static {v0, v2}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_121
    .catch Ljava/lang/Exception; {:try_start_b .. :try_end_121} :catch_123

    .line 4123
    nop

    .end local v1    # "profileCount":I
    goto :goto_13c

    .line 4121
    :catch_123
    move-exception v1

    .line 4122
    .local v1, "e":Ljava/lang/Exception;
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception: "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v1}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 4124
    .end local v1    # "e":Ljava/lang/Exception;
    :goto_13c
    const-string v1, "-----------------Printing profile map --------------------------"

    invoke-static {v0, v1}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 4126
    :cond_141
    return-void
.end method

.method private refreshDomainInHashMap(Ljava/lang/String;)V
    .registers 13
    .param p1, "profileName"    # Ljava/lang/String;

    .line 7789
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    invoke-virtual {v0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDomainsByProfileName(Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v0

    .line 7790
    .local v0, "list":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    if-eqz v0, :cond_d

    .line 7791
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationMap:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v1, p1, v0}, Ljava/util/concurrent/ConcurrentHashMap;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;

    .line 7793
    :cond_d
    sget-boolean v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v1, :cond_e0

    .line 7794
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "#################### Printing domain map ####################"

    invoke-static {v1, v2}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 7796
    :try_start_18
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Domain Count : "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationMap:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v4}, Ljava/util/concurrent/ConcurrentHashMap;->size()I

    move-result v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v4, " [ "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v1, v3}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 7797
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationMap:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v3}, Ljava/util/concurrent/ConcurrentHashMap;->keySet()Ljava/util/Set;

    move-result-object v3

    invoke-interface {v3}, Ljava/util/Set;->iterator()Ljava/util/Iterator;

    move-result-object v3

    :goto_41
    invoke-interface {v3}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_be

    invoke-interface {v3}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Ljava/lang/String;

    .line 7798
    .local v4, "key":Ljava/lang/String;
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationMap:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v5, v4}, Ljava/util/concurrent/ConcurrentHashMap;->get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Ljava/util/ArrayList;
    :try_end_55
    .catch Ljava/lang/Exception; {:try_start_18 .. :try_end_55} :catch_c4

    .line 7799
    .local v5, "items":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    const-string v6, ""

    move-object v7, v6

    .line 7800
    .local v7, "itemStr":Ljava/lang/String;
    const/4 v8, 0x0

    .local v8, "i":I
    :goto_59
    :try_start_59
    invoke-virtual {v5}, Ljava/util/ArrayList;->size()I

    move-result v9

    if-ge v8, v9, :cond_7d

    .line 7801
    new-instance v9, Ljava/lang/StringBuilder;

    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v9, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v10, ","

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v8}, Ljava/util/ArrayList;->get(I)Ljava/lang/Object;

    move-result-object v10

    check-cast v10, Ljava/lang/String;

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v9

    move-object v7, v9

    .line 7800
    add-int/lit8 v8, v8, 0x1

    goto :goto_59

    .line 7804
    .end local v8    # "i":I
    :cond_7d
    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "{ProfileName = "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v9, ": ["

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v1, v8}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 7805
    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v9, "    domains : "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v6}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v9

    if-eqz v9, :cond_a8

    goto :goto_ad

    :cond_a8
    const/4 v6, 0x1

    invoke-virtual {v7, v6}, Ljava/lang/String;->substring(I)Ljava/lang/String;

    move-result-object v6

    :goto_ad
    invoke-virtual {v8, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v1, v6}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 7806
    const-string v6, "]},"

    invoke-static {v1, v6}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 7807
    nop

    .end local v4    # "key":Ljava/lang/String;
    .end local v5    # "items":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    .end local v7    # "itemStr":Ljava/lang/String;
    goto :goto_41

    .line 7808
    :cond_be
    const-string v3, "] "

    invoke-static {v1, v3}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_c3
    .catch Ljava/lang/Exception; {:try_start_59 .. :try_end_c3} :catch_c4

    .line 7811
    goto :goto_dd

    .line 7809
    :catch_c4
    move-exception v3

    .line 7810
    .local v3, "e":Ljava/lang/Exception;
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception: "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v3}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v1, v4}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 7812
    .end local v3    # "e":Ljava/lang/Exception;
    :goto_dd
    invoke-static {v1, v2}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I

    .line 7814
    :cond_e0
    return-void
.end method

.method private removeAddAllPackageInfofromDatabase(Ljava/lang/String;I)I
    .registers 11
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "containerId"    # I

    .line 2115
    const-string v0, "KnoxVpnEngineService"

    const/4 v1, -0x1

    .line 2117
    .local v1, "status":I
    :try_start_3
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v3, "ADD_ALL_PACKAGES"

    invoke-virtual {v2, p2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v2

    .line 2118
    .local v2, "removePackage":Ljava/lang/String;
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_24

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v4, "removeAddAllPackageInfofromDatabase: removePackage value is "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2119
    :cond_24
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v4, "VpnPackageInfo"

    const-string/jumbo v5, "packageName"

    const-string/jumbo v6, "profileName"

    filled-new-array {v5, v6}, [Ljava/lang/String;

    move-result-object v5

    const/4 v6, 0x2

    new-array v6, v6, [Ljava/lang/String;

    const/4 v7, 0x0

    aput-object v2, v6, v7

    const/4 v7, 0x1

    aput-object p1, v6, v7

    invoke-virtual {v3, v4, v5, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->deleteDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Z

    move-result v3
    :try_end_3f
    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_3f} :catch_43

    .line 2122
    .local v3, "success":Z
    if-eqz v3, :cond_42

    .line 2123
    const/4 v1, 0x0

    .line 2127
    .end local v2    # "removePackage":Ljava/lang/String;
    .end local v3    # "success":Z
    :cond_42
    goto :goto_5c

    .line 2125
    :catch_43
    move-exception v2

    .line 2126
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Exception at removeAddAllPackageInfofromDatabase API "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 2128
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_5c
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_75

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "removeAddAllPackageInfofromDatabase: status value is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2129
    :cond_75
    return v1
.end method

.method private declared-synchronized removeAllPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 41
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    move-object/from16 v8, p0

    move-object/from16 v9, p1

    move-object/from16 v10, p2

    monitor-enter p0

    .line 2663
    :try_start_7
    const-string v0, "KnoxVpnEngineService"

    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "removeAllPackages : vpnContext.personaId value is "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget v2, v9, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v2, " profileName value is "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2664
    iget v0, v9, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    move v11, v0

    .line 2665
    .local v11, "cid":I
    new-instance v0, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    move-object v12, v0

    .line 2666
    .local v12, "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v0, -0x1

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v1

    invoke-virtual {v12, v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2667
    const/4 v13, 0x1

    invoke-virtual {v12, v13, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_3d
    .catchall {:try_start_7 .. :try_end_3d} :catchall_3da

    .line 2670
    :try_start_3d
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0

    move-object v14, v0

    .line 2671
    .local v14, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v14, :cond_58

    .line 2672
    const/16 v0, 0x6c

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2673
    const-string v0, "KnoxVpnEngineService"

    const-string v1, "Error while removing all the packages from vpn: The error code is 108"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_56
    .catch Ljava/lang/Exception; {:try_start_3d .. :try_end_56} :catch_39b
    .catchall {:try_start_3d .. :try_end_56} :catchall_3da

    .line 2674
    monitor-exit p0

    return-object v12

    .line 2677
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_58
    :try_start_58
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v1, "ADD_ALL_PACKAGES"

    invoke-virtual {v0, v11, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v0

    move-object v15, v0

    .line 2678
    .local v15, "addAllPackageName":Ljava/lang/String;
    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v0

    invoke-interface {v0}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v0

    move-object/from16 v16, v0

    .line 2679
    .local v16, "it":Ljava/util/Iterator;, "Ljava/util/Iterator<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;>;"
    new-instance v0, Ljava/util/ArrayList;

    invoke-direct {v0}, Ljava/util/ArrayList;-><init>()V

    move-object v7, v0

    .line 2680
    .local v7, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    new-instance v0, Ljava/util/ArrayList;

    invoke-direct {v0}, Ljava/util/ArrayList;-><init>()V

    move-object v6, v0

    .line 2681
    .local v6, "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :goto_77
    invoke-interface/range {v16 .. v16}, Ljava/util/Iterator;->hasNext()Z

    move-result v0

    const/4 v5, 0x0

    if-eqz v0, :cond_188

    .line 2682
    invoke-interface/range {v16 .. v16}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 2683
    .local v0, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getCid()I

    move-result v1

    if-ne v1, v11, :cond_183

    .line 2684
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v1

    .line 2685
    .local v1, "tPackageName":Ljava/lang/String;
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v2

    .line 2686
    .local v2, "rPackageName":Ljava/lang/String;
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v3

    .line 2687
    .local v3, "uid":I
    invoke-virtual {v1, v15}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v4

    if-eqz v4, :cond_12e

    .line 2689
    invoke-direct {v8, v10, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeAddAllPackageInfofromDatabase(Ljava/lang/String;I)I

    .line 2691
    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v4

    if-nez v4, :cond_b9

    .line 2692
    iget-object v4, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v13

    invoke-virtual {v4, v5, v13, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRangeRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;I)V

    .line 2693
    invoke-interface/range {v16 .. v16}, Ljava/util/Iterator;->remove()V

    .line 2694
    const/4 v13, 0x1

    goto :goto_77

    .line 2697
    :cond_b9
    if-nez v11, :cond_ed

    .line 2698
    invoke-direct {v8, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->blockIncomingICMPPackets(Z)V

    .line 2699
    sget-object v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->AID_EXEMPT_LIST:[Ljava/lang/Integer;

    array-length v5, v4

    const/4 v13, 0x0

    :goto_c2
    if-ge v13, v5, :cond_e8

    aget-object v18, v4, v13

    invoke-virtual/range {v18 .. v18}, Ljava/lang/Integer;->intValue()I

    move-result v18

    move/from16 v20, v18

    .line 2700
    .local v20, "aidUid":I
    move-object/from16 v21, v0

    .end local v0    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .local v21, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    move-object/from16 v22, v2

    .end local v2    # "rPackageName":Ljava/lang/String;
    .local v22, "rPackageName":Ljava/lang/String;
    const/4 v2, 0x3

    move-object/from16 v23, v4

    move/from16 v4, v20

    .end local v20    # "aidUid":I
    .local v4, "aidUid":I
    invoke-virtual {v0, v4, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    .line 2701
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v0, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForUid(I)V

    .line 2699
    .end local v4    # "aidUid":I
    add-int/lit8 v13, v13, 0x1

    move-object/from16 v0, v21

    move-object/from16 v2, v22

    move-object/from16 v4, v23

    goto :goto_c2

    .end local v21    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v22    # "rPackageName":Ljava/lang/String;
    .restart local v0    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .restart local v2    # "rPackageName":Ljava/lang/String;
    :cond_e8
    move-object/from16 v21, v0

    move-object/from16 v22, v2

    .end local v0    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v2    # "rPackageName":Ljava/lang/String;
    .restart local v21    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .restart local v22    # "rPackageName":Ljava/lang/String;
    goto :goto_f1

    .line 2697
    .end local v21    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v22    # "rPackageName":Ljava/lang/String;
    .restart local v0    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .restart local v2    # "rPackageName":Ljava/lang/String;
    :cond_ed
    move-object/from16 v21, v0

    move-object/from16 v22, v2

    .line 2705
    .end local v0    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v2    # "rPackageName":Ljava/lang/String;
    .restart local v21    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .restart local v22    # "rPackageName":Ljava/lang/String;
    :goto_f1
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v2

    invoke-direct {v8, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v4

    invoke-virtual {v0, v11, v2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeMiscRulesRange(ILjava/lang/String;I)V

    .line 2706
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v0, v2, v4, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRangeRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;I)V

    .line 2708
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->startUid(I)I

    move-result v0

    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->stopUid(I)I

    move-result v2

    invoke-direct {v8, v10, v0, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->unsetDnsSystemProperty(Ljava/lang/String;II)V

    .line 2710
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v0

    const/4 v2, 0x1

    invoke-virtual {v0, v11, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateProxyList(IZ)Ljava/util/HashMap;

    move-result-object v0

    const/4 v2, 0x2

    invoke-direct {v8, v2, v10, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 2712
    invoke-interface/range {v16 .. v16}, Ljava/util/Iterator;->remove()V

    .line 2716
    invoke-direct {v8, v10, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeContainerFromExceptionList(Ljava/lang/String;I)V

    goto :goto_185

    .line 2719
    .end local v21    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v22    # "rPackageName":Ljava/lang/String;
    .restart local v0    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .restart local v2    # "rPackageName":Ljava/lang/String;
    :cond_12e
    move-object/from16 v21, v0

    move-object/from16 v22, v2

    .end local v0    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v2    # "rPackageName":Ljava/lang/String;
    .restart local v21    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .restart local v22    # "rPackageName":Ljava/lang/String;
    invoke-direct {v8, v10, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackagesFromDatabase(Ljava/lang/String;Ljava/lang/String;)Z

    move-result v0

    .line 2720
    .local v0, "result":Z
    const-string v2, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "removeAllPackage is called, removing per-app packets from db "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v2, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2721
    if-nez v0, :cond_152

    .line 2722
    const/4 v13, 0x1

    goto/16 :goto_77

    .line 2724
    :cond_152
    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-interface {v6, v2}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 2726
    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v2

    if-nez v2, :cond_165

    .line 2727
    invoke-interface/range {v16 .. v16}, Ljava/util/Iterator;->remove()V

    .line 2728
    const/4 v13, 0x1

    goto/16 :goto_77

    .line 2731
    :cond_165
    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-interface {v7, v2}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 2733
    invoke-direct {v8, v10, v3, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->unsetDnsSystemProperty(Ljava/lang/String;II)V

    .line 2735
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v2

    const/4 v5, 0x0

    invoke-virtual {v2, v3, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateProxyList(IZ)Ljava/util/HashMap;

    move-result-object v2

    const/4 v4, 0x2

    invoke-direct {v8, v4, v10, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 2737
    invoke-interface/range {v16 .. v16}, Ljava/util/Iterator;->remove()V

    .line 2740
    invoke-direct {v8, v10, v11, v3, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeUIDListFromExceptionList(Ljava/lang/String;IILjava/lang/String;)V

    goto :goto_185

    .line 2683
    .end local v1    # "tPackageName":Ljava/lang/String;
    .end local v3    # "uid":I
    .end local v21    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v22    # "rPackageName":Ljava/lang/String;
    .local v0, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :cond_183
    move-object/from16 v21, v0

    .line 2744
    .end local v0    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :goto_185
    const/4 v13, 0x1

    goto/16 :goto_77

    .line 2746
    :cond_188
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0, v10, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->removePackagesFromPermissionDb(Ljava/lang/String;I)V

    .line 2748
    invoke-interface {v7}, Ljava/util/List;->isEmpty()Z

    move-result v0

    if-nez v0, :cond_1a0

    .line 2749
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v1

    invoke-direct {v8, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v2

    invoke-virtual {v0, v7, v1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeMiscRules(Ljava/util/List;Ljava/lang/String;I)V

    .line 2752
    :cond_1a0
    invoke-interface {v6}, Ljava/util/List;->isEmpty()Z

    move-result v0

    if-nez v0, :cond_1b3

    .line 2753
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v1

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v0, v1, v2, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;Ljava/util/List;)V

    .line 2756
    :cond_1b3
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdForExemptedUids()Ljava/util/HashSet;

    move-result-object v0

    move-object v13, v0

    .line 2757
    .local v13, "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    invoke-virtual {v13}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_1be
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_1de

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Ljava/lang/Integer;

    invoke-virtual {v1}, Ljava/lang/Integer;->intValue()I

    move-result v1

    .line 2758
    .local v1, "exemptedUserId":I
    if-ne v1, v11, :cond_1dd

    .line 2759
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v3, "com.android.providers.downloads"

    invoke-virtual {v2, v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v2

    .line 2760
    .local v2, "downloadMangerUid":I
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForDownloadManagerUid(I)V

    .line 2762
    .end local v1    # "exemptedUserId":I
    .end local v2    # "downloadMangerUid":I
    :cond_1dd
    goto :goto_1be

    .line 2764
    :cond_1de
    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v0

    move-object/from16 v18, v0

    .line 2765
    .local v18, "uidList_1":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    invoke-virtual/range {v18 .. v18}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v0

    move-object/from16 v19, v0

    .line 2766
    .local v19, "it1":Ljava/util/Iterator;, "Ljava/util/Iterator<Ljava/lang/Integer;>;"
    :goto_1ea
    invoke-interface/range {v19 .. v19}, Ljava/util/Iterator;->hasNext()Z

    move-result v0

    if-eqz v0, :cond_278

    .line 2767
    invoke-interface/range {v19 .. v19}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Ljava/lang/Integer;

    invoke-virtual {v0}, Ljava/lang/Integer;->intValue()I

    move-result v0

    .line 2768
    .local v0, "uid1":I
    invoke-static {v0}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v1

    if-ne v1, v11, :cond_26d

    .line 2769
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1, v10, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->removeExemptedListToDatabase(Ljava/lang/String;I)Z

    move-result v1

    move v4, v1

    .line 2770
    .local v4, "result":Z
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "removeAllPackages: removing from exempeted list "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2771
    if-eqz v4, :cond_266

    .line 2772
    invoke-interface/range {v19 .. v19}, Ljava/util/Iterator;->remove()V

    .line 2773
    const/4 v2, 0x0

    const/4 v3, 0x1

    const/16 v20, 0x0

    const/16 v21, 0x0

    const/16 v22, 0x0

    move-object/from16 v1, p0

    move/from16 v23, v4

    .end local v4    # "result":Z
    .local v23, "result":Z
    move v4, v0

    move/from16 v5, v20

    move-object/from16 v20, v6

    .end local v6    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v20, "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    move-object/from16 v6, v21

    move-object/from16 v21, v7

    .end local v7    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v21, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    move-object/from16 v7, v22

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 2774
    const/4 v2, 0x0

    const/4 v3, 0x2

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v5

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v7

    move-object/from16 v1, p0

    move v4, v0

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 2775
    const/4 v2, 0x0

    const/4 v3, 0x3

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v5

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v7

    move-object/from16 v1, p0

    move v4, v0

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    goto :goto_271

    .line 2771
    .end local v20    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v21    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v23    # "result":Z
    .restart local v4    # "result":Z
    .restart local v6    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v7    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :cond_266
    move/from16 v23, v4

    move-object/from16 v20, v6

    move-object/from16 v21, v7

    .end local v4    # "result":Z
    .end local v6    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v7    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v20    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v21    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v23    # "result":Z
    goto :goto_271

    .line 2768
    .end local v20    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v21    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v23    # "result":Z
    .restart local v6    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v7    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :cond_26d
    move-object/from16 v20, v6

    move-object/from16 v21, v7

    .line 2778
    .end local v0    # "uid1":I
    .end local v6    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v7    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v20    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v21    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :goto_271
    move-object/from16 v6, v20

    move-object/from16 v7, v21

    const/4 v5, 0x0

    goto/16 :goto_1ea

    .line 2780
    .end local v20    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v21    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v6    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v7    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :cond_278
    move-object/from16 v20, v6

    move-object/from16 v21, v7

    .end local v6    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v7    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v20    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v21    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0, v11, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUninsalledAppsFromExemptedList(ILjava/lang/String;)Ljava/util/HashSet;

    move-result-object v0

    move-object v1, v0

    .line 2781
    .local v1, "getNotinsalledAppsFromExemptedList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/String;>;"
    invoke-virtual {v1}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v0

    move-object v2, v0

    .line 2782
    .local v2, "it2":Ljava/util/Iterator;, "Ljava/util/Iterator<Ljava/lang/String;>;"
    :goto_288
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v0

    if-eqz v0, :cond_29b

    .line 2783
    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Ljava/lang/String;

    .line 2784
    .local v0, "tPackageName":Ljava/lang/String;
    iget-object v3, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v10, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->removeExemptedListToDatabase(Ljava/lang/String;Ljava/lang/String;)Z

    .line 2785
    nop

    .end local v0    # "tPackageName":Ljava/lang/String;
    goto :goto_288

    .line 2787
    :cond_29b
    invoke-virtual {v8, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v0

    move-object v3, v0

    .line 2788
    .local v3, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v3, :cond_2b4

    .line 2789
    const/16 v0, 0x6e

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2790
    const-string v0, "KnoxVpnEngineService"

    const-string v4, "Error while removing all the packages from vpn: The error code is110"

    invoke-static {v0, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_2b2
    .catch Ljava/lang/Exception; {:try_start_58 .. :try_end_2b2} :catch_39b
    .catchall {:try_start_58 .. :try_end_2b2} :catchall_3da

    .line 2791
    monitor-exit p0

    return-object v12

    .line 2793
    :cond_2b4
    :try_start_2b4
    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageCount()I

    move-result v0

    move v4, v0

    .line 2794
    .local v4, "size":I
    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVpnConnectionType()I

    move-result v0

    move v5, v0

    .line 2795
    .local v5, "vpnConnectionType":I
    if-gtz v4, :cond_35c

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v0

    const/4 v6, 0x1

    if-ne v0, v6, :cond_35c

    .line 2796
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v0, :cond_2e2

    const-string v0, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "removeAllPackages: The profile is going to be stopped since no packages are present "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v0, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_2e2
    .catch Ljava/lang/Exception; {:try_start_2b4 .. :try_end_2e2} :catch_39b
    .catchall {:try_start_2b4 .. :try_end_2e2} :catchall_3da

    .line 2798
    :cond_2e2
    :try_start_2e2
    invoke-interface {v3, v10}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->stopConnection(Ljava/lang/String;)I

    move-result v0

    .line 2799
    .local v0, "stopStatus":I
    if-eqz v0, :cond_30d

    .line 2800
    const/16 v25, 0x3

    const/16 v26, 0x5

    const/16 v27, 0x0

    .line 2801
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v28

    const-string v29, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "Error occurred trying to stop vpn connection from profile "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v30

    iget v6, v9, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2800
    move/from16 v31, v6

    invoke-static/range {v25 .. v31}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    goto :goto_331

    .line 2805
    :cond_30d
    const/16 v31, 0x5

    const/16 v32, 0x5

    const/16 v33, 0x1

    .line 2806
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v34

    const-string v35, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "Connection with vpn vendor service stopped for profile "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v36

    iget v6, v9, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2805
    move/from16 v37, v6

    invoke-static/range {v31 .. v37}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_331
    .catch Ljava/lang/Exception; {:try_start_2e2 .. :try_end_331} :catch_332
    .catchall {:try_start_2e2 .. :try_end_331} :catchall_3da

    .line 2815
    .end local v0    # "stopStatus":I
    :goto_331
    goto :goto_35c

    .line 2810
    :catch_332
    move-exception v0

    .line 2811
    .local v0, "e":Ljava/lang/Exception;
    const/16 v25, 0x3

    const/16 v26, 0x5

    const/16 v27, 0x0

    .line 2812
    :try_start_339
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v28

    const-string v29, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "Exception stopping connection for profile "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v7, " after removing all packages"

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v30

    iget v6, v9, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2811
    move/from16 v31, v6

    invoke-static/range {v25 .. v31}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 2819
    .end local v0    # "e":Ljava/lang/Exception;
    :cond_35c
    :goto_35c
    invoke-direct {v8, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->refreshDomainInHashMap(Ljava/lang/String;)V

    .line 2820
    const/4 v6, 0x0

    invoke-direct {v8, v10, v11, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateNotification(Ljava/lang/String;IZ)V

    .line 2822
    const-string v0, "KnoxVpnEngineService"

    const-string/jumbo v7, "removeAllPackages success: The error code is 0"

    invoke-static {v0, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2823
    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2824
    invoke-virtual {v12, v6, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 2826
    const/16 v22, 0x5

    const/16 v23, 0x5

    const/16 v24, 0x1

    .line 2827
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v25

    const-string v26, "KnoxVpnEngineService"

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "success while removing all packages from vpn for profile "

    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v27

    iget v0, v9, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2826
    move/from16 v28, v0

    invoke-static/range {v22 .. v28}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_39a
    .catch Ljava/lang/Exception; {:try_start_339 .. :try_end_39a} :catch_39b
    .catchall {:try_start_339 .. :try_end_39a} :catchall_3da

    .line 2837
    .end local v1    # "getNotinsalledAppsFromExemptedList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/String;>;"
    .end local v2    # "it2":Ljava/util/Iterator;, "Ljava/util/Iterator<Ljava/lang/String;>;"
    .end local v3    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v4    # "size":I
    .end local v5    # "vpnConnectionType":I
    .end local v13    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v14    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v15    # "addAllPackageName":Ljava/lang/String;
    .end local v16    # "it":Ljava/util/Iterator;, "Ljava/util/Iterator<Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;>;"
    .end local v18    # "uidList_1":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v19    # "it1":Ljava/util/Iterator;, "Ljava/util/Iterator<Ljava/lang/Integer;>;"
    .end local v20    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v21    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    goto :goto_3d8

    .line 2831
    :catch_39b
    move-exception v0

    .line 2832
    .restart local v0    # "e":Ljava/lang/Exception;
    :try_start_39c
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "removeAllPackages failed: exception occured: The error code is -1"

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2833
    const/4 v13, 0x3

    const/4 v14, 0x5

    const/4 v15, 0x0

    .line 2834
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v16

    const-string v17, "KnoxVpnEngineService"

    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string v2, "Exception while removing all packages from vpn for profile "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v18

    iget v1, v9, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2833
    move/from16 v19, v1

    invoke-static/range {v13 .. v19}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_3d8
    .catchall {:try_start_39c .. :try_end_3d8} :catchall_3da

    .line 2839
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_3d8
    monitor-exit p0

    return-object v12

    .line 2662
    .end local v11    # "cid":I
    .end local v12    # "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    :catchall_3da
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method private removeAllUidByTAG(Ljava/lang/String;)V
    .registers 8
    .param p1, "profileName"    # Ljava/lang/String;

    .line 8089
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v0

    .line 8091
    .local v0, "blockToken":J
    :try_start_4
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-static {v2}, Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;->getInstance(Landroid/content/Context;)Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;

    move-result-object v2

    .line 8092
    .local v2, "mEntProvider":Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;
    if-eqz v2, :cond_f

    .line 8093
    invoke-virtual {v2, p1}, Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;->removeAllUidByTAG(Ljava/lang/String;)Z
    :try_end_f
    .catch Ljava/lang/Exception; {:try_start_4 .. :try_end_f} :catch_15
    .catchall {:try_start_4 .. :try_end_f} :catchall_13

    .line 8098
    .end local v2    # "mEntProvider":Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;
    :cond_f
    :goto_f
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 8099
    goto :goto_35

    .line 8098
    :catchall_13
    move-exception v2

    goto :goto_36

    .line 8095
    :catch_15
    move-exception v2

    .line 8096
    .local v2, "e":Ljava/lang/Exception;
    :try_start_16
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_f

    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception at removeAllUidByTAG API "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_34
    .catchall {:try_start_16 .. :try_end_34} :catchall_13

    goto :goto_f

    .line 8100
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_35
    return-void

    .line 8098
    :goto_36
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 8099
    throw v2
.end method

.method private removeContainerFromExceptionList(Ljava/lang/String;I)V
    .registers 9
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "containerId"    # I

    .line 8074
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v0

    .line 8076
    .local v0, "blockToken":J
    :try_start_4
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-static {v2}, Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;->getInstance(Landroid/content/Context;)Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;

    move-result-object v2

    .line 8077
    .local v2, "mEntProvider":Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;
    if-eqz v2, :cond_f

    .line 8078
    invoke-virtual {v2, p1, p2}, Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;->removeContainerFromExceptionList(Ljava/lang/String;I)I
    :try_end_f
    .catch Ljava/lang/Exception; {:try_start_4 .. :try_end_f} :catch_15
    .catchall {:try_start_4 .. :try_end_f} :catchall_13

    .line 8083
    .end local v2    # "mEntProvider":Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;
    :cond_f
    :goto_f
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 8084
    goto :goto_35

    .line 8083
    :catchall_13
    move-exception v2

    goto :goto_36

    .line 8080
    :catch_15
    move-exception v2

    .line 8081
    .local v2, "e":Ljava/lang/Exception;
    :try_start_16
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_f

    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception at removeContainerFromExceptionList API "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_34
    .catchall {:try_start_16 .. :try_end_34} :catchall_13

    goto :goto_f

    .line 8085
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_35
    return-void

    .line 8083
    :goto_36
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 8084
    throw v2
.end method

.method private removeExemptRulesForUid(ILjava/lang/String;)V
    .registers 6
    .param p1, "vendorUid"    # I
    .param p2, "profileName"    # Ljava/lang/String;

    .line 6508
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v1, "removeExemptRulesForUid : vendor = "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v1, " for profile "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    const-string v1, "KnoxVpnEngineService"

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6509
    invoke-virtual {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getChainingEnabledForProfile(I)I

    move-result v0

    const/4 v2, 0x1

    if-eq v0, v2, :cond_4e

    .line 6510
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "removeExemptRulesForUid : vendorUid = "

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6511
    invoke-static {p1}, Landroid/os/UserHandle;->getAppId(I)I

    move-result v0

    const/16 v1, 0x3e8

    if-ne v0, v1, :cond_49

    .line 6512
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForStrongswan(I)V

    goto :goto_4e

    .line 6514
    :cond_49
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForUid(I)V

    .line 6517
    :cond_4e
    :goto_4e
    return-void
.end method

.method private removeExemptedUidDetailsAfterUninstall(Ljava/lang/String;Ljava/lang/String;I)V
    .registers 27
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "tPackageName"    # Ljava/lang/String;
    .param p3, "uid"    # I

    .line 4741
    move-object/from16 v8, p0

    move-object/from16 v9, p1

    move/from16 v10, p3

    const-string v11, "KnoxVpnEngineService"

    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v12

    .line 4742
    .local v12, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v12, :cond_11

    .line 4743
    return-void

    .line 4745
    :cond_11
    invoke-static/range {p3 .. p3}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v13

    .line 4747
    .local v13, "cid":I
    :try_start_15
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v0}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;

    move-result-object v0

    invoke-virtual {v0, v10}, Landroid/content/pm/PackageManager;->getPackagesForUid(I)[Ljava/lang/String;

    move-result-object v0
    :try_end_1f
    .catch Ljava/lang/Exception; {:try_start_15 .. :try_end_1f} :catch_1c8

    move-object v14, v0

    .line 4748
    .local v14, "packageList":[Ljava/lang/String;
    const-string v15, " from exempted list after uninstallation for profile "

    const-string v0, "Success removing uid = "

    const-string/jumbo v7, "removeExemptedUidDetailsAfterUninstall: removing from exempeted list "

    if-nez v14, :cond_f5

    .line 4749
    :try_start_29
    invoke-virtual {v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v1

    move-object/from16 v16, v1

    .line 4750
    .local v16, "uidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    invoke-virtual/range {v16 .. v16}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v1

    move-object/from16 v17, v1

    .line 4751
    .local v17, "it":Ljava/util/Iterator;, "Ljava/util/Iterator<Ljava/lang/Integer;>;"
    :goto_35
    invoke-interface/range {v17 .. v17}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_f1

    .line 4752
    invoke-interface/range {v17 .. v17}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Ljava/lang/Integer;

    invoke-virtual {v1}, Ljava/lang/Integer;->intValue()I

    move-result v1

    move v6, v1

    .line 4753
    .local v6, "exemptUid":I
    if-ne v6, v10, :cond_e4

    .line 4754
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const/4 v2, -0x1

    move-object/from16 v5, p2

    invoke-virtual {v1, v9, v5, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateExemptedListToDatabase(Ljava/lang/String;Ljava/lang/String;I)Z

    move-result v1

    move v4, v1

    .line 4755
    .local v4, "result":Z
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v1, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, v4}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v11, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4756
    if-eqz v4, :cond_db

    .line 4757
    const/4 v2, 0x0

    const/4 v3, 0x1

    const/16 v18, 0x0

    const/16 v19, 0x0

    const/16 v20, 0x0

    move-object/from16 v1, p0

    move/from16 v21, v4

    .end local v4    # "result":Z
    .local v21, "result":Z
    move v4, v6

    move/from16 v5, v18

    move/from16 v18, v6

    .end local v6    # "exemptUid":I
    .local v18, "exemptUid":I
    move-object/from16 v6, v19

    move-object/from16 v19, v14

    move-object v14, v7

    .end local v14    # "packageList":[Ljava/lang/String;
    .local v19, "packageList":[Ljava/lang/String;
    move-object/from16 v7, v20

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 4758
    const/4 v2, 0x0

    const/4 v3, 0x2

    invoke-virtual {v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v5

    invoke-virtual {v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v7

    move-object/from16 v1, p0

    move/from16 v4, v18

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 4759
    const/4 v2, 0x0

    const/4 v3, 0x3

    invoke-virtual {v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v5

    invoke-virtual {v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v7

    move-object/from16 v1, p0

    move/from16 v4, v18

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 4760
    invoke-interface/range {v17 .. v17}, Ljava/util/Iterator;->remove()V

    .line 4761
    const/4 v1, 0x5

    const/4 v2, 0x5

    const/4 v3, 0x1

    .line 4762
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v4

    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v6, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move/from16 v7, v18

    .end local v18    # "exemptUid":I
    .local v7, "exemptUid":I
    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    .line 4761
    move-object/from16 v22, v0

    move v0, v1

    move v1, v2

    move v2, v3

    move v3, v4

    move-object v4, v5

    move-object v5, v6

    move v6, v13

    invoke-static/range {v0 .. v6}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    goto :goto_ea

    .line 4756
    .end local v7    # "exemptUid":I
    .end local v19    # "packageList":[Ljava/lang/String;
    .end local v21    # "result":Z
    .restart local v4    # "result":Z
    .restart local v6    # "exemptUid":I
    .restart local v14    # "packageList":[Ljava/lang/String;
    :cond_db
    move-object/from16 v22, v0

    move/from16 v21, v4

    move-object/from16 v19, v14

    move-object v14, v7

    move v7, v6

    .end local v4    # "result":Z
    .end local v6    # "exemptUid":I
    .end local v14    # "packageList":[Ljava/lang/String;
    .restart local v7    # "exemptUid":I
    .restart local v19    # "packageList":[Ljava/lang/String;
    .restart local v21    # "result":Z
    goto :goto_ea

    .line 4753
    .end local v7    # "exemptUid":I
    .end local v19    # "packageList":[Ljava/lang/String;
    .end local v21    # "result":Z
    .restart local v6    # "exemptUid":I
    .restart local v14    # "packageList":[Ljava/lang/String;
    :cond_e4
    move-object/from16 v22, v0

    move-object/from16 v19, v14

    move-object v14, v7

    move v7, v6

    .line 4767
    .end local v6    # "exemptUid":I
    .end local v14    # "packageList":[Ljava/lang/String;
    .restart local v19    # "packageList":[Ljava/lang/String;
    :goto_ea
    move-object v7, v14

    move-object/from16 v14, v19

    move-object/from16 v0, v22

    goto/16 :goto_35

    .line 4751
    .end local v19    # "packageList":[Ljava/lang/String;
    .restart local v14    # "packageList":[Ljava/lang/String;
    :cond_f1
    move-object/from16 v19, v14

    .line 4768
    .end local v14    # "packageList":[Ljava/lang/String;
    .end local v16    # "uidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v17    # "it":Ljava/util/Iterator;, "Ljava/util/Iterator<Ljava/lang/Integer;>;"
    .restart local v19    # "packageList":[Ljava/lang/String;
    goto/16 :goto_1aa

    .line 4769
    .end local v19    # "packageList":[Ljava/lang/String;
    .restart local v14    # "packageList":[Ljava/lang/String;
    :cond_f5
    move-object/from16 v22, v0

    move-object/from16 v19, v14

    move-object v14, v7

    .end local v14    # "packageList":[Ljava/lang/String;
    .restart local v19    # "packageList":[Ljava/lang/String;
    invoke-virtual {v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v0

    move-object/from16 v16, v0

    .line 4770
    .restart local v16    # "uidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    invoke-virtual/range {v16 .. v16}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v0

    move-object/from16 v17, v0

    .line 4771
    .restart local v17    # "it":Ljava/util/Iterator;, "Ljava/util/Iterator<Ljava/lang/Integer;>;"
    :goto_106
    invoke-interface/range {v17 .. v17}, Ljava/util/Iterator;->hasNext()Z

    move-result v0

    if-eqz v0, :cond_1aa

    .line 4772
    invoke-interface/range {v17 .. v17}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Ljava/lang/Integer;

    invoke-virtual {v0}, Ljava/lang/Integer;->intValue()I

    move-result v0

    .line 4773
    .local v0, "exemptUid":I
    if-ne v0, v10, :cond_1a2

    .line 4774
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1, v9, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->removeExemptedListToDatabase(Ljava/lang/String;I)Z

    move-result v1

    move v7, v1

    .line 4775
    .local v7, "result":Z
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v1, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, v7}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v11, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4776
    if-eqz v7, :cond_19b

    .line 4777
    const/4 v2, 0x0

    const/4 v3, 0x1

    const/4 v5, 0x0

    const/4 v6, 0x0

    const/16 v18, 0x0

    move-object/from16 v1, p0

    move v4, v0

    move/from16 v20, v7

    .end local v7    # "result":Z
    .local v20, "result":Z
    move-object/from16 v7, v18

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 4778
    const/4 v2, 0x0

    const/4 v3, 0x2

    invoke-virtual {v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v5

    invoke-virtual {v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v7

    move-object/from16 v1, p0

    move v4, v0

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 4779
    const/4 v2, 0x0

    const/4 v3, 0x3

    invoke-virtual {v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v5

    invoke-virtual {v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v7

    move-object/from16 v1, p0

    move v4, v0

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 4780
    invoke-interface/range {v17 .. v17}, Ljava/util/Iterator;->remove()V

    .line 4781
    const/4 v1, 0x5

    const/4 v2, 0x5

    const/4 v3, 0x1

    .line 4782
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v4

    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    move-object/from16 v7, v22

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    .line 4781
    move/from16 v18, v0

    .end local v0    # "exemptUid":I
    .restart local v18    # "exemptUid":I
    move v0, v1

    move v1, v2

    move v2, v3

    move v3, v4

    move-object v4, v5

    move-object v5, v6

    move v6, v13

    invoke-static/range {v0 .. v6}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    goto :goto_1a6

    .line 4776
    .end local v18    # "exemptUid":I
    .end local v20    # "result":Z
    .restart local v0    # "exemptUid":I
    .restart local v7    # "result":Z
    :cond_19b
    move/from16 v18, v0

    move/from16 v20, v7

    move-object/from16 v7, v22

    .end local v0    # "exemptUid":I
    .end local v7    # "result":Z
    .restart local v18    # "exemptUid":I
    .restart local v20    # "result":Z
    goto :goto_1a6

    .line 4773
    .end local v18    # "exemptUid":I
    .end local v20    # "result":Z
    .restart local v0    # "exemptUid":I
    :cond_1a2
    move/from16 v18, v0

    move-object/from16 v7, v22

    .line 4787
    .end local v0    # "exemptUid":I
    :goto_1a6
    move-object/from16 v22, v7

    goto/16 :goto_106

    .line 4789
    .end local v16    # "uidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v17    # "it":Ljava/util/Iterator;, "Ljava/util/Iterator<Ljava/lang/Integer;>;"
    :cond_1aa
    :goto_1aa
    iget-object v0, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdForExemptedUids()Ljava/util/HashSet;

    move-result-object v0

    .line 4790
    .local v0, "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    invoke-static {v13}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v1

    invoke-virtual {v0, v1}, Ljava/util/HashSet;->contains(Ljava/lang/Object;)Z

    move-result v1

    if-nez v1, :cond_1c7

    .line 4791
    iget-object v1, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v2, "com.android.providers.downloads"

    invoke-virtual {v1, v13, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v1

    .line 4792
    .local v1, "downloadMangerUid":I
    iget-object v2, v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v2, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForDownloadManagerUid(I)V
    :try_end_1c7
    .catch Ljava/lang/Exception; {:try_start_29 .. :try_end_1c7} :catch_1c8

    .line 4800
    .end local v0    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v1    # "downloadMangerUid":I
    .end local v19    # "packageList":[Ljava/lang/String;
    :cond_1c7
    goto :goto_201

    .line 4794
    :catch_1c8
    move-exception v0

    move-object v7, v0

    .line 4795
    .local v7, "e":Ljava/lang/Exception;
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v1, "removePackagesAfterUninstall exception "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v7}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v1

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v11, v0}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 4796
    const/4 v0, 0x3

    const/4 v1, 0x5

    const/4 v2, 0x0

    .line 4797
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v3

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception while removing packages exempted from vpn after uninstallation for profile "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    .line 4796
    const-string v4, "KnoxVpnEngineService"

    move v6, v13

    invoke-static/range {v0 .. v6}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 4801
    .end local v7    # "e":Ljava/lang/Exception;
    :goto_201
    return-void
.end method

.method private removeFromHashMapByProfileName(Ljava/lang/String;)V
    .registers 20
    .param p1, "profileName"    # Ljava/lang/String;

    .line 4470
    move-object/from16 v12, p0

    move-object/from16 v13, p1

    const-string v14, "KnoxVpnEngineService"

    const-string/jumbo v0, "profile info is going to be removed from the device"

    invoke-static {v14, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4471
    const/4 v15, -0x1

    .local v15, "uid":I
    const/16 v16, -0x1

    .line 4472
    .local v16, "cid":I
    const/4 v1, 0x0

    .line 4473
    .local v1, "vendorName":Ljava/lang/String;
    iget-object v0, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v17

    .line 4474
    .local v17, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v17, :cond_1e

    .line 4475
    const-string v0, "Error occured while removing hashmap by profile: The error code is 108"

    invoke-static {v14, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4476
    return-void

    .line 4479
    :cond_1e
    :try_start_1e
    iget-object v0, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->containsProfileEntry(Ljava/lang/String;)Z

    move-result v0

    if-eqz v0, :cond_264

    .line 4480
    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v0
    :try_end_2a
    .catch Ljava/lang/Exception; {:try_start_1e .. :try_end_2a} :catch_265

    move-object v11, v0

    .line 4482
    .end local v1    # "vendorName":Ljava/lang/String;
    .local v11, "vendorName":Ljava/lang/String;
    :try_start_2b
    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyServer()Ljava/lang/String;

    move-result-object v0

    sget-object v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->DEFAULT_PROXY_SERVER:Ljava/lang/String;
    :try_end_31
    .catch Ljava/lang/Exception; {:try_start_2b .. :try_end_31} :catch_260

    const/16 v10, 0x3ea

    const/4 v9, 0x0

    if-ne v0, v1, :cond_43

    :try_start_36
    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPacurl()Landroid/net/Uri;

    move-result-object v0

    sget-object v1, Landroid/net/Uri;->EMPTY:Landroid/net/Uri;
    :try_end_3c
    .catch Ljava/lang/Exception; {:try_start_36 .. :try_end_3c} :catch_3f

    if-eq v0, v1, :cond_6a

    goto :goto_43

    .line 4580
    :catch_3f
    move-exception v0

    move-object v1, v11

    goto/16 :goto_266

    .line 4483
    :cond_43
    :goto_43
    :try_start_43
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnPacProcessor()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v0

    invoke-virtual {v0, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->stopPacSupport(Ljava/lang/String;)V

    .line 4484
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v0

    invoke-virtual {v0, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getListOfUid(Ljava/lang/String;)Ljava/util/HashMap;

    move-result-object v0

    invoke-direct {v12, v9, v13, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 4486
    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v0

    invoke-static {v0, v10}, Landroid/os/UserHandle;->getUid(II)I

    move-result v0

    .line 4487
    .local v0, "systemUid":I
    iget-object v1, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v2

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v1, v2, v3, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesToAcceptProxyPackets(ILjava/lang/String;I)V

    .line 4490
    .end local v0    # "systemUid":I
    :cond_6a
    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeMiscRulesForProfile(Ljava/lang/String;)V

    .line 4492
    iget-object v0, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v1

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v2

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v0, v1, v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesForNoUidPackets(Ljava/lang/String;ILjava/lang/String;)V

    .line 4494
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v0

    invoke-virtual {v0, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->checkIfVpnProfileTableIsEmpty(Ljava/lang/String;)Z

    move-result v0
    :try_end_86
    .catch Ljava/lang/Exception; {:try_start_43 .. :try_end_86} :catch_260

    const/4 v8, 0x3

    if-eqz v0, :cond_b4

    .line 4495
    :try_start_89
    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v0

    invoke-direct {v12, v0, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeExemptRulesForUid(ILjava/lang/String;)V

    .line 4497
    iget-object v0, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isNativeVpnClient(Ljava/lang/String;)Z

    move-result v0

    if-eqz v0, :cond_a0

    .line 4498
    iget-object v0, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    const/16 v1, 0x3f8

    invoke-virtual {v0, v1, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    goto :goto_a9

    .line 4500
    :cond_a0
    iget-object v0, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v1

    invoke-virtual {v0, v1, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    .line 4503
    :goto_a9
    iget-object v0, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v0

    .line 4504
    .local v0, "originalPackageName":Ljava/lang/String;
    iget-object v1, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1, v13, v0, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveAppsFromBatteryOptimization(Ljava/lang/String;Ljava/lang/String;Z)V
    :try_end_b4
    .catch Ljava/lang/Exception; {:try_start_89 .. :try_end_b4} :catch_3f

    .line 4506
    .end local v0    # "originalPackageName":Ljava/lang/String;
    :cond_b4
    :try_start_b4
    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v0

    invoke-virtual {v0}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_bc
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_108

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Ljava/lang/Integer;

    invoke-virtual {v1}, Ljava/lang/Integer;->intValue()I

    move-result v4

    .line 4507
    .local v4, "exemptUid":I
    const/4 v2, 0x0

    const/4 v3, 0x1

    const/4 v5, 0x0

    const/4 v6, 0x0

    const/4 v7, 0x0

    move-object/from16 v1, p0

    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 4508
    const/4 v6, 0x0

    const/4 v7, 0x2

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v1

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v2

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v3
    :try_end_e4
    .catch Ljava/lang/Exception; {:try_start_b4 .. :try_end_e4} :catch_260

    move-object/from16 v5, p0

    move v8, v4

    move v9, v1

    move v1, v10

    move-object v10, v2

    move-object v2, v11

    .end local v11    # "vendorName":Ljava/lang/String;
    .local v2, "vendorName":Ljava/lang/String;
    move-object v11, v3

    :try_start_ec
    invoke-direct/range {v5 .. v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 4509
    const/4 v6, 0x0

    const/4 v7, 0x3

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v9

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v10

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v11

    move-object/from16 v5, p0

    move v8, v4

    invoke-direct/range {v5 .. v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 4510
    .end local v4    # "exemptUid":I
    move v10, v1

    move-object v11, v2

    const/4 v8, 0x3

    const/4 v9, 0x0

    goto :goto_bc

    .line 4512
    .end local v2    # "vendorName":Ljava/lang/String;
    .restart local v11    # "vendorName":Ljava/lang/String;
    :cond_108
    move v1, v10

    move-object v2, v11

    .end local v11    # "vendorName":Ljava/lang/String;
    .restart local v2    # "vendorName":Ljava/lang/String;
    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v0

    .line 4513
    .local v0, "ipChainName":Ljava/lang/String;
    iget-object v3, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v3, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpChainForProfile(Ljava/lang/String;)V

    .line 4515
    iget-object v3, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v4

    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v5

    invoke-virtual {v3, v4, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeNatRules(Ljava/lang/String;I)V

    .line 4517
    iget-object v6, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    const/4 v7, 0x1

    .line 4518
    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v8

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceAddress()Ljava/lang/String;

    move-result-object v9

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v10

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getV6InterfaceAddress()Ljava/lang/String;

    move-result-object v11

    .line 4517
    invoke-virtual/range {v6 .. v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->updateDropRulesForNoUidPackets(ILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V

    .line 4520
    iget-object v3, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v4

    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v5

    invoke-virtual {v3, v4, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRouteAndPolicyRules(Ljava/lang/String;I)V

    .line 4521
    iget-object v3, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v4

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v3, v4, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesToAcceptIncomingPackets(ILjava/lang/String;)V

    .line 4524
    new-instance v3, Landroid/os/Bundle;

    invoke-direct {v3}, Landroid/os/Bundle;-><init>()V

    .line 4525
    .local v3, "map":Landroid/os/Bundle;
    const-string/jumbo v4, "profileName"

    invoke-virtual {v3, v4, v13}, Landroid/os/Bundle;->putString(Ljava/lang/String;Ljava/lang/String;)V

    .line 4526
    const/16 v4, 0x10

    invoke-direct {v12, v4, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->sendMessageToHandler(ILandroid/os/Bundle;)V

    .line 4528
    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeProcessKillNotification(Ljava/lang/String;)V

    .line 4529
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationMap:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v4, v13}, Ljava/util/concurrent/ConcurrentHashMap;->remove(Ljava/lang/Object;)Ljava/lang/Object;

    .line 4531
    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbTethering()I

    move-result v4

    const/4 v5, 0x1

    if-ne v4, v5, :cond_188

    .line 4532
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v6

    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v4, v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesForUsbTethering(ILjava/lang/String;)V

    .line 4533
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const/4 v6, 0x0

    invoke-virtual {v4, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->registerNetdTetherEventListener(Z)V

    .line 4534
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->enableKnoxVpnFlagForTether(Z)V

    goto :goto_189

    .line 4531
    :cond_188
    const/4 v6, 0x0

    .line 4536
    :goto_189
    invoke-virtual/range {v17 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbtetherAuth()I

    move-result v4

    if-ne v4, v5, :cond_1a3

    .line 4538
    const-string v4, "KnoxVpnTetherAuthentication"

    const-string/jumbo v7, "unbind usb auth service after profile removal or user removal"

    invoke-static {v4, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4539
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v7, "com.samsung.knox.vpn.tether.auth"

    invoke-virtual {v4, v13, v7, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveAppsFromBatteryOptimization(Ljava/lang/String;Ljava/lang/String;Z)V

    .line 4540
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    invoke-virtual {v4, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->unbindTetherAuthService(Z)V

    .line 4543
    :cond_1a3
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v4, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->removeProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 4545
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v4

    invoke-interface {v4}, Ljava/util/Collection;->isEmpty()Z

    move-result v4

    if-eqz v4, :cond_25b

    .line 4546
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    const/4 v5, 0x5

    invoke-virtual {v4, v6, v6, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->applyBlockingRulesForDns(III)V

    .line 4547
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpBlockingRule()V

    .line 4548
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    sget-object v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->BLOCK_APP_TRAFFIC:Ljava/lang/String;

    sget-object v7, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->BLOCK_APP_TRAFFIC:Ljava/lang/String;

    const/4 v8, 0x3

    invoke-virtual {v4, v5, v8, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesForNoUidPackets(Ljava/lang/String;ILjava/lang/String;)V

    .line 4549
    const-string/jumbo v4, "net.vpn.framework"

    const-string v5, "0.0"

    invoke-static {v4, v5}, Landroid/os/SystemProperties;->set(Ljava/lang/String;Ljava/lang/String;)V

    .line 4550
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getListOfActiveUsers()Ljava/util/HashSet;

    move-result-object v4

    invoke-virtual {v4}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v4

    :goto_1db
    invoke-interface {v4}, Ljava/util/Iterator;->hasNext()Z

    move-result v5

    if-eqz v5, :cond_1f3

    invoke-interface {v4}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Ljava/lang/Integer;

    invoke-virtual {v5}, Ljava/lang/Integer;->intValue()I

    move-result v5

    .line 4551
    .local v5, "user":I
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnPacProcessor()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v7

    invoke-virtual {v7, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->unBindPacService(I)V

    .line 4552
    .end local v5    # "user":I
    goto :goto_1db

    .line 4553
    :cond_1f3
    invoke-virtual/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->denyAppsToMakeDnsQueryForNetId()V

    .line 4554
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v5, "com.knox.vpn.proxyhandler"

    invoke-virtual {v4, v13, v5, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveSystemAppFromBatteryOptimization(Ljava/lang/String;Ljava/lang/String;Z)V

    .line 4556
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v5, "com.android.vpndialogs"

    invoke-virtual {v4, v13, v5, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveAppsFromBatteryOptimization(Ljava/lang/String;Ljava/lang/String;Z)V

    .line 4558
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getListOfActiveUsers()Ljava/util/HashSet;

    move-result-object v4

    invoke-virtual {v4}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v4

    :goto_20e
    invoke-interface {v4}, Ljava/util/Iterator;->hasNext()Z

    move-result v5

    if-eqz v5, :cond_228

    invoke-interface {v4}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Ljava/lang/Integer;

    invoke-virtual {v5}, Ljava/lang/Integer;->intValue()I

    move-result v5

    .line 4559
    .local v5, "userId":I
    iget-object v7, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-static {v5, v1}, Landroid/os/UserHandle;->getUid(II)I

    move-result v9

    invoke-virtual {v7, v13, v9, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveSystemAppFromDataSaverWhitelist(Ljava/lang/String;IZ)V

    .line 4560
    .end local v5    # "userId":I
    goto :goto_20e

    .line 4562
    :cond_228
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->unregisterFilterList()V

    .line 4567
    iget-object v1, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v4, "com.android.providers.downloads"

    invoke-virtual {v1, v6, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v1

    .line 4568
    .local v1, "downloadMangerUid":I
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForDownloadManagerUid(I)V

    .line 4570
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mProcessManager:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;->unregisterProcessObserver()V

    .line 4572
    sget-object v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->AID_EXEMPT_LIST:[Ljava/lang/Integer;

    array-length v5, v4

    move v9, v6

    :goto_241
    if-ge v9, v5, :cond_256

    aget-object v7, v4, v9

    invoke-virtual {v7}, Ljava/lang/Integer;->intValue()I

    move-result v7

    .line 4573
    .local v7, "aidUid":I
    iget-object v10, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v10, v7, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    .line 4574
    iget-object v10, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v10, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForUid(I)V

    .line 4572
    .end local v7    # "aidUid":I
    add-int/lit8 v9, v9, 0x1

    goto :goto_241

    .line 4577
    :cond_256
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->clearEbpfMap(I)V
    :try_end_25b
    .catch Ljava/lang/Exception; {:try_start_ec .. :try_end_25b} :catch_25d

    .line 4582
    .end local v0    # "ipChainName":Ljava/lang/String;
    .end local v1    # "downloadMangerUid":I
    .end local v3    # "map":Landroid/os/Bundle;
    :cond_25b
    move-object v1, v2

    goto :goto_264

    .line 4580
    :catch_25d
    move-exception v0

    move-object v1, v2

    goto :goto_266

    .end local v2    # "vendorName":Ljava/lang/String;
    .restart local v11    # "vendorName":Ljava/lang/String;
    :catch_260
    move-exception v0

    move-object v2, v11

    move-object v1, v2

    .end local v11    # "vendorName":Ljava/lang/String;
    .restart local v2    # "vendorName":Ljava/lang/String;
    goto :goto_266

    .line 4582
    .end local v2    # "vendorName":Ljava/lang/String;
    .local v1, "vendorName":Ljava/lang/String;
    :cond_264
    :goto_264
    goto :goto_282

    .line 4580
    :catch_265
    move-exception v0

    .line 4581
    .local v0, "e":Ljava/lang/Exception;
    :goto_266
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_282

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception occured while removing the profile info from the device"

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v14, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4583
    .end local v0    # "e":Ljava/lang/Exception;
    :cond_282
    :goto_282
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v0, :cond_289

    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->printProfileVpnMap()V

    .line 4584
    :cond_289
    return-void
.end method

.method private removeMiscRulesForProfile(Ljava/lang/String;)V
    .registers 11
    .param p1, "profileName"    # Ljava/lang/String;

    .line 7142
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v1, "removeMiscRulesForProfile : profileName =  "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    const-string v1, "KnoxVpnEngineService"

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7143
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0

    .line 7144
    .local v0, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    const/4 v1, -0x1

    .local v1, "uid":I
    const/4 v2, -0x1

    .line 7145
    .local v2, "cid":I
    new-instance v3, Ljava/util/ArrayList;

    invoke-direct {v3}, Ljava/util/ArrayList;-><init>()V

    .line 7147
    .local v3, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    if-eqz v0, :cond_83

    .line 7148
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v4

    .line 7149
    .local v4, "interfaceName":Ljava/lang/String;
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v5

    invoke-interface {v5}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v5

    :goto_32
    invoke-interface {v5}, Ljava/util/Iterator;->hasNext()Z

    move-result v6

    if-eqz v6, :cond_70

    invoke-interface {v5}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 7150
    .local v6, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v7

    if-eqz v7, :cond_5d

    .line 7151
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v8

    invoke-virtual {v7, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v2

    .line 7153
    invoke-direct {p0, p1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeContainerFromExceptionList(Ljava/lang/String;I)V

    .line 7155
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v8

    invoke-virtual {v7, v2, v4, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeMiscRulesRange(ILjava/lang/String;I)V

    goto :goto_6f

    .line 7157
    :cond_5d
    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v1

    .line 7158
    invoke-static {v1}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-interface {v3, v7}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 7160
    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v7

    invoke-direct {p0, p1, v2, v1, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeUIDListFromExceptionList(Ljava/lang/String;IILjava/lang/String;)V

    .line 7163
    .end local v6    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :goto_6f
    goto :goto_32

    .line 7164
    :cond_70
    invoke-interface {v3}, Ljava/util/List;->isEmpty()Z

    move-result v5

    if-nez v5, :cond_83

    .line 7165
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v7

    invoke-virtual {v5, v3, v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeMiscRules(Ljava/util/List;Ljava/lang/String;I)V

    .line 7168
    .end local v4    # "interfaceName":Ljava/lang/String;
    :cond_83
    return-void
.end method

.method private removePackageListByUid(Ljava/lang/String;Ljava/lang/String;I)V
    .registers 32
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "rPackageName"    # Ljava/lang/String;
    .param p3, "uid"    # I

    .line 4590
    move-object/from16 v1, p0

    move-object/from16 v2, p1

    move/from16 v3, p3

    const-string v4, "KnoxVpnEngineService"

    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v5

    .line 4591
    .local v5, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v5, :cond_11

    .line 4592
    return-void

    .line 4594
    :cond_11
    invoke-static/range {p3 .. p3}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v13

    .line 4595
    .local v13, "cid":I
    new-instance v0, Ljava/util/ArrayList;

    invoke-direct {v0}, Ljava/util/ArrayList;-><init>()V

    move-object v14, v0

    .line 4596
    .local v14, "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v15

    .line 4598
    .local v15, "ipChainName":Ljava/lang/String;
    :try_start_1f
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v0}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;

    move-result-object v0

    invoke-virtual {v0, v3}, Landroid/content/pm/PackageManager;->getPackagesForUid(I)[Ljava/lang/String;

    move-result-object v0
    :try_end_29
    .catch Ljava/lang/Exception; {:try_start_1f .. :try_end_29} :catch_2c8

    move-object v12, v0

    .line 4599
    .local v12, "packageList":[Ljava/lang/String;
    const/4 v0, 0x2

    const-string v11, " removed from vpn for profile "

    const/4 v10, 0x0

    if-nez v12, :cond_dc

    .line 4601
    :try_start_30
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-object/from16 v9, p2

    invoke-virtual {v6, v13, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v6

    move-object v8, v6

    .line 4603
    .local v8, "tPackageName":Ljava/lang/String;
    invoke-virtual {v5, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackage(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    move-result-object v6

    move-object/from16 v16, v6

    .line 4604
    .local v16, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    if-nez v16, :cond_42

    .line 4605
    return-void

    .line 4607
    :cond_42
    invoke-direct {v1, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->deleteUIDFromPackageData(Ljava/lang/String;)Z

    move-result v6

    move/from16 v17, v6

    .line 4608
    .local v17, "result":Z
    if-nez v17, :cond_4b

    .line 4609
    return-void

    .line 4612
    :cond_4b
    invoke-static/range {p3 .. p3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v6

    invoke-interface {v14, v6}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 4614
    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v6

    if-nez v6, :cond_82

    .line 4615
    invoke-virtual {v5, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->removePackageEntry(Ljava/lang/String;)V

    .line 4616
    const/4 v6, 0x5

    const/4 v7, 0x5

    .line 4617
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v10

    const-string v18, "KnoxVpnEngineService"

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v0, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11
    :try_end_75
    .catch Ljava/lang/Exception; {:try_start_30 .. :try_end_75} :catch_2c8

    .line 4616
    move-object v0, v8

    const/4 v8, 0x1

    .end local v8    # "tPackageName":Ljava/lang/String;
    .local v0, "tPackageName":Ljava/lang/String;
    move v9, v10

    move-object/from16 v10, v18

    move-object/from16 v18, v4

    move-object v4, v12

    .end local v12    # "packageList":[Ljava/lang/String;
    .local v4, "packageList":[Ljava/lang/String;
    move v12, v13

    :try_start_7e
    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 4620
    return-void

    .line 4623
    .end local v0    # "tPackageName":Ljava/lang/String;
    .end local v4    # "packageList":[Ljava/lang/String;
    .restart local v8    # "tPackageName":Ljava/lang/String;
    .restart local v12    # "packageList":[Ljava/lang/String;
    :cond_82
    move-object/from16 v18, v4

    move-object v4, v12

    move-object v12, v8

    .end local v8    # "tPackageName":Ljava/lang/String;
    .restart local v4    # "packageList":[Ljava/lang/String;
    .local v12, "tPackageName":Ljava/lang/String;
    new-instance v6, Ljava/util/ArrayList;

    invoke-direct {v6}, Ljava/util/ArrayList;-><init>()V

    move-object v9, v6

    .line 4624
    .local v9, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    invoke-static/range {p3 .. p3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v6

    invoke-interface {v9, v6}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 4625
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v7

    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v8

    invoke-virtual {v6, v9, v7, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeMiscRules(Ljava/util/List;Ljava/lang/String;I)V

    .line 4626
    invoke-direct {v1, v2, v3, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->unsetDnsSystemProperty(Ljava/lang/String;II)V

    .line 4628
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v6

    invoke-virtual {v6, v3, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateProxyList(IZ)Ljava/util/HashMap;

    move-result-object v6

    invoke-direct {v1, v0, v2, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 4630
    invoke-virtual {v5, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->removePackageEntry(Ljava/lang/String;)V

    .line 4632
    const/4 v6, 0x5

    const/4 v7, 0x5

    const/4 v8, 0x1

    .line 4633
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v0

    const-string v19, "KnoxVpnEngineService"

    new-instance v10, Ljava/lang/StringBuilder;

    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v10, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    .line 4632
    move-object/from16 v21, v9

    .end local v9    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v21, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    move v9, v0

    const/4 v0, 0x0

    move-object/from16 v10, v19

    move-object v0, v12

    .end local v12    # "tPackageName":Ljava/lang/String;
    .restart local v0    # "tPackageName":Ljava/lang/String;
    move v12, v13

    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 4639
    invoke-direct {v1, v2, v13, v3, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeUIDListFromExceptionList(Ljava/lang/String;IILjava/lang/String;)V

    .line 4641
    .end local v0    # "tPackageName":Ljava/lang/String;
    .end local v16    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v17    # "result":Z
    .end local v21    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    goto/16 :goto_1cb

    .line 4642
    .end local v4    # "packageList":[Ljava/lang/String;
    .local v12, "packageList":[Ljava/lang/String;
    :cond_dc
    move-object/from16 v18, v4

    move-object v4, v12

    move v12, v10

    .end local v12    # "packageList":[Ljava/lang/String;
    .restart local v4    # "packageList":[Ljava/lang/String;
    array-length v10, v4

    move v9, v12

    :goto_e2
    if-ge v9, v10, :cond_1cb

    aget-object v6, v4, v9

    move-object v8, v6

    .line 4643
    .local v8, "packageName":Ljava/lang/String;
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v6, v13, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v6

    move-object v7, v6

    .line 4645
    .local v7, "tPackageName":Ljava/lang/String;
    invoke-virtual {v5, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackage(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    move-result-object v6

    move-object/from16 v16, v6

    .line 4646
    .restart local v16    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    if-nez v16, :cond_ff

    .line 4647
    move/from16 v22, v0

    move/from16 v20, v9

    move/from16 v21, v10

    move-object v0, v11

    goto/16 :goto_1c1

    .line 4649
    :cond_ff
    invoke-direct {v1, v2, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackagesFromDatabase(Ljava/lang/String;Ljava/lang/String;)Z

    move-result v6

    move/from16 v17, v6

    .line 4650
    .restart local v17    # "result":Z
    if-nez v17, :cond_110

    .line 4651
    move/from16 v22, v0

    move/from16 v20, v9

    move/from16 v21, v10

    move-object v0, v11

    goto/16 :goto_1c1

    .line 4654
    :cond_110
    invoke-static/range {p3 .. p3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v6

    invoke-interface {v14, v6}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 4656
    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v6

    if-nez v6, :cond_15a

    .line 4657
    invoke-virtual {v5, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->removePackageEntry(Ljava/lang/String;)V

    .line 4658
    const/4 v6, 0x5

    const/16 v19, 0x5

    const/16 v20, 0x1

    .line 4659
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v21

    const-string v22, "KnoxVpnEngineService"

    new-instance v12, Ljava/lang/StringBuilder;

    invoke-direct {v12}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v12, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v12, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v12, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v12}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v12

    .line 4658
    move-object/from16 v24, v7

    .end local v7    # "tPackageName":Ljava/lang/String;
    .local v24, "tPackageName":Ljava/lang/String;
    move/from16 v7, v19

    move-object/from16 v19, v8

    .end local v8    # "packageName":Ljava/lang/String;
    .local v19, "packageName":Ljava/lang/String;
    move/from16 v8, v20

    move/from16 v20, v9

    move/from16 v9, v21

    move/from16 v21, v10

    move-object/from16 v10, v22

    move-object/from16 v25, v11

    move-object v11, v12

    const/4 v0, 0x0

    move v12, v13

    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 4662
    move-object/from16 v0, v25

    const/16 v22, 0x2

    goto :goto_1c1

    .line 4665
    .end local v19    # "packageName":Ljava/lang/String;
    .end local v24    # "tPackageName":Ljava/lang/String;
    .restart local v7    # "tPackageName":Ljava/lang/String;
    .restart local v8    # "packageName":Ljava/lang/String;
    :cond_15a
    move-object/from16 v24, v7

    move-object/from16 v19, v8

    move/from16 v20, v9

    move/from16 v21, v10

    move-object/from16 v25, v11

    move v0, v12

    .end local v7    # "tPackageName":Ljava/lang/String;
    .end local v8    # "packageName":Ljava/lang/String;
    .restart local v19    # "packageName":Ljava/lang/String;
    .restart local v24    # "tPackageName":Ljava/lang/String;
    new-instance v6, Ljava/util/ArrayList;

    invoke-direct {v6}, Ljava/util/ArrayList;-><init>()V

    move-object v12, v6

    .line 4666
    .local v12, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    invoke-static/range {p3 .. p3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v6

    invoke-interface {v12, v6}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 4667
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v7

    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v8

    invoke-virtual {v6, v12, v7, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeMiscRules(Ljava/util/List;Ljava/lang/String;I)V

    .line 4668
    invoke-direct {v1, v2, v3, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->unsetDnsSystemProperty(Ljava/lang/String;II)V

    .line 4670
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v6

    invoke-virtual {v6, v3, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateProxyList(IZ)Ljava/util/HashMap;

    move-result-object v6

    const/4 v11, 0x2

    invoke-direct {v1, v11, v2, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 4672
    move-object/from16 v10, v24

    .end local v24    # "tPackageName":Ljava/lang/String;
    .local v10, "tPackageName":Ljava/lang/String;
    invoke-virtual {v5, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->removePackageEntry(Ljava/lang/String;)V

    .line 4674
    const/4 v6, 0x5

    const/4 v7, 0x5

    const/4 v8, 0x1

    .line 4675
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v9

    const-string v22, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v11, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-object/from16 v0, v25

    invoke-virtual {v11, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    .line 4674
    move-object/from16 v26, v10

    .end local v10    # "tPackageName":Ljava/lang/String;
    .local v26, "tPackageName":Ljava/lang/String;
    move-object/from16 v10, v22

    const/16 v22, 0x2

    move-object/from16 v23, v12

    .end local v12    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v23, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    move v12, v13

    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 4681
    move-object/from16 v6, v26

    .end local v26    # "tPackageName":Ljava/lang/String;
    .local v6, "tPackageName":Ljava/lang/String;
    invoke-direct {v1, v2, v13, v3, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeUIDListFromExceptionList(Ljava/lang/String;IILjava/lang/String;)V

    .line 4642
    .end local v6    # "tPackageName":Ljava/lang/String;
    .end local v16    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v17    # "result":Z
    .end local v19    # "packageName":Ljava/lang/String;
    .end local v23    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :goto_1c1
    add-int/lit8 v9, v20, 0x1

    move-object v11, v0

    move/from16 v10, v21

    move/from16 v0, v22

    const/4 v12, 0x0

    goto/16 :goto_e2

    .line 4685
    :cond_1cb
    :goto_1cb
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v0, v6, v15, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;Ljava/util/List;)V

    .line 4687
    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->refreshDomainInHashMap(Ljava/lang/String;)V

    .line 4689
    const/4 v0, 0x0

    invoke-direct {v1, v2, v13, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateNotification(Ljava/lang/String;IZ)V

    .line 4691
    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageCount()I

    move-result v0

    move/from16 v16, v0

    .line 4692
    .local v16, "size":I
    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVpnConnectionType()I

    move-result v0

    move v12, v0

    .line 4694
    .local v12, "vpnConnectionType":I
    const/4 v0, 0x0

    .line 4695
    .local v0, "onDemand":Z
    const/4 v6, 0x1

    if-ne v12, v6, :cond_1f6

    .line 4696
    iget-object v7, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mProcessManager:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;

    invoke-virtual {v7, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;->processRunCheck(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;)Z

    move-result v7

    .line 4697
    .local v7, "isRunning":Z
    if-nez v7, :cond_1f6

    .line 4698
    const/4 v0, 0x1

    move/from16 v17, v0

    goto :goto_1f8

    .line 4702
    .end local v7    # "isRunning":Z
    :cond_1f6
    move/from16 v17, v0

    .end local v0    # "onDemand":Z
    .local v17, "onDemand":Z
    :goto_1f8
    if-lez v16, :cond_1fc

    if-eqz v17, :cond_2c3

    :cond_1fc
    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v0
    :try_end_200
    .catch Ljava/lang/Exception; {:try_start_7e .. :try_end_200} :catch_2c4

    if-ne v0, v6, :cond_2c1

    .line 4704
    :try_start_202
    invoke-virtual/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v0

    .line 4705
    .local v0, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-eqz v0, :cond_276

    .line 4706
    invoke-interface {v0, v2}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->stopConnection(Ljava/lang/String;)I

    move-result v6

    move v11, v6

    .line 4707
    .local v11, "stopStatus":I
    if-eqz v11, :cond_234

    .line 4708
    const/4 v6, 0x3

    .line 4709
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v9

    const-string v10, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "Error occurred trying to stop vpn connection from profile "

    invoke-virtual {v8, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v21
    :try_end_227
    .catch Ljava/lang/Exception; {:try_start_202 .. :try_end_227} :catch_279

    .line 4708
    const/4 v7, 0x5

    const/4 v8, 0x0

    move/from16 v27, v11

    .end local v11    # "stopStatus":I
    .local v27, "stopStatus":I
    move-object/from16 v11, v21

    move/from16 v19, v12

    .end local v12    # "vpnConnectionType":I
    .local v19, "vpnConnectionType":I
    move v12, v13

    :try_start_230
    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    goto :goto_256

    .line 4713
    .end local v19    # "vpnConnectionType":I
    .end local v27    # "stopStatus":I
    .restart local v11    # "stopStatus":I
    .restart local v12    # "vpnConnectionType":I
    :cond_234
    move/from16 v27, v11

    move/from16 v19, v12

    .end local v11    # "stopStatus":I
    .end local v12    # "vpnConnectionType":I
    .restart local v19    # "vpnConnectionType":I
    .restart local v27    # "stopStatus":I
    const/4 v6, 0x5

    const/4 v7, 0x5

    const/4 v8, 0x1

    .line 4714
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v9

    const-string v10, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string v12, "Connection with vpn vendor service stopped for profile "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    .line 4713
    move v12, v13

    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 4718
    :goto_256
    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "removePackagesAfterUninstall: stopping the vpn connection status for on-demand configuration after removing all the packages "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move/from16 v7, v27

    .end local v27    # "stopStatus":I
    .local v7, "stopStatus":I
    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6
    :try_end_26a
    .catch Ljava/lang/Exception; {:try_start_230 .. :try_end_26a} :catch_272

    move-object/from16 v12, v18

    :try_start_26c
    invoke-static {v12, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_26f
    .catch Ljava/lang/Exception; {:try_start_26c .. :try_end_26f} :catch_270

    goto :goto_278

    .line 4721
    .end local v0    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v7    # "stopStatus":I
    :catch_270
    move-exception v0

    goto :goto_27e

    :catch_272
    move-exception v0

    move-object/from16 v12, v18

    goto :goto_27e

    .line 4705
    .end local v19    # "vpnConnectionType":I
    .restart local v0    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .restart local v12    # "vpnConnectionType":I
    :cond_276
    move/from16 v19, v12

    .line 4727
    .end local v0    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v12    # "vpnConnectionType":I
    .restart local v19    # "vpnConnectionType":I
    :goto_278
    goto :goto_2c3

    .line 4721
    .end local v19    # "vpnConnectionType":I
    .restart local v12    # "vpnConnectionType":I
    :catch_279
    move-exception v0

    move/from16 v19, v12

    move-object/from16 v12, v18

    .line 4722
    .end local v12    # "vpnConnectionType":I
    .local v0, "e":Ljava/lang/Exception;
    .restart local v19    # "vpnConnectionType":I
    :goto_27e
    const/4 v6, 0x3

    const/4 v7, 0x5

    .line 4723
    :try_start_280
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v9

    const-string v10, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string v8, "Exception stopping connection for profile "

    invoke-virtual {v11, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v8, " after removing package list by uid"

    invoke-virtual {v11, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11
    :try_end_29c
    .catch Ljava/lang/Exception; {:try_start_280 .. :try_end_29c} :catch_2be

    .line 4722
    const/4 v8, 0x0

    move-object v1, v12

    move v12, v13

    :try_start_29f
    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 4726
    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "removePackagesAfterUninstall: stopping the vpn connection failed for on-demand configuration after removing all the packages "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v1, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_2bb
    .catch Ljava/lang/Exception; {:try_start_29f .. :try_end_2bb} :catch_2bc

    goto :goto_2c3

    .line 4729
    .end local v0    # "e":Ljava/lang/Exception;
    .end local v4    # "packageList":[Ljava/lang/String;
    .end local v16    # "size":I
    .end local v17    # "onDemand":Z
    .end local v19    # "vpnConnectionType":I
    :catch_2bc
    move-exception v0

    goto :goto_2ca

    :catch_2be
    move-exception v0

    move-object v1, v12

    goto :goto_2ca

    .line 4702
    .restart local v4    # "packageList":[Ljava/lang/String;
    .restart local v12    # "vpnConnectionType":I
    .restart local v16    # "size":I
    .restart local v17    # "onDemand":Z
    :cond_2c1
    move/from16 v19, v12

    .line 4735
    .end local v4    # "packageList":[Ljava/lang/String;
    .end local v12    # "vpnConnectionType":I
    .end local v16    # "size":I
    .end local v17    # "onDemand":Z
    :cond_2c3
    :goto_2c3
    goto :goto_301

    .line 4729
    :catch_2c4
    move-exception v0

    move-object/from16 v1, v18

    goto :goto_2ca

    :catch_2c8
    move-exception v0

    move-object v1, v4

    .line 4730
    .restart local v0    # "e":Ljava/lang/Exception;
    :goto_2ca
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "removePackagesAfterUninstall exception "

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v1, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 4731
    const/4 v6, 0x3

    const/4 v7, 0x5

    const/4 v8, 0x0

    .line 4732
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v9

    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Exception while removing packages from vpn after uninstallation for profile "

    invoke-virtual {v1, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    .line 4731
    const-string v10, "KnoxVpnEngineService"

    move v12, v13

    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 4736
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_301
    return-void
.end method

.method private removePackagesFromDatabase(Ljava/lang/String;Ljava/lang/String;)Z
    .registers 9
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "tPackageName"    # Ljava/lang/String;

    .line 2135
    const/4 v0, 0x0

    .line 2137
    .local v0, "result":Z
    :try_start_1
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v2, "VpnPackageInfo"

    const-string/jumbo v3, "packageName"

    const-string/jumbo v4, "profileName"

    filled-new-array {v3, v4}, [Ljava/lang/String;

    move-result-object v3

    const/4 v4, 0x2

    new-array v4, v4, [Ljava/lang/String;

    const/4 v5, 0x0

    aput-object p2, v4, v5

    const/4 v5, 0x1

    aput-object p1, v4, v5

    invoke-virtual {v1, v2, v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->deleteDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Z

    move-result v1
    :try_end_1c
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_1c} :catch_1e

    move v0, v1

    .line 2142
    goto :goto_39

    .line 2140
    :catch_1e
    move-exception v1

    .line 2141
    .local v1, "e":Ljava/lang/Exception;
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception at removePackagesFromDatabase API "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v1}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    const-string v3, "KnoxVpnEngineService"

    invoke-static {v3, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 2143
    .end local v1    # "e":Ljava/lang/Exception;
    :goto_39
    return v0
.end method

.method private removePackagesFromPermissionCheckDb(I)V
    .registers 8
    .param p1, "uid"    # I

    .line 2026
    :try_start_0
    invoke-static {p1}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;

    move-result-object v0

    .line 2027
    .local v0, "uid_string":Ljava/lang/String;
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string/jumbo v2, "vpnNoInternetPermission"

    const-string/jumbo v3, "packageUid"

    filled-new-array {v3}, [Ljava/lang/String;

    move-result-object v3

    const/4 v4, 0x1

    new-array v4, v4, [Ljava/lang/String;

    const/4 v5, 0x0

    aput-object v0, v4, v5

    invoke-virtual {v1, v2, v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->deleteDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Z
    :try_end_19
    .catch Ljava/lang/Exception; {:try_start_0 .. :try_end_19} :catch_1a

    .line 2033
    .end local v0    # "uid_string":Ljava/lang/String;
    goto :goto_35

    .line 2031
    :catch_1a
    move-exception v0

    .line 2032
    .local v0, "e":Ljava/lang/Exception;
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string v2, "Exception at removePackagestoPermissionCheckDb API "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    const-string v2, "KnoxVpnEngineService"

    invoke-static {v2, v1}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 2034
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_35
    return-void
.end method

.method private removeProcessKillNotification(Ljava/lang/String;)V
    .registers 10
    .param p1, "profileName"    # Ljava/lang/String;

    .line 8631
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v0

    .line 8633
    .local v0, "clearToken":J
    :try_start_4
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 8634
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v2, :cond_25

    .line 8635
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v3

    invoke-static {v3}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v3

    .line 8636
    .local v3, "removeNotificationAtUser":I
    invoke-virtual {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getNotificationManager()Landroid/app/NotificationManager;

    move-result-object v4

    const/4 v5, 0x0

    invoke-virtual {p1}, Ljava/lang/String;->hashCode()I

    move-result v6

    new-instance v7, Landroid/os/UserHandle;

    invoke-direct {v7, v3}, Landroid/os/UserHandle;-><init>(I)V

    invoke-virtual {v4, v5, v6, v7}, Landroid/app/NotificationManager;->cancelAsUser(Ljava/lang/String;ILandroid/os/UserHandle;)V
    :try_end_25
    .catch Ljava/lang/Exception; {:try_start_4 .. :try_end_25} :catch_2b
    .catchall {:try_start_4 .. :try_end_25} :catchall_29

    .line 8641
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "removeNotificationAtUser":I
    :cond_25
    :goto_25
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 8642
    goto :goto_4b

    .line 8641
    :catchall_29
    move-exception v2

    goto :goto_4c

    .line 8638
    :catch_2b
    move-exception v2

    .line 8639
    .local v2, "e":Ljava/lang/Exception;
    :try_start_2c
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_25

    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception occured while trying to remove a notification which informed user about process restart "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_4a
    .catchall {:try_start_2c .. :try_end_4a} :catchall_29

    goto :goto_25

    .line 8643
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_4b
    return-void

    .line 8641
    :goto_4c
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 8642
    throw v2
.end method

.method private removeProfileFromHashMapAndDB(Ljava/lang/String;)V
    .registers 8
    .param p1, "profileName"    # Ljava/lang/String;

    .line 4941
    const-string v0, "KnoxVpnEngineService"

    const-string/jumbo v1, "removeProfileFromHashMapAndDB : removeProfileFromHashMapAndDB beginning"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4945
    :try_start_8
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeAllUidByTAG(Ljava/lang/String;)V

    .line 4947
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v2, "VpnProfileInfo"

    const-string/jumbo v3, "profileName"

    filled-new-array {v3}, [Ljava/lang/String;

    move-result-object v3

    const/4 v4, 0x1

    new-array v4, v4, [Ljava/lang/String;

    const/4 v5, 0x0

    aput-object p1, v4, v5

    invoke-virtual {v1, v2, v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->deleteDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Z

    move-result v1

    .line 4949
    .local v1, "success":Z
    if-eqz v1, :cond_25

    .line 4950
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeFromHashMapByProfileName(Ljava/lang/String;)V

    .line 4952
    :cond_25
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "remove vpn connection for per app : success : "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v1}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_3a
    .catch Ljava/lang/Exception; {:try_start_8 .. :try_end_3a} :catch_3c

    .line 4955
    nop

    .end local v1    # "success":Z
    goto :goto_56

    .line 4953
    :catch_3c
    move-exception v1

    .line 4954
    .local v1, "e":Ljava/lang/Exception;
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "remove vpn connection for perapp : Error in handling remove connection for per app vpn Feature"

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v1}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 4956
    .end local v1    # "e":Ljava/lang/Exception;
    :goto_56
    return-void
.end method

.method private removeProfileFromKeyStore(Ljava/lang/String;ILjava/lang/String;)V
    .registers 13
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "uid"    # I
    .param p3, "tPackageName"    # Ljava/lang/String;

    .line 8124
    const-string v0, "KnoxVpnEngineService"

    invoke-static {p2}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v1

    .line 8125
    .local v1, "userId":I
    invoke-static {p2}, Landroid/os/UserHandle;->getAppId(I)I

    move-result v2

    .line 8126
    .local v2, "appId":I
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v3

    .line 8128
    .local v3, "originalPackageName":Ljava/lang/String;
    const/16 v4, 0x3e8

    if-ne v2, v4, :cond_79

    .line 8129
    :try_start_14
    const-string v4, "com.samsung.sVpn"

    invoke-virtual {v3, v4}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v4

    if-eqz v4, :cond_79

    .line 8130
    if-nez v1, :cond_79

    .line 8131
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->retrieveVpnListFromStorage()Ljava/util/ArrayList;

    move-result-object v4

    .line 8132
    .local v4, "profileList":Ljava/util/List;, "Ljava/util/List<Lcom/android/internal/net/VpnProfile;>;"
    invoke-interface {v4}, Ljava/util/List;->iterator()Ljava/util/Iterator;

    move-result-object v5

    :goto_26
    invoke-interface {v5}, Ljava/util/Iterator;->hasNext()Z

    move-result v6

    if-eqz v6, :cond_79

    invoke-interface {v5}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Lcom/android/internal/net/VpnProfile;

    .line 8133
    .local v6, "profileInfo":Lcom/android/internal/net/VpnProfile;
    iget-object v7, v6, Lcom/android/internal/net/VpnProfile;->name:Ljava/lang/String;

    invoke-virtual {v7, p1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v7

    if-eqz v7, :cond_5e

    .line 8134
    sget-boolean v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v5, :cond_43

    const-string v5, "The profileInfo present in the keystore belongs to knox, so going to delete it"

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8135
    :cond_43
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKeyStore()Landroid/security/KeyStore;

    move-result-object v5

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string v8, "VPN_"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v8, v6, Lcom/android/internal/net/VpnProfile;->key:Ljava/lang/String;

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v5, v7, p2}, Landroid/security/KeyStore;->delete(Ljava/lang/String;I)Z
    :try_end_5d
    .catch Ljava/lang/Exception; {:try_start_14 .. :try_end_5d} :catch_5f

    .line 8136
    goto :goto_79

    .line 8138
    .end local v6    # "profileInfo":Lcom/android/internal/net/VpnProfile;
    :cond_5e
    goto :goto_26

    .line 8142
    .end local v4    # "profileList":Ljava/util/List;, "Ljava/util/List<Lcom/android/internal/net/VpnProfile;>;"
    :catch_5f
    move-exception v4

    .line 8143
    .local v4, "e":Ljava/lang/Exception;
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception occured at removeProfileFromKeyStore API "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v4}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v0, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_7a

    .line 8144
    .end local v4    # "e":Ljava/lang/Exception;
    :cond_79
    :goto_79
    nop

    .line 8145
    :goto_7a
    return-void
.end method

.method private removeUIDListFromExceptionList(Ljava/lang/String;IILjava/lang/String;)V
    .registers 11
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "cid"    # I
    .param p3, "uid"    # I
    .param p4, "packageName"    # Ljava/lang/String;

    .line 8052
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v0

    .line 8054
    .local v0, "blockToken":J
    const/4 v2, -0x2

    if-ne p3, v2, :cond_b

    .line 8055
    :try_start_7
    invoke-direct {p0, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeContainerFromExceptionList(Ljava/lang/String;I)V

    goto :goto_24

    .line 8057
    :cond_b
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-static {v2}, Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;->getInstance(Landroid/content/Context;)Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;

    move-result-object v2

    .line 8058
    .local v2, "mEntProvider":Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;
    if-eqz v2, :cond_24

    if-eqz p4, :cond_24

    .line 8059
    new-instance v3, Ljava/util/HashMap;

    invoke-direct {v3}, Ljava/util/HashMap;-><init>()V

    .line 8060
    .local v3, "packageUidMappings":Ljava/util/Map;, "Ljava/util/Map<Ljava/lang/Integer;Ljava/lang/String;>;"
    invoke-static {p3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v4

    invoke-interface {v3, v4, p4}, Ljava/util/Map;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;

    .line 8061
    invoke-virtual {v2, p1, v3}, Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;->removeUIDListFromExceptionList(Ljava/lang/String;Ljava/util/Map;)I
    :try_end_24
    .catch Ljava/lang/Exception; {:try_start_7 .. :try_end_24} :catch_2a
    .catchall {:try_start_7 .. :try_end_24} :catchall_28

    .line 8067
    .end local v2    # "mEntProvider":Lcom/android/server/enterprise/billing/EnterpriseBillingEngine;
    .end local v3    # "packageUidMappings":Ljava/util/Map;, "Ljava/util/Map<Ljava/lang/Integer;Ljava/lang/String;>;"
    :cond_24
    :goto_24
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 8068
    goto :goto_4a

    .line 8067
    :catchall_28
    move-exception v2

    goto :goto_4b

    .line 8064
    :catch_2a
    move-exception v2

    .line 8065
    .local v2, "e":Ljava/lang/Exception;
    :try_start_2b
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_24

    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception at removeUIDListFromExceptionList API "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_49
    .catchall {:try_start_2b .. :try_end_49} :catchall_28

    goto :goto_24

    .line 8069
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_4a
    return-void

    .line 8067
    :goto_4b
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 8068
    throw v2
.end method

.method private removeUidFromExemptList(Ljava/lang/String;II)V
    .registers 12
    .param p1, "interfaceName"    # Ljava/lang/String;
    .param p2, "uidStart"    # I
    .param p3, "uidEnd"    # I

    .line 7374
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v1, "The following app removed from the interface "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string/jumbo v1, "will not go through vpn since it was blacklisted "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    const-string v1, "KnoxVpnEngineService"

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7375
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getNetworkManagementService()Landroid/os/INetworkManagementService;

    move-result-object v0

    if-eqz v0, :cond_6e

    .line 7376
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v2

    .line 7378
    .local v2, "token":J
    const/4 v0, 0x3

    :try_start_2a
    invoke-virtual {p1, v0}, Ljava/lang/String;->substring(I)Ljava/lang/String;

    move-result-object v4

    invoke-static {v4}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I

    move-result v4

    .line 7379
    .local v4, "passedinterfaceID":I
    invoke-virtual {p1, v0}, Ljava/lang/String;->substring(I)Ljava/lang/String;

    move-result-object v0

    invoke-static {v0}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I

    move-result v0

    add-int/lit8 v0, v0, 0x65

    .line 7380
    .local v0, "netId":I
    new-instance v5, Ljava/util/ArrayList;

    invoke-direct {v5}, Ljava/util/ArrayList;-><init>()V

    .line 7381
    .local v5, "uidList":Ljava/util/List;, "Ljava/util/List<Landroid/net/UidRange;>;"
    new-instance v6, Landroid/net/UidRange;

    invoke-direct {v6, p2, p3}, Landroid/net/UidRange;-><init>(II)V

    invoke-interface {v5, v6}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 7382
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getNetworkManagementService()Landroid/os/INetworkManagementService;

    move-result-object v6

    invoke-interface {v5}, Ljava/util/List;->size()I

    move-result v7

    new-array v7, v7, [Landroid/net/UidRange;

    invoke-interface {v5, v7}, Ljava/util/List;->toArray([Ljava/lang/Object;)[Ljava/lang/Object;

    move-result-object v7

    check-cast v7, [Landroid/net/UidRange;

    invoke-interface {v6, v0, v7}, Landroid/os/INetworkManagementService;->removeUidFromExemptList(I[Landroid/net/UidRange;)V
    :try_end_5c
    .catch Ljava/lang/Exception; {:try_start_2a .. :try_end_5c} :catch_5f
    .catchall {:try_start_2a .. :try_end_5c} :catchall_5d

    .line 7387
    .end local v0    # "netId":I
    .end local v4    # "passedinterfaceID":I
    .end local v5    # "uidList":Ljava/util/List;, "Ljava/util/List<Landroid/net/UidRange;>;"
    goto :goto_66

    :catchall_5d
    move-exception v0

    goto :goto_6a

    .line 7383
    :catch_5f
    move-exception v0

    .line 7384
    .local v0, "e":Ljava/lang/Exception;
    :try_start_60
    const-string v4, "Exception occured while trying to remove Uid From Vpn List "

    invoke-static {v1, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_65
    .catchall {:try_start_60 .. :try_end_65} :catchall_5d

    .line 7387
    nop

    .end local v0    # "e":Ljava/lang/Exception;
    :goto_66
    invoke-static {v2, v3}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7388
    goto :goto_6e

    .line 7387
    :goto_6a
    invoke-static {v2, v3}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7388
    throw v0

    .line 7390
    .end local v2    # "token":J
    :cond_6e
    :goto_6e
    return-void
.end method

.method private removeVpnInterface(Ljava/lang/String;)V
    .registers 4
    .param p1, "vendorName"    # Ljava/lang/String;

    .line 7636
    if-eqz p1, :cond_10

    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnInterfaceMap:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v0, p1}, Ljava/util/concurrent/ConcurrentHashMap;->containsKey(Ljava/lang/Object;)Z

    move-result v0

    const/4 v1, 0x1

    if-ne v0, v1, :cond_10

    .line 7637
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnInterfaceMap:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v0, p1}, Ljava/util/concurrent/ConcurrentHashMap;->remove(Ljava/lang/Object;)Ljava/lang/Object;

    .line 7639
    :cond_10
    return-void
.end method

.method private resetInterfaceParameter(Ljava/lang/String;)V
    .registers 4
    .param p1, "profileName"    # Ljava/lang/String;

    .line 6481
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0

    .line 6482
    .local v0, "profileInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v0, :cond_19

    .line 6483
    const/4 v1, 0x0

    invoke-virtual {v0, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setInterfaceName(Ljava/lang/String;)V

    .line 6484
    invoke-virtual {v0, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setInterfaceAddress(Ljava/lang/String;)V

    .line 6485
    invoke-virtual {v0, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setV6InterfaceAddress(Ljava/lang/String;)V

    .line 6486
    invoke-virtual {v0, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setDefaultInterface(Ljava/lang/String;)V

    .line 6487
    const/4 v1, 0x0

    invoke-virtual {v0, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setInterfaceType(I)V

    .line 6489
    :cond_19
    return-void
.end method

.method private retrieveVpnListFromStorage()Ljava/util/ArrayList;
    .registers 9
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "()",
            "Ljava/util/ArrayList<",
            "Lcom/android/internal/net/VpnProfile;",
            ">;"
        }
    .end annotation

    .line 8150
    new-instance v0, Ljava/util/ArrayList;

    invoke-direct {v0}, Ljava/util/ArrayList;-><init>()V

    .line 8152
    .local v0, "ProfileList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Lcom/android/internal/net/VpnProfile;>;"
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKeyStore()Landroid/security/KeyStore;

    move-result-object v1

    const-string v2, "VPN_"

    invoke-virtual {v1, v2}, Landroid/security/KeyStore;->list(Ljava/lang/String;)[Ljava/lang/String;

    move-result-object v1

    .line 8153
    .local v1, "keys":[Ljava/lang/String;
    if-eqz v1, :cond_45

    array-length v3, v1

    if-lez v3, :cond_45

    .line 8154
    array-length v3, v1

    const/4 v4, 0x0

    :goto_16
    if-ge v4, v3, :cond_45

    aget-object v5, v1, v4

    .line 8155
    .local v5, "key":Ljava/lang/String;
    invoke-static {v5}, Landroid/text/TextUtils;->isEmpty(Ljava/lang/CharSequence;)Z

    move-result v6

    if-nez v6, :cond_42

    .line 8156
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKeyStore()Landroid/security/KeyStore;

    move-result-object v6

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v7, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Landroid/security/KeyStore;->get(Ljava/lang/String;)[B

    move-result-object v6

    .line 8157
    .local v6, "value":[B
    if-eqz v6, :cond_42

    .line 8158
    invoke-static {v5, v6}, Lcom/android/internal/net/VpnProfile;->decode(Ljava/lang/String;[B)Lcom/android/internal/net/VpnProfile;

    move-result-object v7

    .line 8159
    .local v7, "profile":Lcom/android/internal/net/VpnProfile;
    if-eqz v7, :cond_42

    .line 8160
    invoke-virtual {v0, v7}, Ljava/util/ArrayList;->add(Ljava/lang/Object;)Z

    .line 8154
    .end local v5    # "key":Ljava/lang/String;
    .end local v6    # "value":[B
    .end local v7    # "profile":Lcom/android/internal/net/VpnProfile;
    :cond_42
    add-int/lit8 v4, v4, 0x1

    goto :goto_16

    .line 8165
    :cond_45
    return-object v0
.end method

.method private runAllVpnService()V
    .registers 10

    .line 4961
    const-string v0, "KnoxVpnEngineService"

    const-string/jumbo v1, "run all vpn : runAllVpnService beginning"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4963
    :try_start_8
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_12
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_97

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 4965
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    .line 4967
    .local v3, "profileName":Ljava/lang/String;
    invoke-virtual {p0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v4

    .line 4968
    .local v4, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v4, :cond_3e

    .line 4969
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "runAllVpnService:binder value is null for the profile "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4970
    goto :goto_12

    .line 4973
    :cond_3e
    invoke-direct {p0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVPNTransitionState(Ljava/lang/String;)I

    move-result v5

    .line 4974
    .local v5, "state":I
    sget-boolean v6, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z
    :try_end_44
    .catch Ljava/lang/Exception; {:try_start_8 .. :try_end_44} :catch_98

    const-string v7, " state : "

    if-eqz v6, :cond_63

    :try_start_48
    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "run all vpn : profileName "

    invoke-virtual {v6, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v5}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v0, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4976
    :cond_63
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v6

    if-nez v6, :cond_6a

    .line 4977
    goto :goto_12

    .line 4981
    :cond_6a
    const/4 v6, 0x1

    if-eq v5, v6, :cond_73

    const/4 v6, 0x5

    if-eq v5, v6, :cond_73

    const/4 v6, -0x1

    if-ne v5, v6, :cond_95

    .line 4982
    :cond_73
    sget-boolean v6, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v6, :cond_92

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "run all vpn : startVpnProfile : profileName "

    invoke-virtual {v6, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v5}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v0, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4983
    :cond_92
    invoke-direct {p0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnProfile(Ljava/lang/String;)I
    :try_end_95
    .catch Ljava/lang/Exception; {:try_start_48 .. :try_end_95} :catch_98

    .line 4985
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "profileName":Ljava/lang/String;
    .end local v4    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v5    # "state":I
    :cond_95
    goto/16 :goto_12

    .line 4988
    :cond_97
    goto :goto_b1

    .line 4986
    :catch_98
    move-exception v1

    .line 4987
    .local v1, "e":Ljava/lang/Exception;
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception occured while doing runAllVpnService "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v1}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4989
    .end local v1    # "e":Ljava/lang/Exception;
    :goto_b1
    return-void
.end method

.method private sendBindDisconnectedIntent(Ljava/lang/String;I)V
    .registers 16
    .param p1, "vendorNameWithCid"    # Ljava/lang/String;
    .param p2, "adminUid"    # I

    .line 638
    const-string v0, " whose package name is "

    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v1}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;

    move-result-object v1

    invoke-virtual {v1, p2}, Landroid/content/pm/PackageManager;->getPackagesForUid(I)[Ljava/lang/String;

    move-result-object v1

    .line 640
    .local v1, "adminPackageName":[Ljava/lang/String;
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v2

    .line 642
    .local v2, "token":J
    :try_start_10
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v4

    .line 643
    .local v4, "vendorName":Ljava/lang/String;
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v5, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v5

    .line 645
    .local v5, "containerId":I
    if-eqz v1, :cond_86

    const/4 v6, -0x1

    if-ne p2, v6, :cond_22

    goto :goto_86

    .line 649
    :cond_22
    new-instance v6, Landroid/content/Intent;

    invoke-direct {v6}, Landroid/content/Intent;-><init>()V

    .line 650
    .local v6, "successIntent":Landroid/content/Intent;
    const-string v7, "com.samsung.android.knox.intent.action.VPN_BIND_RESULT"

    invoke-virtual {v6, v7}, Landroid/content/Intent;->setAction(Ljava/lang/String;)Landroid/content/Intent;

    .line 651
    const-string v7, "com.samsung.android.knox.intent.extra.VPN_BIND_VENDOR"

    invoke-virtual {v6, v7, v4}, Landroid/content/Intent;->putExtra(Ljava/lang/String;Ljava/lang/String;)Landroid/content/Intent;

    .line 652
    const-string v7, "com.samsung.android.knox.intent.extra.VPN_BIND_CID"

    invoke-virtual {v6, v7, v5}, Landroid/content/Intent;->putExtra(Ljava/lang/String;I)Landroid/content/Intent;

    .line 653
    const-string v7, "com.samsung.android.knox.intent.extra.VPN_BIND_STATUS"

    const/4 v8, 0x0

    invoke-virtual {v6, v7, v8}, Landroid/content/Intent;->putExtra(Ljava/lang/String;Z)Landroid/content/Intent;

    .line 655
    array-length v7, v1

    :goto_3d
    if-ge v8, v7, :cond_81

    aget-object v9, v1, v8

    .line 656
    .local v9, "pkgName":Ljava/lang/String;
    const-string v10, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string v12, "Sending bind disconnect intent to admin uid  "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v12, " for the vpn client in user "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v5}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    invoke-static {v10, v11}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 658
    invoke-virtual {v6, v9}, Landroid/content/Intent;->setPackage(Ljava/lang/String;)Landroid/content/Intent;

    .line 659
    iget-object v10, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    new-instance v11, Landroid/os/UserHandle;

    invoke-static {p2}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v12

    invoke-direct {v11, v12}, Landroid/os/UserHandle;-><init>(I)V

    const-string v12, "com.samsung.android.knox.permission.KNOX_VPN_GENERIC"

    invoke-virtual {v10, v6, v11, v12}, Landroid/content/Context;->sendBroadcastAsUser(Landroid/content/Intent;Landroid/os/UserHandle;Ljava/lang/String;)V
    :try_end_7e
    .catchall {:try_start_10 .. :try_end_7e} :catchall_8a

    .line 655
    .end local v9    # "pkgName":Ljava/lang/String;
    add-int/lit8 v8, v8, 0x1

    goto :goto_3d

    .line 662
    .end local v4    # "vendorName":Ljava/lang/String;
    .end local v5    # "containerId":I
    .end local v6    # "successIntent":Landroid/content/Intent;
    :cond_81
    invoke-static {v2, v3}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 663
    nop

    .line 664
    return-void

    .line 662
    .restart local v4    # "vendorName":Ljava/lang/String;
    .restart local v5    # "containerId":I
    :cond_86
    :goto_86
    invoke-static {v2, v3}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 646
    return-void

    .line 662
    .end local v4    # "vendorName":Ljava/lang/String;
    .end local v5    # "containerId":I
    :catchall_8a
    move-exception v0

    invoke-static {v2, v3}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 663
    throw v0
.end method

.method private sendBindSuccessIntent(Ljava/lang/String;I)V
    .registers 12
    .param p1, "vendorNameWithCid"    # Ljava/lang/String;
    .param p2, "adminUid"    # I

    .line 604
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v0}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;

    move-result-object v0

    invoke-virtual {v0, p2}, Landroid/content/pm/PackageManager;->getPackagesForUid(I)[Ljava/lang/String;

    move-result-object v0

    .line 606
    .local v0, "adminPackageName":[Ljava/lang/String;
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v1

    .line 608
    .local v1, "token":J
    :try_start_e
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v3

    .line 609
    .local v3, "vendorName":Ljava/lang/String;
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v4

    .line 611
    .local v4, "containerId":I
    if-eqz v0, :cond_5e

    const/4 v5, -0x1

    if-ne p2, v5, :cond_20

    goto :goto_5e

    .line 615
    :cond_20
    new-instance v5, Landroid/content/Intent;

    invoke-direct {v5}, Landroid/content/Intent;-><init>()V

    .line 616
    .local v5, "successIntent":Landroid/content/Intent;
    const-string v6, "com.samsung.android.knox.intent.action.VPN_BIND_RESULT"

    invoke-virtual {v5, v6}, Landroid/content/Intent;->setAction(Ljava/lang/String;)Landroid/content/Intent;

    .line 617
    const-string v6, "com.samsung.android.knox.intent.extra.VPN_BIND_VENDOR"

    invoke-virtual {v5, v6, v3}, Landroid/content/Intent;->putExtra(Ljava/lang/String;Ljava/lang/String;)Landroid/content/Intent;

    .line 618
    const-string v6, "com.samsung.android.knox.intent.extra.VPN_BIND_CID"

    invoke-virtual {v5, v6, v4}, Landroid/content/Intent;->putExtra(Ljava/lang/String;I)Landroid/content/Intent;

    .line 619
    const-string v6, "com.samsung.android.knox.intent.extra.VPN_BIND_STATUS"

    const/4 v7, 0x1

    invoke-virtual {v5, v6, v7}, Landroid/content/Intent;->putExtra(Ljava/lang/String;Z)Landroid/content/Intent;

    .line 620
    const-string v6, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string v8, "Sending bind success intent to User "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v6, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 621
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    sget-object v7, Landroid/os/UserHandle;->ALL:Landroid/os/UserHandle;

    const-string v8, "com.samsung.android.knox.permission.KNOX_VPN_GENERIC"

    invoke-virtual {v6, v5, v7, v8}, Landroid/content/Context;->sendBroadcastAsUser(Landroid/content/Intent;Landroid/os/UserHandle;Ljava/lang/String;)V
    :try_end_59
    .catchall {:try_start_e .. :try_end_59} :catchall_62

    .line 631
    .end local v3    # "vendorName":Ljava/lang/String;
    .end local v4    # "containerId":I
    .end local v5    # "successIntent":Landroid/content/Intent;
    invoke-static {v1, v2}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 632
    nop

    .line 633
    return-void

    .line 631
    .restart local v3    # "vendorName":Ljava/lang/String;
    .restart local v4    # "containerId":I
    :cond_5e
    :goto_5e
    invoke-static {v1, v2}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 612
    return-void

    .line 631
    .end local v3    # "vendorName":Ljava/lang/String;
    .end local v4    # "containerId":I
    :catchall_62
    move-exception v3

    invoke-static {v1, v2}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 632
    throw v3
.end method

.method private sendMessageToHandler(ILandroid/os/Bundle;)V
    .registers 5
    .param p1, "action"    # I
    .param p2, "map"    # Landroid/os/Bundle;

    .line 5394
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    if-eqz v0, :cond_e

    .line 5395
    const/4 v1, 0x0

    invoke-static {v0, p1, v1, v1, p2}, Landroid/os/Message;->obtain(Landroid/os/Handler;IIILjava/lang/Object;)Landroid/os/Message;

    move-result-object v0

    .line 5396
    .local v0, "msg":Landroid/os/Message;
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    invoke-virtual {v1, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;->sendMessage(Landroid/os/Message;)Z

    .line 5398
    .end local v0    # "msg":Landroid/os/Message;
    :cond_e
    return-void
.end method

.method private sendProxyBroadcast(I)V
    .registers 14
    .param p1, "uid"    # I

    .line 8650
    :try_start_0
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v0

    invoke-interface {v0}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_a
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_ca

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 8651
    .local v1, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    const/4 v2, 0x0

    .line 8652
    .local v2, "uidList":Ljava/util/HashMap;, "Ljava/util/HashMap<Ljava/lang/Integer;Ljava/lang/Boolean;>;"
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPacurl()Landroid/net/Uri;

    move-result-object v3

    sget-object v4, Landroid/net/Uri;->EMPTY:Landroid/net/Uri;

    if-ne v3, v4, :cond_27

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyServer()Ljava/lang/String;

    move-result-object v3

    sget-object v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->DEFAULT_PROXY_SERVER:Ljava/lang/String;

    if-eq v3, v4, :cond_c8

    .line 8653
    :cond_27
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v3

    .line 8654
    .local v3, "activateState":I
    const/4 v4, 0x1

    if-eq v3, v4, :cond_30

    goto/16 :goto_c8

    .line 8656
    :cond_30
    new-instance v4, Ljava/util/HashMap;

    invoke-direct {v4}, Ljava/util/HashMap;-><init>()V

    move-object v2, v4

    .line 8657
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v4

    invoke-interface {v4}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v4

    :goto_3e
    invoke-interface {v4}, Ljava/util/Iterator;->hasNext()Z

    move-result v5

    if-eqz v5, :cond_aa

    invoke-interface {v4}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 8658
    .local v5, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    const/4 v6, 0x0

    .line 8659
    .local v6, "isExempted":Z
    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v7

    const/4 v8, 0x0

    if-ne v7, p1, :cond_5e

    .line 8660
    invoke-static {p1}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-static {v8}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;

    move-result-object v8

    invoke-virtual {v2, v7, v8}, Ljava/util/HashMap;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;

    goto :goto_a9

    .line 8661
    :cond_5e
    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v7

    const/4 v9, -0x2

    if-ne v7, v9, :cond_a9

    .line 8662
    invoke-static {p1}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v7

    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v9

    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v10

    invoke-virtual {v9, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v9

    if-ne v7, v9, :cond_a9

    .line 8663
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v7

    if-ne v7, p1, :cond_7e

    goto :goto_3e

    .line 8665
    :cond_7e
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v7

    .line 8666
    .local v7, "exemptedList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    invoke-virtual {v7}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v9

    :goto_86
    invoke-interface {v9}, Ljava/util/Iterator;->hasNext()Z

    move-result v10

    if-eqz v10, :cond_9b

    invoke-interface {v9}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v10

    check-cast v10, Ljava/lang/Integer;

    invoke-virtual {v10}, Ljava/lang/Integer;->intValue()I

    move-result v10

    .line 8667
    .local v10, "exemptedUid":I
    if-ne v10, p1, :cond_9a

    .line 8668
    const/4 v6, 0x1

    .line 8669
    goto :goto_9b

    .line 8671
    .end local v10    # "exemptedUid":I
    :cond_9a
    goto :goto_86

    .line 8672
    :cond_9b
    :goto_9b
    if-eqz v6, :cond_9e

    .line 8673
    goto :goto_3e

    .line 8674
    :cond_9e
    invoke-static {p1}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v9

    invoke-static {v8}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;

    move-result-object v8

    invoke-virtual {v2, v9, v8}, Ljava/util/HashMap;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;

    .line 8677
    .end local v5    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v6    # "isExempted":Z
    .end local v7    # "exemptedList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    :cond_a9
    :goto_a9
    goto :goto_3e

    .line 8678
    :cond_aa
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v5

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v7

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v8

    .line 8679
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyPort()I

    move-result v9

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyServer()Ljava/lang/String;

    move-result-object v10

    new-instance v11, Ljava/util/HashSet;

    invoke-direct {v11}, Ljava/util/HashSet;-><init>()V

    .line 8678
    move-object v6, v2

    invoke-virtual/range {v5 .. v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->sendProxyConfigBroadcast(Ljava/util/HashMap;ILandroid/net/ProxyInfo;ILjava/lang/String;Ljava/util/HashSet;)V
    :try_end_c7
    .catch Ljava/lang/Exception; {:try_start_0 .. :try_end_c7} :catch_cb

    .line 8680
    nop

    .line 8687
    .end local v1    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v2    # "uidList":Ljava/util/HashMap;, "Ljava/util/HashMap<Ljava/lang/Integer;Ljava/lang/Boolean;>;"
    .end local v3    # "activateState":I
    :cond_c8
    :goto_c8
    goto/16 :goto_a

    .line 8690
    :cond_ca
    goto :goto_d7

    .line 8688
    :catch_cb
    move-exception v0

    .line 8689
    .local v0, "e":Ljava/lang/Exception;
    sget-boolean v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v1, :cond_d7

    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Exception occured while trying to send proxy broadcast for apps which are registered dynamically"

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 8691
    .end local v0    # "e":Ljava/lang/Exception;
    :cond_d7
    :goto_d7
    return-void
.end method

.method private setActivate(Ljava/lang/String;I)Z
    .registers 12
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "activateState"    # I

    .line 7665
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v1, "setActivate: profileName value is "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v1, "activateState value is "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    const-string v1, "KnoxVpnEngineService"

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7666
    const/4 v0, 0x0

    .line 7669
    .local v0, "isActivateInfoSaved":Z
    :try_start_20
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 7670
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v2, :cond_29

    .line 7671
    return v0

    .line 7673
    :cond_29
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v3

    .line 7675
    .local v3, "previousActivateState":I
    new-instance v4, Landroid/content/ContentValues;

    invoke-direct {v4}, Landroid/content/ContentValues;-><init>()V

    .line 7676
    .local v4, "cv":Landroid/content/ContentValues;
    const-string v5, "activateState"

    invoke-static {p2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v6

    invoke-virtual {v4, v5, v6}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Integer;)V

    .line 7677
    const-string/jumbo v5, "profileName"

    filled-new-array {v5}, [Ljava/lang/String;

    move-result-object v5

    .line 7678
    .local v5, "columns":[Ljava/lang/String;
    const/4 v6, 0x1

    new-array v6, v6, [Ljava/lang/String;

    const/4 v7, 0x0

    aput-object p1, v6, v7

    .line 7680
    .local v6, "values":[Ljava/lang/String;
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v8, "VpnProfileInfo"

    invoke-virtual {v7, v8, v5, v6, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->putDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;Landroid/content/ContentValues;)Z

    move-result v7

    .line 7684
    .local v7, "activateStatus":Z
    if-eqz v7, :cond_57

    .line 7685
    invoke-virtual {v2, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setActivateState(I)V

    .line 7686
    const/4 v0, 0x1

    goto :goto_5a

    .line 7688
    :cond_57
    invoke-virtual {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setActivateState(I)V
    :try_end_5a
    .catch Ljava/lang/Exception; {:try_start_20 .. :try_end_5a} :catch_5b

    .line 7693
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "previousActivateState":I
    .end local v4    # "cv":Landroid/content/ContentValues;
    .end local v5    # "columns":[Ljava/lang/String;
    .end local v6    # "values":[Ljava/lang/String;
    .end local v7    # "activateStatus":Z
    :goto_5a
    goto :goto_78

    .line 7691
    :catch_5b
    move-exception v2

    .line 7692
    .local v2, "e":Ljava/lang/Exception;
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_78

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Exception occured while storing activateState info in db "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v1, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 7694
    .end local v2    # "e":Ljava/lang/Exception;
    :cond_78
    :goto_78
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "setActivate: isActivateInfoSaved value is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v0}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7695
    return v0
.end method

.method private setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V
    .registers 9
    .param p1, "data"    # Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;
    .param p2, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p3, "profileName"    # Ljava/lang/String;
    .param p4, "extra"    # I

    .line 9071
    const/4 v0, -0x1

    .line 9072
    .local v0, "profileId":I
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v1

    .line 9073
    .local v1, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz p2, :cond_20

    .line 9074
    iget v2, p2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->adminId:I

    const-string v3, "admUid"

    invoke-virtual {p1, v3, v2}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 9075
    iget v2, p2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    const-string/jumbo v3, "vndrCid"

    invoke-virtual {p1, v3, v2}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 9076
    iget-object v2, p2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->vendorName:Ljava/lang/String;

    const-string/jumbo v3, "vndrPkgN"

    invoke-virtual {p1, v3, v2}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;Ljava/lang/String;)V

    .line 9078
    :cond_20
    if-eqz v1, :cond_27

    .line 9079
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileId()I

    move-result v0

    goto :goto_28

    .line 9081
    :cond_27
    move v0, p4

    .line 9083
    :goto_28
    const-string/jumbo v2, "prfid"

    invoke-virtual {p1, v2, v0}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 9084
    return-void
.end method

.method private setDnsSystemProperty(Ljava/lang/String;IILjava/lang/String;)V
    .registers 13
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "uidStart"    # I
    .param p3, "uidEnd"    # I
    .param p4, "interfaceName"    # Ljava/lang/String;

    .line 7311
    const-string v0, "KnoxVpnEngineService"

    if-eqz p1, :cond_b1

    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getNetworkManagementService()Landroid/os/INetworkManagementService;

    move-result-object v1

    if-eqz v1, :cond_b1

    .line 7312
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v1

    .line 7314
    .local v1, "token":J
    :try_start_e
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v3, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v3

    .line 7315
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v3, :cond_8f

    .line 7317
    const-string/jumbo v4, "tun"

    invoke-virtual {p4, v4}, Ljava/lang/String;->contains(Ljava/lang/CharSequence;)Z

    move-result v4

    if-nez v4, :cond_22

    .line 7318
    const/16 v4, 0x64

    .local v4, "netId":I
    goto :goto_35

    .line 7320
    .end local v4    # "netId":I
    :cond_22
    const/4 v4, 0x3

    invoke-virtual {p4, v4}, Ljava/lang/String;->substring(I)Ljava/lang/String;

    move-result-object v5

    invoke-static {v5}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I

    move-result v5

    .line 7321
    .local v5, "passedinterfaceID":I
    invoke-virtual {p4, v4}, Ljava/lang/String;->substring(I)Ljava/lang/String;

    move-result-object v4

    invoke-static {v4}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I

    move-result v4

    add-int/lit8 v4, v4, 0x65

    .line 7323
    .end local v5    # "passedinterfaceID":I
    .restart local v4    # "netId":I
    :goto_35
    sget-boolean v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v5, :cond_6f

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "setDnsSystemProperty is reached : whose profileName is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string/jumbo v6, "whose start uid is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v6, " whose stop uid is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, p3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v6, " whose interface "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, p4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, " whose netId is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7325
    :cond_6f
    new-instance v5, Ljava/util/ArrayList;

    invoke-direct {v5}, Ljava/util/ArrayList;-><init>()V

    .line 7326
    .local v5, "uidList":Ljava/util/List;, "Ljava/util/List<Landroid/net/UidRange;>;"
    new-instance v6, Landroid/net/UidRange;

    invoke-direct {v6, p2, p3}, Landroid/net/UidRange;-><init>(II)V

    invoke-interface {v5, v6}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 7327
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getNetworkManagementService()Landroid/os/INetworkManagementService;

    move-result-object v6

    invoke-interface {v5}, Ljava/util/List;->size()I

    move-result v7

    new-array v7, v7, [Landroid/net/UidRange;

    invoke-interface {v5, v7}, Ljava/util/List;->toArray([Ljava/lang/Object;)[Ljava/lang/Object;

    move-result-object v7

    check-cast v7, [Landroid/net/UidRange;

    invoke-interface {v6, v4, v7}, Landroid/os/INetworkManagementService;->addVpnUidRanges(I[Landroid/net/UidRange;)V
    :try_end_8f
    .catch Ljava/lang/Exception; {:try_start_e .. :try_end_8f} :catch_96
    .catchall {:try_start_e .. :try_end_8f} :catchall_94

    .line 7332
    .end local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v4    # "netId":I
    .end local v5    # "uidList":Ljava/util/List;, "Ljava/util/List<Landroid/net/UidRange;>;"
    :cond_8f
    nop

    :goto_90
    invoke-static {v1, v2}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7333
    goto :goto_b1

    .line 7332
    :catchall_94
    move-exception v0

    goto :goto_ad

    .line 7329
    :catch_96
    move-exception v3

    .line 7330
    .local v3, "e":Ljava/lang/Exception;
    :try_start_97
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception occured while trying to set the dns entry for the profile "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_ab
    .catchall {:try_start_97 .. :try_end_ab} :catchall_94

    .line 7332
    nop

    .end local v3    # "e":Ljava/lang/Exception;
    goto :goto_90

    :goto_ad
    invoke-static {v1, v2}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7333
    throw v0

    .line 7335
    .end local v1    # "token":J
    :cond_b1
    :goto_b1
    return-void
.end method

.method private setPropertiesWithLocalEntry(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Ljava/lang/String;)V
    .registers 10
    .param p1, "data"    # Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;
    .param p2, "profileName"    # Ljava/lang/String;

    .line 9089
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0

    .line 9090
    .local v0, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v0, :cond_42

    .line 9091
    const/4 v1, 0x0

    .line 9092
    .local v1, "protocolType":Ljava/lang/String;
    const/4 v2, -0x1

    .line 9093
    .local v2, "routeType":I
    const/4 v3, 0x0

    .line 9094
    .local v3, "vpnConnectionType":I
    const/4 v4, 0x0

    .line 9095
    .local v4, "proxy_auth":I
    const/4 v5, -0x1

    .line 9097
    .local v5, "chainingEnabled":I
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProtocolType()Ljava/lang/String;

    move-result-object v1

    .line 9098
    if-eqz v1, :cond_19

    const-string/jumbo v6, "prtTp"

    invoke-virtual {p1, v6, v1}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;Ljava/lang/String;)V

    .line 9100
    :cond_19
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v2

    .line 9101
    const/4 v6, -0x1

    if-eq v2, v6, :cond_26

    const-string/jumbo v6, "rtTp"

    invoke-virtual {p1, v6, v2}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 9103
    :cond_26
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVpnConnectionType()I

    move-result v3

    .line 9104
    const-string v6, "connTp"

    invoke-virtual {p1, v6, v3}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 9106
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->isProxyAuthRequired()I

    move-result v4

    .line 9107
    const-string/jumbo v6, "prxAuth"

    invoke-virtual {p1, v6, v4}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 9109
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getChainingEnabled()I

    move-result v5

    .line 9110
    const-string v6, "chn"

    invoke-virtual {p1, v6, v5}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 9112
    .end local v1    # "protocolType":Ljava/lang/String;
    .end local v2    # "routeType":I
    .end local v3    # "vpnConnectionType":I
    .end local v4    # "proxy_auth":I
    .end local v5    # "chainingEnabled":I
    :cond_42
    return-void
.end method

.method private setVpnInterface(Ljava/lang/String;Ljava/lang/Object;)V
    .registers 5
    .param p1, "vendorName"    # Ljava/lang/String;
    .param p2, "vpnInterface"    # Ljava/lang/Object;

    .line 7606
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v0, :cond_24

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v1, "setVpnInterface: vendorName value is "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string/jumbo v1, "vpnInterface value is "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    const-string v1, "KnoxVpnEngineService"

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7607
    :cond_24
    if-nez p2, :cond_28

    .line 7608
    sget-object p2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->NULL_OBJECT:Ljava/lang/Object;

    .line 7610
    :cond_28
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnInterfaceMap:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v0, p1, p2}, Ljava/util/concurrent/ConcurrentHashMap;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;

    .line 7611
    return-void
.end method

.method private setupIntentFilter()V
    .registers 11

    .line 5152
    const-string v0, "KnoxVpnEngineService"

    const-string/jumbo v1, "setup intent filter is called"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5153
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->receiver:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;

    if-eqz v1, :cond_12

    .line 5154
    const-string v1, "VpnReceiver already registered"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5155
    return-void

    .line 5157
    :cond_12
    const-string v1, "Registering VpnReceiver is successful"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5158
    new-instance v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;

    invoke-direct {v0, p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;-><init>(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;)V

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->receiver:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;

    .line 5159
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v0

    .line 5162
    .local v0, "token":J
    :try_start_22
    new-instance v2, Landroid/content/IntentFilter;

    invoke-direct {v2}, Landroid/content/IntentFilter;-><init>()V

    .line 5163
    .local v2, "filter":Landroid/content/IntentFilter;
    const-string v3, "android.intent.action.PACKAGE_ADDED"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5164
    const-string v3, "android.intent.action.PACKAGE_REMOVED"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5165
    const-string v3, "android.intent.category.DEFAULT"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addCategory(Ljava/lang/String;)V

    .line 5166
    const-string/jumbo v3, "package"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addDataScheme(Ljava/lang/String;)V

    .line 5167
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->receiver:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;

    sget-object v5, Landroid/os/UserHandle;->ALL:Landroid/os/UserHandle;

    const/4 v7, 0x0

    const/4 v8, 0x0

    move-object v6, v2

    invoke-virtual/range {v3 .. v8}, Landroid/content/Context;->registerReceiverAsUser(Landroid/content/BroadcastReceiver;Landroid/os/UserHandle;Landroid/content/IntentFilter;Ljava/lang/String;Landroid/os/Handler;)Landroid/content/Intent;

    .line 5170
    new-instance v3, Landroid/content/IntentFilter;

    invoke-direct {v3}, Landroid/content/IntentFilter;-><init>()V

    move-object v2, v3

    .line 5171
    const-string v3, "android.intent.action.BOOT_COMPLETED"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5172
    const-string v3, "android.intent.action.LOCKED_BOOT_COMPLETED"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5173
    const-string v3, "android.intent.action.USER_STARTED"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5174
    const-string v3, "android.intent.action.USER_SWITCHED"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5175
    const-string v3, "android.intent.action.USER_REMOVED"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5176
    const-string v3, "android.net.conn.CONNECTIVITY_CHANGE"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5177
    const-string v3, "android.intent.action.AIRPLANE_MODE"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5178
    const-string v3, "android.intent.action.USER_PRESENT"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5179
    const-string v3, "com.samsung.intent.action.EMERGENCY_STATE_CHANGED"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5180
    const-string v3, "com.samsung.android.knox.intent.action.UCM_REFRESH_DONE"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5181
    const-string v3, "android.net.wifi.STATE_CHANGE"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5182
    const-string v3, "com.samsung.android.knox.intent.action.NETWORK_VALIDATED_INTERNAL"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5183
    const-string v3, "android.hardware.usb.action.USB_STATE"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5184
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->receiver:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;

    sget-object v6, Landroid/os/UserHandle;->ALL:Landroid/os/UserHandle;

    const/4 v8, 0x0

    const/4 v9, 0x0

    move-object v7, v2

    invoke-virtual/range {v4 .. v9}, Landroid/content/Context;->registerReceiverAsUser(Landroid/content/BroadcastReceiver;Landroid/os/UserHandle;Landroid/content/IntentFilter;Ljava/lang/String;Landroid/os/Handler;)Landroid/content/Intent;

    .line 5187
    new-instance v3, Landroid/content/IntentFilter;

    invoke-direct {v3}, Landroid/content/IntentFilter;-><init>()V

    move-object v2, v3

    .line 5188
    const-string v3, "enterprise.container.uninstalled"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5189
    const-string v3, "enterprise.container.admin.changed"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5190
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->receiver:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;

    sget-object v6, Landroid/os/UserHandle;->ALL:Landroid/os/UserHandle;

    const-string v8, "com.samsung.android.knox.permission.KNOX_CONTAINER"

    const/4 v9, 0x0

    move-object v7, v2

    invoke-virtual/range {v4 .. v9}, Landroid/content/Context;->registerReceiverAsUser(Landroid/content/BroadcastReceiver;Landroid/os/UserHandle;Landroid/content/IntentFilter;Ljava/lang/String;Landroid/os/Handler;)Landroid/content/Intent;

    .line 5193
    new-instance v3, Landroid/content/IntentFilter;

    invoke-direct {v3}, Landroid/content/IntentFilter;-><init>()V

    move-object v2, v3

    .line 5194
    const-string v3, "com.samsung.android.knox.intent.action.INTERFACE_STATUS_INTERNAL"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5195
    const-string v3, "com.samsung.android.knox.intent.action.VPN_PROXY_BROADCAST_INTERNAL"

    invoke-virtual {v2, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V

    .line 5196
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->receiver:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;

    sget-object v6, Landroid/os/UserHandle;->ALL:Landroid/os/UserHandle;

    const-string v8, "com.samsung.android.knox.permission.KNOX_VPN_INTERNAL"

    const/4 v9, 0x0

    move-object v7, v2

    invoke-virtual/range {v4 .. v9}, Landroid/content/Context;->registerReceiverAsUser(Landroid/content/BroadcastReceiver;Landroid/os/UserHandle;Landroid/content/IntentFilter;Ljava/lang/String;Landroid/os/Handler;)Landroid/content/Intent;
    :try_end_d5
    .catchall {:try_start_22 .. :try_end_d5} :catchall_db

    .line 5198
    nop

    .end local v2    # "filter":Landroid/content/IntentFilter;
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 5199
    nop

    .line 5200
    return-void

    .line 5198
    :catchall_db
    move-exception v2

    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 5199
    throw v2
.end method

.method private startChainedProfile(Ljava/lang/String;)V
    .registers 5
    .param p1, "profileName"    # Ljava/lang/String;

    .line 7997
    :try_start_0
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mChainingStateMachine:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$ChainingStateMachine;

    if-eqz v0, :cond_c

    .line 7998
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mChainingStateMachine:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$ChainingStateMachine;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$ChainingStateMachine;->exit()V

    .line 7999
    const/4 v0, 0x0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mChainingStateMachine:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$ChainingStateMachine;

    .line 8001
    :cond_c
    new-instance v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$ChainingStateMachine;

    const/4 v1, 0x4

    invoke-direct {v0, p0, p1, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$ChainingStateMachine;-><init>(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Ljava/lang/String;I)V

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mChainingStateMachine:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$ChainingStateMachine;

    .line 8002
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$ChainingStateMachine;->start()V
    :try_end_17
    .catch Ljava/lang/Exception; {:try_start_0 .. :try_end_17} :catch_18

    .line 8006
    goto :goto_33

    .line 8004
    :catch_18
    move-exception v0

    .line 8005
    .local v0, "e":Ljava/lang/Exception;
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string v2, "Exception at startChainedProfile API "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    const-string v2, "KnoxVpnEngineService"

    invoke-static {v2, v1}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 8007
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_33
    return-void
.end method

.method private declared-synchronized startVpnConnectionForAllClients()V
    .registers 9

    monitor-enter p0

    .line 5029
    :try_start_1
    new-instance v0, Ljava/util/HashSet;

    invoke-direct {v0}, Ljava/util/HashSet;-><init>()V

    .line 5030
    .local v0, "clientsWithNullBinder":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_10
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_8e

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 5031
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    .line 5032
    .local v3, "profileName":Ljava/lang/String;
    invoke-virtual {p0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v4

    if-nez v4, :cond_56

    .line 5033
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnConnectionList:Ljava/util/HashMap;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/util/HashMap;->containsKey(Ljava/lang/Object;)Z

    move-result v4

    if-eqz v4, :cond_4e

    .line 5034
    const-string v4, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "startVpnConnectionForAllClients: skip binding for "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5035
    goto :goto_10

    .line 5037
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_4e
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v4

    invoke-interface {v0, v4}, Ljava/util/Set;->add(Ljava/lang/Object;)Z

    .line 5038
    goto :goto_10

    .line 5041
    :cond_56
    invoke-direct {p0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVPNTransitionState(Ljava/lang/String;)I

    move-result v4

    .line 5042
    .local v4, "state":I
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v5

    if-nez v5, :cond_61

    .line 5043
    goto :goto_10

    .line 5046
    :cond_61
    const/4 v5, 0x1

    if-eq v4, v5, :cond_6a

    const/4 v5, 0x5

    if-eq v4, v5, :cond_6a

    const/4 v5, -0x1

    if-ne v4, v5, :cond_8d

    .line 5047
    :cond_6a
    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "starting the vpn connection for the profile after UPSM is switched off "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string/jumbo v7, "state:"

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5048
    invoke-direct {p0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnProfile(Ljava/lang/String;)I

    .line 5051
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "profileName":Ljava/lang/String;
    .end local v4    # "state":I
    :cond_8d
    goto :goto_10

    .line 5052
    :cond_8e
    invoke-interface {v0}, Ljava/util/Set;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_92
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_b0

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Ljava/lang/String;

    .line 5053
    .local v2, "client":Ljava/lang/String;
    const-string v3, "KnoxVpnEngineService"

    const-string v4, "The client binder object was set to null due to app getting killed when UPSM was switched on and trying to bind again"

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5054
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getAdminIdFromPackageName(Ljava/lang/String;)I

    move-result v3

    .line 5055
    .local v3, "adminId":I
    invoke-direct {p0, v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->bindKnoxVpnInterface(Ljava/lang/String;I)Z
    :try_end_ae
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_ae} :catch_b3
    .catchall {:try_start_1 .. :try_end_ae} :catchall_b1

    .line 5056
    nop

    .end local v2    # "client":Ljava/lang/String;
    .end local v3    # "adminId":I
    goto :goto_92

    .line 5059
    .end local v0    # "clientsWithNullBinder":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    :cond_b0
    goto :goto_ce

    .line 5028
    :catchall_b1
    move-exception v0

    goto :goto_d0

    .line 5057
    :catch_b3
    move-exception v0

    .line 5058
    .local v0, "e":Ljava/lang/Exception;
    :try_start_b4
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception occured while trying to start the vpn connection after UPSM is switched off"

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_ce
    .catchall {:try_start_b4 .. :try_end_ce} :catchall_b1

    .line 5060
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_ce
    monitor-exit p0

    return-void

    .line 5028
    :goto_d0
    monitor-exit p0

    throw v0
.end method

.method private startVpnConnectionForBindedClient(Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;)V
    .registers 10
    .param p1, "vendorNameWithCid"    # Ljava/lang/String;
    .param p2, "vpnInterface"    # Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    .line 4995
    const-string v0, "KnoxVpnEngineService"

    :try_start_2
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_c
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_6e

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 4996
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v3, p1}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v3

    if-nez v3, :cond_23

    .line 4997
    goto :goto_c

    .line 4999
    :cond_23
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v3

    if-nez v3, :cond_2a

    .line 5000
    goto :goto_c

    .line 5002
    :cond_2a
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v3

    if-nez v3, :cond_31

    .line 5003
    goto :goto_c

    .line 5005
    :cond_31
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    .line 5006
    .local v3, "profileName":Ljava/lang/String;
    invoke-interface {p2, v3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getState(Ljava/lang/String;)I

    move-result v4

    .line 5007
    .local v4, "state":I
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Start the vpn connection after binding successfully for the profile "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, " with the vpn client "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, " whose current state is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5010
    const/4 v5, 0x1

    if-eq v4, v5, :cond_6a

    const/4 v5, 0x5

    if-eq v4, v5, :cond_6a

    const/4 v5, -0x1

    if-ne v4, v5, :cond_6d

    .line 5011
    :cond_6a
    invoke-direct {p0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnProfile(Ljava/lang/String;)I
    :try_end_6d
    .catch Ljava/lang/Exception; {:try_start_2 .. :try_end_6d} :catch_6f

    .line 5013
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "profileName":Ljava/lang/String;
    .end local v4    # "state":I
    :cond_6d
    goto :goto_c

    .line 5016
    :cond_6e
    goto :goto_88

    .line 5014
    :catch_6f
    move-exception v1

    .line 5015
    .local v1, "e":Ljava/lang/Exception;
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception occured while doing runAllVpnService "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v1}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5017
    .end local v1    # "e":Ljava/lang/Exception;
    :goto_88
    return-void
.end method

.method private declared-synchronized startVpnConnectionForClient(I)V
    .registers 10
    .param p1, "vpnClient"    # I

    monitor-enter p0

    .line 5072
    :try_start_1
    new-instance v0, Ljava/util/HashSet;

    invoke-direct {v0}, Ljava/util/HashSet;-><init>()V

    .line 5073
    .local v0, "clientsWithNullBinder":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_10
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_9f

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 5074
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v3

    if-eq v3, p1, :cond_23

    goto :goto_10

    .line 5075
    :cond_23
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v3

    .line 5076
    .local v3, "profileName":Ljava/lang/String;
    invoke-virtual {p0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v4

    if-nez v4, :cond_5d

    .line 5077
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnConnectionList:Ljava/util/HashMap;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/util/HashMap;->containsKey(Ljava/lang/Object;)Z

    move-result v4

    if-eqz v4, :cond_55

    .line 5078
    const-string v4, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "startVpnConnectionForClient: skip binding for "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5079
    goto :goto_10

    .line 5081
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_55
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v4

    invoke-interface {v0, v4}, Ljava/util/Set;->add(Ljava/lang/Object;)Z

    .line 5082
    goto :goto_10

    .line 5085
    :cond_5d
    invoke-direct {p0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVPNTransitionState(Ljava/lang/String;)I

    move-result v4

    .line 5086
    .local v4, "state":I
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v5

    if-nez v5, :cond_68

    .line 5087
    goto :goto_10

    .line 5090
    :cond_68
    const/4 v5, 0x1

    if-eq v4, v5, :cond_71

    const/4 v5, 0x5

    if-eq v4, v5, :cond_71

    const/4 v5, -0x1

    if-ne v4, v5, :cond_9d

    .line 5091
    :cond_71
    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "starting the vpn connection for the profile after system restriction is removed "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string/jumbo v7, "state:"

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string/jumbo v7, "vpnClient:"

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5092
    invoke-direct {p0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnProfile(Ljava/lang/String;)I

    .line 5095
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "profileName":Ljava/lang/String;
    .end local v4    # "state":I
    :cond_9d
    goto/16 :goto_10

    .line 5096
    :cond_9f
    invoke-interface {v0}, Ljava/util/Set;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_a3
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_c1

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Ljava/lang/String;

    .line 5097
    .local v2, "client":Ljava/lang/String;
    const-string v3, "KnoxVpnEngineService"

    const-string v4, "The client binder object was set to null due to app getting killed during idle or power mode and trying to bind again"

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5098
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getAdminIdFromPackageName(Ljava/lang/String;)I

    move-result v3

    .line 5099
    .local v3, "adminId":I
    invoke-direct {p0, v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->bindKnoxVpnInterface(Ljava/lang/String;I)Z
    :try_end_bf
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_bf} :catch_c4
    .catchall {:try_start_1 .. :try_end_bf} :catchall_c2

    .line 5100
    nop

    .end local v2    # "client":Ljava/lang/String;
    .end local v3    # "adminId":I
    goto :goto_a3

    .line 5103
    .end local v0    # "clientsWithNullBinder":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
    :cond_c1
    goto :goto_df

    .line 5071
    .end local p1    # "vpnClient":I
    :catchall_c2
    move-exception p1

    goto :goto_e1

    .line 5101
    .restart local p1    # "vpnClient":I
    :catch_c4
    move-exception v0

    .line 5102
    .local v0, "e":Ljava/lang/Exception;
    :try_start_c5
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception occured while trying to start the vpn connection after the system restriction is removed"

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_df
    .catchall {:try_start_c5 .. :try_end_df} :catchall_c2

    .line 5104
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_df
    monitor-exit p0

    return-void

    .line 5071
    .end local p1    # "vpnClient":I
    :goto_e1
    monitor-exit p0

    throw p1
.end method

.method private declared-synchronized startVpnProfile(Ljava/lang/String;)I
    .registers 29
    .param p1, "profileName"    # Ljava/lang/String;

    move-object/from16 v1, p0

    move-object/from16 v2, p1

    monitor-enter p0

    .line 7203
    :try_start_5
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v0, :cond_20

    const-string v0, "KnoxVpnEngineService"

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v4, "startVpnProfile : profileName value is "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7204
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_20
    const/4 v3, -0x1

    .line 7205
    .local v3, "startVpn":I
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0
    :try_end_27
    .catchall {:try_start_5 .. :try_end_27} :catchall_242

    move-object v4, v0

    .line 7206
    .local v4, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v4, :cond_2e

    .line 7207
    const/16 v0, 0x6c

    monitor-exit p0

    return v0

    .line 7210
    .restart local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_2e
    :try_start_2e
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v0
    :try_end_32
    .catch Ljava/lang/Exception; {:try_start_2e .. :try_end_32} :catch_201
    .catchall {:try_start_2e .. :try_end_32} :catchall_242

    .line 7211
    .local v0, "activateState":I
    if-nez v0, :cond_61

    .line 7212
    const/4 v5, 0x3

    const/4 v6, 0x5

    const/4 v7, 0x0

    .line 7213
    :try_start_37
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v8

    const-string v9, "KnoxVpnEngineService"

    new-instance v10, Ljava/lang/StringBuilder;

    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V

    const-string v11, "Error trying to start vpn profile "

    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v11, ". Profile is not activated"

    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v10

    .line 7215
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v11

    .line 7212
    invoke-static/range {v5 .. v11}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_5a
    .catch Ljava/lang/Exception; {:try_start_37 .. :try_end_5a} :catch_5e
    .catchall {:try_start_37 .. :try_end_5a} :catchall_242

    .line 7216
    const/16 v5, 0x12d

    monitor-exit p0

    return v5

    .line 7297
    .end local v0    # "activateState":I
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :catch_5e
    move-exception v0

    goto/16 :goto_204

    .line 7219
    .restart local v0    # "activateState":I
    :cond_61
    :try_start_61
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->isNetworkConnected()Z

    move-result v5
    :try_end_65
    .catch Ljava/lang/Exception; {:try_start_61 .. :try_end_65} :catch_201
    .catchall {:try_start_61 .. :try_end_65} :catchall_242

    if-nez v5, :cond_91

    .line 7220
    const/4 v6, 0x3

    const/4 v7, 0x5

    const/4 v8, 0x0

    .line 7221
    :try_start_6a
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v9

    const-string v10, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v11, "Error trying to start vpn profile "

    invoke-virtual {v5, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v11, ". Network is not available"

    invoke-virtual {v5, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    .line 7223
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v12

    .line 7220
    invoke-static/range {v6 .. v12}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_8d
    .catch Ljava/lang/Exception; {:try_start_6a .. :try_end_8d} :catch_5e
    .catchall {:try_start_6a .. :try_end_8d} :catchall_242

    .line 7224
    const/16 v5, 0x130

    monitor-exit p0

    return v5

    .line 7227
    :cond_91
    :try_start_91
    iget-object v5, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v5, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->checkIfProfileHasChainingFeature(Ljava/lang/String;)I

    move-result v5
    :try_end_97
    .catch Ljava/lang/Exception; {:try_start_91 .. :try_end_97} :catch_201
    .catchall {:try_start_91 .. :try_end_97} :catchall_242

    .line 7228
    .local v5, "isChainingEnabled":I
    const/4 v6, 0x1

    if-ne v5, v6, :cond_b6

    .line 7229
    :try_start_9a
    invoke-virtual/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkChainingStatus(Ljava/lang/String;)I

    move-result v7

    .line 7230
    .local v7, "chainingStatus":I
    if-nez v7, :cond_b6

    .line 7231
    const/4 v8, 0x3

    const/4 v9, 0x5

    const/4 v10, 0x0

    .line 7232
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v11

    const-string v12, "KnoxVpnEngineService"

    const-string v13, "Error trying to start vpn profile. Chaining is not ready"

    .line 7234
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v14

    .line 7231
    invoke-static/range {v8 .. v14}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_b2
    .catch Ljava/lang/Exception; {:try_start_9a .. :try_end_b2} :catch_5e
    .catchall {:try_start_9a .. :try_end_b2} :catchall_242

    .line 7235
    const/16 v6, 0x1f6

    monitor-exit p0

    return v6

    .line 7239
    .end local v7    # "chainingStatus":I
    :cond_b6
    :try_start_b6
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageCount()I

    move-result v7
    :try_end_ba
    .catch Ljava/lang/Exception; {:try_start_b6 .. :try_end_ba} :catch_201
    .catchall {:try_start_b6 .. :try_end_ba} :catchall_242

    .line 7241
    .local v7, "size":I
    if-gtz v7, :cond_e1

    .line 7242
    const/4 v8, 0x3

    const/4 v9, 0x5

    const/4 v10, 0x0

    .line 7243
    :try_start_bf
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v11

    const-string v12, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v13, "Vpn connection not established. No package added to profile "

    invoke-virtual {v6, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v13

    .line 7245
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v14

    .line 7242
    invoke-static/range {v8 .. v14}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_dd
    .catch Ljava/lang/Exception; {:try_start_bf .. :try_end_dd} :catch_5e
    .catchall {:try_start_bf .. :try_end_dd} :catchall_242

    .line 7246
    const/16 v6, 0x12e

    monitor-exit p0

    return v6

    .line 7249
    :cond_e1
    :try_start_e1
    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVPNTransitionState(Ljava/lang/String;)I

    move-result v8

    const/4 v9, 0x4

    if-eq v8, v9, :cond_1fc

    .line 7254
    invoke-virtual/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v8

    .line 7255
    .local v8, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-eqz v8, :cond_1f3

    .line 7256
    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVPNTransitionState(Ljava/lang/String;)I

    move-result v9

    .line 7257
    .local v9, "state":I
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v11

    .line 7258
    .local v11, "active":I
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVpnConnectionType()I

    move-result v12
    :try_end_fa
    .catch Ljava/lang/Exception; {:try_start_e1 .. :try_end_fa} :catch_201
    .catchall {:try_start_e1 .. :try_end_fa} :catchall_242

    .line 7259
    .local v12, "vpnConnectionType":I
    if-eq v9, v6, :cond_102

    const/4 v13, 0x5

    if-eq v9, v13, :cond_102

    const/4 v13, -0x1

    if-ne v9, v13, :cond_104

    :cond_102
    if-nez v11, :cond_106

    :cond_104
    move v13, v6

    goto :goto_107

    :cond_106
    const/4 v13, 0x0

    .line 7261
    .local v13, "notAllowed":Z
    :goto_107
    if-nez v12, :cond_10b

    move v14, v6

    goto :goto_10c

    :cond_10b
    const/4 v14, 0x0

    .line 7263
    .local v14, "keepOn":Z
    :goto_10c
    const/4 v15, 0x0

    .line 7264
    .local v15, "isRunning":Z
    if-ne v12, v6, :cond_116

    .line 7265
    :try_start_10f
    iget-object v10, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mProcessManager:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;

    invoke-virtual {v10, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;->processRunCheck(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;)Z

    move-result v10
    :try_end_115
    .catch Ljava/lang/Exception; {:try_start_10f .. :try_end_115} :catch_5e
    .catchall {:try_start_10f .. :try_end_115} :catchall_242

    move v15, v10

    .line 7268
    :cond_116
    if-ne v12, v6, :cond_11c

    if-ne v15, v6, :cond_11c

    move v10, v6

    goto :goto_11d

    :cond_11c
    const/4 v10, 0x0

    .line 7269
    .local v10, "startOnDemand":Z
    :goto_11d
    if-ne v12, v6, :cond_122

    if-nez v15, :cond_122

    goto :goto_123

    :cond_122
    const/4 v6, 0x0

    .line 7271
    .local v6, "notStartOnDemand":Z
    :goto_123
    if-eqz v13, :cond_14e

    .line 7272
    move/from16 v17, v0

    .end local v0    # "activateState":I
    .local v17, "activateState":I
    :try_start_127
    const-string v0, "KnoxVpnEngineService"
    :try_end_129
    .catch Ljava/lang/Exception; {:try_start_127 .. :try_end_129} :catch_201
    .catchall {:try_start_127 .. :try_end_129} :catchall_242

    move/from16 v18, v3

    .end local v3    # "startVpn":I
    .local v18, "startVpn":I
    :try_start_12b
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    move/from16 v19, v5

    .end local v5    # "isChainingEnabled":I
    .local v19, "isChainingEnabled":I
    const-string/jumbo v5, "not allowd state for starting a vpn : profileName = "

    invoke-virtual {v3, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v5, ": state = "

    invoke-virtual {v3, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v9}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_14a
    .catch Ljava/lang/Exception; {:try_start_12b .. :try_end_14a} :catch_1ef
    .catchall {:try_start_12b .. :try_end_14a} :catchall_242

    .line 7273
    const/16 v0, 0x131

    monitor-exit p0

    return v0

    .line 7276
    .end local v17    # "activateState":I
    .end local v18    # "startVpn":I
    .end local v19    # "isChainingEnabled":I
    .restart local v0    # "activateState":I
    .restart local v3    # "startVpn":I
    .restart local v5    # "isChainingEnabled":I
    :cond_14e
    move/from16 v17, v0

    move/from16 v18, v3

    move/from16 v19, v5

    .end local v0    # "activateState":I
    .end local v3    # "startVpn":I
    .end local v5    # "isChainingEnabled":I
    .restart local v17    # "activateState":I
    .restart local v18    # "startVpn":I
    .restart local v19    # "isChainingEnabled":I
    :try_start_154
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v0, :cond_177

    const-string v0, "KnoxVpnEngineService"

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "startVpnProfile : keepOn =  "

    invoke-virtual {v3, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v14}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v5, " / startOnDemand = "

    invoke-virtual {v3, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v10}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7278
    :cond_177
    if-nez v14, :cond_182

    if-eqz v10, :cond_17c

    goto :goto_182

    .line 7293
    :cond_17c
    if-eqz v6, :cond_1f9

    .line 7294
    const/16 v3, 0x12f

    .end local v18    # "startVpn":I
    .restart local v3    # "startVpn":I
    goto/16 :goto_1fb

    .line 7279
    .end local v3    # "startVpn":I
    .restart local v18    # "startVpn":I
    :cond_182
    :goto_182
    invoke-interface {v8, v2}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->startConnection(Ljava/lang/String;)I

    move-result v0
    :try_end_186
    .catch Ljava/lang/Exception; {:try_start_154 .. :try_end_186} :catch_1ef
    .catchall {:try_start_154 .. :try_end_186} :catchall_242

    move v3, v0

    .line 7280
    .end local v18    # "startVpn":I
    .restart local v3    # "startVpn":I
    :try_start_187
    const-string v0, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    move/from16 v16, v6

    .end local v6    # "notStartOnDemand":Z
    .local v16, "notStartOnDemand":Z
    const-string/jumbo v6, "startVpnProfile: start result : "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7281
    if-eqz v3, :cond_1ca

    .line 7282
    const/16 v20, 0x3

    const/16 v21, 0x5

    const/16 v22, 0x0

    .line 7283
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v23

    const-string v24, "KnoxVpnEngineService"

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Error trying to start vpn connection for profile "

    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v25

    .line 7285
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v26

    .line 7282
    invoke-static/range {v20 .. v26}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_1c6
    .catch Ljava/lang/Exception; {:try_start_187 .. :try_end_1c6} :catch_5e
    .catchall {:try_start_187 .. :try_end_1c6} :catchall_242

    .line 7286
    const/16 v0, 0x66

    monitor-exit p0

    return v0

    .line 7289
    :cond_1ca
    const/16 v20, 0x5

    const/16 v21, 0x5

    const/16 v22, 0x1

    .line 7290
    :try_start_1d0
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v23

    const-string v24, "KnoxVpnEngineService"

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Connection established for vpn profile "

    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v25

    .line 7292
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v26

    .line 7289
    invoke-static/range {v20 .. v26}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_1ee
    .catch Ljava/lang/Exception; {:try_start_1d0 .. :try_end_1ee} :catch_5e
    .catchall {:try_start_1d0 .. :try_end_1ee} :catchall_242

    goto :goto_1fb

    .line 7297
    .end local v3    # "startVpn":I
    .end local v7    # "size":I
    .end local v8    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v9    # "state":I
    .end local v10    # "startOnDemand":Z
    .end local v11    # "active":I
    .end local v12    # "vpnConnectionType":I
    .end local v13    # "notAllowed":Z
    .end local v14    # "keepOn":Z
    .end local v15    # "isRunning":Z
    .end local v16    # "notStartOnDemand":Z
    .end local v17    # "activateState":I
    .end local v19    # "isChainingEnabled":I
    .restart local v18    # "startVpn":I
    :catch_1ef
    move-exception v0

    move/from16 v3, v18

    goto :goto_204

    .line 7255
    .end local v18    # "startVpn":I
    .restart local v0    # "activateState":I
    .restart local v3    # "startVpn":I
    .restart local v5    # "isChainingEnabled":I
    .restart local v7    # "size":I
    .restart local v8    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :cond_1f3
    move/from16 v17, v0

    move/from16 v18, v3

    move/from16 v19, v5

    .line 7303
    .end local v0    # "activateState":I
    .end local v3    # "startVpn":I
    .end local v5    # "isChainingEnabled":I
    .end local v7    # "size":I
    .end local v8    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .restart local v18    # "startVpn":I
    :cond_1f9
    move/from16 v3, v18

    .end local v18    # "startVpn":I
    .restart local v3    # "startVpn":I
    :goto_1fb
    goto :goto_240

    .line 7251
    .restart local v0    # "activateState":I
    .restart local v5    # "isChainingEnabled":I
    .restart local v7    # "size":I
    :cond_1fc
    move/from16 v17, v0

    .end local v0    # "activateState":I
    .restart local v17    # "activateState":I
    monitor-exit p0

    const/4 v0, 0x0

    return v0

    .line 7297
    .end local v5    # "isChainingEnabled":I
    .end local v7    # "size":I
    .end local v17    # "activateState":I
    :catch_201
    move-exception v0

    move/from16 v18, v3

    .line 7298
    .local v0, "e":Ljava/lang/Exception;
    :goto_204
    const/4 v5, 0x3

    const/4 v6, 0x5

    const/4 v7, 0x0

    .line 7299
    :try_start_207
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v8

    const-string v9, "KnoxVpnEngineService"

    new-instance v10, Ljava/lang/StringBuilder;

    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V

    const-string v11, "Exception trying to start vpn profile "

    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v10

    .line 7301
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v11

    .line 7298
    invoke-static/range {v5 .. v11}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 7302
    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "startVpnProfile : Exception : "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_240
    .catchall {:try_start_207 .. :try_end_240} :catchall_242

    .line 7304
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_240
    monitor-exit p0

    return v3

    .line 7202
    .end local v3    # "startVpn":I
    .end local v4    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local p1    # "profileName":Ljava/lang/String;
    :catchall_242
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method private stopStrongwanProxyConnection(Ljava/lang/String;Ljava/lang/String;I)V
    .registers 7
    .param p1, "vendorPkgName"    # Ljava/lang/String;
    .param p2, "vendorNameWithCid"    # Ljava/lang/String;
    .param p3, "userID"    # I

    .line 8173
    :try_start_0
    const-string v0, "com.samsung.sVpn"

    invoke-virtual {p1, v0}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v0

    if-eqz v0, :cond_2d

    .line 8174
    invoke-direct {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getActiveProfilesForVendor(Ljava/lang/String;)Ljava/util/List;

    move-result-object v0

    if-eqz v0, :cond_2d

    invoke-direct {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getActiveProfilesForVendor(Ljava/lang/String;)Ljava/util/List;

    move-result-object v0

    invoke-interface {v0}, Ljava/util/List;->size()I

    move-result v0
    :try_end_16
    .catch Ljava/lang/Exception; {:try_start_0 .. :try_end_16} :catch_2e

    if-lez v0, :cond_2d

    .line 8175
    const-string v0, "[Legacy VPN]"

    if-nez p3, :cond_24

    .line 8176
    :try_start_1c
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getConnectivityManagerService()Landroid/net/IConnectivityManager;

    move-result-object v1

    invoke-interface {v1, v0, v0, p3}, Landroid/net/IConnectivityManager;->prepareVpn(Ljava/lang/String;Ljava/lang/String;I)Z

    goto :goto_2d

    .line 8177
    :cond_24
    if-lez p3, :cond_2d

    .line 8178
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getConnectivityManagerService()Landroid/net/IConnectivityManager;

    move-result-object v1

    invoke-interface {v1, p3, v0, v0}, Landroid/net/IConnectivityManager;->stopLegacyKnoxVpn(ILjava/lang/String;Ljava/lang/String;)V
    :try_end_2d
    .catch Ljava/lang/Exception; {:try_start_1c .. :try_end_2d} :catch_2e

    .line 8184
    :cond_2d
    :goto_2d
    goto :goto_49

    .line 8182
    :catch_2e
    move-exception v0

    .line 8183
    .local v0, "e":Ljava/lang/Exception;
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string v2, "Exception occured at stopStrongwanProxyConnection API "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    const-string v2, "KnoxVpnEngineService"

    invoke-static {v2, v1}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 8185
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_49
    return-void
.end method

.method private declared-synchronized stopVpnConnectionAfterAdminRemoval(I)V
    .registers 29
    .param p1, "uid"    # I

    move-object/from16 v1, p0

    move/from16 v2, p1

    monitor-enter p0

    .line 4857
    :try_start_5
    const-string v0, "KnoxVpnEngineService"

    const-string/jumbo v3, "stopVpnConnectionAfterAdminRemoval :  beginning"

    invoke-static {v0, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_d
    .catchall {:try_start_5 .. :try_end_d} :catchall_20a

    .line 4858
    const/4 v3, 0x0

    .line 4859
    .local v3, "profileName":Ljava/lang/String;
    const/4 v4, -0x1

    .line 4861
    .local v4, "adminUid":I
    :try_start_f
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v5, "VpnProfileInfo"

    const-string/jumbo v6, "profileName"

    const-string v7, "adminUid"

    filled-new-array {v6, v7}, [Ljava/lang/String;

    move-result-object v6

    const/4 v7, 0x0

    invoke-virtual {v0, v5, v7, v7, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v0

    move-object v5, v0

    .line 4863
    .local v5, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    const-string v0, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "stopVpnConnectionAfterAdminRemoval :  got cvList from DB : "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v0, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4864
    if-eqz v5, :cond_1af

    invoke-virtual {v5}, Ljava/util/ArrayList;->size()I

    move-result v0

    if-lez v0, :cond_1af

    .line 4865
    invoke-virtual {v5}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v6

    :goto_45
    invoke-interface {v6}, Ljava/util/Iterator;->hasNext()Z

    move-result v0

    if-eqz v0, :cond_1af

    invoke-interface {v6}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Landroid/content/ContentValues;

    move-object v7, v0

    .line 4866
    .local v7, "cv":Landroid/content/ContentValues;
    const-string/jumbo v0, "profileName"

    invoke-virtual {v7, v0}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v0

    move-object v3, v0

    .line 4867
    const-string v0, "adminUid"

    invoke-virtual {v7, v0}, Landroid/content/ContentValues;->getAsInteger(Ljava/lang/String;)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v0}, Ljava/lang/Integer;->intValue()I

    move-result v0

    move v4, v0

    .line 4868
    const-string v0, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "stopVpnConnectionAfterAdminRemoval :  checking profile : "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v9, " admin: "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v0, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4869
    if-ne v4, v2, :cond_1ad

    .line 4870
    const-string v0, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "stopVpnConnectionAfterAdminRemoval :   admin matched: "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v0, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4871
    const-string v0, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "stopVpnConnectionAfterAdminRemoval :  removing hashmap and db: "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v0, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4872
    invoke-virtual {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v0

    move-object v8, v0

    .line 4873
    .local v8, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    const-string v0, "KnoxVpnEngineService"

    new-instance v9, Ljava/lang/StringBuilder;

    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v10, "stopVpnConnectionAfterAdminRemoval :  vpnInterface: "

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v9

    invoke-static {v0, v9}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4874
    if-eqz v8, :cond_198

    .line 4875
    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getActivate(Ljava/lang/String;)I

    move-result v0

    move v9, v0

    .line 4876
    .local v9, "isProfileActivated":I
    const/4 v0, 0x1

    if-ne v9, v0, :cond_175

    .line 4877
    invoke-interface {v8, v3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getState(Ljava/lang/String;)I

    move-result v10

    .line 4878
    .local v10, "currentStateOfProfile":I
    const-string v11, "KnoxVpnEngineService"

    new-instance v12, Ljava/lang/StringBuilder;

    invoke-direct {v12}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v13, "stopVpnConnectionAfterAdminRemoval: currentStateOfProfile value is "

    invoke-virtual {v12, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v12, v10}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v12}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v12

    invoke-static {v11, v12}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_f5
    .catch Ljava/lang/Exception; {:try_start_f .. :try_end_f5} :catch_1ec
    .catchall {:try_start_f .. :try_end_f5} :catchall_20a

    .line 4879
    if-ne v10, v0, :cond_fa

    const/4 v0, 0x5

    if-eq v10, v0, :cond_175

    .line 4881
    :cond_fa
    :try_start_fa
    invoke-interface {v8, v3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->stopConnection(Ljava/lang/String;)I

    move-result v0

    .line 4882
    .local v0, "stopConnectionStatus":I
    if-eqz v0, :cond_126

    .line 4883
    const/4 v11, 0x3

    .line 4884
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v14

    const-string v15, "KnoxVpnEngineService"

    new-instance v13, Ljava/lang/StringBuilder;

    invoke-direct {v13}, Ljava/lang/StringBuilder;-><init>()V

    const-string v12, "Error occurred trying to stop vpn connection from profile "

    invoke-virtual {v13, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v18

    .line 4886
    invoke-static/range {p1 .. p1}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v19

    .line 4883
    const/4 v12, 0x5

    const/4 v13, 0x0

    move-object/from16 v16, v18

    move/from16 v17, v19

    invoke-static/range {v11 .. v17}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    goto :goto_14a

    .line 4888
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_126
    const/16 v20, 0x5

    const/16 v21, 0x5

    const/16 v22, 0x1

    .line 4889
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v23

    const-string v24, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string v12, "Connection with vpn vendor service stopped for profile "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v25

    .line 4891
    invoke-static/range {p1 .. p1}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v26

    .line 4888
    invoke-static/range {v20 .. v26}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 4893
    :goto_14a
    const-string v11, "KnoxVpnEngineService"

    new-instance v12, Ljava/lang/StringBuilder;

    invoke-direct {v12}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v13, "stopVpnConnectionAfterAdminRemoval: stopConnectionStatus value is "

    invoke-virtual {v12, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v12, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v12}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v12

    invoke-static {v11, v12}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_161
    .catch Ljava/lang/Exception; {:try_start_fa .. :try_end_161} :catch_162
    .catchall {:try_start_fa .. :try_end_161} :catchall_20a

    .line 4899
    .end local v0    # "stopConnectionStatus":I
    goto :goto_175

    .line 4894
    :catch_162
    move-exception v0

    .line 4895
    .local v0, "e":Ljava/lang/Exception;
    const/4 v11, 0x3

    const/4 v12, 0x5

    const/4 v13, 0x0

    .line 4896
    :try_start_166
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v14

    const-string v15, "KnoxVpnEngineService"

    const-string v16, "Exception stopping vpn connection after admin removal"

    .line 4898
    invoke-static/range {p1 .. p1}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v17

    .line 4895
    invoke-static/range {v11 .. v17}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 4902
    .end local v0    # "e":Ljava/lang/Exception;
    .end local v10    # "currentStateOfProfile":I
    :cond_175
    :goto_175
    const-string v0, "KnoxVpnEngineService"

    const-string/jumbo v10, "stopVpnConnectionAfterAdminRemoval :  Calling remove Connection: "

    invoke-static {v0, v10}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4903
    invoke-interface {v8, v3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->removeConnection(Ljava/lang/String;)I

    move-result v0

    .line 4904
    .local v0, "removeStatus":I
    const-string v10, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v12, "stopVpnConnectionAfterAdminRemoval : remove Connection. Status = "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    invoke-static {v10, v11}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4906
    .end local v0    # "removeStatus":I
    .end local v9    # "isProfileActivated":I
    :cond_198
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0

    .line 4907
    .local v0, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v0, :cond_1a7

    .line 4908
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v9

    invoke-direct {v1, v9, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeExemptRulesForUid(ILjava/lang/String;)V

    .line 4911
    :cond_1a7
    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeAllUidByTAG(Ljava/lang/String;)V

    .line 4913
    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeFromHashMapByProfileName(Ljava/lang/String;)V

    .line 4915
    .end local v0    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v7    # "cv":Landroid/content/ContentValues;
    .end local v8    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :cond_1ad
    goto/16 :goto_45

    .line 4919
    :cond_1af
    if-lez v4, :cond_1eb

    .line 4920
    invoke-static {v4}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v0

    .line 4921
    .local v0, "userId":I
    if-eqz v0, :cond_1eb

    if-ne v4, v2, :cond_1eb

    .line 4923
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const/16 v7, 0x3ea

    invoke-static {v0, v7}, Landroid/os/UserHandle;->getUid(II)I

    move-result v7

    const/4 v8, 0x0

    invoke-virtual {v6, v3, v7, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveSystemAppFromDataSaverWhitelist(Ljava/lang/String;IZ)V

    .line 4925
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mIgnoreConnectCheckForChaining:Ljava/util/concurrent/ConcurrentHashMap;

    if-eqz v6, :cond_1de

    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mIgnoreConnectCheckForChaining:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-virtual {v6, v7}, Ljava/util/concurrent/ConcurrentHashMap;->containsKey(Ljava/lang/Object;)Z

    move-result v6

    if-eqz v6, :cond_1de

    .line 4926
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mIgnoreConnectCheckForChaining:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-virtual {v6, v7}, Ljava/util/concurrent/ConcurrentHashMap;->remove(Ljava/lang/Object;)Ljava/lang/Object;

    .line 4929
    :cond_1de
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v7, "com.android.providers.downloads"

    invoke-virtual {v6, v0, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v6

    .line 4930
    .local v6, "downloadMangerUid":I
    iget-object v7, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v7, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForDownloadManagerUid(I)V
    :try_end_1eb
    .catch Ljava/lang/Exception; {:try_start_166 .. :try_end_1eb} :catch_1ec
    .catchall {:try_start_166 .. :try_end_1eb} :catchall_20a

    .line 4935
    .end local v0    # "userId":I
    .end local v5    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .end local v6    # "downloadMangerUid":I
    :cond_1eb
    goto :goto_208

    .line 4933
    :catch_1ec
    move-exception v0

    .line 4934
    .local v0, "e":Ljava/lang/Exception;
    :try_start_1ed
    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "stop vpn connection after admin remove : Failed "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_208
    .catchall {:try_start_1ed .. :try_end_208} :catchall_20a

    .line 4936
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_208
    monitor-exit p0

    return-void

    .line 4856
    .end local v3    # "profileName":Ljava/lang/String;
    .end local v4    # "adminUid":I
    .end local p1    # "uid":I
    :catchall_20a
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method private stopVpnConnectionForAirplaneMode()V
    .registers 14

    .line 5605
    const-string v0, "Airplane Mode: Stopping connection for "

    const-string v1, "KnoxVpnEngineService"

    const/4 v2, 0x0

    .line 5607
    .local v2, "personaId":I
    :try_start_5
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v3

    invoke-interface {v3}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v3

    :goto_f
    invoke-interface {v3}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_82

    invoke-interface {v3}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 5608
    .local v4, "p":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v11
    :try_end_1f
    .catch Ljava/lang/Exception; {:try_start_5 .. :try_end_1f} :catch_83

    .line 5609
    .end local v2    # "personaId":I
    .local v11, "personaId":I
    :try_start_1f
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v2

    const/4 v5, 0x1

    if-ne v2, v5, :cond_7e

    .line 5610
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v2

    .line 5611
    .local v2, "profileName":Ljava/lang/String;
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v5, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v1, v5}, Landroid/util/Log;->i(Ljava/lang/String;Ljava/lang/String;)I

    .line 5612
    const/4 v5, 0x5

    const/4 v6, 0x5

    const/4 v7, 0x0

    .line 5613
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v8

    const-string v9, "KnoxVpnEngineService"

    new-instance v10, Ljava/lang/StringBuilder;

    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V

    const-string v12, "Airplane Mode: Stopping connection for profile "

    invoke-virtual {v10, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v10

    .line 5612
    invoke-static/range {v5 .. v11}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 5616
    invoke-virtual {p0, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v5

    .line 5617
    .local v5, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    const/4 v6, -0x1

    .line 5618
    .local v6, "ret":I
    if-eqz v5, :cond_65

    .line 5619
    invoke-interface {v5, v2}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->stopConnection(Ljava/lang/String;)I

    move-result v7

    move v6, v7

    .line 5621
    :cond_65
    if-eqz v6, :cond_7e

    .line 5622
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v7, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v8, " failed!!"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v1, v7}, Landroid/util/Log;->i(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_7e
    .catch Ljava/lang/Exception; {:try_start_1f .. :try_end_7e} :catch_80

    .line 5625
    .end local v2    # "profileName":Ljava/lang/String;
    .end local v4    # "p":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v5    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v6    # "ret":I
    :cond_7e
    move v2, v11

    goto :goto_f

    .line 5626
    :catch_80
    move-exception v0

    goto :goto_85

    .line 5632
    .end local v11    # "personaId":I
    .local v2, "personaId":I
    :cond_82
    goto :goto_9a

    .line 5626
    :catch_83
    move-exception v0

    move v11, v2

    .line 5627
    .end local v2    # "personaId":I
    .local v0, "e":Ljava/lang/Exception;
    .restart local v11    # "personaId":I
    :goto_85
    const/4 v2, 0x3

    const/4 v3, 0x5

    const/4 v4, 0x0

    .line 5628
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v5

    .line 5627
    const-string v6, "KnoxVpnEngineService"

    const-string v7, "Exception stopping vpn connection for airplane mode"

    move v8, v11

    invoke-static/range {v2 .. v8}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 5631
    const-string v2, "Airplane Mode: ACTION_AIRPLANE_MODE_CHANGED Exception"

    invoke-static {v1, v2, v0}, Landroid/util/Log;->i(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I

    move v2, v11

    .line 5633
    .end local v0    # "e":Ljava/lang/Exception;
    .end local v11    # "personaId":I
    .restart local v2    # "personaId":I
    :goto_9a
    return-void
.end method

.method private declared-synchronized stopVpnConnectionForClient(I)V
    .registers 14
    .param p1, "vpnClient"    # I

    monitor-enter p0

    .line 5117
    :try_start_1
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v0

    invoke-interface {v0}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_b
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_9a

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 5118
    .local v1, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v2

    if-eq v2, p1, :cond_1e

    goto :goto_b

    .line 5119
    :cond_1e
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v2

    .line 5120
    .local v2, "profileName":Ljava/lang/String;
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "stopping the vpn connection for the profile due to system restriction"

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string/jumbo v5, "vpnClient: "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5121
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v3

    if-nez v3, :cond_49

    .line 5122
    goto :goto_b

    .line 5124
    :cond_49
    invoke-virtual {p0, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v3

    .line 5125
    .local v3, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-eqz v3, :cond_98

    .line 5126
    invoke-interface {v3, v2}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->stopConnection(Ljava/lang/String;)I

    move-result v4

    .line 5127
    .local v4, "stopStatus":I
    if-eqz v4, :cond_77

    .line 5128
    const/4 v5, 0x3

    const/4 v6, 0x5

    const/4 v7, 0x0

    .line 5129
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v8

    const-string v9, "KnoxVpnEngineService"

    new-instance v10, Ljava/lang/StringBuilder;

    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V

    const-string v11, "Error occurred trying to stop vpn connection from profile "

    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v10

    .line 5131
    invoke-static {p1}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v11

    .line 5128
    invoke-static/range {v5 .. v11}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    goto :goto_98

    .line 5133
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_77
    const/4 v5, 0x5

    const/4 v6, 0x5

    const/4 v7, 0x1

    .line 5134
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v8

    const-string v9, "KnoxVpnEngineService"

    new-instance v10, Ljava/lang/StringBuilder;

    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V

    const-string v11, "Connection with vpn vendor service stopped for profile "

    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v10

    .line 5136
    invoke-static {p1}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v11

    .line 5133
    invoke-static/range {v5 .. v11}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_98
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_98} :catch_9d
    .catchall {:try_start_1 .. :try_end_98} :catchall_9b

    .line 5139
    .end local v1    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v2    # "profileName":Ljava/lang/String;
    .end local v3    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v4    # "stopStatus":I
    :cond_98
    :goto_98
    goto/16 :goto_b

    .line 5146
    :cond_9a
    goto :goto_d9

    .line 5116
    .end local p1    # "vpnClient":I
    :catchall_9b
    move-exception p1

    goto :goto_db

    .line 5140
    .restart local p1    # "vpnClient":I
    :catch_9d
    move-exception v0

    .line 5141
    .local v0, "e":Ljava/lang/Exception;
    const/4 v1, 0x3

    const/4 v2, 0x5

    const/4 v3, 0x0

    .line 5142
    :try_start_a1
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v4

    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "Exception stopping vpn connection for client with uid "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    .line 5144
    invoke-static {p1}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v7

    .line 5141
    invoke-static/range {v1 .. v7}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 5145
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception occured while trying to stopping the vpn connection due to system restriction"

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_d9
    .catchall {:try_start_a1 .. :try_end_d9} :catchall_9b

    .line 5147
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_d9
    monitor-exit p0

    return-void

    .line 5116
    .end local p1    # "vpnClient":I
    :goto_db
    monitor-exit p0

    throw p1
.end method

.method private syncVpnProfile(Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;Ljava/lang/String;)V
    .registers 9
    .param p1, "vpnInterface"    # Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .param p2, "profileName"    # Ljava/lang/String;

    .line 7843
    const-string v0, "KnoxVpnEngineService"

    const-string v1, "Start syncProfile between VPNDB and Vendor\'s"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7844
    const/4 v1, 0x0

    .line 7845
    .local v1, "profileNameinVendor":Ljava/lang/String;
    const/4 v2, 0x0

    .line 7847
    .local v2, "jsonProfile":Ljava/lang/String;
    :try_start_9
    invoke-interface {p1, p2}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getConnection(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v3

    move-object v2, v3

    .line 7848
    if-eqz v2, :cond_2f

    .line 7849
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getProfileNameFromJsonString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v3

    move-object v1, v3

    .line 7850
    invoke-interface {p1, v1}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->removeConnection(Ljava/lang/String;)I

    move-result v3

    .line 7851
    .local v3, "removeStatus":I
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Profile in VendorDB is removed successfullyStatus of remove: "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_2f
    .catch Ljava/lang/Exception; {:try_start_9 .. :try_end_2f} :catch_30

    .line 7856
    .end local v3    # "removeStatus":I
    :cond_2f
    goto :goto_49

    .line 7854
    :catch_30
    move-exception v3

    .line 7855
    .local v3, "e":Ljava/lang/Exception;
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Sync the profile : Failure at "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v3}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 7857
    .end local v3    # "e":Ljava/lang/Exception;
    :goto_49
    return-void
.end method

.method private unregisterFilterList()V
    .registers 6

    .line 5205
    const-string v0, "KnoxVpnEngineService"

    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v1

    .line 5207
    .local v1, "token":J
    :try_start_6
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->receiver:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;

    if-eqz v3, :cond_17

    .line 5208
    const-string/jumbo v3, "unregistering VpnReceiver is successful"

    invoke-static {v0, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 5209
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->receiver:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;

    invoke-virtual {v3, v4}, Landroid/content/Context;->unregisterReceiver(Landroid/content/BroadcastReceiver;)V

    .line 5211
    :cond_17
    const/4 v3, 0x0

    iput-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->receiver:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$VpnReceiver;
    :try_end_1a
    .catch Ljava/lang/Exception; {:try_start_6 .. :try_end_1a} :catch_21
    .catchall {:try_start_6 .. :try_end_1a} :catchall_1f

    .line 5215
    nop

    :goto_1b
    invoke-static {v1, v2}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 5216
    goto :goto_29

    .line 5215
    :catchall_1f
    move-exception v0

    goto :goto_2a

    .line 5212
    :catch_21
    move-exception v3

    .line 5213
    .local v3, "e":Ljava/lang/Exception;
    :try_start_22
    const-string v4, "Error occured while trying to unregister the reciever"

    invoke-static {v0, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_27
    .catchall {:try_start_22 .. :try_end_27} :catchall_1f

    .line 5215
    nop

    .end local v3    # "e":Ljava/lang/Exception;
    goto :goto_1b

    .line 5217
    :goto_29
    return-void

    .line 5215
    :goto_2a
    invoke-static {v1, v2}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 5216
    throw v0
.end method

.method private unsetDnsSystemProperty(Ljava/lang/String;II)V
    .registers 13
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "uidStart"    # I
    .param p3, "uidEnd"    # I

    .line 7340
    const-string v0, "KnoxVpnEngineService"

    if-eqz p1, :cond_c5

    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getNetworkManagementService()Landroid/os/INetworkManagementService;

    move-result-object v1

    if-eqz v1, :cond_c5

    .line 7341
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v1

    .line 7343
    .local v1, "token":J
    :try_start_e
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v3, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v3

    .line 7344
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v3, :cond_a3

    .line 7345
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v4

    if-eqz v4, :cond_a3

    .line 7346
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_26

    const-string/jumbo v4, "unsetDnsSystemProperty: interface name is not null"

    invoke-static {v0, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7347
    :cond_26
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v4

    .line 7349
    .local v4, "interfaceName":Ljava/lang/String;
    const-string/jumbo v5, "tun"

    invoke-virtual {v4, v5}, Ljava/lang/String;->contains(Ljava/lang/CharSequence;)Z

    move-result v5

    if-nez v5, :cond_36

    .line 7350
    const/16 v5, 0x64

    .local v5, "netId":I
    goto :goto_49

    .line 7352
    .end local v5    # "netId":I
    :cond_36
    const/4 v5, 0x3

    invoke-virtual {v4, v5}, Ljava/lang/String;->substring(I)Ljava/lang/String;

    move-result-object v6

    invoke-static {v6}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I

    move-result v6

    .line 7353
    .local v6, "passedinterfaceID":I
    invoke-virtual {v4, v5}, Ljava/lang/String;->substring(I)Ljava/lang/String;

    move-result-object v5

    invoke-static {v5}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I

    move-result v5

    add-int/lit8 v5, v5, 0x65

    .line 7355
    .end local v6    # "passedinterfaceID":I
    .restart local v5    # "netId":I
    :goto_49
    sget-boolean v6, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v6, :cond_83

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "unsetDnsSystemProperty is reached : whose profileName is "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string/jumbo v7, "whose start uid is "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v7, " whose stop uid is "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, p3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v7, " whose interface "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v7, " whose netId is "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v5}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v0, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7357
    :cond_83
    new-instance v6, Ljava/util/ArrayList;

    invoke-direct {v6}, Ljava/util/ArrayList;-><init>()V

    .line 7358
    .local v6, "uidList":Ljava/util/List;, "Ljava/util/List<Landroid/net/UidRange;>;"
    new-instance v7, Landroid/net/UidRange;

    invoke-direct {v7, p2, p3}, Landroid/net/UidRange;-><init>(II)V

    invoke-interface {v6, v7}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 7359
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getNetworkManagementService()Landroid/os/INetworkManagementService;

    move-result-object v7

    invoke-interface {v6}, Ljava/util/List;->size()I

    move-result v8

    new-array v8, v8, [Landroid/net/UidRange;

    invoke-interface {v6, v8}, Ljava/util/List;->toArray([Ljava/lang/Object;)[Ljava/lang/Object;

    move-result-object v8

    check-cast v8, [Landroid/net/UidRange;

    invoke-interface {v7, v5, v8}, Landroid/os/INetworkManagementService;->removeVpnUidRanges(I[Landroid/net/UidRange;)V
    :try_end_a3
    .catch Ljava/lang/Exception; {:try_start_e .. :try_end_a3} :catch_aa
    .catchall {:try_start_e .. :try_end_a3} :catchall_a8

    .line 7366
    .end local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v4    # "interfaceName":Ljava/lang/String;
    .end local v5    # "netId":I
    .end local v6    # "uidList":Ljava/util/List;, "Ljava/util/List<Landroid/net/UidRange;>;"
    :cond_a3
    nop

    :goto_a4
    invoke-static {v1, v2}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7367
    goto :goto_c5

    .line 7366
    :catchall_a8
    move-exception v0

    goto :goto_c1

    .line 7362
    :catch_aa
    move-exception v3

    .line 7363
    .local v3, "e":Ljava/lang/Exception;
    :try_start_ab
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception occured while trying to unset the dns entry for the profile "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_bf
    .catchall {:try_start_ab .. :try_end_bf} :catchall_a8

    .line 7366
    nop

    .end local v3    # "e":Ljava/lang/Exception;
    goto :goto_a4

    :goto_c1
    invoke-static {v1, v2}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7367
    throw v0

    .line 7369
    .end local v1    # "token":J
    :cond_c5
    :goto_c5
    return-void
.end method

.method private updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z
    .registers 4
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "callerUid"    # I

    .line 7497
    iget v0, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-direct {p0, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkIfLegacyUser(I)Z

    move-result v0

    if-nez v0, :cond_a

    .line 7498
    iput p2, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->adminId:I

    .line 7500
    :cond_a
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Z

    move-result v0

    return v0
.end method

.method private updateNotification(Ljava/lang/String;IZ)V
    .registers 11
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "domain"    # I
    .param p3, "flag"    # Z

    .line 7819
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    const-string v1, "KnoxVpnEngineService"

    if-eqz v0, :cond_23

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "updateNotification profileName : "

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v2, " , flag : "

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p3}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7820
    :cond_23
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v2

    .line 7822
    .local v2, "token":J
    :try_start_27
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0
    :try_end_2d
    .catch Ljava/lang/Exception; {:try_start_27 .. :try_end_2d} :catch_4f
    .catchall {:try_start_27 .. :try_end_2d} :catchall_4d

    .line 7823
    .local v0, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v0, :cond_33

    .line 7835
    invoke-static {v2, v3}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7824
    return-void

    .line 7826
    :cond_33
    :try_start_33
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v4

    .line 7828
    .local v4, "activateState":I
    const/4 v5, 0x1

    if-ne v4, v5, :cond_48

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVPNTransitionState(Ljava/lang/String;)I

    move-result v5

    const/4 v6, 0x4

    if-ne v5, v6, :cond_48

    .line 7830
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getConnectivityManagerService()Landroid/net/IConnectivityManager;

    move-result-object v5

    invoke-interface {v5, p1, p2, p3}, Landroid/net/IConnectivityManager;->updateEnterpriseVpn(Ljava/lang/String;IZ)V
    :try_end_48
    .catch Ljava/lang/Exception; {:try_start_33 .. :try_end_48} :catch_4f
    .catchall {:try_start_33 .. :try_end_48} :catchall_4d

    .line 7835
    .end local v0    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v4    # "activateState":I
    :cond_48
    nop

    :goto_49
    invoke-static {v2, v3}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7836
    goto :goto_6b

    .line 7835
    :catchall_4d
    move-exception v0

    goto :goto_6c

    .line 7832
    :catch_4f
    move-exception v0

    .line 7833
    .local v0, "e":Ljava/lang/Exception;
    :try_start_50
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "updateNotification : Exception : "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v1, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_69
    .catchall {:try_start_50 .. :try_end_69} :catchall_4d

    .line 7835
    nop

    .end local v0    # "e":Ljava/lang/Exception;
    goto :goto_49

    .line 7838
    :goto_6b
    return-void

    .line 7835
    :goto_6c
    invoke-static {v2, v3}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7836
    throw v0
.end method

.method private updatePackageData(Ljava/lang/String;I)Z
    .registers 13
    .param p1, "packageName"    # Ljava/lang/String;
    .param p2, "uid"    # I

    .line 4813
    const-string/jumbo v0, "packageUid"

    const-string/jumbo v1, "packageName"

    const-string v2, "VpnPackageInfo"

    const-string v3, "KnoxVpnEngineService"

    const/4 v4, 0x0

    if-eqz p1, :cond_97

    .line 4815
    :try_start_d
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Inside updatePackageData : packageName = "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v3, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4816
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    filled-new-array {v1}, [Ljava/lang/String;

    move-result-object v6

    const/4 v7, 0x1

    new-array v8, v7, [Ljava/lang/String;

    aput-object p1, v8, v4

    const-string/jumbo v9, "profileName"

    filled-new-array {v9, v0}, [Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v5, v2, v6, v8, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v5

    .line 4824
    .local v5, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    if-eqz v5, :cond_7c

    invoke-virtual {v5}, Ljava/util/ArrayList;->size()I

    move-result v6

    if-lez v6, :cond_7c

    .line 4825
    const-string/jumbo v6, "update to package : Cursor not null and data present, so update packageData UID in DB"

    invoke-static {v3, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4826
    new-instance v6, Landroid/content/ContentValues;

    invoke-direct {v6}, Landroid/content/ContentValues;-><init>()V

    .line 4827
    .local v6, "cv":Landroid/content/ContentValues;
    invoke-static {p2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v8

    invoke-virtual {v6, v0, v8}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Integer;)V

    .line 4828
    filled-new-array {v1}, [Ljava/lang/String;

    move-result-object v0

    .line 4831
    .local v0, "columns":[Ljava/lang/String;
    new-array v1, v7, [Ljava/lang/String;

    aput-object p1, v1, v4

    .line 4834
    .local v1, "values":[Ljava/lang/String;
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "update to package : update to package before DB insert:"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    aget-object v8, v1, v4

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    aget-object v8, v0, v4

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v3, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4835
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    invoke-virtual {v7, v2, v0, v1, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->putDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;Landroid/content/ContentValues;)Z

    move-result v2
    :try_end_7b
    .catch Ljava/lang/Exception; {:try_start_d .. :try_end_7b} :catch_7d

    return v2

    .line 4839
    .end local v0    # "columns":[Ljava/lang/String;
    .end local v1    # "values":[Ljava/lang/String;
    .end local v5    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .end local v6    # "cv":Landroid/content/ContentValues;
    :cond_7c
    goto :goto_97

    .line 4837
    :catch_7d
    move-exception v0

    .line 4838
    .local v0, "e":Ljava/lang/Exception;
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "update to package : Exception:"

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v3, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4841
    .end local v0    # "e":Ljava/lang/Exception;
    :cond_97
    :goto_97
    return v4
.end method

.method private updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V
    .registers 28
    .param p1, "action"    # I
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(I",
            "Ljava/lang/String;",
            "Ljava/util/HashMap<",
            "Ljava/lang/Integer;",
            "Ljava/lang/Boolean;",
            ">;)V"
        }
    .end annotation

    .line 8376
    .local p3, "uidList":Ljava/util/HashMap;, "Ljava/util/HashMap<Ljava/lang/Integer;Ljava/lang/Boolean;>;"
    move-object/from16 v15, p0

    move/from16 v13, p1

    move-object/from16 v12, p2

    move-object/from16 v11, p3

    const-string v14, "KnoxVpnEngineService"

    :try_start_a
    iget-object v0, v15, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0

    .line 8377
    .local v0, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v0, :cond_1cc

    .line 8378
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyServer()Ljava/lang/String;

    move-result-object v1

    move-object v10, v1

    .line 8379
    .local v10, "proxyServer":Ljava/lang/String;
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyUsername()Ljava/lang/String;

    move-result-object v1

    move-object/from16 v19, v1

    .line 8380
    .local v19, "proxyUsername":Ljava/lang/String;
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyPassword()Ljava/lang/String;

    move-result-object v1

    move-object/from16 v20, v1

    .line 8381
    .local v20, "proxyPassword":Ljava/lang/String;
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPacurl()Landroid/net/Uri;

    move-result-object v1

    move-object v9, v1

    .line 8382
    .local v9, "pacUrl":Landroid/net/Uri;
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v5

    .line 8383
    .local v5, "vendorUid":I
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyPort()I

    move-result v8

    .line 8384
    .local v8, "proxyPort":I
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v1

    move-object v7, v1

    .line 8386
    .local v7, "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    sget-object v1, Landroid/net/Uri;->EMPTY:Landroid/net/Uri;

    if-ne v9, v1, :cond_42

    sget-object v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->DEFAULT_PROXY_SERVER:Ljava/lang/String;

    if-eq v10, v1, :cond_3e

    goto :goto_42

    :cond_3e
    move-object v7, v11

    move-object v2, v15

    goto/16 :goto_1ce

    .line 8387
    :cond_42
    :goto_42
    const/4 v1, -0x1

    const/4 v2, 0x1

    const/4 v3, 0x0

    if-eqz v13, :cond_175

    if-eq v13, v2, :cond_11c

    const/4 v4, 0x2

    if-eq v13, v4, :cond_a3

    const/4 v1, 0x3

    if-eq v13, v1, :cond_53

    move-object v7, v11

    move-object v2, v15

    goto/16 :goto_1ce

    .line 8417
    :cond_53
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v1

    if-nez v1, :cond_68

    .line 8418
    new-instance v1, Landroid/net/ProxyInfo;

    invoke-direct {v15, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getPortForProfileName(Ljava/lang/String;)I

    move-result v3

    invoke-direct {v1, v9, v3}, Landroid/net/ProxyInfo;-><init>(Landroid/net/Uri;I)V

    .line 8419
    .local v1, "proxyInfo":Landroid/net/ProxyInfo;
    invoke-virtual {v1, v2}, Landroid/net/ProxyInfo;->setKnoxVpnProfile(I)V

    .line 8420
    invoke-virtual {v0, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setProxyInfo(Landroid/net/ProxyInfo;)V

    .line 8422
    .end local v1    # "proxyInfo":Landroid/net/ProxyInfo;
    :cond_68
    if-eqz v11, :cond_99

    invoke-virtual/range {p3 .. p3}, Ljava/util/HashMap;->size()I

    move-result v1

    if-lez v1, :cond_99

    .line 8423
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v6

    .line 8424
    .local v6, "profileProxyInfo":Landroid/net/ProxyInfo;
    new-instance v16, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$2;

    move-object/from16 v1, v16

    move-object/from16 v2, p0

    move-object/from16 v3, p2

    move-object/from16 v4, p3

    move-object/from16 v21, v7

    .end local v7    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .local v21, "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    move-object/from16 v22, v9

    .end local v9    # "pacUrl":Landroid/net/Uri;
    .local v22, "pacUrl":Landroid/net/Uri;
    move-object v9, v10

    move-object/from16 v23, v10

    .end local v10    # "proxyServer":Ljava/lang/String;
    .local v23, "proxyServer":Ljava/lang/String;
    move/from16 v10, p1

    invoke-direct/range {v1 .. v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$2;-><init>(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Ljava/lang/String;Ljava/util/HashMap;ILandroid/net/ProxyInfo;Ljava/util/HashSet;ILjava/lang/String;I)V

    move-object/from16 v1, v16

    .line 8440
    .local v1, "runnable":Ljava/lang/Runnable;
    iget-object v2, v15, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    if-eqz v2, :cond_95

    iget-object v2, v15, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    invoke-virtual {v2, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;->post(Ljava/lang/Runnable;)Z
    :try_end_95
    .catch Ljava/lang/Exception; {:try_start_a .. :try_end_95} :catch_1cf

    .line 8441
    .end local v1    # "runnable":Ljava/lang/Runnable;
    .end local v6    # "profileProxyInfo":Landroid/net/ProxyInfo;
    :cond_95
    move-object v7, v11

    move-object v2, v15

    goto/16 :goto_1ce

    .line 8422
    .end local v21    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v22    # "pacUrl":Landroid/net/Uri;
    .end local v23    # "proxyServer":Ljava/lang/String;
    .restart local v7    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v9    # "pacUrl":Landroid/net/Uri;
    .restart local v10    # "proxyServer":Ljava/lang/String;
    :cond_99
    move-object/from16 v21, v7

    move-object/from16 v22, v9

    move-object/from16 v23, v10

    .end local v7    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v9    # "pacUrl":Landroid/net/Uri;
    .end local v10    # "proxyServer":Ljava/lang/String;
    .restart local v21    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v22    # "pacUrl":Landroid/net/Uri;
    .restart local v23    # "proxyServer":Ljava/lang/String;
    move-object v7, v11

    move-object v2, v15

    goto/16 :goto_1ce

    .line 8470
    .end local v21    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v22    # "pacUrl":Landroid/net/Uri;
    .end local v23    # "proxyServer":Ljava/lang/String;
    .restart local v7    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v9    # "pacUrl":Landroid/net/Uri;
    .restart local v10    # "proxyServer":Ljava/lang/String;
    :cond_a3
    move-object/from16 v21, v7

    move-object/from16 v22, v9

    move-object/from16 v23, v10

    .end local v7    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v9    # "pacUrl":Landroid/net/Uri;
    .end local v10    # "proxyServer":Ljava/lang/String;
    .restart local v21    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v22    # "pacUrl":Landroid/net/Uri;
    .restart local v23    # "proxyServer":Ljava/lang/String;
    if-eqz v11, :cond_115

    :try_start_ab
    invoke-virtual/range {p3 .. p3}, Ljava/util/HashMap;->size()I

    move-result v4

    if-lez v4, :cond_115

    .line 8471
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageCount()I

    move-result v4

    invoke-virtual/range {p3 .. p3}, Ljava/util/HashMap;->size()I

    move-result v6
    :try_end_b9
    .catch Ljava/lang/Exception; {:try_start_ab .. :try_end_b9} :catch_110

    if-ne v4, v6, :cond_de

    .line 8472
    :try_start_bb
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_c4

    const-string v4, "The admin has removed all the apps from the profile, setting the default PAC proxy configuration"

    invoke-static {v14, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8473
    :cond_c4
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v4

    invoke-virtual {v4}, Landroid/net/ProxyInfo;->getPort()I

    move-result v4

    .line 8474
    .local v4, "localPort":I
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnPacProcessor()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v6

    .line 8475
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v7

    invoke-virtual {v7, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getListOfUid(Ljava/lang/String;)Ljava/util/HashMap;

    move-result-object v7

    .line 8474
    invoke-virtual {v6, v12, v2, v4, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->updatePermissionForAppsToaccessLocalHost(Ljava/lang/String;IILjava/util/HashMap;)V

    .line 8476
    invoke-virtual {v0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setProxyInfo(Landroid/net/ProxyInfo;)V
    :try_end_de
    .catch Ljava/lang/Exception; {:try_start_bb .. :try_end_de} :catch_1cf

    .line 8478
    .end local v4    # "localPort":I
    :cond_de
    :try_start_de
    new-instance v2, Landroid/net/ProxyInfo;

    invoke-direct {v2, v3, v1, v3}, Landroid/net/ProxyInfo;-><init>(Ljava/lang/String;ILjava/lang/String;)V
    :try_end_e3
    .catch Ljava/lang/Exception; {:try_start_de .. :try_end_e3} :catch_110

    move-object v4, v14

    move-object v14, v2

    .line 8480
    .local v14, "profileProxyInfo":Landroid/net/ProxyInfo;
    move-object/from16 v6, v21

    .end local v21    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .local v6, "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    :try_start_e7
    invoke-direct {v15, v13, v11, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkExistsEmailPackageInProfiles(ILjava/util/HashMap;Ljava/util/HashSet;)V

    .line 8481
    new-instance v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$4;
    :try_end_ec
    .catch Ljava/lang/Exception; {:try_start_e7 .. :try_end_ec} :catch_10b

    move-object v9, v1

    move-object/from16 v10, p0

    move-object v7, v11

    move-object/from16 v11, p2

    move-object v3, v12

    move-object/from16 v12, p3

    move v2, v13

    move v13, v5

    move-object v2, v15

    move-object v15, v6

    move/from16 v16, v8

    move-object/from16 v17, v23

    :try_start_fd
    invoke-direct/range {v9 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$4;-><init>(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Ljava/lang/String;Ljava/util/HashMap;ILandroid/net/ProxyInfo;Ljava/util/HashSet;ILjava/lang/String;)V

    .line 8495
    .restart local v1    # "runnable":Ljava/lang/Runnable;
    iget-object v9, v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    if-eqz v9, :cond_109

    iget-object v9, v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    invoke-virtual {v9, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;->post(Ljava/lang/Runnable;)Z

    .line 8496
    .end local v1    # "runnable":Ljava/lang/Runnable;
    .end local v14    # "profileProxyInfo":Landroid/net/ProxyInfo;
    :cond_109
    goto/16 :goto_1ce

    .line 8503
    .end local v0    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v5    # "vendorUid":I
    .end local v6    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v8    # "proxyPort":I
    .end local v19    # "proxyUsername":Ljava/lang/String;
    .end local v20    # "proxyPassword":Ljava/lang/String;
    .end local v22    # "pacUrl":Landroid/net/Uri;
    .end local v23    # "proxyServer":Ljava/lang/String;
    :catch_10b
    move-exception v0

    move-object v7, v11

    move-object v3, v12

    goto/16 :goto_1d2

    :catch_110
    move-exception v0

    move-object v7, v11

    move-object v3, v12

    goto/16 :goto_1d1

    .line 8470
    .restart local v0    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v5    # "vendorUid":I
    .restart local v8    # "proxyPort":I
    .restart local v19    # "proxyUsername":Ljava/lang/String;
    .restart local v20    # "proxyPassword":Ljava/lang/String;
    .restart local v21    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v22    # "pacUrl":Landroid/net/Uri;
    .restart local v23    # "proxyServer":Ljava/lang/String;
    :cond_115
    move-object v7, v11

    move-object v3, v12

    move-object v2, v15

    move-object/from16 v6, v21

    .end local v21    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v6    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    goto/16 :goto_1ce

    .line 8390
    .end local v6    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v22    # "pacUrl":Landroid/net/Uri;
    .end local v23    # "proxyServer":Ljava/lang/String;
    .restart local v7    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v9    # "pacUrl":Landroid/net/Uri;
    .restart local v10    # "proxyServer":Ljava/lang/String;
    :cond_11c
    move-object v6, v7

    move-object/from16 v22, v9

    move-object/from16 v23, v10

    move-object v7, v11

    move-object v3, v12

    move v1, v13

    move-object v4, v14

    move v9, v2

    move-object v2, v15

    .end local v7    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v9    # "pacUrl":Landroid/net/Uri;
    .end local v10    # "proxyServer":Ljava/lang/String;
    .restart local v6    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v22    # "pacUrl":Landroid/net/Uri;
    .restart local v23    # "proxyServer":Ljava/lang/String;
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v10

    if-nez v10, :cond_13f

    .line 8391
    new-instance v10, Landroid/net/ProxyInfo;

    invoke-direct {v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getPortForProfileName(Ljava/lang/String;)I

    move-result v11

    move-object/from16 v15, v22

    .end local v22    # "pacUrl":Landroid/net/Uri;
    .local v15, "pacUrl":Landroid/net/Uri;
    invoke-direct {v10, v15, v11}, Landroid/net/ProxyInfo;-><init>(Landroid/net/Uri;I)V

    .line 8392
    .local v10, "proxyInfo":Landroid/net/ProxyInfo;
    invoke-virtual {v10, v9}, Landroid/net/ProxyInfo;->setKnoxVpnProfile(I)V

    .line 8393
    invoke-virtual {v0, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setProxyInfo(Landroid/net/ProxyInfo;)V

    goto :goto_141

    .line 8390
    .end local v10    # "proxyInfo":Landroid/net/ProxyInfo;
    .end local v15    # "pacUrl":Landroid/net/Uri;
    .restart local v22    # "pacUrl":Landroid/net/Uri;
    :cond_13f
    move-object/from16 v15, v22

    .line 8395
    .end local v22    # "pacUrl":Landroid/net/Uri;
    .restart local v15    # "pacUrl":Landroid/net/Uri;
    :goto_141
    if-eqz v7, :cond_171

    invoke-virtual/range {p3 .. p3}, Ljava/util/HashMap;->size()I

    move-result v9

    if-lez v9, :cond_171

    .line 8396
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v14

    .line 8397
    .restart local v14    # "profileProxyInfo":Landroid/net/ProxyInfo;
    new-instance v21, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$1;

    move-object/from16 v9, v21

    move-object/from16 v10, p0

    move-object/from16 v11, p2

    move-object/from16 v12, p3

    move v13, v5

    move-object/from16 v22, v15

    .end local v15    # "pacUrl":Landroid/net/Uri;
    .restart local v22    # "pacUrl":Landroid/net/Uri;
    move-object v15, v6

    move/from16 v16, v8

    move-object/from16 v17, v23

    move/from16 v18, p1

    invoke-direct/range {v9 .. v18}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$1;-><init>(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Ljava/lang/String;Ljava/util/HashMap;ILandroid/net/ProxyInfo;Ljava/util/HashSet;ILjava/lang/String;I)V

    move-object/from16 v9, v21

    .line 8413
    .local v9, "runnable":Ljava/lang/Runnable;
    iget-object v10, v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    if-eqz v10, :cond_16f

    iget-object v10, v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    invoke-virtual {v10, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;->post(Ljava/lang/Runnable;)Z

    .line 8414
    .end local v9    # "runnable":Ljava/lang/Runnable;
    .end local v14    # "profileProxyInfo":Landroid/net/ProxyInfo;
    :cond_16f
    goto/16 :goto_1ce

    .line 8395
    .end local v22    # "pacUrl":Landroid/net/Uri;
    .restart local v15    # "pacUrl":Landroid/net/Uri;
    :cond_171
    move-object/from16 v22, v15

    .end local v15    # "pacUrl":Landroid/net/Uri;
    .restart local v22    # "pacUrl":Landroid/net/Uri;
    goto/16 :goto_1ce

    .line 8444
    .end local v6    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v22    # "pacUrl":Landroid/net/Uri;
    .end local v23    # "proxyServer":Ljava/lang/String;
    .restart local v7    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .local v9, "pacUrl":Landroid/net/Uri;
    .local v10, "proxyServer":Ljava/lang/String;
    :cond_175
    move-object v6, v7

    move-object/from16 v22, v9

    move-object/from16 v23, v10

    move-object v7, v11

    move-object v4, v14

    move v9, v2

    move-object v2, v15

    move v15, v13

    move-object v13, v12

    .end local v7    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v9    # "pacUrl":Landroid/net/Uri;
    .end local v10    # "proxyServer":Ljava/lang/String;
    .restart local v6    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v22    # "pacUrl":Landroid/net/Uri;
    .restart local v23    # "proxyServer":Ljava/lang/String;
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v10

    invoke-virtual {v10}, Landroid/net/ProxyInfo;->getPort()I

    move-result v10

    move v12, v10

    .line 8445
    .local v12, "localProxyPort":I
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnPacProcessor()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v10

    .line 8446
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v11

    invoke-virtual {v11, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getListOfUid(Ljava/lang/String;)Ljava/util/HashMap;

    move-result-object v11

    .line 8445
    invoke-virtual {v10, v13, v9, v12, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->updatePermissionForAppsToaccessLocalHost(Ljava/lang/String;IILjava/util/HashMap;)V

    .line 8447
    invoke-virtual {v0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setProxyInfo(Landroid/net/ProxyInfo;)V

    .line 8448
    if-eqz v7, :cond_1c8

    invoke-virtual/range {p3 .. p3}, Ljava/util/HashMap;->size()I

    move-result v9

    if-lez v9, :cond_1c8

    .line 8449
    new-instance v14, Landroid/net/ProxyInfo;

    invoke-direct {v14, v3, v1, v3}, Landroid/net/ProxyInfo;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    .line 8451
    .restart local v14    # "profileProxyInfo":Landroid/net/ProxyInfo;
    invoke-direct {v2, v15, v7, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkExistsEmailPackageInProfiles(ILjava/util/HashMap;Ljava/util/HashSet;)V

    .line 8452
    new-instance v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$3;

    move-object v9, v1

    move-object/from16 v10, p0

    move-object/from16 v11, p2

    move v3, v12

    .end local v12    # "localProxyPort":I
    .local v3, "localProxyPort":I
    move-object/from16 v12, p3

    move v13, v5

    move-object v15, v6

    move/from16 v16, v8

    move-object/from16 v17, v23

    invoke-direct/range {v9 .. v17}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$3;-><init>(Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;Ljava/lang/String;Ljava/util/HashMap;ILandroid/net/ProxyInfo;Ljava/util/HashSet;ILjava/lang/String;)V

    .line 8466
    .restart local v1    # "runnable":Ljava/lang/Runnable;
    iget-object v9, v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    if-eqz v9, :cond_1c7

    iget-object v9, v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    invoke-virtual {v9, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;->post(Ljava/lang/Runnable;)Z
    :try_end_1c7
    .catch Ljava/lang/Exception; {:try_start_fd .. :try_end_1c7} :catch_1ca

    .line 8467
    .end local v1    # "runnable":Ljava/lang/Runnable;
    .end local v14    # "profileProxyInfo":Landroid/net/ProxyInfo;
    :cond_1c7
    goto :goto_1ce

    .line 8448
    .end local v3    # "localProxyPort":I
    .restart local v12    # "localProxyPort":I
    :cond_1c8
    move v3, v12

    .end local v12    # "localProxyPort":I
    .restart local v3    # "localProxyPort":I
    goto :goto_1ce

    .line 8503
    .end local v0    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "localProxyPort":I
    .end local v5    # "vendorUid":I
    .end local v6    # "exemptedUidList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .end local v8    # "proxyPort":I
    .end local v19    # "proxyUsername":Ljava/lang/String;
    .end local v20    # "proxyPassword":Ljava/lang/String;
    .end local v22    # "pacUrl":Landroid/net/Uri;
    .end local v23    # "proxyServer":Ljava/lang/String;
    :catch_1ca
    move-exception v0

    goto :goto_1d3

    .line 8377
    .restart local v0    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_1cc
    move-object v7, v11

    move-object v2, v15

    .line 8505
    .end local v0    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :goto_1ce
    goto :goto_1ef

    .line 8503
    :catch_1cf
    move-exception v0

    move-object v7, v11

    :goto_1d1
    move-object v4, v14

    :goto_1d2
    move-object v2, v15

    .line 8504
    .local v0, "e":Ljava/lang/Exception;
    :goto_1d3
    sget-boolean v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v1, :cond_1ef

    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception occured while applying the proxy rules at KnoxVpnEngineService "

    invoke-virtual {v1, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v1, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v4, v1}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 8506
    .end local v0    # "e":Ljava/lang/Exception;
    :cond_1ef
    :goto_1ef
    return-void
.end method

.method private updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V
    .registers 12
    .param p1, "rules"    # I
    .param p2, "action"    # I
    .param p3, "uid"    # I
    .param p4, "interfaceType"    # I
    .param p5, "vInterface"    # Ljava/lang/String;
    .param p6, "dInterface"    # Ljava/lang/String;

    .line 9032
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->getDefaultRouteAppUidList()Ljava/util/List;

    move-result-object v0

    .line 9035
    .local v0, "defaultRouteUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    const/4 v1, 0x3

    const/4 v2, 0x2

    const-string v3, "KnoxVpnEngineService"

    const/4 v4, 0x1

    if-eqz p1, :cond_47

    if-eq p1, v4, :cond_11

    goto/16 :goto_93

    .line 9037
    :cond_11
    if-ne p2, v4, :cond_1a

    .line 9038
    :try_start_13
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addExemptRulesForUid(I)V

    goto/16 :goto_93

    .line 9039
    :cond_1a
    if-ne p2, v2, :cond_41

    .line 9040
    invoke-static {p3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v1

    invoke-interface {v0, v1}, Ljava/util/List;->contains(Ljava/lang/Object;)Z

    move-result v1

    if-eqz v1, :cond_3b

    .line 9041
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string v2, "Ignore applying exempt rule for uid "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v3, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_93

    .line 9043
    :cond_3b
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1, p3, p6, p4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    goto :goto_93

    .line 9045
    :cond_41
    if-ne p2, v1, :cond_93

    .line 9046
    invoke-direct {p0, p5, p3, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->addUidToExemptList(Ljava/lang/String;II)V

    goto :goto_93

    .line 9049
    :cond_47
    if-ne p2, v4, :cond_51

    .line 9050
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForUid(I)V

    goto :goto_93

    .line 9063
    :catch_4f
    move-exception v1

    goto :goto_7e

    .line 9051
    :cond_51
    if-ne p2, v2, :cond_78

    .line 9052
    invoke-static {p3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v1

    invoke-interface {v0, v1}, Ljava/util/List;->contains(Ljava/lang/Object;)Z

    move-result v1

    if-eqz v1, :cond_72

    .line 9053
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string v2, "Ignore removing exempt rule for uid "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v3, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_93

    .line 9055
    :cond_72
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1, p3, p4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    goto :goto_93

    .line 9057
    :cond_78
    if-ne p2, v1, :cond_93

    .line 9058
    invoke-direct {p0, p5, p3, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeUidFromExemptList(Ljava/lang/String;II)V
    :try_end_7d
    .catch Ljava/lang/Exception; {:try_start_13 .. :try_end_7d} :catch_4f

    goto :goto_93

    .line 9064
    .local v1, "e":Ljava/lang/Exception;
    :goto_7e
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Error at updateRulesToExemtUid "

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v3, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_94

    .line 9065
    .end local v1    # "e":Ljava/lang/Exception;
    :cond_93
    :goto_93
    nop

    .line 9066
    :goto_94
    return-void
.end method

.method private validateAdminAndVendorForProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;)I
    .registers 14
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .param p3, "responseData"    # Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    .line 7546
    iget v0, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->adminId:I

    .line 7547
    .local v0, "adminId":I
    iget-object v1, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->vendorName:Ljava/lang/String;

    .line 7548
    .local v1, "vendorName":Ljava/lang/String;
    iget v2, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 7549
    .local v2, "personaId":I
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v2, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v3

    .line 7550
    .local v3, "vendorNameWithCid":Ljava/lang/String;
    const/4 v4, 0x0

    .line 7551
    .local v4, "returnValue":I
    const/4 v5, 0x1

    const-string v6, " :admin = "

    const-string v7, "KnoxVpnEngineService"

    if-eqz p2, :cond_42

    if-eqz v1, :cond_42

    if-nez p3, :cond_19

    goto :goto_42

    .line 7556
    :cond_19
    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v8, v0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->checkAdminForProfile(ILjava/lang/String;)I

    move-result v8

    if-eqz v8, :cond_63

    .line 7557
    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v9, "Admin check failed for profile : "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v7, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7558
    const/4 v4, 0x1

    .line 7559
    const/16 v6, 0x8

    invoke-virtual {p3, v5, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    goto :goto_63

    .line 7552
    :cond_42
    :goto_42
    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v9, "Admin check null for profile : "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v7, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7553
    const/4 v4, -0x1

    .line 7554
    if-eqz p3, :cond_63

    .line 7555
    const/4 v6, 0x7

    invoke-virtual {p3, v5, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 7561
    :cond_63
    :goto_63
    return v4
.end method

.method private validateProfilesForVendor(Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;)V
    .registers 10
    .param p1, "vendorNameWithCid"    # Ljava/lang/String;
    .param p2, "vpnInterface"    # Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    .line 6993
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    const-string v1, "KnoxVpnEngineService"

    if-eqz v0, :cond_23

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "validateProfilesForVendor - vendorNameWithCid = "

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v2, " vpnInterface = "

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6995
    :cond_23
    :try_start_23
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v2, "VpnProfileInfo"

    const-string/jumbo v3, "vendorName"

    filled-new-array {v3}, [Ljava/lang/String;

    move-result-object v3

    const/4 v4, 0x1

    new-array v4, v4, [Ljava/lang/String;

    const/4 v5, 0x0

    aput-object p1, v4, v5

    const/4 v5, 0x0

    invoke-virtual {v0, v2, v3, v4, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v0

    .line 6997
    .local v0, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    const/4 v2, 0x0

    .line 6998
    .local v2, "profileName":Ljava/lang/String;
    if-eqz v0, :cond_79

    if-eqz p2, :cond_79

    .line 6999
    invoke-virtual {v0}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v3

    :goto_42
    invoke-interface {v3}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_79

    invoke-interface {v3}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Landroid/content/ContentValues;

    .line 7000
    .local v4, "cv":Landroid/content/ContentValues;
    const-string/jumbo v5, "profileName"

    invoke-virtual {v4, v5}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v5

    move-object v2, v5

    .line 7001
    sget-boolean v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v5, :cond_6f

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "validateProfilesForVendor : profileName = "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v1, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7002
    :cond_6f
    invoke-interface {p2, v2}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getConnection(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v5

    .line 7003
    .local v5, "jsonProfile":Ljava/lang/String;
    if-nez v5, :cond_78

    .line 7004
    invoke-direct {p0, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeProfileFromHashMapAndDB(Ljava/lang/String;)V
    :try_end_78
    .catch Ljava/lang/Exception; {:try_start_23 .. :try_end_78} :catch_7a

    .line 7006
    .end local v4    # "cv":Landroid/content/ContentValues;
    .end local v5    # "jsonProfile":Ljava/lang/String;
    :cond_78
    goto :goto_42

    .line 7010
    .end local v0    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .end local v2    # "profileName":Ljava/lang/String;
    :cond_79
    goto :goto_94

    .line 7008
    :catch_7a
    move-exception v0

    .line 7009
    .local v0, "e":Ljava/lang/Exception;
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "validateProfilesForVendor : Failure at "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 7011
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_94
    return-void
.end method

.method private writeAddAllPackageToDB(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Ljava/lang/String;)I
    .registers 14
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "packageName"    # Ljava/lang/String;
    .param p3, "profileName"    # Ljava/lang/String;

    .line 2083
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    const-string v1, "KnoxVpnEngineService"

    if-eqz v0, :cond_23

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "writeAddAllPackageToDB:profileName = "

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v2, " :packageName = "

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2084
    :cond_23
    iget v0, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->adminId:I

    .line 2085
    .local v0, "adminId":I
    iget v2, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2086
    .local v2, "containerId":I
    const/4 v3, -0x1

    .line 2088
    .local v3, "retvalue":I
    :try_start_28
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v4, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v4

    .line 2089
    .local v4, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    new-instance v5, Landroid/content/ContentValues;

    invoke-direct {v5}, Landroid/content/ContentValues;-><init>()V

    .line 2090
    .local v5, "cv":Landroid/content/ContentValues;
    const-string/jumbo v6, "packageName"

    invoke-virtual {v5, v6, p2}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/String;)V

    .line 2091
    const-string/jumbo v6, "profileName"

    invoke-virtual {v5, v6, p3}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/String;)V

    .line 2092
    const-string/jumbo v6, "packageUid"

    const/4 v7, -0x2

    invoke-static {v7}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v8

    invoke-virtual {v5, v6, v8}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Integer;)V

    .line 2093
    const-string/jumbo v6, "packageCid"

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v8

    invoke-virtual {v5, v6, v8}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Integer;)V

    .line 2096
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v8, "VpnPackageInfo"

    const/4 v9, 0x0

    invoke-virtual {v6, v8, v9, v9, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->putDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;Landroid/content/ContentValues;)Z

    move-result v6

    .line 2097
    .local v6, "status":Z
    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "writeAddAllPackageToDB: status value is"

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v6}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v1, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2098
    if-nez v6, :cond_75

    .line 2099
    return v3

    .line 2101
    :cond_75
    if-eqz v4, :cond_7a

    .line 2102
    invoke-virtual {v4, p2, v7, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->addPackageEntry(Ljava/lang/String;II)V
    :try_end_7a
    .catch Ljava/lang/Exception; {:try_start_28 .. :try_end_7a} :catch_7d

    .line 2107
    .end local v4    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v5    # "cv":Landroid/content/ContentValues;
    .end local v6    # "status":Z
    :cond_7a
    nop

    .line 2108
    const/4 v1, 0x0

    .line 2109
    .end local v3    # "retvalue":I
    .local v1, "retvalue":I
    return v1

    .line 2104
    .end local v1    # "retvalue":I
    .restart local v3    # "retvalue":I
    :catch_7d
    move-exception v4

    .line 2105
    .local v4, "e":Ljava/lang/Exception;
    sget-boolean v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v5, :cond_9a

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception at writeAddAllPackageToDB API"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v4}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v1, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 2106
    :cond_9a
    return v3
.end method

.method private writePackageToDB(Ljava/lang/String;Ljava/lang/String;II)I
    .registers 13
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "packageName"    # Ljava/lang/String;
    .param p3, "uid"    # I
    .param p4, "cid"    # I

    .line 2039
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    const-string v1, "KnoxVpnEngineService"

    if-eqz v0, :cond_2b

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "write package DB : profileName = "

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v2, " :packageName = "

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v2, " :cid = "

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2040
    :cond_2b
    const/4 v0, 0x0

    .line 2042
    .local v0, "retvalue":I
    :try_start_2c
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2, p4, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v2

    .line 2044
    .local v2, "transformedPackageName":Ljava/lang/String;
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_4b

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v4, "write package DB : Transformed UID: "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, p3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v1, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2045
    :cond_4b
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_64

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v4, "write package DB : Transformed packagename before adding to db : "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v1, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2047
    :cond_64
    new-instance v3, Landroid/content/ContentValues;

    invoke-direct {v3}, Landroid/content/ContentValues;-><init>()V

    .line 2048
    .local v3, "cv":Landroid/content/ContentValues;
    const-string/jumbo v4, "packageName"

    invoke-virtual {v3, v4, v2}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/String;)V

    .line 2049
    const-string/jumbo v4, "profileName"

    invoke-virtual {v3, v4, p1}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/String;)V

    .line 2050
    const-string/jumbo v4, "packageUid"

    invoke-static {p3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v5

    invoke-virtual {v3, v4, v5}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Integer;)V

    .line 2051
    const-string/jumbo v4, "packageCid"

    invoke-static {p4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v5

    invoke-virtual {v3, v4, v5}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Integer;)V

    .line 2054
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v5, "VpnPackageInfo"

    const/4 v6, 0x0

    invoke-virtual {v4, v5, v6, v6, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->putDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;Landroid/content/ContentValues;)Z

    move-result v4

    .line 2055
    .local v4, "addPackageInfo":Z
    if-nez v4, :cond_97

    .line 2056
    const/16 v0, 0x7e

    .line 2057
    return v0

    .line 2061
    :cond_97
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v5, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v5

    .line 2062
    .local v5, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v5, :cond_a2

    .line 2063
    invoke-virtual {v5, v2, p3, p4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->addPackageEntry(Ljava/lang/String;II)V

    .line 2066
    :cond_a2
    const/4 v6, -0x1

    if-eq p3, v6, :cond_b7

    .line 2068
    new-instance v6, Ljava/util/ArrayList;

    invoke-direct {v6}, Ljava/util/ArrayList;-><init>()V

    .line 2069
    .local v6, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    invoke-static {p3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-interface {v6, v7}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 2070
    const/4 v7, 0x1

    invoke-virtual {p0, p1, v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnForPerApplication(Ljava/lang/String;Ljava/util/List;Z)I

    move-result v7

    move v0, v7

    .line 2072
    .end local v6    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :cond_b7
    sget-boolean v6, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v6, :cond_be

    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->printProfileVpnMap()V
    :try_end_be
    .catch Ljava/lang/Exception; {:try_start_2c .. :try_end_be} :catch_bf

    .line 2076
    .end local v2    # "transformedPackageName":Ljava/lang/String;
    .end local v3    # "cv":Landroid/content/ContentValues;
    .end local v4    # "addPackageInfo":Z
    .end local v5    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_be
    goto :goto_da

    .line 2073
    :catch_bf
    move-exception v2

    .line 2074
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v4, "write package DB : Exception occured for adding vpn, package map."

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v1, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 2075
    const/4 v0, -0x1

    .line 2077
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_da
    return v0
.end method

.method private writePackagestoPermissionCheckDb(Ljava/lang/String;Ljava/lang/String;II)V
    .registers 14
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "packageName"    # Ljava/lang/String;
    .param p3, "cid"    # I
    .param p4, "uid"    # I

    .line 1993
    const-string/jumbo v0, "vpnNoInternetPermission"

    const-string/jumbo v1, "packageUid"

    const-string v2, "KnoxVpnEngineService"

    :try_start_8
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, p3, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v3

    .line 1995
    .local v3, "transformedPackageName":Ljava/lang/String;
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    filled-new-array {v1}, [Ljava/lang/String;

    move-result-object v5

    const/4 v6, 0x1

    new-array v6, v6, [Ljava/lang/String;

    const/4 v7, 0x0

    .line 1999
    invoke-static {p4}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;

    move-result-object v8

    aput-object v8, v6, v7

    filled-new-array {v1}, [Ljava/lang/String;

    move-result-object v7

    .line 1995
    invoke-virtual {v4, v0, v5, v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v4

    .line 2003
    .local v4, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    if-eqz v4, :cond_34

    invoke-virtual {v4}, Ljava/util/ArrayList;->size()I

    move-result v5

    if-lez v5, :cond_34

    .line 2004
    const-string v0, "Error adding the package to permission check db since it is already added"

    invoke-static {v2, v0}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 2005
    return-void

    .line 2008
    :cond_34
    new-instance v5, Landroid/content/ContentValues;

    invoke-direct {v5}, Landroid/content/ContentValues;-><init>()V

    .line 2009
    .local v5, "cv":Landroid/content/ContentValues;
    const-string/jumbo v6, "profileName"

    invoke-virtual {v5, v6, p1}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/String;)V

    .line 2010
    const-string/jumbo v6, "packageName"

    invoke-virtual {v5, v6, v3}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/String;)V

    .line 2011
    invoke-static {p4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v6

    invoke-virtual {v5, v1, v6}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Integer;)V

    .line 2013
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const/4 v6, 0x0

    invoke-virtual {v1, v0, v6, v6, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->putDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;Landroid/content/ContentValues;)Z

    move-result v0

    .line 2014
    .local v0, "result":Z
    if-nez v0, :cond_5a

    .line 2015
    const-string v1, "Error adding the package info to permission exempt list in db"

    invoke-static {v2, v1}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_5a
    .catch Ljava/lang/Exception; {:try_start_8 .. :try_end_5a} :catch_5b

    .line 2019
    .end local v0    # "result":Z
    .end local v3    # "transformedPackageName":Ljava/lang/String;
    .end local v4    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .end local v5    # "cv":Landroid/content/ContentValues;
    :cond_5a
    goto :goto_74

    .line 2017
    :catch_5b
    move-exception v0

    .line 2018
    .local v0, "e":Ljava/lang/Exception;
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception at writePackagestoPermissionCheckDb API "

    invoke-virtual {v1, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v1, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v2, v1}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 2020
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_74
    return-void
.end method


# virtual methods
.method public declared-synchronized activateVpnProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Z)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 52
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .param p3, "enable"    # Z
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            "Z)",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    move-object/from16 v12, p0

    move-object/from16 v13, p1

    move-object/from16 v14, p2

    move/from16 v15, p3

    monitor-enter p0

    .line 1144
    :try_start_9
    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v1

    move-object v11, v1

    .line 1146
    .local v11, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "knox vpn profile activation is going to take place: profileName value is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1147
    const/4 v1, 0x0

    .line 1148
    .local v1, "insertActivateInfoInDb":Z
    const/16 v16, -0x1

    .local v16, "uid":I
    const/16 v17, -0x1

    .line 1150
    .local v17, "cid":I
    new-instance v2, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    move-object v10, v2

    .line 1151
    .local v10, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v9, -0x1

    invoke-static {v9}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v10, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1152
    const/4 v8, 0x1

    invoke-virtual {v10, v8, v9}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1154
    iget v2, v11, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {v12, v13, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v2

    if-nez v2, :cond_4f

    .line 1155
    const/16 v2, 0x8c

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v10, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_4d
    .catchall {:try_start_9 .. :try_end_4d} :catchall_6c3

    .line 1156
    monitor-exit p0

    return-object v10

    .line 1161
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_4f
    :try_start_4f
    iget-object v2, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v2, v13, v14, v15}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->activateVpnProfileValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Z)I

    move-result v2
    :try_end_55
    .catch Ljava/lang/Exception; {:try_start_4f .. :try_end_55} :catch_63a
    .catchall {:try_start_4f .. :try_end_55} :catchall_6c3

    move v7, v2

    .line 1162
    .local v7, "activateVpnProfileValidation":I
    const/16 v2, 0x64

    if-eq v7, v2, :cond_a8

    .line 1163
    :try_start_5a
    invoke-static {v7}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v10, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1164
    const-string v2, "KnoxVpnEngineService"

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Error occured while activating the vpn profile: The error code is "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v7}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v2, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1166
    const/16 v18, 0x3

    const/16 v19, 0x5

    const/16 v20, 0x0

    .line 1167
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v21

    const-string v22, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Error validating information from profile "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v3, " before activation"

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v23

    iget v2, v13, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1166
    move/from16 v24, v2

    invoke-static/range {v18 .. v24}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_a0
    .catch Ljava/lang/Exception; {:try_start_5a .. :try_end_a0} :catch_a2
    .catchall {:try_start_5a .. :try_end_a0} :catchall_6c3

    .line 1171
    monitor-exit p0

    return-object v10

    .line 1388
    .end local v7    # "activateVpnProfileValidation":I
    :catch_a2
    move-exception v0

    move-object v2, v0

    move-object/from16 v21, v11

    goto/16 :goto_63e

    .line 1174
    .restart local v7    # "activateVpnProfileValidation":I
    :cond_a8
    :try_start_a8
    invoke-virtual {v12, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v2
    :try_end_ac
    .catch Ljava/lang/Exception; {:try_start_a8 .. :try_end_ac} :catch_63a
    .catchall {:try_start_a8 .. :try_end_ac} :catchall_6c3

    move-object v6, v2

    .line 1175
    .local v6, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v6, :cond_c1

    .line 1176
    const/16 v2, 0x6e

    :try_start_b1
    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v10, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1177
    const-string v2, "KnoxVpnEngineService"

    const-string v3, "Error occured while activating the vpn profile: The error code is 110"

    invoke-static {v2, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_bf
    .catch Ljava/lang/Exception; {:try_start_b1 .. :try_end_bf} :catch_a2
    .catchall {:try_start_b1 .. :try_end_bf} :catchall_6c3

    .line 1178
    monitor-exit p0

    return-object v10

    .line 1181
    :cond_c1
    if-eqz v15, :cond_c5

    move v2, v8

    goto :goto_c6

    :cond_c5
    const/4 v2, 0x0

    :goto_c6
    move v3, v2

    .line 1182
    .local v3, "iNewActivateState":I
    :try_start_c7
    const-string v2, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "current profile activation state is "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v2, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1184
    iget-object v2, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2
    :try_end_e3
    .catch Ljava/lang/Exception; {:try_start_c7 .. :try_end_e3} :catch_63a
    .catchall {:try_start_c7 .. :try_end_e3} :catchall_6c3

    move-object/from16 v19, v2

    .line 1185
    .local v19, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v19, :cond_11b

    .line 1186
    const/16 v2, 0x6c

    :try_start_e9
    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v10, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1188
    const/16 v20, 0x3

    const/16 v21, 0x5

    const/16 v22, 0x0

    .line 1189
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v23

    const-string v24, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Error occurred while activating vpn profile "

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v4, ". Profile does not exist in device."

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v25

    iget v2, v13, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1188
    move/from16 v26, v2

    invoke-static/range {v20 .. v26}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_119
    .catch Ljava/lang/Exception; {:try_start_e9 .. :try_end_119} :catch_a2
    .catchall {:try_start_e9 .. :try_end_119} :catchall_6c3

    .line 1193
    monitor-exit p0

    return-object v10

    .line 1196
    :cond_11b
    const/16 v2, 0x7e

    if-ne v3, v8, :cond_3e4

    .line 1198
    :try_start_11f
    invoke-direct {v12, v14, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setActivate(Ljava/lang/String;I)Z

    move-result v20
    :try_end_123
    .catch Ljava/lang/Exception; {:try_start_11f .. :try_end_123} :catch_63a
    .catchall {:try_start_11f .. :try_end_123} :catchall_6c3

    move/from16 v1, v20

    .line 1199
    :try_start_125
    sget-boolean v20, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z
    :try_end_127
    .catch Ljava/lang/Exception; {:try_start_125 .. :try_end_127} :catch_3dc
    .catchall {:try_start_125 .. :try_end_127} :catchall_6c3

    if-eqz v20, :cond_13f

    :try_start_129
    const-string v4, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v9, "activateVpnProfile: insertActivateInfoInDb value is "

    invoke-virtual {v5, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v1}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1200
    :cond_13f
    if-nez v1, :cond_175

    .line 1201
    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v10, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1202
    const-string v2, "KnoxVpnEngineService"

    const-string v4, "Error occured while activating the vpn profile: The error code is 126"

    invoke-static {v2, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1204
    const/16 v23, 0x3

    const/16 v24, 0x5

    const/16 v25, 0x0

    .line 1205
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v26

    const-string v27, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Error adding vpn profile info in database while activating profile "

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v28

    iget v2, v13, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1204
    move/from16 v29, v2

    invoke-static/range {v23 .. v29}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_173
    .catch Ljava/lang/Exception; {:try_start_129 .. :try_end_173} :catch_a2
    .catchall {:try_start_129 .. :try_end_173} :catchall_6c3

    .line 1209
    monitor-exit p0

    return-object v10

    .line 1212
    :cond_175
    :try_start_175
    iget-object v2, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getActiveNetworkInterface()Ljava/lang/String;

    move-result-object v2
    :try_end_17b
    .catch Ljava/lang/Exception; {:try_start_175 .. :try_end_17b} :catch_3d5
    .catchall {:try_start_175 .. :try_end_17b} :catchall_6c3

    move-object v9, v2

    .line 1213
    .local v9, "defaultInterface":Ljava/lang/String;
    if-nez v9, :cond_189

    .line 1214
    const/16 v2, 0x130

    :try_start_180
    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v10, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_187
    .catch Ljava/lang/Exception; {:try_start_180 .. :try_end_187} :catch_a2
    .catchall {:try_start_180 .. :try_end_187} :catchall_6c3

    .line 1215
    monitor-exit p0

    return-object v10

    .line 1218
    :cond_189
    :try_start_189
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbTethering()I

    move-result v2
    :try_end_18d
    .catch Ljava/lang/Exception; {:try_start_189 .. :try_end_18d} :catch_3d5
    .catchall {:try_start_189 .. :try_end_18d} :catchall_6c3

    if-ne v2, v8, :cond_1a3

    .line 1219
    :try_start_18f
    iget-object v2, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getInterfaceNameForUsbtethering()Ljava/lang/String;

    move-result-object v2

    .line 1220
    .local v2, "usbTetheringIface":Ljava/lang/String;
    if-eqz v2, :cond_1a3

    .line 1221
    const-string v4, "KnoxVpnEngineService"

    const-string v5, "Applying rules to drop tether packets after the profile is activated and before vpn comes up"

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1222
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForDroppingTetherPackets(Ljava/lang/String;)V
    :try_end_1a3
    .catch Ljava/lang/Exception; {:try_start_18f .. :try_end_1a3} :catch_a2
    .catchall {:try_start_18f .. :try_end_1a3} :catchall_6c3

    .line 1226
    .end local v2    # "usbTetheringIface":Ljava/lang/String;
    :cond_1a3
    :try_start_1a3
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v2

    invoke-virtual {v2}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v23

    :goto_1ab
    invoke-interface/range {v23 .. v23}, Ljava/util/Iterator;->hasNext()Z

    move-result v2
    :try_end_1af
    .catch Ljava/lang/Exception; {:try_start_1a3 .. :try_end_1af} :catch_3d5
    .catchall {:try_start_1a3 .. :try_end_1af} :catchall_6c3

    if-eqz v2, :cond_205

    :try_start_1b1
    invoke-interface/range {v23 .. v23}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Ljava/lang/Integer;

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v4
    :try_end_1bb
    .catch Ljava/lang/Exception; {:try_start_1b1 .. :try_end_1bb} :catch_3dc
    .catchall {:try_start_1b1 .. :try_end_1bb} :catchall_6c3

    const/4 v5, 0x3

    .line 1227
    .local v4, "exemptUid":I
    const/4 v2, 0x1

    const/16 v20, 0x1

    const/16 v24, 0x0

    const/16 v25, 0x0

    const/16 v26, 0x0

    move/from16 v27, v1

    .end local v1    # "insertActivateInfoInDb":Z
    .local v27, "insertActivateInfoInDb":Z
    move-object/from16 v1, p0

    move/from16 v30, v3

    .end local v3    # "iNewActivateState":I
    .local v30, "iNewActivateState":I
    move/from16 v3, v20

    move/from16 v5, v24

    move-object/from16 v33, v6

    .end local v6    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .local v33, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    move-object/from16 v6, v25

    move/from16 v18, v7

    .end local v7    # "activateVpnProfileValidation":I
    .local v18, "activateVpnProfileValidation":I
    move-object/from16 v7, v26

    :try_start_1d7
    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V
    :try_end_1da
    .catch Ljava/lang/Exception; {:try_start_1d7 .. :try_end_1da} :catch_1fd
    .catchall {:try_start_1d7 .. :try_end_1da} :catchall_6c3

    .line 1228
    const/4 v6, 0x1

    const/4 v7, 0x2

    const/4 v1, 0x3

    const/4 v2, 0x0

    move-object/from16 v5, p0

    move v3, v8

    move v8, v4

    move-object/from16 v20, v9

    .end local v9    # "defaultInterface":Ljava/lang/String;
    .local v20, "defaultInterface":Ljava/lang/String;
    move v9, v1

    move-object v1, v10

    .end local v10    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .local v1, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    move-object v10, v2

    move-object/from16 v21, v11

    .end local v11    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .local v21, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    move-object/from16 v11, v20

    :try_start_1eb
    invoke-direct/range {v5 .. v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 1229
    .end local v4    # "exemptUid":I
    move-object v10, v1

    move v8, v3

    move/from16 v7, v18

    move-object/from16 v9, v20

    move-object/from16 v11, v21

    move/from16 v1, v27

    move/from16 v3, v30

    move-object/from16 v6, v33

    goto :goto_1ab

    .line 1388
    .end local v1    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local v18    # "activateVpnProfileValidation":I
    .end local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v20    # "defaultInterface":Ljava/lang/String;
    .end local v21    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v30    # "iNewActivateState":I
    .end local v33    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .restart local v10    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .restart local v11    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    :catch_1fd
    move-exception v0

    move-object/from16 v21, v11

    move-object v2, v0

    move/from16 v1, v27

    .end local v10    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local v11    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v1    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .restart local v21    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    goto/16 :goto_63e

    .line 1231
    .end local v21    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v27    # "insertActivateInfoInDb":Z
    .local v1, "insertActivateInfoInDb":Z
    .restart local v3    # "iNewActivateState":I
    .restart local v6    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .restart local v7    # "activateVpnProfileValidation":I
    .restart local v9    # "defaultInterface":Ljava/lang/String;
    .restart local v10    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .restart local v11    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_205
    move/from16 v27, v1

    move/from16 v30, v3

    move-object/from16 v33, v6

    move/from16 v18, v7

    move v3, v8

    move-object/from16 v20, v9

    move-object v1, v10

    move-object/from16 v21, v11

    .end local v3    # "iNewActivateState":I
    .end local v6    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v7    # "activateVpnProfileValidation":I
    .end local v9    # "defaultInterface":Ljava/lang/String;
    .end local v10    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local v11    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .local v1, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .restart local v18    # "activateVpnProfileValidation":I
    .restart local v20    # "defaultInterface":Ljava/lang/String;
    .restart local v21    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v27    # "insertActivateInfoInDb":Z
    .restart local v30    # "iNewActivateState":I
    .restart local v33    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v2

    invoke-virtual {v12, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getChainingEnabledForProfile(I)I

    move-result v2

    if-eq v2, v3, :cond_23d

    .line 1232
    iget-object v2, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isNativeVpnClient(Ljava/lang/String;)Z

    move-result v2

    if-eqz v2, :cond_230

    .line 1233
    iget-object v2, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    const/16 v4, 0x3f8

    move-object/from16 v5, v20

    const/4 v8, 0x3

    .end local v20    # "defaultInterface":Ljava/lang/String;
    .local v5, "defaultInterface":Ljava/lang/String;
    invoke-virtual {v2, v4, v5, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    goto :goto_240

    .line 1235
    .end local v5    # "defaultInterface":Ljava/lang/String;
    .restart local v20    # "defaultInterface":Ljava/lang/String;
    :cond_230
    move-object/from16 v5, v20

    const/4 v8, 0x3

    .end local v20    # "defaultInterface":Ljava/lang/String;
    .restart local v5    # "defaultInterface":Ljava/lang/String;
    iget-object v2, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v4

    invoke-virtual {v2, v4, v5, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    goto :goto_240

    .line 1231
    .end local v5    # "defaultInterface":Ljava/lang/String;
    .restart local v20    # "defaultInterface":Ljava/lang/String;
    :cond_23d
    move-object/from16 v5, v20

    const/4 v8, 0x3

    .line 1239
    .end local v20    # "defaultInterface":Ljava/lang/String;
    .restart local v5    # "defaultInterface":Ljava/lang/String;
    :goto_240
    iget-object v2, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdForExemptedUidByProfile(Ljava/lang/String;)Ljava/util/HashSet;

    move-result-object v2

    .line 1240
    .local v2, "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    invoke-virtual {v2}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v4

    :goto_24a
    invoke-interface {v4}, Ljava/util/Iterator;->hasNext()Z

    move-result v6

    if-eqz v6, :cond_268

    invoke-interface {v4}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Ljava/lang/Integer;

    invoke-virtual {v6}, Ljava/lang/Integer;->intValue()I

    move-result v6

    .line 1241
    .local v6, "exemptedUserId":I
    iget-object v7, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v9, "com.android.providers.downloads"

    invoke-virtual {v7, v6, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v7

    .line 1242
    .local v7, "downloadMangerUid":I
    iget-object v9, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v9, v7, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addExemptRulesForDownloadManagerUid(ILjava/lang/String;)V

    .line 1243
    .end local v6    # "exemptedUserId":I
    .end local v7    # "downloadMangerUid":I
    goto :goto_24a

    .line 1245
    :cond_268
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v4, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v4

    .line 1246
    .local v4, "vpnClientPackageName":Ljava/lang/String;
    iget-object v6, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    sget-object v7, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->BLOCK_APP_TRAFFIC:Ljava/lang/String;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v6, v7, v9, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMarkingRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;I)V

    .line 1247
    iget-object v6, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v7, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v7

    invoke-virtual {v6, v4, v3, v7, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addInputFilterDropRulesForInterface(Ljava/lang/String;ILjava/util/List;Ljava/lang/String;)V

    .line 1248
    iget-object v6, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v7, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuidListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v7

    const/4 v9, 0x0

    invoke-virtual {v6, v4, v9, v7, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addInputFilterDropRulesForInterface(Ljava/lang/String;ILjava/util/List;Ljava/lang/String;)V

    .line 1250
    new-instance v6, Ljava/util/ArrayList;

    invoke-direct {v6}, Ljava/util/ArrayList;-><init>()V

    .line 1251
    .local v6, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v7

    invoke-interface {v7}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v7

    :goto_2a1
    invoke-interface {v7}, Ljava/util/Iterator;->hasNext()Z

    move-result v10

    if-eqz v10, :cond_31e

    invoke-interface {v7}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v10

    check-cast v10, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 1252
    .local v10, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v11

    move-object/from16 v20, v7

    const/4 v7, -0x2

    if-ne v11, v7, :cond_2fc

    .line 1253
    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getCid()I

    move-result v11

    if-nez v11, :cond_2e4

    .line 1254
    invoke-direct {v12, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->blockIncomingICMPPackets(Z)V

    .line 1255
    sget-object v11, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->AID_EXEMPT_LIST:[Ljava/lang/Integer;

    array-length v3, v11

    move v7, v9

    :goto_2c3
    if-ge v7, v3, :cond_2e1

    aget-object v23, v11, v7

    invoke-virtual/range {v23 .. v23}, Ljava/lang/Integer;->intValue()I

    move-result v23

    move/from16 v24, v23

    .line 1256
    .local v24, "aidUid":I
    iget-object v9, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    move-object/from16 v23, v2

    move/from16 v2, v24

    .end local v24    # "aidUid":I
    .local v2, "aidUid":I
    .local v23, "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    invoke-virtual {v9, v2, v5, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRulesForExemptedUid(ILjava/lang/String;I)V

    .line 1257
    iget-object v9, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v9, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addExemptRulesForUid(I)V

    .line 1255
    .end local v2    # "aidUid":I
    add-int/lit8 v7, v7, 0x1

    move-object/from16 v2, v23

    const/4 v9, 0x0

    goto :goto_2c3

    .end local v23    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .local v2, "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    :cond_2e1
    move-object/from16 v23, v2

    .end local v2    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v23    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    goto :goto_2e6

    .line 1253
    .end local v23    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v2    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    :cond_2e4
    move-object/from16 v23, v2

    .line 1260
    .end local v2    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v23    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    :goto_2e6
    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getCid()I

    move-result v2

    const/4 v3, 0x0

    invoke-virtual {v12, v14, v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnForUserwideVpn(Ljava/lang/String;IZ)I

    move-result v2

    .line 1261
    .local v2, "startUserwideResult":I
    if-eqz v2, :cond_2fa

    .line 1262
    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v1, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_2f8
    .catch Ljava/lang/Exception; {:try_start_1eb .. :try_end_2f8} :catch_3ce
    .catchall {:try_start_1eb .. :try_end_2f8} :catchall_6c3

    .line 1263
    monitor-exit p0

    return-object v1

    .line 1265
    .end local v2    # "startUserwideResult":I
    :cond_2fa
    const/4 v9, -0x1

    goto :goto_317

    .end local v23    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .local v2, "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    :cond_2fc
    move-object/from16 v23, v2

    .end local v2    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v23    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    :try_start_2fe
    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v2

    const/4 v9, -0x1

    if-ne v2, v9, :cond_30c

    .line 1266
    move-object/from16 v7, v20

    move-object/from16 v2, v23

    const/4 v3, 0x1

    const/4 v9, 0x0

    goto :goto_2a1

    .line 1268
    :cond_30c
    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v2

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-interface {v6, v2}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 1270
    .end local v10    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :goto_317
    move-object/from16 v7, v20

    move-object/from16 v2, v23

    const/4 v3, 0x1

    const/4 v9, 0x0

    goto :goto_2a1

    .line 1271
    .end local v23    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v2    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    :cond_31e
    move-object/from16 v23, v2

    const/4 v9, -0x1

    .end local v2    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    .restart local v23    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    invoke-interface {v6}, Ljava/util/List;->isEmpty()Z

    move-result v2

    if-nez v2, :cond_338

    .line 1272
    const/4 v2, 0x0

    invoke-virtual {v12, v14, v6, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnForPerApplication(Ljava/lang/String;Ljava/util/List;Z)I

    move-result v3

    move v2, v3

    .line 1273
    .local v2, "startperAppResult":I
    if-eqz v2, :cond_338

    .line 1274
    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v1, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_336
    .catch Ljava/lang/Exception; {:try_start_2fe .. :try_end_336} :catch_3ce
    .catchall {:try_start_2fe .. :try_end_336} :catchall_6c3

    .line 1275
    monitor-exit p0

    return-object v1

    .line 1278
    .end local v2    # "startperAppResult":I
    :cond_338
    :try_start_338
    invoke-direct {v12, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnProfile(Ljava/lang/String;)I

    move-result v2

    .line 1279
    .local v2, "startResult":I
    const/16 v3, 0x12f

    if-ne v2, v3, :cond_358

    .line 1280
    const-string v3, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "starting the vpn connection delayed due to app not started on on-demand config "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v3, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_395

    .line 1281
    :cond_358
    const/16 v3, 0x12e

    if-ne v2, v3, :cond_374

    .line 1282
    const-string v3, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "starting the vpn connection delayed since no packages were added to vpn profile"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v3, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_395

    .line 1283
    :cond_374
    if-eqz v2, :cond_395

    .line 1284
    const-string v3, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string v8, "Error occured while starting the vpn profile: The error code is "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v3, v7}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 1285
    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v1, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_393
    .catch Ljava/lang/Exception; {:try_start_338 .. :try_end_393} :catch_3ce
    .catchall {:try_start_338 .. :try_end_393} :catchall_6c3

    .line 1286
    monitor-exit p0

    return-object v1

    .line 1289
    :cond_395
    :goto_395
    const/4 v3, 0x0

    :try_start_396
    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-virtual {v1, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1290
    invoke-virtual {v1, v3, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1292
    const/16 v34, 0x5

    const/16 v35, 0x5

    const/16 v36, 0x1

    .line 1293
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v37

    const-string v38, "KnoxVpnEngineService"

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "Vpn profile "

    invoke-virtual {v3, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v7, " successfully activated"

    invoke-virtual {v3, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v39

    iget v3, v13, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1292
    move/from16 v40, v3

    invoke-static/range {v34 .. v40}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_3c9
    .catch Ljava/lang/Exception; {:try_start_396 .. :try_end_3c9} :catch_3ce
    .catchall {:try_start_396 .. :try_end_3c9} :catchall_6c3

    .line 1297
    .end local v2    # "startResult":I
    .end local v4    # "vpnClientPackageName":Ljava/lang/String;
    .end local v5    # "defaultInterface":Ljava/lang/String;
    .end local v6    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v23    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    move-object v10, v1

    move/from16 v1, v27

    goto/16 :goto_639

    .line 1388
    .end local v18    # "activateVpnProfileValidation":I
    .end local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v30    # "iNewActivateState":I
    .end local v33    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :catch_3ce
    move-exception v0

    move-object v2, v0

    move-object v10, v1

    move/from16 v1, v27

    goto/16 :goto_63e

    .end local v21    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v27    # "insertActivateInfoInDb":Z
    .local v1, "insertActivateInfoInDb":Z
    .local v10, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .restart local v11    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    :catch_3d5
    move-exception v0

    move/from16 v27, v1

    move-object/from16 v21, v11

    const/4 v9, -0x1

    goto :goto_3e1

    :catch_3dc
    move-exception v0

    move/from16 v27, v1

    move-object/from16 v21, v11

    :goto_3e1
    move-object v2, v0

    .end local v10    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local v11    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .local v1, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .restart local v21    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v27    # "insertActivateInfoInDb":Z
    goto/16 :goto_63e

    .line 1297
    .end local v21    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v27    # "insertActivateInfoInDb":Z
    .local v1, "insertActivateInfoInDb":Z
    .restart local v3    # "iNewActivateState":I
    .local v6, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .local v7, "activateVpnProfileValidation":I
    .restart local v10    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .restart local v11    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_3e4
    move/from16 v30, v3

    move-object/from16 v33, v6

    move/from16 v18, v7

    move-object/from16 v21, v11

    const/4 v8, 0x3

    .end local v3    # "iNewActivateState":I
    .end local v6    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v7    # "activateVpnProfileValidation":I
    .end local v11    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v18    # "activateVpnProfileValidation":I
    .restart local v21    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v30    # "iNewActivateState":I
    .restart local v33    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    move/from16 v11, v30

    .end local v30    # "iNewActivateState":I
    .local v11, "iNewActivateState":I
    if-nez v11, :cond_637

    .line 1299
    :try_start_3f1
    invoke-direct {v12, v14, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setActivate(Ljava/lang/String;I)Z

    move-result v3
    :try_end_3f5
    .catch Ljava/lang/Exception; {:try_start_3f1 .. :try_end_3f5} :catch_634
    .catchall {:try_start_3f1 .. :try_end_3f5} :catchall_6c3

    move v7, v3

    .line 1300
    .end local v1    # "insertActivateInfoInDb":Z
    .local v7, "insertActivateInfoInDb":Z
    :try_start_3f6
    sget-boolean v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z
    :try_end_3f8
    .catch Ljava/lang/Exception; {:try_start_3f6 .. :try_end_3f8} :catch_62d
    .catchall {:try_start_3f6 .. :try_end_3f8} :catchall_6c3

    if-eqz v1, :cond_416

    :try_start_3fa
    const-string v1, "KnoxVpnEngineService"

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "deactivateVpnProfile: insertActivateInfoInDb value is "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v7}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v1, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_410
    .catch Ljava/lang/Exception; {:try_start_3fa .. :try_end_410} :catch_411
    .catchall {:try_start_3fa .. :try_end_410} :catchall_6c3

    goto :goto_416

    .line 1388
    .end local v11    # "iNewActivateState":I
    .end local v18    # "activateVpnProfileValidation":I
    .end local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v33    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :catch_411
    move-exception v0

    move-object v2, v0

    move v1, v7

    goto/16 :goto_63e

    .line 1304
    .restart local v11    # "iNewActivateState":I
    .restart local v18    # "activateVpnProfileValidation":I
    .restart local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v33    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :cond_416
    :goto_416
    :try_start_416
    invoke-direct {v12, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeAllUidByTAG(Ljava/lang/String;)V
    :try_end_419
    .catch Ljava/lang/Exception; {:try_start_416 .. :try_end_419} :catch_62d
    .catchall {:try_start_416 .. :try_end_419} :catchall_6c3

    .line 1307
    if-nez v7, :cond_44f

    .line 1308
    :try_start_41b
    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v1

    invoke-virtual {v10, v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1309
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Error occured while deactivating the vpn profile: The error code is 126"

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1311
    const/16 v23, 0x3

    const/16 v24, 0x5

    const/16 v25, 0x0

    .line 1312
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v26

    const-string v27, "KnoxVpnEngineService"

    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string v2, "Error adding vpn profile info in database while deactivating profile "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v28

    iget v1, v13, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1311
    move/from16 v29, v1

    invoke-static/range {v23 .. v29}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_44d
    .catch Ljava/lang/Exception; {:try_start_41b .. :try_end_44d} :catch_411
    .catchall {:try_start_41b .. :try_end_44d} :catchall_6c3

    .line 1316
    monitor-exit p0

    return-object v10

    .line 1319
    :cond_44f
    :try_start_44f
    iget-object v1, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v1, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdForExemptedUidByProfile(Ljava/lang/String;)Ljava/util/HashSet;

    move-result-object v1

    move-object/from16 v20, v1

    .line 1320
    .local v20, "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    invoke-virtual/range {v20 .. v20}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_45b
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2
    :try_end_45f
    .catch Ljava/lang/Exception; {:try_start_44f .. :try_end_45f} :catch_62d
    .catchall {:try_start_44f .. :try_end_45f} :catchall_6c3

    if-eqz v2, :cond_479

    :try_start_461
    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Ljava/lang/Integer;

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    .line 1321
    .local v2, "exemptedUserId":I
    iget-object v3, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v4, "com.android.providers.downloads"

    invoke-virtual {v3, v2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v3

    .line 1322
    .local v3, "downloadMangerUid":I
    iget-object v4, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForDownloadManagerUid(I)V
    :try_end_478
    .catch Ljava/lang/Exception; {:try_start_461 .. :try_end_478} :catch_411
    .catchall {:try_start_461 .. :try_end_478} :catchall_6c3

    .line 1323
    .end local v2    # "exemptedUserId":I
    .end local v3    # "downloadMangerUid":I
    goto :goto_45b

    .line 1325
    :cond_479
    :try_start_479
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v1

    invoke-virtual {v1}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v23

    :goto_481
    invoke-interface/range {v23 .. v23}, Ljava/util/Iterator;->hasNext()Z

    move-result v1

    if-eqz v1, :cond_4a6

    invoke-interface/range {v23 .. v23}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v1

    check-cast v1, Ljava/lang/Integer;

    invoke-virtual {v1}, Ljava/lang/Integer;->intValue()I

    move-result v4
    :try_end_491
    .catch Ljava/lang/Exception; {:try_start_479 .. :try_end_491} :catch_62d
    .catchall {:try_start_479 .. :try_end_491} :catchall_6c3

    .line 1326
    .local v4, "exemptUid_1":I
    const/4 v2, 0x0

    const/4 v3, 0x1

    const/4 v5, 0x0

    const/4 v6, 0x0

    const/16 v24, 0x0

    move-object/from16 v1, p0

    const/4 v9, 0x1

    move/from16 v22, v7

    const/4 v9, -0x2

    .end local v7    # "insertActivateInfoInDb":Z
    .local v22, "insertActivateInfoInDb":Z
    move-object/from16 v7, v24

    :try_start_49f
    invoke-direct/range {v1 .. v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 1327
    .end local v4    # "exemptUid_1":I
    move/from16 v7, v22

    const/4 v9, -0x1

    goto :goto_481

    .line 1329
    .end local v22    # "insertActivateInfoInDb":Z
    .restart local v7    # "insertActivateInfoInDb":Z
    :cond_4a6
    move/from16 v22, v7

    const/4 v9, -0x2

    .end local v7    # "insertActivateInfoInDb":Z
    .restart local v22    # "insertActivateInfoInDb":Z
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_4b1
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_4e8

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 1330
    .local v2, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v3

    if-ne v3, v9, :cond_4e7

    .line 1331
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getCid()I

    move-result v3

    if-nez v3, :cond_4e7

    .line 1332
    const/4 v1, 0x0

    invoke-direct {v12, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->blockIncomingICMPPackets(Z)V

    .line 1333
    sget-object v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->AID_EXEMPT_LIST:[Ljava/lang/Integer;

    array-length v3, v1

    const/4 v5, 0x0

    :goto_4d1
    if-ge v5, v3, :cond_4e6

    aget-object v4, v1, v5

    invoke-virtual {v4}, Ljava/lang/Integer;->intValue()I

    move-result v4

    .line 1334
    .local v4, "aidUid":I
    iget-object v6, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v6, v4, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRulesForExemptedUid(II)V

    .line 1335
    iget-object v6, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v6, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeExemptRulesForUid(I)V

    .line 1333
    .end local v4    # "aidUid":I
    add-int/lit8 v5, v5, 0x1

    goto :goto_4d1

    .line 1337
    :cond_4e6
    goto :goto_4e8

    .line 1339
    .end local v2    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :cond_4e7
    goto :goto_4b1

    .line 1341
    :cond_4e8
    :goto_4e8
    iget-object v1, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->flushMarkingRulesForFilteredPackages(Ljava/lang/String;)V

    .line 1342
    iget-object v1, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuserIdListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v2

    const/4 v3, 0x1

    invoke-virtual {v1, v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeInputFilterDropRulesForInterface(ILjava/util/List;)V

    .line 1343
    iget-object v1, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    iget-object v2, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getuidListForProfile(Ljava/lang/String;)Ljava/util/List;

    move-result-object v2

    const/4 v3, 0x0

    invoke-virtual {v1, v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeInputFilterDropRulesForInterface(ILjava/util/List;)V

    .line 1346
    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyServer()Ljava/lang/String;

    move-result-object v1

    sget-object v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->DEFAULT_PROXY_SERVER:Ljava/lang/String;

    if-ne v1, v2, :cond_519

    invoke-virtual/range {v19 .. v19}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPacurl()Landroid/net/Uri;

    move-result-object v1

    sget-object v2, Landroid/net/Uri;->EMPTY:Landroid/net/Uri;

    if-eq v1, v2, :cond_52c

    .line 1347
    :cond_519
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnPacProcessor()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v1

    invoke-virtual {v1, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->stopPacSupport(Ljava/lang/String;)V

    .line 1348
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v1

    invoke-virtual {v1, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getListOfUid(Ljava/lang/String;)Ljava/util/HashMap;

    move-result-object v1

    const/4 v2, 0x0

    invoke-direct {v12, v2, v14, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 1351
    :cond_52c
    invoke-direct {v12, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeMiscRulesForProfile(Ljava/lang/String;)V

    .line 1353
    move-object/from16 v2, v33

    .end local v33    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .local v2, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    invoke-interface {v2, v14}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getState(Ljava/lang/String;)I

    move-result v1

    .line 1354
    .local v1, "currentStateOfProfile":I
    const/4 v3, 0x1

    if-ne v1, v3, :cond_53b

    const/4 v3, 0x5

    if-eq v1, v3, :cond_5ea

    .line 1355
    :cond_53b
    invoke-interface {v2, v14}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->stopConnection(Ljava/lang/String;)I

    move-result v3

    .line 1356
    .local v3, "stopStatus":I
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_559

    const-string v4, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "deactivateVpnProfile: stopStatus value is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1357
    :cond_559
    if-eqz v3, :cond_5c6

    .line 1358
    invoke-interface {v2, v14}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->stopConnection(Ljava/lang/String;)I

    move-result v4

    move v3, v4

    .line 1359
    if-eqz v3, :cond_587

    .line 1360
    const/16 v35, 0x3

    const/16 v36, 0x5

    const/16 v37, 0x0

    .line 1361
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v38

    const-string v39, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Error occurred trying to stop vpn connection from profile "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v40

    iget v4, v13, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1360
    move/from16 v41, v4

    invoke-static/range {v35 .. v41}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    goto :goto_5ab

    .line 1365
    :cond_587
    const/16 v41, 0x5

    const/16 v42, 0x5

    const/16 v43, 0x1

    .line 1366
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v44

    const-string v45, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Connection with vpn vendor service stopped for profile "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v46

    iget v4, v13, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1365
    move/from16 v47, v4

    invoke-static/range {v41 .. v47}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 1370
    :goto_5ab
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_5ea

    const-string v4, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "deactivateVpnProfile: stopStatus for lockup case value is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_5ea

    .line 1372
    :cond_5c6
    const/16 v35, 0x5

    const/16 v36, 0x5

    const/16 v37, 0x1

    .line 1373
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v38

    const-string v39, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Connection with vpn vendor service stopped for profile "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v40

    iget v4, v13, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1372
    move/from16 v41, v4

    invoke-static/range {v35 .. v41}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 1378
    .end local v3    # "stopStatus":I
    :cond_5ea
    :goto_5ea
    const-string v3, "KnoxVpnEngineService"

    const-string v4, "De-Activating the vpn profile is a success: The error code is 0"

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1380
    const/16 v35, 0x5

    const/16 v36, 0x5

    const/16 v37, 0x1

    .line 1381
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v38

    const-string v39, "KnoxVpnEngineService"

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Vpn profile "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v4, " successfully deactivated"

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v40

    iget v3, v13, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1380
    move/from16 v41, v3

    invoke-static/range {v35 .. v41}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 1385
    const/4 v3, 0x0

    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v4

    invoke-virtual {v10, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1386
    invoke-virtual {v10, v3, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_625
    .catch Ljava/lang/Exception; {:try_start_49f .. :try_end_625} :catch_628
    .catchall {:try_start_49f .. :try_end_625} :catchall_6c3

    move/from16 v1, v22

    goto :goto_639

    .line 1388
    .end local v1    # "currentStateOfProfile":I
    .end local v2    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v11    # "iNewActivateState":I
    .end local v18    # "activateVpnProfileValidation":I
    .end local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v20    # "exemptedUserIdList":Ljava/util/HashSet;, "Ljava/util/HashSet<Ljava/lang/Integer;>;"
    :catch_628
    move-exception v0

    move-object v2, v0

    move/from16 v1, v22

    goto :goto_63e

    .end local v22    # "insertActivateInfoInDb":Z
    .restart local v7    # "insertActivateInfoInDb":Z
    :catch_62d
    move-exception v0

    move/from16 v22, v7

    move-object v2, v0

    move/from16 v1, v22

    .end local v7    # "insertActivateInfoInDb":Z
    .restart local v22    # "insertActivateInfoInDb":Z
    goto :goto_63e

    .end local v22    # "insertActivateInfoInDb":Z
    .local v1, "insertActivateInfoInDb":Z
    :catch_634
    move-exception v0

    move-object v2, v0

    goto :goto_63e

    .line 1297
    .restart local v11    # "iNewActivateState":I
    .restart local v18    # "activateVpnProfileValidation":I
    .restart local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v33    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :cond_637
    move-object/from16 v2, v33

    .line 1395
    .end local v11    # "iNewActivateState":I
    .end local v18    # "activateVpnProfileValidation":I
    .end local v19    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v33    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :goto_639
    goto :goto_67c

    .line 1388
    .end local v21    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .local v11, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    :catch_63a
    move-exception v0

    move-object/from16 v21, v11

    move-object v2, v0

    .line 1389
    .end local v11    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .local v2, "e":Ljava/lang/Exception;
    .restart local v21    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    :goto_63e
    :try_start_63e
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Error occured while activating the vpn profile: exception occured: The error code is -1"

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1391
    const/16 v26, 0x3

    const/16 v27, 0x5

    const/16 v28, 0x0

    .line 1392
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v29

    const-string v30, "KnoxVpnEngineService"

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Exception occurred while activating vpn profile "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v31

    iget v3, v13, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1391
    move/from16 v32, v3

    invoke-static/range {v26 .. v32}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_67c
    .catchall {:try_start_63e .. :try_end_67c} :catchall_6c3

    .line 1397
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_67c
    :try_start_67c
    invoke-virtual {v10}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Ljava/lang/Integer;

    invoke-virtual {v2}, Ljava/lang/Integer;->intValue()I

    move-result v2

    if-nez v2, :cond_6a4

    .line 1398
    new-instance v2, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v3, "KNOX_VPN"

    const-string v4, "API:activateVpnProfile"

    const/4 v5, 0x1

    invoke-direct {v2, v3, v5, v4}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v2, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 1399
    const/4 v3, -0x1

    invoke-direct {v12, v2, v13, v14, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 1400
    iget-object v2, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v3, "enb"

    invoke-virtual {v2, v3, v15}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;Z)V

    .line 1401
    iget-object v2, v12, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v2}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_6a4
    .catch Ljava/lang/Exception; {:try_start_67c .. :try_end_6a4} :catch_6a5
    .catchall {:try_start_67c .. :try_end_6a4} :catchall_6c3

    .line 1405
    :cond_6a4
    goto :goto_6c1

    .line 1403
    :catch_6a5
    move-exception v0

    move-object v2, v0

    .line 1404
    .restart local v2    # "e":Ljava/lang/Exception;
    :try_start_6a7
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception = "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_6c1
    .catchall {:try_start_6a7 .. :try_end_6c1} :catchall_6c3

    .line 1406
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_6c1
    monitor-exit p0

    return-object v10

    .line 1143
    .end local v1    # "insertActivateInfoInDb":Z
    .end local v10    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local v16    # "uid":I
    .end local v17    # "cid":I
    .end local v21    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    .end local p3    # "enable":Z
    :catchall_6c3
    move-exception v0

    move-object v1, v0

    monitor-exit p0

    throw v1
.end method

.method public addAllContainerPackagesToVpn(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;ILjava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 13
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "containerId"    # I
    .param p3, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "I",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    .line 3244
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 3246
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string v2, "addAllContainerPackagesToVpn : containerId value is "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v2, " profileName value is "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    const-string v2, "KnoxVpnEngineService"

    invoke-static {v2, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3248
    new-instance v1, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 3249
    .local v1, "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v3, -0x1

    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v4

    invoke-virtual {v1, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3250
    const/4 v4, 0x1

    invoke-virtual {v1, v4, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 3252
    iget v5, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v5

    if-nez v5, :cond_45

    .line 3253
    const/16 v2, 0x8c

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3254
    return-object v1

    .line 3257
    :cond_45
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v5, p1, p2, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->addAllContainerPackagesToVpnValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;ILjava/lang/String;)I

    move-result v5

    .line 3258
    .local v5, "addAllContainerPackagesToVpnValidation":I
    const/16 v6, 0x64

    if-eq v5, v6, :cond_74

    .line 3259
    invoke-static {v5}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v1, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3260
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "addAllContainerPackagesToVpn failed: The error code is "

    invoke-virtual {v3, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v5}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v2, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3261
    const/16 v2, 0x71

    if-ne v5, v2, :cond_73

    .line 3262
    const/16 v2, 0xb

    invoke-virtual {v1, v4, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 3263
    :cond_73
    return-object v1

    .line 3266
    :cond_74
    iput p2, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 3267
    invoke-direct {p0, p1, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->addAllPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    move-result-object v1

    .line 3270
    :try_start_7a
    invoke-virtual {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Ljava/lang/Integer;

    invoke-virtual {v6}, Ljava/lang/Integer;->intValue()I

    move-result v6

    if-nez v6, :cond_a6

    .line 3271
    new-instance v6, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v7, "KNOX_VPN"

    const-string v8, "API:addAllContainerPackagesToVpn"

    invoke-direct {v6, v7, v4, v8}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 3272
    invoke-direct {p0, v6, p1, p3, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 3273
    iget v3, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    if-eqz v3, :cond_a1

    .line 3274
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v4, "cid"

    iget v6, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v3, v4, v6}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 3276
    :cond_a1
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v3}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_a6
    .catch Ljava/lang/Exception; {:try_start_7a .. :try_end_a6} :catch_a7

    .line 3280
    :cond_a6
    goto :goto_c0

    .line 3278
    :catch_a7
    move-exception v3

    .line 3279
    .local v3, "e":Ljava/lang/Exception;
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception = "

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v3}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v2, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 3282
    .end local v3    # "e":Ljava/lang/Exception;
    :goto_c0
    return-object v1
.end method

.method public addAllPackagesToVpn(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 12
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    .line 3289
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 3291
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    new-instance v1, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 3292
    .local v1, "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v2, -0x1

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v1, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3293
    const/4 v3, 0x1

    invoke-virtual {v1, v3, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 3295
    iget v4, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v4

    if-nez v4, :cond_27

    .line 3296
    const/16 v2, 0x8c

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3297
    return-object v1

    .line 3300
    :cond_27
    if-nez p1, :cond_2a

    return-object v1

    .line 3301
    :cond_2a
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "addAllPackagesToVpn : vpnContext.personaId value is "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget v5, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v5, " profileName value is "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    const-string v5, "KnoxVpnEngineService"

    invoke-static {v5, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3303
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v4, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->addAllPackagesToVpnValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)I

    move-result v4

    .line 3304
    .local v4, "addAllPackagesToVpnValidation":I
    const/16 v6, 0x64

    if-eq v4, v6, :cond_70

    .line 3305
    invoke-static {v4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3306
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Adding all the packages to vpn failed: The error code is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v5, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3307
    return-object v1

    .line 3310
    :cond_70
    invoke-direct {p0, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->addAllPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    move-result-object v1

    .line 3313
    :try_start_74
    invoke-virtual {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Ljava/lang/Integer;

    invoke-virtual {v6}, Ljava/lang/Integer;->intValue()I

    move-result v6

    if-nez v6, :cond_a0

    .line 3314
    new-instance v6, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v7, "KNOX_VPN"

    const-string v8, "API:addAllPackagesToVpn"

    invoke-direct {v6, v7, v3, v8}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 3315
    invoke-direct {p0, v6, p1, p2, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 3316
    iget v2, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    if-eqz v2, :cond_9b

    .line 3317
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v3, "cid"

    iget v6, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v2, v3, v6}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 3319
    :cond_9b
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v2}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_a0
    .catch Ljava/lang/Exception; {:try_start_74 .. :try_end_a0} :catch_a1

    .line 3323
    :cond_a0
    goto :goto_ba

    .line 3321
    :catch_a1
    move-exception v2

    .line 3322
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception = "

    invoke-virtual {v3, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v3, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v5, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 3325
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_ba
    return-object v1
.end method

.method public declared-synchronized addContainerPackagesToVpn(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I[Ljava/lang/String;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 13
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "containerId"    # I
    .param p3, "packageList"    # [Ljava/lang/String;
    .param p4, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "I[",
            "Ljava/lang/String;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    monitor-enter p0

    .line 2845
    :try_start_1
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 2847
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "addContainerPackagesToVpn : containerId value is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v3, " profileName value is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2849
    new-instance v1, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 2850
    .local v1, "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v2, -0x1

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v1, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2851
    const/4 v3, 0x1

    invoke-virtual {v1, v3, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 2853
    iget v4, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v4

    if-nez v4, :cond_47

    .line 2854
    const/16 v2, 0x8c

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_45
    .catchall {:try_start_1 .. :try_end_45} :catchall_fe

    .line 2855
    monitor-exit p0

    return-object v1

    .line 2858
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_47
    :try_start_47
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v4, p1, p2, p3, p4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->addContainerPackagesToVpnValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I[Ljava/lang/String;Ljava/lang/String;)I

    move-result v4

    .line 2859
    .local v4, "addContainerPackagesToVpnValidation":I
    const/16 v5, 0x64

    if-eq v4, v5, :cond_79

    .line 2860
    invoke-static {v4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2861
    const-string v2, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Error occured while adding container packages to vpn: The error code is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v2, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2862
    const/16 v2, 0x71

    if-ne v4, v2, :cond_77

    .line 2863
    const/16 v2, 0xb

    invoke-virtual {v1, v3, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_77
    .catchall {:try_start_47 .. :try_end_77} :catchall_fe

    .line 2864
    :cond_77
    monitor-exit p0

    return-object v1

    .line 2867
    :cond_79
    :try_start_79
    iput p2, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2868
    invoke-direct {p0, p1, p3, p4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->addPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;[Ljava/lang/String;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    move-result-object v5
    :try_end_7f
    .catchall {:try_start_79 .. :try_end_7f} :catchall_fe

    move-object v1, v5

    .line 2871
    :try_start_80
    invoke-virtual {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Ljava/lang/Integer;

    invoke-virtual {v5}, Ljava/lang/Integer;->intValue()I

    move-result v5

    if-nez v5, :cond_e0

    .line 2872
    new-instance v5, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v6, "KNOX_VPN"

    const-string v7, "API:addContainerPackagesToVpn"

    invoke-direct {v5, v6, v3, v7}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 2873
    invoke-direct {p0, v5, p1, p4, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 2874
    invoke-static {p3}, Ljava/util/Arrays;->sort([Ljava/lang/Object;)V

    .line 2875
    new-instance v2, Ljava/lang/StringBuffer;

    const/4 v3, 0x0

    aget-object v3, p3, v3

    invoke-direct {v2, v3}, Ljava/lang/StringBuffer;-><init>(Ljava/lang/String;)V

    .line 2876
    .local v2, "pkgList":Ljava/lang/StringBuffer;
    const/4 v3, 0x1

    .local v3, "i":I
    :goto_a6
    array-length v5, p3

    if-ge v3, v5, :cond_c2

    .line 2877
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, ","

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    aget-object v6, p3, v3

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v2, v5}, Ljava/lang/StringBuffer;->append(Ljava/lang/String;)Ljava/lang/StringBuffer;

    .line 2876
    add-int/lit8 v3, v3, 0x1

    goto :goto_a6

    .line 2879
    .end local v3    # "i":I
    :cond_c2
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string/jumbo v5, "pkgLst"

    invoke-virtual {v2}, Ljava/lang/StringBuffer;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v3, v5, v6}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;Ljava/lang/String;)V

    .line 2880
    iget v3, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    if-eqz v3, :cond_db

    .line 2881
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v5, "cid"

    iget v6, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v3, v5, v6}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 2883
    :cond_db
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v3}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_e0
    .catch Ljava/lang/Exception; {:try_start_80 .. :try_end_e0} :catch_e1
    .catchall {:try_start_80 .. :try_end_e0} :catchall_fe

    .line 2887
    .end local v2    # "pkgList":Ljava/lang/StringBuffer;
    :cond_e0
    goto :goto_fc

    .line 2885
    :catch_e1
    move-exception v2

    .line 2886
    .local v2, "e":Ljava/lang/Exception;
    :try_start_e2
    const-string v3, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception = "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v3, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_fc
    .catchall {:try_start_e2 .. :try_end_fc} :catchall_fe

    .line 2889
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_fc
    monitor-exit p0

    return-object v1

    .line 2844
    .end local v0    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v1    # "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local v4    # "addContainerPackagesToVpnValidation":I
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "containerId":I
    .end local p3    # "packageList":[Ljava/lang/String;
    .end local p4    # "profileName":Ljava/lang/String;
    :catchall_fe
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method public addExemptUidListForNetwork(Landroid/net/NetworkInfo;)V
    .registers 20
    .param p1, "ni"    # Landroid/net/NetworkInfo;

    .line 7106
    move-object/from16 v7, p0

    const/4 v8, -0x1

    .local v8, "uid":I
    const/4 v9, -0x1

    .line 7107
    .local v9, "cid":I
    if-nez p1, :cond_7

    .line 7108
    return-void

    .line 7109
    :cond_7
    invoke-static {}, Landroid/os/Binder;->getCallingUid()I

    move-result v0

    const/16 v1, 0x3e8

    if-eq v0, v1, :cond_10

    .line 7110
    return-void

    .line 7112
    :cond_10
    invoke-virtual/range {p1 .. p1}, Landroid/net/NetworkInfo;->getprofileName()Ljava/lang/String;

    move-result-object v10

    .line 7113
    .local v10, "profileName":Ljava/lang/String;
    iget-object v0, v7, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v11

    .line 7114
    .local v11, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v11, :cond_1d

    .line 7115
    return-void

    .line 7117
    :cond_1d
    invoke-virtual {v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v0

    if-nez v0, :cond_24

    .line 7118
    return-void

    .line 7120
    :cond_24
    invoke-virtual {v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v12

    .line 7121
    .local v12, "activateState":I
    if-nez v12, :cond_2b

    .line 7122
    return-void

    .line 7124
    :cond_2b
    invoke-virtual/range {p1 .. p1}, Landroid/net/NetworkInfo;->getKnoxInterfaceName()Ljava/lang/String;

    move-result-object v13

    .line 7125
    .local v13, "interfaceName":Ljava/lang/String;
    if-nez v13, :cond_32

    .line 7126
    return-void

    .line 7128
    :cond_32
    iget-object v0, v7, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getActiveNetworkInterface()Ljava/lang/String;

    move-result-object v14

    .line 7129
    .local v14, "defaultInterface":Ljava/lang/String;
    if-nez v14, :cond_3b

    .line 7130
    return-void

    .line 7132
    :cond_3b
    invoke-virtual/range {p1 .. p1}, Landroid/net/NetworkInfo;->getInterfaceType()I

    move-result v15

    .line 7133
    .local v15, "interfaceType":I
    invoke-virtual {v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v0

    invoke-virtual {v0}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v16

    :goto_47
    invoke-interface/range {v16 .. v16}, Ljava/util/Iterator;->hasNext()Z

    move-result v0

    if-eqz v0, :cond_64

    invoke-interface/range {v16 .. v16}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Ljava/lang/Integer;

    invoke-virtual {v0}, Ljava/lang/Integer;->intValue()I

    move-result v17

    .line 7134
    .local v17, "uid1":I
    const/4 v1, 0x1

    const/4 v2, 0x3

    move-object/from16 v0, p0

    move/from16 v3, v17

    move v4, v15

    move-object v5, v13

    move-object v6, v14

    invoke-direct/range {v0 .. v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateRulesToExemptUid(IIIILjava/lang/String;Ljava/lang/String;)V

    .line 7135
    .end local v17    # "uid1":I
    goto :goto_47

    .line 7136
    :cond_64
    return-void
.end method

.method public declared-synchronized addPackagesToVpn(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;[Ljava/lang/String;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 11
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "packageList"    # [Ljava/lang/String;
    .param p3, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "[",
            "Ljava/lang/String;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    monitor-enter p0

    .line 2895
    :try_start_1
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 2897
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    new-instance v1, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 2898
    .local v1, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v2, 0x0

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2899
    const/4 v2, -0x1

    const/4 v3, 0x1

    invoke-virtual {v1, v3, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 2901
    iget v4, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v4
    :try_end_19
    .catchall {:try_start_1 .. :try_end_19} :catchall_a0

    if-nez v4, :cond_1d

    .line 2902
    monitor-exit p0

    return-object v1

    .line 2905
    :cond_1d
    :try_start_1d
    invoke-direct {p0, p1, p2, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->addPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;[Ljava/lang/String;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    move-result-object v4
    :try_end_21
    .catchall {:try_start_1d .. :try_end_21} :catchall_a0

    move-object v1, v4

    .line 2908
    :try_start_22
    invoke-virtual {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Ljava/lang/Integer;

    invoke-virtual {v4}, Ljava/lang/Integer;->intValue()I

    move-result v4

    if-nez v4, :cond_82

    .line 2909
    new-instance v4, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v5, "KNOX_VPN"

    const-string v6, "API:addPackagesToVpn"

    invoke-direct {v4, v5, v3, v6}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 2910
    invoke-direct {p0, v4, p1, p3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 2911
    invoke-static {p2}, Ljava/util/Arrays;->sort([Ljava/lang/Object;)V

    .line 2912
    new-instance v2, Ljava/lang/StringBuffer;

    const/4 v3, 0x0

    aget-object v3, p2, v3

    invoke-direct {v2, v3}, Ljava/lang/StringBuffer;-><init>(Ljava/lang/String;)V

    .line 2913
    .local v2, "pkgList":Ljava/lang/StringBuffer;
    const/4 v3, 0x1

    .local v3, "i":I
    :goto_48
    array-length v4, p2

    if-ge v3, v4, :cond_64

    .line 2914
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, ","

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    aget-object v5, p2, v3

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v2, v4}, Ljava/lang/StringBuffer;->append(Ljava/lang/String;)Ljava/lang/StringBuffer;

    .line 2913
    add-int/lit8 v3, v3, 0x1

    goto :goto_48

    .line 2916
    .end local v3    # "i":I
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_64
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string/jumbo v4, "pkgLst"

    invoke-virtual {v2}, Ljava/lang/StringBuffer;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v3, v4, v5}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;Ljava/lang/String;)V

    .line 2917
    iget v3, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    if-eqz v3, :cond_7d

    .line 2918
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v4, "cid"

    iget v5, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v3, v4, v5}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 2920
    :cond_7d
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v3}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_82
    .catch Ljava/lang/Exception; {:try_start_22 .. :try_end_82} :catch_83
    .catchall {:try_start_22 .. :try_end_82} :catchall_a0

    .line 2924
    .end local v2    # "pkgList":Ljava/lang/StringBuffer;
    :cond_82
    goto :goto_9e

    .line 2922
    :catch_83
    move-exception v2

    .line 2923
    .local v2, "e":Ljava/lang/Exception;
    :try_start_84
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception = "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_9e
    .catchall {:try_start_84 .. :try_end_9e} :catchall_a0

    .line 2926
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_9e
    monitor-exit p0

    return-object v1

    .line 2894
    .end local v0    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v1    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "packageList":[Ljava/lang/String;
    .end local p3    # "profileName":Ljava/lang/String;
    :catchall_a0
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method protected declared-synchronized addRulesAfterVpnEstablished(Landroid/os/Bundle;)V
    .registers 5
    .param p1, "map"    # Landroid/os/Bundle;

    monitor-enter p0

    .line 6372
    :try_start_1
    const-string v0, "bundle_profile_name"

    invoke-virtual {p1, v0}, Landroid/os/Bundle;->getString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v0

    .line 6373
    .local v0, "profileName":Ljava/lang/String;
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v1
    :try_end_d
    .catchall {:try_start_1 .. :try_end_d} :catchall_1e

    .line 6374
    .local v1, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v1, :cond_11

    .line 6375
    monitor-exit p0

    return-void

    .line 6377
    :cond_11
    :try_start_11
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v2
    :try_end_15
    .catchall {:try_start_11 .. :try_end_15} :catchall_1e

    if-nez v2, :cond_19

    .line 6378
    monitor-exit p0

    return-void

    .line 6380
    :cond_19
    :try_start_19
    invoke-direct {p0, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleChainingScenarioForStartConnection(Ljava/lang/String;)V
    :try_end_1c
    .catchall {:try_start_19 .. :try_end_1c} :catchall_1e

    .line 6381
    monitor-exit p0

    return-void

    .line 6371
    .end local v0    # "profileName":Ljava/lang/String;
    .end local v1    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .end local p1    # "map":Landroid/os/Bundle;
    :catchall_1e
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method public declared-synchronized addVpnUidRanges(Landroid/net/NetworkInfo;)V
    .registers 24
    .param p1, "ni"    # Landroid/net/NetworkInfo;
    .annotation system Ldalvik/annotation/Throws;
        value = {
            Ljava/lang/IllegalStateException;
        }
    .end annotation

    move-object/from16 v1, p0

    monitor-enter p0

    .line 6108
    :try_start_3
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v0, :cond_e

    const-string v0, "KnoxVpnEngineService"

    const-string v2, "Applying firewall rules after vpn is up"

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_e
    .catchall {:try_start_3 .. :try_end_e} :catchall_280

    .line 6109
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_e
    if-nez p1, :cond_12

    .line 6110
    monitor-exit p0

    return-void

    .line 6111
    .restart local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_12
    :try_start_12
    invoke-static {}, Landroid/os/Binder;->getCallingUid()I

    move-result v0
    :try_end_16
    .catchall {:try_start_12 .. :try_end_16} :catchall_280

    const/16 v2, 0x3e8

    if-eq v0, v2, :cond_1c

    .line 6112
    monitor-exit p0

    return-void

    .line 6114
    :cond_1c
    :try_start_1c
    invoke-virtual/range {p1 .. p1}, Landroid/net/NetworkInfo;->getprofileName()Ljava/lang/String;

    move-result-object v0

    move-object v3, v0

    .line 6115
    .local v3, "profileName":Ljava/lang/String;
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0
    :try_end_27
    .catchall {:try_start_1c .. :try_end_27} :catchall_280

    move-object v4, v0

    .line 6116
    .local v4, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v4, :cond_2c

    .line 6117
    monitor-exit p0

    return-void

    .line 6119
    :cond_2c
    :try_start_2c
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v0
    :try_end_30
    .catchall {:try_start_2c .. :try_end_30} :catchall_280

    if-nez v0, :cond_34

    .line 6120
    monitor-exit p0

    return-void

    .line 6123
    :cond_34
    :try_start_34
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v0

    move v5, v0

    .line 6124
    .local v5, "isProfileActivated":I
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageCount()I

    move-result v0

    move v6, v0

    .line 6125
    .local v6, "packageCount":I
    const/4 v7, 0x1

    if-eqz v5, :cond_45

    if-gtz v6, :cond_62

    if-ne v5, v7, :cond_62

    .line 6126
    :cond_45
    const-string v0, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v9, "Applying firewall rules after vpn is up is stopped for the profile "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v0, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6127
    invoke-virtual {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v0

    move-object v8, v0

    .line 6128
    .local v8, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v8, :cond_275

    .line 6138
    .end local v8    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :cond_62
    invoke-virtual/range {p1 .. p1}, Landroid/net/NetworkInfo;->getKnoxInterfaceName()Ljava/lang/String;

    move-result-object v0

    move-object v14, v0

    .line 6139
    .local v14, "tunInterfaceName":Ljava/lang/String;
    invoke-virtual {v4, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setInterfaceName(Ljava/lang/String;)V

    .line 6141
    invoke-virtual/range {p1 .. p1}, Landroid/net/NetworkInfo;->getV4Address()Ljava/lang/String;

    move-result-object v0

    move-object v15, v0

    .line 6142
    .local v15, "tunInterfaceAddress":Ljava/lang/String;
    invoke-virtual {v4, v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setInterfaceAddress(Ljava/lang/String;)V

    .line 6144
    invoke-virtual/range {p1 .. p1}, Landroid/net/NetworkInfo;->getV6Address()Ljava/lang/String;

    move-result-object v0

    move-object v13, v0

    .line 6145
    .local v13, "tunV6InterfaceAddress":Ljava/lang/String;
    invoke-virtual {v4, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setV6InterfaceAddress(Ljava/lang/String;)V

    .line 6147
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getActiveNetworkInterface()Ljava/lang/String;

    move-result-object v0

    move-object v12, v0

    .line 6148
    .local v12, "defaultInterface":Ljava/lang/String;
    invoke-virtual {v4, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setDefaultInterface(Ljava/lang/String;)V

    .line 6150
    invoke-virtual/range {p1 .. p1}, Landroid/net/NetworkInfo;->getInterfaceType()I

    move-result v0

    move v11, v0

    .line 6151
    .local v11, "interfaceType":I
    invoke-virtual {v4, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setInterfaceType(I)V

    .line 6153
    const-string v0, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v9, "addVpnUidRanges:defaultInterface value to which the virual tunnel is added is "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v9, " for the profile "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v9, " with interface type "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v11}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v0, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6156
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v0

    move/from16 v16, v0

    .line 6157
    .local v16, "vendorUid":I
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v0

    move-object v10, v0

    .line 6158
    .local v10, "vendorPackageName":Ljava/lang/String;
    invoke-static/range {v16 .. v16}, Landroid/os/UserHandle;->getAppId(I)I

    move-result v0

    if-ne v0, v2, :cond_cf

    const-string v0, "com.samsung.sVpn"

    invoke-virtual {v10, v0}, Ljava/lang/String;->contains(Ljava/lang/CharSequence;)Z

    move-result v0

    if-eqz v0, :cond_cf

    .line 6159
    invoke-virtual {v4, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setVpnType(I)V

    goto :goto_d3

    .line 6161
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_cf
    const/4 v0, 0x0

    invoke-virtual {v4, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setVpnType(I)V

    .line 6164
    :goto_d3
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v0

    move-object v2, v0

    .line 6167
    .local v2, "ipChainName":Ljava/lang/String;
    const-string v0, "Strawberry"

    const-string v8, "Combination"

    invoke-virtual {v0, v8}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v0

    if-eqz v0, :cond_110

    const-string v0, "33"

    .line 6168
    invoke-static {v0}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I

    move-result v0

    const/16 v8, 0x1c

    if-lt v0, v8, :cond_110

    .line 6170
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVpnType()I

    move-result v0
    :try_end_f0
    .catchall {:try_start_34 .. :try_end_f0} :catchall_280

    if-ne v0, v7, :cond_110

    .line 6171
    const/4 v8, -0x1

    .line 6173
    .local v8, "defaultNetworkId":I
    :try_start_f3
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getConnectivityManagerService()Landroid/net/IConnectivityManager;

    move-result-object v0

    invoke-interface {v0}, Landroid/net/IConnectivityManager;->getNetIdforDefaultInterface()I

    move-result v0
    :try_end_fb
    .catch Landroid/os/RemoteException; {:try_start_f3 .. :try_end_fb} :catch_fd
    .catchall {:try_start_f3 .. :try_end_fb} :catchall_280

    move v8, v0

    .line 6176
    goto :goto_fe

    .line 6174
    :catch_fd
    move-exception v0

    .line 6177
    :goto_fe
    const/4 v0, -0x1

    if-eq v8, v0, :cond_110

    .line 6178
    :try_start_101
    const-string v0, "KnoxVpnEngineService"

    const-string v9, "addRulesForStrongswanP $$$ BEYOND EXYNOS CASE $$$"

    invoke-static {v0, v9}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6179
    invoke-virtual {v4, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setDefaultNetworkId(I)V

    .line 6180
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v0, v11, v8, v12}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForStrongswanP(IILjava/lang/String;)V

    .line 6186
    .end local v8    # "defaultNetworkId":I
    :cond_110
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v8

    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v9

    invoke-virtual {v0, v8, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addNatRules(Ljava/lang/String;I)V

    .line 6188
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v8

    invoke-virtual {v0, v14, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addIpRouteAndPolicyRules(Ljava/lang/String;I)V

    .line 6190
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v0, v2, v14, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForNoUidPackets(Ljava/lang/String;Ljava/lang/String;I)V

    .line 6192
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v8

    invoke-virtual {v0, v14, v8, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMarkingRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;I)V

    .line 6194
    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->addMiscRulesForProfile(Ljava/lang/String;)V

    .line 6196
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v0, v11, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesToAcceptIncomingPackets(ILjava/lang/String;)V

    .line 6204
    iget-object v8, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    const/4 v9, 0x0

    move-object/from16 v17, v10

    .end local v10    # "vendorPackageName":Ljava/lang/String;
    .local v17, "vendorPackageName":Ljava/lang/String;
    move-object v10, v14

    move/from16 v18, v11

    .end local v11    # "interfaceType":I
    .local v18, "interfaceType":I
    move-object v11, v15

    move-object/from16 v19, v12

    .end local v12    # "defaultInterface":Ljava/lang/String;
    .local v19, "defaultInterface":Ljava/lang/String;
    move-object/from16 v20, v13

    .end local v13    # "tunV6InterfaceAddress":Ljava/lang/String;
    .local v20, "tunV6InterfaceAddress":Ljava/lang/String;
    invoke-virtual/range {v8 .. v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->updateDropRulesForNoUidPackets(ILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V

    .line 6207
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbTethering()I

    move-result v0
    :try_end_150
    .catchall {:try_start_101 .. :try_end_150} :catchall_280

    if-ne v0, v7, :cond_1c7

    .line 6211
    :try_start_152
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getInterfaceNameForUsbtethering()Ljava/lang/String;

    move-result-object v0

    .line 6212
    .local v0, "usbTetheringIface":Ljava/lang/String;
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbtetherAuth()I

    move-result v8

    move v12, v8

    .line 6213
    .local v12, "isUsbTetherAuthEnabled":I
    if-eqz v0, :cond_1c3

    .line 6214
    if-ne v12, v7, :cond_1a7

    .line 6215
    iget-object v8, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    invoke-virtual {v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->getTetherAuthStatus()Z

    move-result v8

    if-eqz v8, :cond_18d

    .line 6216
    const-string v8, "KnoxVpnTetherAuthentication"

    const-string/jumbo v9, "vpn is up and and if mutual authentication is already validated"

    invoke-static {v8, v9}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6217
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getConnectivityManagerService()Landroid/net/IConnectivityManager;

    move-result-object v8

    invoke-interface {v8, v14}, Landroid/net/IConnectivityManager;->getDnsServerListForInterface(Ljava/lang/String;)[Ljava/lang/String;

    move-result-object v11

    .line 6218
    .local v11, "dnsServerList":[Ljava/lang/String;
    iget-object v8, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v8, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getNetworkPartWithMask(Ljava/lang/String;)Ljava/util/List;

    move-result-object v13

    .line 6219
    .local v13, "networkPartList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    iget-object v8, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v10

    move-object v9, v14

    move/from16 v21, v12

    .end local v12    # "isUsbTetherAuthEnabled":I
    .local v21, "isUsbTetherAuthEnabled":I
    move-object v12, v0

    invoke-virtual/range {v8 .. v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForUsbTethering(Ljava/lang/String;I[Ljava/lang/String;Ljava/lang/String;Ljava/util/List;)V

    .line 6220
    .end local v11    # "dnsServerList":[Ljava/lang/String;
    .end local v13    # "networkPartList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    goto :goto_1c5

    .line 6221
    .end local v21    # "isUsbTetherAuthEnabled":I
    .restart local v12    # "isUsbTetherAuthEnabled":I
    :cond_18d
    move/from16 v21, v12

    .end local v12    # "isUsbTetherAuthEnabled":I
    .restart local v21    # "isUsbTetherAuthEnabled":I
    const-string v8, "KnoxVpnTetherAuthentication"

    const-string/jumbo v9, "vpn is up and if mutual authentication is going to be validated"

    invoke-static {v8, v9}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6222
    iget-object v8, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getIpAddressForUsbTetheringInterface()Ljava/util/List;

    move-result-object v8

    .line 6223
    .local v8, "usbTetherIfaceAddr":Ljava/util/List;, "Ljava/util/List<Ljava/net/InetAddress;>;"
    iget-object v9, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v10

    invoke-virtual {v9, v10, v0, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->startTetherAuthProcess(ILjava/lang/String;Ljava/util/List;)V

    .line 6224
    .end local v8    # "usbTetherIfaceAddr":Ljava/util/List;, "Ljava/util/List<Ljava/net/InetAddress;>;"
    goto :goto_1c5

    .line 6226
    .end local v21    # "isUsbTetherAuthEnabled":I
    .restart local v12    # "isUsbTetherAuthEnabled":I
    :cond_1a7
    move/from16 v21, v12

    .end local v12    # "isUsbTetherAuthEnabled":I
    .restart local v21    # "isUsbTetherAuthEnabled":I
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getConnectivityManagerService()Landroid/net/IConnectivityManager;

    move-result-object v8

    invoke-interface {v8, v14}, Landroid/net/IConnectivityManager;->getDnsServerListForInterface(Ljava/lang/String;)[Ljava/lang/String;

    move-result-object v11

    .line 6227
    .restart local v11    # "dnsServerList":[Ljava/lang/String;
    iget-object v8, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v8, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getNetworkPartWithMask(Ljava/lang/String;)Ljava/util/List;

    move-result-object v13

    .line 6228
    .restart local v13    # "networkPartList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    iget-object v8, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v10

    move-object v9, v14

    move-object v12, v0

    invoke-virtual/range {v8 .. v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForUsbTethering(Ljava/lang/String;I[Ljava/lang/String;Ljava/lang/String;Ljava/util/List;)V
    :try_end_1c2
    .catch Landroid/os/RemoteException; {:try_start_152 .. :try_end_1c2} :catch_1c6
    .catchall {:try_start_152 .. :try_end_1c2} :catchall_280

    goto :goto_1c5

    .line 6213
    .end local v11    # "dnsServerList":[Ljava/lang/String;
    .end local v13    # "networkPartList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    .end local v21    # "isUsbTetherAuthEnabled":I
    .restart local v12    # "isUsbTetherAuthEnabled":I
    :cond_1c3
    move/from16 v21, v12

    .line 6233
    .end local v0    # "usbTetheringIface":Ljava/lang/String;
    .end local v12    # "isUsbTetherAuthEnabled":I
    :goto_1c5
    goto :goto_1c7

    .line 6231
    :catch_1c6
    move-exception v0

    .line 6236
    :cond_1c7
    :goto_1c7
    :try_start_1c7
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyServer()Ljava/lang/String;

    move-result-object v0

    sget-object v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->DEFAULT_PROXY_SERVER:Ljava/lang/String;

    if-ne v0, v8, :cond_1db

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPacurl()Landroid/net/Uri;

    move-result-object v0

    sget-object v8, Landroid/net/Uri;->EMPTY:Landroid/net/Uri;

    if-eq v0, v8, :cond_1d8

    goto :goto_1db

    :cond_1d8
    move/from16 v9, v18

    goto :goto_22b

    .line 6237
    :cond_1db
    :goto_1db
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v0

    const/16 v8, 0x3ea

    invoke-static {v0, v8}, Landroid/os/UserHandle;->getUid(II)I

    move-result v0

    .line 6238
    .local v0, "uid":I
    iget-object v8, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    move/from16 v9, v18

    .end local v18    # "interfaceType":I
    .local v9, "interfaceType":I
    invoke-virtual {v8, v9, v14, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesToAcceptProxyPackets(ILjava/lang/String;I)V

    .line 6240
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v8

    if-nez v8, :cond_1fe

    .line 6241
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnPacProcessor()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v8

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPacurl()Landroid/net/Uri;

    move-result-object v10

    invoke-virtual {v8, v3, v14, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->bindProxyService(Ljava/lang/String;Ljava/lang/String;Landroid/net/Uri;)V

    goto :goto_22b

    .line 6243
    :cond_1fe
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnPacProcessor()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v8

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPacurl()Landroid/net/Uri;

    move-result-object v10

    invoke-virtual {v8, v3, v14, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->setCurrentProxyScript(Ljava/lang/String;Ljava/lang/String;Landroid/net/Uri;)V

    .line 6244
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnPacProcessor()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v8

    invoke-virtual {v8, v3, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->setMiscValueForPacProfile(Ljava/lang/String;Ljava/lang/String;)Z

    .line 6245
    iget-object v8, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    const/4 v10, 0x0

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v11

    invoke-virtual {v11}, Landroid/net/ProxyInfo;->getPort()I

    move-result v11

    invoke-virtual {v8, v10, v11, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesToAllowAccessToLocalHostWithValidMark(Ljava/lang/String;II)V

    .line 6246
    iget-object v8, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v10

    invoke-virtual {v10}, Landroid/net/ProxyInfo;->getPort()I

    move-result v10

    invoke-virtual {v8, v14, v10, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesToAllowAccessToLocalHostWithValidMark(Ljava/lang/String;II)V

    .line 6250
    .end local v0    # "uid":I
    :goto_22b
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v0, :cond_236

    const-string v0, "KnoxVpnEngineService"

    const-string v8, "Applying Knox VPN Analytics rules after vpn is up"

    invoke-static {v0, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6252
    :cond_236
    invoke-static {}, Ljava/lang/System;->currentTimeMillis()J

    move-result-wide v10

    invoke-virtual {v4, v10, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setVpnStartTime(J)V

    .line 6253
    invoke-static {}, Ljava/lang/System;->currentTimeMillis()J

    move-result-wide v10

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVpnStartTimeToConnect()J

    move-result-wide v12

    sub-long/2addr v10, v12

    .line 6254
    .local v10, "vpnElapsedTimeToConnect":J
    new-instance v0, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v8, "KNOX_VPN"

    const-string v12, "API:addVpnUidRanges"

    invoke-direct {v0, v8, v7, v12}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 6255
    const-string/jumbo v7, "vpnEt"

    invoke-virtual {v0, v7, v10, v11}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;J)V

    .line 6256
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string/jumbo v7, "vndrPkgN"

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v8

    invoke-virtual {v0, v7, v8}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;Ljava/lang/String;)V

    .line 6257
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v0}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V

    .line 6259
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v0, :cond_273

    const-string v0, "KnoxVpnEngineService"

    const-string v7, "Applying firewall rules after vpn is up is finished"

    invoke-static {v0, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_273
    .catchall {:try_start_1c7 .. :try_end_273} :catchall_280

    .line 6260
    :cond_273
    monitor-exit p0

    return-void

    .line 6130
    .end local v2    # "ipChainName":Ljava/lang/String;
    .end local v9    # "interfaceType":I
    .end local v10    # "vpnElapsedTimeToConnect":J
    .end local v14    # "tunInterfaceName":Ljava/lang/String;
    .end local v15    # "tunInterfaceAddress":Ljava/lang/String;
    .end local v16    # "vendorUid":I
    .end local v17    # "vendorPackageName":Ljava/lang/String;
    .end local v19    # "defaultInterface":Ljava/lang/String;
    .end local v20    # "tunV6InterfaceAddress":Ljava/lang/String;
    .local v8, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :cond_275
    :try_start_275
    invoke-interface {v8, v3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->stopConnection(Ljava/lang/String;)I
    :try_end_278
    .catch Landroid/os/RemoteException; {:try_start_275 .. :try_end_278} :catch_279
    .catchall {:try_start_275 .. :try_end_278} :catchall_280

    .line 6133
    goto :goto_27a

    .line 6131
    :catch_279
    move-exception v0

    .line 6134
    :goto_27a
    :try_start_27a
    new-instance v0, Ljava/lang/IllegalStateException;

    invoke-direct {v0}, Ljava/lang/IllegalStateException;-><init>()V

    throw v0
    :try_end_280
    .catchall {:try_start_27a .. :try_end_280} :catchall_280

    .line 6107
    .end local v3    # "profileName":Ljava/lang/String;
    .end local v4    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v5    # "isProfileActivated":I
    .end local v6    # "packageCount":I
    .end local v8    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local p1    # "ni":Landroid/net/NetworkInfo;
    :catchall_280
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method protected allowAppsToMakeDnsQueryForNetId()V
    .registers 9

    .line 7416
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v0

    .line 7418
    .local v0, "token":J
    :try_start_4
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const/4 v3, 0x0

    const-string v4, "com.android.providers.downloads"

    invoke-virtual {v2, v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v2

    .line 7419
    .local v2, "downloadUid":I
    new-instance v3, Ljava/util/ArrayList;

    invoke-direct {v3}, Ljava/util/ArrayList;-><init>()V

    .line 7420
    .local v3, "uidList":Ljava/util/List;, "Ljava/util/List<Landroid/net/UidRange;>;"
    new-instance v4, Landroid/net/UidRange;

    invoke-direct {v4, v2, v2}, Landroid/net/UidRange;-><init>(II)V

    invoke-interface {v3, v4}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 7421
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getNetworkManagementService()Landroid/os/INetworkManagementService;

    move-result-object v4

    invoke-interface {v3}, Ljava/util/List;->size()I

    move-result v5

    new-array v5, v5, [Landroid/net/UidRange;

    invoke-interface {v3, v5}, Ljava/util/List;->toArray([Ljava/lang/Object;)[Ljava/lang/Object;

    move-result-object v5

    check-cast v5, [Landroid/net/UidRange;

    invoke-interface {v4, v2, v5}, Landroid/os/INetworkManagementService;->allowAppIdToMakeDnsQueryForNetid(I[Landroid/net/UidRange;)V

    .line 7423
    const/16 v4, 0x3ea

    .line 7424
    .local v4, "blueoothUid":I
    new-instance v5, Ljava/util/ArrayList;

    invoke-direct {v5}, Ljava/util/ArrayList;-><init>()V

    move-object v3, v5

    .line 7425
    new-instance v5, Landroid/net/UidRange;

    invoke-direct {v5, v4, v4}, Landroid/net/UidRange;-><init>(II)V

    invoke-interface {v3, v5}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 7426
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getNetworkManagementService()Landroid/os/INetworkManagementService;

    move-result-object v5

    invoke-interface {v3}, Ljava/util/List;->size()I

    move-result v6

    new-array v6, v6, [Landroid/net/UidRange;

    invoke-interface {v3, v6}, Ljava/util/List;->toArray([Ljava/lang/Object;)[Ljava/lang/Object;

    move-result-object v6

    check-cast v6, [Landroid/net/UidRange;

    invoke-interface {v5, v4, v6}, Landroid/os/INetworkManagementService;->allowAppIdToMakeDnsQueryForNetid(I[Landroid/net/UidRange;)V

    .line 7428
    const/16 v5, 0x3e8

    .line 7429
    .local v5, "systemUid":I
    new-instance v6, Ljava/util/ArrayList;

    invoke-direct {v6}, Ljava/util/ArrayList;-><init>()V

    move-object v3, v6

    .line 7430
    new-instance v6, Landroid/net/UidRange;

    invoke-direct {v6, v5, v5}, Landroid/net/UidRange;-><init>(II)V

    invoke-interface {v3, v6}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 7431
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getNetworkManagementService()Landroid/os/INetworkManagementService;

    move-result-object v6

    invoke-interface {v3}, Ljava/util/List;->size()I

    move-result v7

    new-array v7, v7, [Landroid/net/UidRange;

    invoke-interface {v3, v7}, Ljava/util/List;->toArray([Ljava/lang/Object;)[Ljava/lang/Object;

    move-result-object v7

    check-cast v7, [Landroid/net/UidRange;

    invoke-interface {v6, v5, v7}, Landroid/os/INetworkManagementService;->allowAppIdToMakeDnsQueryForNetid(I[Landroid/net/UidRange;)V
    :try_end_73
    .catch Ljava/lang/Exception; {:try_start_4 .. :try_end_73} :catch_76
    .catchall {:try_start_4 .. :try_end_73} :catchall_74

    .line 7436
    .end local v2    # "downloadUid":I
    .end local v3    # "uidList":Ljava/util/List;, "Ljava/util/List<Landroid/net/UidRange;>;"
    .end local v4    # "blueoothUid":I
    .end local v5    # "systemUid":I
    goto :goto_7f

    :catchall_74
    move-exception v2

    goto :goto_84

    .line 7433
    :catch_76
    move-exception v2

    .line 7434
    .local v2, "e":Ljava/lang/Exception;
    :try_start_77
    const-string v3, "KnoxVpnEngineService"

    const-string v4, "Error at allowAppsToMakeDnsQueryForNetId"

    invoke-static {v3, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_7e
    .catchall {:try_start_77 .. :try_end_7e} :catchall_74

    .line 7436
    nop

    .end local v2    # "e":Ljava/lang/Exception;
    :goto_7f
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7437
    nop

    .line 7438
    return-void

    .line 7436
    :goto_84
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7437
    throw v2
.end method

.method public declared-synchronized allowAuthUsbTetheringOverVpn(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Landroid/os/Bundle;)I
    .registers 13
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .param p3, "whitelistInfo"    # Landroid/os/Bundle;

    monitor-enter p0

    .line 3672
    :try_start_1
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 3674
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    iget v1, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v1
    :try_end_b
    .catchall {:try_start_1 .. :try_end_b} :catchall_a1

    if-nez v1, :cond_11

    .line 3675
    const/16 v1, 0x8c

    monitor-exit p0

    return v1

    .line 3678
    :cond_11
    const/16 v1, 0x64

    .line 3680
    .local v1, "returnValue":I
    :try_start_13
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v2, p1, p2, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->allowUsbTetheringValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Landroid/os/Bundle;)I

    move-result v2
    :try_end_19
    .catchall {:try_start_13 .. :try_end_19} :catchall_a1

    move v1, v2

    .line 3681
    const/16 v2, 0x64

    if-eq v1, v2, :cond_20

    .line 3682
    monitor-exit p0

    return v1

    .line 3685
    :cond_20
    :try_start_20
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2
    :try_end_26
    .catchall {:try_start_20 .. :try_end_26} :catchall_a1

    .line 3686
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v2, :cond_2c

    .line 3687
    const/16 v1, 0x6c

    .line 3688
    monitor-exit p0

    return v1

    .line 3691
    :cond_2c
    :try_start_2c
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbTethering()I

    move-result v3
    :try_end_30
    .catch Ljava/lang/Exception; {:try_start_2c .. :try_end_30} :catch_9c
    .catchall {:try_start_2c .. :try_end_30} :catchall_a1

    const/4 v4, 0x1

    if-ne v3, v4, :cond_35

    .line 3692
    monitor-exit p0

    return v1

    .line 3695
    :cond_35
    :try_start_35
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, p2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateUsbTetheringForProfileInDb(Ljava/lang/String;I)V

    .line 3696
    invoke-virtual {v2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setUsbTethering(I)V

    .line 3697
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->registerNetdTetherEventListener(Z)V

    .line 3698
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->enableKnoxVpnFlagForTether(Z)V

    .line 3700
    invoke-virtual {v2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setUsbTetherAuth(I)V

    .line 3701
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, p2, p3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateUsbTetherAuthDetails(Ljava/lang/String;Landroid/os/Bundle;Z)V

    .line 3703
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v5, "com.samsung.knox.vpn.tether.auth"

    invoke-virtual {v3, p2, v5, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveAppsFromBatteryOptimization(Ljava/lang/String;Ljava/lang/String;Z)V

    .line 3705
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    invoke-virtual {p1}, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->getPersonaId()I

    move-result v5

    invoke-virtual {v3, p2, v5, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->bindTetherAuthService(Ljava/lang/String;ILandroid/os/Bundle;)V

    .line 3707
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getInterfaceNameForUsbtethering()Ljava/lang/String;

    move-result-object v3

    .line 3708
    .local v3, "usbTetheringIface":Ljava/lang/String;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v5

    .line 3709
    .local v5, "vpnInterface":Ljava/lang/String;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v6

    .line 3710
    .local v6, "activateState":I
    if-eqz v3, :cond_9b

    .line 3711
    if-nez v5, :cond_80

    if-ne v6, v4, :cond_80

    .line 3712
    const-string v4, "KnoxVpnTetherAuthentication"

    const-string v7, "Applying rules to drop tether packets after allowAuthUsbTetheringOverVpn API is called and before vpn comes up"

    invoke-static {v4, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3713
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForDroppingTetherPackets(Ljava/lang/String;)V

    goto :goto_9b

    .line 3714
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_80
    if-eqz v5, :cond_9b

    if-ne v6, v4, :cond_9b

    .line 3715
    const-string v4, "KnoxVpnTetherAuthentication"

    const-string/jumbo v7, "start tether auth process after allowAuthUsbTetheringOverVpn API is called"

    invoke-static {v4, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3716
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getIpAddressForUsbTetheringInterface()Ljava/util/List;

    move-result-object v4

    .line 3717
    .local v4, "usbTetherIfaceAddr":Ljava/util/List;, "Ljava/util/List<Ljava/net/InetAddress;>;"
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v8

    invoke-virtual {v7, v8, v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->startTetherAuthProcess(ILjava/lang/String;Ljava/util/List;)V
    :try_end_9b
    .catch Ljava/lang/Exception; {:try_start_35 .. :try_end_9b} :catch_9c
    .catchall {:try_start_35 .. :try_end_9b} :catchall_a1

    .line 3722
    .end local v3    # "usbTetheringIface":Ljava/lang/String;
    .end local v4    # "usbTetherIfaceAddr":Ljava/util/List;, "Ljava/util/List<Ljava/net/InetAddress;>;"
    .end local v5    # "vpnInterface":Ljava/lang/String;
    .end local v6    # "activateState":I
    :cond_9b
    :goto_9b
    goto :goto_9f

    .line 3720
    :catch_9c
    move-exception v3

    .line 3721
    .local v3, "e":Ljava/lang/Exception;
    const/16 v1, 0x65

    .line 3723
    .end local v3    # "e":Ljava/lang/Exception;
    :goto_9f
    monitor-exit p0

    return v1

    .line 3671
    .end local v0    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v1    # "returnValue":I
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    .end local p3    # "whitelistInfo":Landroid/os/Bundle;
    :catchall_a1
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method public declared-synchronized allowNoAuthUsbTetheringOverVpn(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)I
    .registers 16
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;

    monitor-enter p0

    .line 3612
    :try_start_1
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0
    :try_end_5
    .catchall {:try_start_1 .. :try_end_5} :catchall_a5

    .line 3616
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const/16 v1, 0x8d

    :try_start_7
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getEnterpriseDeviceManagerService()Lcom/samsung/android/knox/IEnterpriseDeviceManager;

    move-result-object v2
    :try_end_b
    .catch Ljava/lang/SecurityException; {:try_start_7 .. :try_end_b} :catch_a2
    .catch Landroid/os/RemoteException; {:try_start_7 .. :try_end_b} :catch_9f
    .catchall {:try_start_7 .. :try_end_b} :catchall_a5

    :try_start_b
    invoke-interface {v2, v0}, Lcom/samsung/android/knox/IEnterpriseDeviceManager;->isCallerValidKPU(Lcom/samsung/android/knox/ContextInfo;)Z

    move-result v2
    :try_end_f
    .catch Ljava/lang/SecurityException; {:try_start_b .. :try_end_f} :catch_9d
    .catch Landroid/os/RemoteException; {:try_start_b .. :try_end_f} :catch_9f
    .catchall {:try_start_b .. :try_end_f} :catchall_a5

    if-nez v2, :cond_13

    .line 3617
    monitor-exit p0

    return v1

    .line 3623
    :cond_13
    nop

    .line 3625
    :try_start_14
    iget v1, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v1
    :try_end_1a
    .catchall {:try_start_14 .. :try_end_1a} :catchall_a5

    if-nez v1, :cond_20

    .line 3626
    const/16 v1, 0x8c

    monitor-exit p0

    return v1

    .line 3629
    :cond_20
    const/16 v1, 0x64

    .line 3631
    .local v1, "returnValue":I
    :try_start_22
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    const/4 v3, 0x0

    invoke-virtual {v2, p1, p2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->allowUsbTetheringValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Landroid/os/Bundle;)I

    move-result v2
    :try_end_29
    .catchall {:try_start_22 .. :try_end_29} :catchall_a5

    move v1, v2

    .line 3632
    const/16 v2, 0x64

    if-eq v1, v2, :cond_30

    .line 3633
    monitor-exit p0

    return v1

    .line 3636
    :cond_30
    :try_start_30
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2
    :try_end_36
    .catchall {:try_start_30 .. :try_end_36} :catchall_a5

    .line 3637
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v2, :cond_3c

    .line 3638
    const/16 v1, 0x6c

    .line 3639
    monitor-exit p0

    return v1

    .line 3642
    :cond_3c
    :try_start_3c
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbTethering()I

    move-result v3
    :try_end_40
    .catch Ljava/lang/Exception; {:try_start_3c .. :try_end_40} :catch_98
    .catchall {:try_start_3c .. :try_end_40} :catchall_a5

    const/4 v4, 0x1

    if-ne v3, v4, :cond_45

    .line 3643
    monitor-exit p0

    return v1

    .line 3646
    :cond_45
    :try_start_45
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, p2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateUsbTetheringForProfileInDb(Ljava/lang/String;I)V

    .line 3647
    invoke-virtual {v2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setUsbTethering(I)V

    .line 3648
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->registerNetdTetherEventListener(Z)V

    .line 3649
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->enableKnoxVpnFlagForTether(Z)V

    .line 3651
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getInterfaceNameForUsbtethering()Ljava/lang/String;

    move-result-object v3

    .line 3652
    .local v3, "usbTetheringIface":Ljava/lang/String;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v5

    move-object v11, v5

    .line 3653
    .local v11, "vpnInterface":Ljava/lang/String;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v5

    move v12, v5

    .line 3654
    .local v12, "activateState":I
    if-eqz v3, :cond_97

    .line 3655
    if-nez v11, :cond_7a

    if-ne v12, v4, :cond_7a

    .line 3656
    const-string v4, "KnoxVpnEngineService"

    const-string v5, "Applying rules to drop tether packets after enableUsbTethering API is called and before vpn comes up"

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3657
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v4, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForDroppingTetherPackets(Ljava/lang/String;)V

    goto :goto_97

    .line 3658
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_7a
    if-eqz v11, :cond_97

    if-ne v12, v4, :cond_97

    .line 3659
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getConnectivityManagerService()Landroid/net/IConnectivityManager;

    move-result-object v4

    invoke-interface {v4, v11}, Landroid/net/IConnectivityManager;->getDnsServerListForInterface(Ljava/lang/String;)[Ljava/lang/String;

    move-result-object v8

    .line 3660
    .local v8, "dnsServerList":[Ljava/lang/String;
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getNetworkPartWithMask(Ljava/lang/String;)Ljava/util/List;

    move-result-object v10

    .line 3661
    .local v10, "networkPartList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v7

    move-object v6, v11

    move-object v9, v3

    invoke-virtual/range {v5 .. v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForUsbTethering(Ljava/lang/String;I[Ljava/lang/String;Ljava/lang/String;Ljava/util/List;)V
    :try_end_97
    .catch Ljava/lang/Exception; {:try_start_45 .. :try_end_97} :catch_98
    .catchall {:try_start_45 .. :try_end_97} :catchall_a5

    .line 3666
    .end local v3    # "usbTetheringIface":Ljava/lang/String;
    .end local v8    # "dnsServerList":[Ljava/lang/String;
    .end local v10    # "networkPartList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    .end local v11    # "vpnInterface":Ljava/lang/String;
    .end local v12    # "activateState":I
    :cond_97
    :goto_97
    goto :goto_9b

    .line 3664
    :catch_98
    move-exception v3

    .line 3665
    .local v3, "e":Ljava/lang/Exception;
    const/16 v1, 0x65

    .line 3667
    .end local v3    # "e":Ljava/lang/Exception;
    :goto_9b
    monitor-exit p0

    return v1

    .line 3619
    .end local v1    # "returnValue":I
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :catch_9d
    move-exception v2

    goto :goto_a3

    .line 3621
    :catch_9f
    move-exception v2

    .line 3622
    .local v2, "e1":Landroid/os/RemoteException;
    monitor-exit p0

    return v1

    .line 3619
    .end local v2    # "e1":Landroid/os/RemoteException;
    .restart local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :catch_a2
    move-exception v2

    .line 3620
    .local v2, "e":Ljava/lang/SecurityException;
    :goto_a3
    monitor-exit p0

    return v1

    .line 3611
    .end local v0    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v2    # "e":Ljava/lang/SecurityException;
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    :catchall_a5
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method public bindKnoxVpnInterface(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Z
    .registers 6
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;

    .line 364
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 366
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    iget v1, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v1

    if-nez v1, :cond_e

    .line 367
    const/4 v1, 0x0

    return v1

    .line 370
    :cond_e
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {p1}, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->getPersonaId()I

    move-result v2

    invoke-virtual {p1}, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->getVendorName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v1, v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v1

    iget v2, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->adminId:I

    invoke-direct {p0, v1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->bindKnoxVpnInterface(Ljava/lang/String;I)Z

    move-result v1

    return v1
.end method

.method public checkChainingStatus(Ljava/lang/String;)I
    .registers 12
    .param p1, "profileName"    # Ljava/lang/String;

    .line 7864
    const-string v0, "KnoxVpnEngineService"

    const/4 v1, 0x0

    .line 7866
    .local v1, "chaining_status":I
    :try_start_3
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 7867
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v2, :cond_89

    .line 7868
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v3

    .line 7869
    .local v3, "vendorName":Ljava/lang/String;
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "checkChainingStatus: vendorName value is "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7870
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getProfileOwningThePackage(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v4

    .line 7871
    .local v4, "profile_added_vendor_name":Ljava/lang/String;
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "checkChainingStatus: profile_added_vendor_name value is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7872
    if-eqz v4, :cond_89

    .line 7873
    invoke-virtual {p0, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v5

    .line 7874
    .local v5, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-eqz v5, :cond_89

    .line 7875
    invoke-interface {v5, v4}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getState(Ljava/lang/String;)I

    move-result v6

    .line 7876
    .local v6, "state":I
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string v8, "checkChainingStatus: state value is "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v0, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7877
    const/4 v7, 0x4

    if-eq v6, v7, :cond_76

    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mIgnoreConnectCheckForChaining:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v8

    invoke-static {v8}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v8

    invoke-virtual {v7, v8}, Ljava/util/concurrent/ConcurrentHashMap;->get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v7

    check-cast v7, Ljava/lang/Boolean;

    invoke-virtual {v7}, Ljava/lang/Boolean;->booleanValue()Z

    move-result v7

    if-eqz v7, :cond_89

    .line 7878
    :cond_76
    const/4 v1, 0x1

    .line 7879
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mIgnoreConnectCheckForChaining:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v8

    invoke-static {v8}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v8

    const/4 v9, 0x0

    invoke-static {v9}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;

    move-result-object v9

    invoke-virtual {v7, v8, v9}, Ljava/util/concurrent/ConcurrentHashMap;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
    :try_end_89
    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_89} :catch_8a

    .line 7886
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "vendorName":Ljava/lang/String;
    .end local v4    # "profile_added_vendor_name":Ljava/lang/String;
    .end local v5    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v6    # "state":I
    :cond_89
    goto :goto_a3

    .line 7884
    :catch_8a
    move-exception v2

    .line 7885
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Exception at checkChainingStatus API "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 7887
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_a3
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "checkChainingStatus: chaining_status value is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7888
    return v1
.end method

.method public checkIfCallerIsVpnVendor(I)Z
    .registers 8
    .param p1, "callingUid"    # I

    .line 8781
    const-string v0, "KnoxVpnEngineService"

    const/4 v1, 0x0

    .line 8783
    .local v1, "packageName":Ljava/lang/String;
    const/4 v2, 0x0

    :try_start_4
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-virtual {v3}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;

    move-result-object v3

    invoke-virtual {v3, p1}, Landroid/content/pm/PackageManager;->getPackagesForUid(I)[Ljava/lang/String;

    move-result-object v3

    .line 8784
    .local v3, "packageList":[Ljava/lang/String;
    if-eqz v3, :cond_33

    .line 8785
    aget-object v4, v3, v2

    move-object v1, v4

    .line 8786
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_33

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Packagename of uid "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v5, " is "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8789
    :cond_33
    invoke-static {p1}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v4

    invoke-direct {p0, v1, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->implementsVpnService(Ljava/lang/String;I)Z

    move-result v0
    :try_end_3b
    .catch Ljava/lang/Exception; {:try_start_4 .. :try_end_3b} :catch_40

    if-eqz v0, :cond_3f

    .line 8790
    const/4 v0, 0x1

    return v0

    .line 8794
    .end local v3    # "packageList":[Ljava/lang/String;
    :cond_3f
    goto :goto_59

    .line 8792
    :catch_40
    move-exception v3

    .line 8793
    .local v3, "e":Ljava/lang/Exception;
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception at checkIfCallerIsVpnVendor "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v3}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 8795
    .end local v3    # "e":Ljava/lang/Exception;
    :goto_59
    return v2
.end method

.method public checkIfLocalProxyPortExists(I)Z
    .registers 7
    .param p1, "port"    # I

    .line 8971
    const-string v0, "KnoxVpnEngineService"

    const/4 v1, 0x0

    .line 8973
    .local v1, "isLocalProxyPortExists":Z
    :try_start_3
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v2

    invoke-interface {v2}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_d
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_3f

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 8974
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v4

    invoke-virtual {v4}, Landroid/net/ProxyInfo;->getPort()I

    move-result v4

    if-ne v4, p1, :cond_3e

    .line 8975
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "The local proxy port is currently owned by the vpn profile "

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_3b
    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_3b} :catch_40

    .line 8976
    const/4 v0, 0x1

    .line 8977
    .end local v1    # "isLocalProxyPortExists":Z
    .local v0, "isLocalProxyPortExists":Z
    move v1, v0

    goto :goto_3f

    .line 8979
    .end local v0    # "isLocalProxyPortExists":Z
    .end local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v1    # "isLocalProxyPortExists":Z
    :cond_3e
    goto :goto_d

    .line 8982
    :cond_3f
    :goto_3f
    goto :goto_46

    .line 8980
    :catch_40
    move-exception v2

    .line 8981
    .local v2, "e":Ljava/lang/Exception;
    const-string v3, "Exception occured while trying to check if local proxy port exists for vpn profile"

    invoke-static {v0, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 8983
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_46
    return v1
.end method

.method public checkIfUidIsExempted(I)Z
    .registers 10
    .param p1, "uid"    # I

    .line 8941
    const/4 v0, 0x0

    .line 8944
    .local v0, "isUidExempted":Z
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_b
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_6b

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 8945
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v3

    const/4 v4, 0x1

    if-eq v3, v4, :cond_1f

    goto :goto_6a

    .line 8947
    :cond_1f
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v3

    invoke-interface {v3}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v3

    :goto_27
    invoke-interface {v3}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_6a

    invoke-interface {v3}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 8948
    .local v4, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v5

    const/4 v6, -0x2

    if-ne v5, v6, :cond_69

    .line 8949
    invoke-static {p1}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v5

    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v6

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v6

    if-ne v5, v6, :cond_69

    .line 8950
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v5

    invoke-virtual {v5}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v5

    :goto_54
    invoke-interface {v5}, Ljava/util/Iterator;->hasNext()Z

    move-result v6

    if-eqz v6, :cond_69

    invoke-interface {v5}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Ljava/lang/Integer;

    invoke-virtual {v6}, Ljava/lang/Integer;->intValue()I

    move-result v6

    .line 8951
    .local v6, "uid_1":I
    if-ne p1, v6, :cond_68

    .line 8952
    const/4 v0, 0x1

    .line 8953
    return v0

    .line 8955
    .end local v6    # "uid_1":I
    :cond_68
    goto :goto_54

    .line 8958
    .end local v4    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :cond_69
    goto :goto_27

    .line 8961
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_6a
    :goto_6a
    goto :goto_b

    .line 8962
    :cond_6b
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string v2, "checkIfUidIsExempted returned "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, v0}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v2, " for uid "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    const-string v2, "KnoxVpnEngineService"

    invoke-static {v2, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8963
    return v0
.end method

.method public checkIfVendorCreatedKnoxProfile(Ljava/lang/String;II)Z
    .registers 10
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "callerUid"    # I
    .param p3, "callerUserId"    # I

    .line 3846
    const-string v0, "KnoxVpnEngineService"

    const/4 v1, 0x0

    .line 3848
    .local v1, "profilecreatedByKnoxVendor":Z
    :try_start_3
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_1e

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "checkIfVendorCreatedKnoxProfile: profile name and the vendor uid is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3849
    :cond_1e
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 3850
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v2, :cond_5a

    .line 3851
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v3

    .line 3852
    .local v3, "vendorName":Ljava/lang/String;
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_48

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "The vendor name who created the profile is "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3853
    :cond_48
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4, p3, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUIDForPackage(ILjava/lang/String;)I

    move-result v4

    if-ne v4, p2, :cond_5a

    .line 3854
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_59

    const-string v4, "The vendor name who created the profile and the caller has the same uid"

    invoke-static {v0, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_59
    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_59} :catch_5b

    .line 3855
    :cond_59
    const/4 v1, 0x1

    .line 3860
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "vendorName":Ljava/lang/String;
    :cond_5a
    goto :goto_78

    .line 3858
    :catch_5b
    move-exception v2

    .line 3859
    .local v2, "e":Ljava/lang/Exception;
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_78

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "checkIfVendorCreatedKnoxProfile Exception :"

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 3861
    .end local v2    # "e":Ljava/lang/Exception;
    :cond_78
    :goto_78
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_90

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "checkIfVendorCreatedKnoxProfile: profilecreatedByKnoxVendor "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v1}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3862
    :cond_90
    return v1
.end method

.method public declared-synchronized createVpnProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 35
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "jsonProfile"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    move-object/from16 v1, p0

    move-object/from16 v2, p1

    move-object/from16 v3, p2

    monitor-enter p0

    .line 755
    :try_start_7
    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v4

    .line 757
    .local v4, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    new-instance v5, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 758
    .local v5, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v6, -0x1

    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-virtual {v5, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 759
    const/4 v7, 0x1

    invoke-virtual {v5, v7, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_1c
    .catchall {:try_start_7 .. :try_end_1c} :catchall_445

    .line 760
    if-nez v2, :cond_20

    monitor-exit p0

    return-object v5

    .line 763
    :cond_20
    :try_start_20
    iget-object v8, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v8, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isUsbTetheringConfigured(Ljava/lang/String;)Z

    move-result v8
    :try_end_26
    .catchall {:try_start_20 .. :try_end_26} :catchall_445

    if-eqz v8, :cond_54

    .line 765
    const/16 v8, 0x8d

    :try_start_2a
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getEnterpriseDeviceManagerService()Lcom/samsung/android/knox/IEnterpriseDeviceManager;

    move-result-object v9

    invoke-interface {v9, v4}, Lcom/samsung/android/knox/IEnterpriseDeviceManager;->isCallerValidKPU(Lcom/samsung/android/knox/ContextInfo;)Z

    move-result v9

    if-nez v9, :cond_3d

    .line 766
    invoke-static {v8}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v6

    invoke-virtual {v5, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_3b
    .catch Ljava/lang/SecurityException; {:try_start_2a .. :try_end_3b} :catch_49
    .catch Landroid/os/RemoteException; {:try_start_2a .. :try_end_3b} :catch_3e
    .catchall {:try_start_2a .. :try_end_3b} :catchall_445

    .line 767
    monitor-exit p0

    return-object v5

    .line 775
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_3d
    goto :goto_54

    .line 772
    :catch_3e
    move-exception v0

    move-object v6, v0

    .line 773
    .local v6, "e1":Landroid/os/RemoteException;
    :try_start_40
    invoke-static {v8}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-virtual {v5, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_47
    .catchall {:try_start_40 .. :try_end_47} :catchall_445

    .line 774
    monitor-exit p0

    return-object v5

    .line 769
    .end local v6    # "e1":Landroid/os/RemoteException;
    :catch_49
    move-exception v0

    move-object v6, v0

    .line 770
    .local v6, "e":Ljava/lang/SecurityException;
    :try_start_4b
    invoke-static {v8}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-virtual {v5, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_52
    .catchall {:try_start_4b .. :try_end_52} :catchall_445

    .line 771
    monitor-exit p0

    return-object v5

    .line 778
    .end local v6    # "e":Ljava/lang/SecurityException;
    :cond_54
    :goto_54
    :try_start_54
    iget v8, v4, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {v1, v2, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v8

    if-nez v8, :cond_67

    .line 779
    const/16 v6, 0x8c

    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v6

    invoke-virtual {v5, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_65
    .catchall {:try_start_54 .. :try_end_65} :catchall_445

    .line 780
    monitor-exit p0

    return-object v5

    .line 783
    :cond_67
    const/4 v8, 0x0

    .line 784
    .local v8, "profileName":Ljava/lang/String;
    :try_start_68
    iget-object v9, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->vendorName:Ljava/lang/String;

    .line 785
    .local v9, "vendorName":Ljava/lang/String;
    const-string v10, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string v12, "createVpnProfile: vendorName = "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v12, " : personaId = "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget v12, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    invoke-static {v10, v11}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 787
    iget-object v10, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v10, v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->createVpnProfileValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)I

    move-result v10

    .line 788
    .local v10, "createVpnProfileValidation":I
    const/16 v11, 0x64

    if-eq v10, v11, :cond_d5

    .line 789
    invoke-static {v10}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v6

    invoke-virtual {v5, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 790
    const-string v6, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v11, "knox vpn profile creation failed: The error code is "

    invoke-virtual {v7, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v10}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v6, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 792
    const/4 v11, 0x3

    const/4 v12, 0x5

    const/4 v13, 0x0

    .line 793
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v14

    const-string v15, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "Error occurred while validating profile information for vendor "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v16

    iget v6, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 792
    move/from16 v17, v6

    invoke-static/range {v11 .. v17}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_d3
    .catchall {:try_start_68 .. :try_end_d3} :catchall_445

    .line 797
    monitor-exit p0

    return-object v5

    .line 802
    :cond_d5
    :try_start_d5
    iget-object v11, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    iget v12, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v11, v12, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v11

    .line 803
    .local v11, "vendorNameWithCid":Ljava/lang/String;
    invoke-direct {v1, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVpnInterface(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v12
    :try_end_e1
    .catch Ljava/lang/Exception; {:try_start_d5 .. :try_end_e1} :catch_3fb
    .catchall {:try_start_d5 .. :try_end_e1} :catchall_445

    .line 804
    .local v12, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v12, :cond_fc

    .line 805
    const/16 v7, 0x6e

    :try_start_e5
    invoke-static {v7}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-virtual {v5, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 806
    const-string v7, "KnoxVpnEngineService"

    const-string/jumbo v13, "knox vpn profile creation failed: The error code is 110"

    invoke-static {v7, v13}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_f4
    .catch Ljava/lang/Exception; {:try_start_e5 .. :try_end_f4} :catch_f6
    .catchall {:try_start_e5 .. :try_end_f4} :catchall_445

    .line 807
    monitor-exit p0

    return-object v5

    .line 940
    .end local v11    # "vendorNameWithCid":Ljava/lang/String;
    .end local v12    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :catch_f6
    move-exception v0

    move-object v3, v0

    move-object/from16 v18, v4

    goto/16 :goto_3ff

    .line 810
    .restart local v11    # "vendorNameWithCid":Ljava/lang/String;
    .restart local v12    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :cond_fc
    :try_start_fc
    iget-object v13, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v13, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getProfileNameFromJsonString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v13

    move-object v8, v13

    .line 812
    invoke-direct {v1, v12, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->syncVpnProfile(Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;Ljava/lang/String;)V

    .line 814
    invoke-interface {v12, v3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->createConnection(Ljava/lang/String;)I

    move-result v13
    :try_end_10a
    .catch Ljava/lang/Exception; {:try_start_fc .. :try_end_10a} :catch_3fb
    .catchall {:try_start_fc .. :try_end_10a} :catchall_445

    .line 815
    .local v13, "profileCreated":I
    if-eqz v13, :cond_142

    .line 816
    const/16 v7, 0x66

    :try_start_10e
    invoke-static {v7}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-virtual {v5, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 817
    const-string v7, "KnoxVpnEngineService"

    const-string/jumbo v14, "knox vpn profile creation failed: The error code is 102"

    invoke-static {v7, v14}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 819
    const/4 v15, 0x3

    const/16 v16, 0x5

    const/16 v17, 0x0

    .line 820
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v18

    const-string v19, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string v14, "Error received from vendor while creating vpn connection for profile "

    invoke-virtual {v7, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v20

    iget v7, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 819
    move/from16 v21, v7

    invoke-static/range {v15 .. v21}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_140
    .catch Ljava/lang/Exception; {:try_start_10e .. :try_end_140} :catch_f6
    .catchall {:try_start_10e .. :try_end_140} :catchall_445

    .line 824
    monitor-exit p0

    return-object v5

    .line 827
    :cond_142
    :try_start_142
    iget-object v14, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    invoke-virtual {v14}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getProfileId()I

    move-result v14

    .line 829
    .local v14, "profileId":I
    const/4 v15, 0x0

    .line 830
    .local v15, "insertProfileInDb":Z
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v6, v2, v3, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addVpnProfileToDatabase(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)Z

    move-result v6

    .line 831
    .end local v15    # "insertProfileInDb":Z
    .local v6, "insertProfileInDb":Z
    if-nez v6, :cond_1d5

    .line 832
    sget-boolean v7, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z
    :try_end_153
    .catch Ljava/lang/Exception; {:try_start_142 .. :try_end_153} :catch_3fb
    .catchall {:try_start_142 .. :try_end_153} :catchall_445

    if-eqz v7, :cond_15d

    :try_start_155
    const-string v7, "KnoxVpnEngineService"

    const-string/jumbo v15, "knox vpn profile creation failed : failure to add the entry to db"

    invoke-static {v7, v15}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_15d
    .catch Ljava/lang/Exception; {:try_start_155 .. :try_end_15d} :catch_f6
    .catchall {:try_start_155 .. :try_end_15d} :catchall_445

    .line 835
    :cond_15d
    :try_start_15d
    new-instance v7, Landroid/os/Bundle;

    invoke-direct {v7}, Landroid/os/Bundle;-><init>()V

    .line 836
    .local v7, "map":Landroid/os/Bundle;
    const-string/jumbo v15, "profileName"

    invoke-virtual {v7, v15, v8}, Landroid/os/Bundle;->putString(Ljava/lang/String;Ljava/lang/String;)V

    .line 837
    const/16 v15, 0x10

    invoke-direct {v1, v15, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->sendMessageToHandler(ILandroid/os/Bundle;)V

    .line 840
    invoke-interface {v12, v8}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->removeConnection(Ljava/lang/String;)I

    move-result v15

    .line 841
    .local v15, "removeStatus":I
    sget-boolean v17, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z
    :try_end_173
    .catch Ljava/lang/Exception; {:try_start_15d .. :try_end_173} :catch_3fb
    .catchall {:try_start_15d .. :try_end_173} :catchall_445

    if-eqz v17, :cond_193

    move-object/from16 v18, v4

    .end local v4    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .local v18, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    :try_start_177
    const-string v4, "KnoxVpnEngineService"

    move/from16 v19, v6

    .end local v6    # "insertProfileInDb":Z
    .local v19, "insertProfileInDb":Z
    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    move-object/from16 v17, v7

    .end local v7    # "map":Landroid/os/Bundle;
    .local v17, "map":Landroid/os/Bundle;
    const-string/jumbo v7, "knox vpn profile creation failed : removeStatus value is "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v15}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v4, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_199

    .end local v17    # "map":Landroid/os/Bundle;
    .end local v18    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v19    # "insertProfileInDb":Z
    .restart local v4    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v6    # "insertProfileInDb":Z
    .restart local v7    # "map":Landroid/os/Bundle;
    :cond_193
    move-object/from16 v18, v4

    move/from16 v19, v6

    move-object/from16 v17, v7

    .line 842
    .end local v4    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v6    # "insertProfileInDb":Z
    .end local v7    # "map":Landroid/os/Bundle;
    .restart local v17    # "map":Landroid/os/Bundle;
    .restart local v18    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v19    # "insertProfileInDb":Z
    :goto_199
    const/16 v4, 0x7e

    invoke-static {v4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v4

    invoke-virtual {v5, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 843
    const-string v4, "KnoxVpnEngineService"

    const-string/jumbo v6, "knox vpn profile creation failed: The error code is 126"

    invoke-static {v4, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 845
    const/16 v20, 0x3

    const/16 v21, 0x5

    const/16 v22, 0x0

    .line 846
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v23

    const-string v24, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Error occurred while adding profile "

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, " into database"

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v25

    iget v4, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 845
    move/from16 v26, v4

    invoke-static/range {v20 .. v26}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_1d3
    .catch Ljava/lang/Exception; {:try_start_177 .. :try_end_1d3} :catch_3f8
    .catchall {:try_start_177 .. :try_end_1d3} :catchall_445

    .line 850
    monitor-exit p0

    return-object v5

    .line 854
    .end local v15    # "removeStatus":I
    .end local v17    # "map":Landroid/os/Bundle;
    .end local v18    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v19    # "insertProfileInDb":Z
    .restart local v4    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v6    # "insertProfileInDb":Z
    :cond_1d5
    move-object/from16 v18, v4

    move/from16 v19, v6

    .end local v4    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v6    # "insertProfileInDb":Z
    .restart local v18    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v19    # "insertProfileInDb":Z
    :try_start_1d9
    iget-object v4, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4, v2, v3, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addVpnProfileToMap(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)Z

    move-result v4

    .line 855
    .local v4, "insertProfileInLocalEntry":Z
    if-nez v4, :cond_278

    .line 856
    sget-boolean v15, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v15, :cond_1ed

    const-string v15, "KnoxVpnEngineService"

    const-string/jumbo v6, "knox vpn profile creation failed : failure to add the entry to local entry"

    invoke-static {v15, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 859
    :cond_1ed
    new-instance v6, Landroid/os/Bundle;

    invoke-direct {v6}, Landroid/os/Bundle;-><init>()V

    .line 860
    .local v6, "map":Landroid/os/Bundle;
    const-string/jumbo v15, "profileName"

    invoke-virtual {v6, v15, v8}, Landroid/os/Bundle;->putString(Ljava/lang/String;Ljava/lang/String;)V

    .line 861
    const/16 v15, 0x10

    invoke-direct {v1, v15, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->sendMessageToHandler(ILandroid/os/Bundle;)V

    .line 864
    invoke-interface {v12, v8}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->removeConnection(Ljava/lang/String;)I

    move-result v15

    .line 865
    .restart local v15    # "removeStatus":I
    sget-boolean v17, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v17, :cond_21f

    const-string v7, "KnoxVpnEngineService"

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    move/from16 v21, v4

    .end local v4    # "insertProfileInLocalEntry":Z
    .local v21, "insertProfileInLocalEntry":Z
    const-string/jumbo v4, "knox vpn profile creation failed : removeStatus value is "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v15}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v7, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_221

    .end local v21    # "insertProfileInLocalEntry":Z
    .restart local v4    # "insertProfileInLocalEntry":Z
    :cond_21f
    move/from16 v21, v4

    .line 869
    .end local v4    # "insertProfileInLocalEntry":Z
    .restart local v21    # "insertProfileInLocalEntry":Z
    :goto_221
    invoke-direct {v1, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeAllUidByTAG(Ljava/lang/String;)V

    .line 872
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v4, "VpnProfileInfo"

    const-string/jumbo v7, "profileName"

    filled-new-array {v7}, [Ljava/lang/String;

    move-result-object v7

    move-object/from16 v22, v6

    const/4 v6, 0x1

    .end local v6    # "map":Landroid/os/Bundle;
    .local v22, "map":Landroid/os/Bundle;
    new-array v6, v6, [Ljava/lang/String;

    const/16 v17, 0x0

    aput-object v8, v6, v17

    invoke-virtual {v3, v4, v7, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->deleteDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Z

    move-result v3

    .line 874
    .local v3, "removeProfileStatus":Z
    const/16 v4, 0x7f

    invoke-static {v4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v4

    invoke-virtual {v5, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 875
    const-string v4, "KnoxVpnEngineService"

    const-string/jumbo v6, "knox vpn profile creation failed: The error code is 127"

    invoke-static {v4, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 877
    const/16 v23, 0x3

    const/16 v24, 0x5

    const/16 v25, 0x0

    .line 878
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v26

    const-string v27, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Error occurred while adding vpn profile "

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, " in vpn map"

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v28

    iget v4, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 877
    move/from16 v29, v4

    invoke-static/range {v23 .. v29}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_276
    .catch Ljava/lang/Exception; {:try_start_1d9 .. :try_end_276} :catch_3f8
    .catchall {:try_start_1d9 .. :try_end_276} :catchall_445

    .line 882
    monitor-exit p0

    return-object v5

    .line 885
    .end local v3    # "removeProfileStatus":Z
    .end local v15    # "removeStatus":I
    .end local v21    # "insertProfileInLocalEntry":Z
    .end local v22    # "map":Landroid/os/Bundle;
    .restart local v4    # "insertProfileInLocalEntry":Z
    :cond_278
    move/from16 v21, v4

    .end local v4    # "insertProfileInLocalEntry":Z
    .restart local v21    # "insertProfileInLocalEntry":Z
    :try_start_27a
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v3

    invoke-interface {v3}, Ljava/util/Collection;->size()I

    move-result v3

    const/4 v4, 0x1

    if-ne v3, v4, :cond_2b7

    .line 887
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setupIntentFilter()V

    .line 888
    invoke-static {}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->getInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    move-result-object v3

    iput-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    .line 890
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->updateIpBlockingRule()V

    .line 891
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    sget-object v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->BLOCK_APP_TRAFFIC:Ljava/lang/String;

    sget-object v6, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->BLOCK_APP_TRAFFIC:Ljava/lang/String;

    const/4 v7, 0x3

    invoke-virtual {v3, v4, v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForNoUidPackets(Ljava/lang/String;Ljava/lang/String;I)V

    .line 893
    const-string v3, "KnoxVpnEngineService"

    const-string v4, "Setting the system property to confirm Generic vpn policy has been configured"

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 894
    const-string/jumbo v3, "net.vpn.framework"

    const-string v4, "2.0"

    invoke-static {v3, v4}, Landroid/os/SystemProperties;->set(Ljava/lang/String;Ljava/lang/String;)V

    .line 896
    invoke-virtual/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->allowAppsToMakeDnsQueryForNetId()V

    .line 899
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v4, "com.android.vpndialogs"

    const/4 v6, 0x1

    invoke-virtual {v3, v8, v4, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveAppsFromBatteryOptimization(Ljava/lang/String;Ljava/lang/String;Z)V

    .line 902
    :cond_2b7
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getConnectionType(Ljava/lang/String;)I

    move-result v3

    .line 903
    .local v3, "connectionType":I
    const/4 v4, 0x1

    if-ne v3, v4, :cond_2cd

    .line 904
    iget-object v4, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mProcessManager:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;->isProcessObserverRegistered()Z

    move-result v4

    if-nez v4, :cond_2cd

    .line 905
    iget-object v4, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mProcessManager:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;->registerProcessObserver()V

    .line 909
    :cond_2cd
    iget-object v4, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUidForPackageName(Ljava/lang/String;)I

    move-result v4

    invoke-direct {v1, v4, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->addExemptRulesForUid(ILjava/lang/String;)V

    .line 912
    iget-object v4, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v6, "com.knox.vpn.proxyhandler"

    const/4 v7, 0x1

    invoke-virtual {v4, v8, v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveSystemAppFromBatteryOptimization(Ljava/lang/String;Ljava/lang/String;Z)V

    .line 914
    iget-object v4, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4, v8, v9, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveAppsFromBatteryOptimization(Ljava/lang/String;Ljava/lang/String;Z)V

    .line 916
    iget-object v4, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    iget v6, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    const/16 v7, 0x3ea

    invoke-static {v6, v7}, Landroid/os/UserHandle;->getUid(II)I

    move-result v6

    const/4 v7, 0x1

    invoke-virtual {v4, v8, v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveSystemAppFromDataSaverWhitelist(Ljava/lang/String;IZ)V

    .line 919
    iget-object v4, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->setRandomIpChainName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v4

    .line 920
    .local v4, "ipChainName":Ljava/lang/String;
    const-string v6, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string v15, "The IP Chain Name obtained for the profile "

    invoke-virtual {v7, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v15, " is "

    invoke-virtual {v7, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v6, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 921
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v6, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->createIpChainForProfile(Ljava/lang/String;)V

    .line 922
    iget-object v6, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v6, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesInOutputChain(Ljava/lang/String;)V

    .line 924
    const-string v6, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v15, "profileid : "

    invoke-virtual {v7, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v14}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v6, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 925
    const-string/jumbo v6, "profileCount"

    filled-new-array {v6}, [Ljava/lang/String;

    move-result-object v6

    .line 926
    .local v6, "columns":[Ljava/lang/String;
    const/4 v7, 0x1

    new-array v15, v7, [Ljava/lang/String;

    invoke-static {v14}, Ljava/lang/String;->valueOf(I)Ljava/lang/String;

    move-result-object v7

    const/16 v20, 0x0

    aput-object v7, v15, v20

    move-object v7, v15

    .line 927
    .local v7, "values":[Ljava/lang/String;
    new-instance v15, Landroid/content/ContentValues;

    invoke-direct {v15}, Landroid/content/ContentValues;-><init>()V

    .line 928
    .local v15, "cv":Landroid/content/ContentValues;
    move/from16 v22, v3

    .end local v3    # "connectionType":I
    .local v22, "connectionType":I
    const-string/jumbo v3, "profileCount"

    add-int/lit8 v23, v14, 0x1

    move-object/from16 v24, v4

    .end local v4    # "ipChainName":Ljava/lang/String;
    .local v24, "ipChainName":Ljava/lang/String;
    invoke-static/range {v23 .. v23}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v4

    invoke-virtual {v15, v3, v4}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Integer;)V

    .line 929
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v4, "VpnAnalyticsTable"

    invoke-virtual {v3, v4, v6, v7, v15}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->putDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;Landroid/content/ContentValues;)Z

    .line 931
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    move-object/from16 v23, v6

    .end local v6    # "columns":[Ljava/lang/String;
    .local v23, "columns":[Ljava/lang/String;
    const-string/jumbo v6, "knox vpn profile creation success: The error code is "

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v13}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 933
    const/16 v25, 0x5

    const/16 v26, 0x5

    const/16 v27, 0x1

    .line 934
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v28

    const-string v29, "KnoxVpnEngineService"

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Vpn profile "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v4, " successfully created"

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v30

    iget v3, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 933
    move/from16 v31, v3

    invoke-static/range {v25 .. v31}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 938
    invoke-static {v13}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v5, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 939
    const/4 v3, 0x0

    invoke-virtual {v5, v3, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_3b2
    .catch Ljava/lang/Exception; {:try_start_27a .. :try_end_3b2} :catch_3f8
    .catchall {:try_start_27a .. :try_end_3b2} :catchall_445

    .line 951
    .end local v7    # "values":[Ljava/lang/String;
    .end local v11    # "vendorNameWithCid":Ljava/lang/String;
    .end local v12    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v13    # "profileCreated":I
    .end local v14    # "profileId":I
    .end local v15    # "cv":Landroid/content/ContentValues;
    .end local v19    # "insertProfileInDb":Z
    .end local v21    # "insertProfileInLocalEntry":Z
    .end local v22    # "connectionType":I
    .end local v23    # "columns":[Ljava/lang/String;
    .end local v24    # "ipChainName":Ljava/lang/String;
    nop

    .line 953
    :try_start_3b3
    invoke-virtual {v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Ljava/lang/Integer;

    invoke-virtual {v3}, Ljava/lang/Integer;->intValue()I

    move-result v3

    if-nez v3, :cond_3d9

    .line 954
    new-instance v3, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v4, "KNOX_VPN"

    const-string v6, "API:createVpnProfile"

    const/4 v7, 0x1

    invoke-direct {v3, v4, v7, v6}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 955
    const/4 v4, -0x1

    invoke-direct {v1, v3, v2, v8, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 956
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-direct {v1, v3, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setPropertiesWithLocalEntry(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Ljava/lang/String;)V

    .line 957
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v3}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_3d9
    .catch Ljava/lang/Exception; {:try_start_3b3 .. :try_end_3d9} :catch_3da
    .catchall {:try_start_3b3 .. :try_end_3d9} :catchall_445

    .line 961
    :cond_3d9
    goto :goto_3f6

    .line 959
    :catch_3da
    move-exception v0

    move-object v3, v0

    .line 960
    .local v3, "e":Ljava/lang/Exception;
    :try_start_3dc
    const-string v4, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "Exception = "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v3}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v4, v6}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_3f6
    .catchall {:try_start_3dc .. :try_end_3f6} :catchall_445

    .line 962
    .end local v3    # "e":Ljava/lang/Exception;
    :goto_3f6
    monitor-exit p0

    return-object v5

    .line 940
    :catch_3f8
    move-exception v0

    move-object v3, v0

    goto :goto_3ff

    .end local v18    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .local v4, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    :catch_3fb
    move-exception v0

    move-object/from16 v18, v4

    move-object v3, v0

    .line 941
    .end local v4    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v3    # "e":Ljava/lang/Exception;
    .restart local v18    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    :goto_3ff
    const/4 v4, -0x1

    :try_start_400
    invoke-static {v4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v4

    invoke-virtual {v5, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 942
    const-string v4, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "knox vpn profile creation failed: exception occured: The error code is -1"

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v3}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v4, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 944
    const/4 v11, 0x3

    const/4 v12, 0x5

    const/4 v13, 0x0

    .line 945
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v14

    const-string v15, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception occurred while creating vpn profile for vendor "

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v16

    iget v4, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 944
    move/from16 v17, v4

    invoke-static/range {v11 .. v17}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_443
    .catchall {:try_start_400 .. :try_end_443} :catchall_445

    .line 949
    monitor-exit p0

    return-object v5

    .line 754
    .end local v3    # "e":Ljava/lang/Exception;
    .end local v5    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local v8    # "profileName":Ljava/lang/String;
    .end local v9    # "vendorName":Ljava/lang/String;
    .end local v10    # "createVpnProfileValidation":I
    .end local v18    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "jsonProfile":Ljava/lang/String;
    :catchall_445
    move-exception v0

    move-object v2, v0

    monitor-exit p0

    throw v2
.end method

.method protected denyAppsToMakeDnsQueryForNetId()V
    .registers 7

    .line 7443
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v0

    .line 7445
    .local v0, "token":J
    const/4 v2, 0x0

    .line 7447
    .local v2, "mainUid":I
    :try_start_5
    new-instance v3, Ljava/util/ArrayList;

    invoke-direct {v3}, Ljava/util/ArrayList;-><init>()V

    .line 7448
    .local v3, "uidList":Ljava/util/List;, "Ljava/util/List<Landroid/net/UidRange;>;"
    new-instance v4, Landroid/net/UidRange;

    invoke-direct {v4, v2, v2}, Landroid/net/UidRange;-><init>(II)V

    invoke-interface {v3, v4}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 7449
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getNetworkManagementService()Landroid/os/INetworkManagementService;

    move-result-object v4

    invoke-interface {v3}, Ljava/util/List;->size()I

    move-result v5

    new-array v5, v5, [Landroid/net/UidRange;

    invoke-interface {v3, v5}, Ljava/util/List;->toArray([Ljava/lang/Object;)[Ljava/lang/Object;

    move-result-object v5

    check-cast v5, [Landroid/net/UidRange;

    invoke-interface {v4, v2, v5}, Landroid/os/INetworkManagementService;->removeAppIdFromMakingDnsQueryForNetid(I[Landroid/net/UidRange;)V
    :try_end_25
    .catch Ljava/lang/Exception; {:try_start_5 .. :try_end_25} :catch_28
    .catchall {:try_start_5 .. :try_end_25} :catchall_26

    .line 7453
    .end local v2    # "mainUid":I
    .end local v3    # "uidList":Ljava/util/List;, "Ljava/util/List<Landroid/net/UidRange;>;"
    goto :goto_31

    :catchall_26
    move-exception v2

    goto :goto_36

    .line 7450
    :catch_28
    move-exception v2

    .line 7451
    .local v2, "e":Ljava/lang/Exception;
    :try_start_29
    const-string v3, "KnoxVpnEngineService"

    const-string v4, "Error at denyAppsToMakeDnsQueryForNetId"

    invoke-static {v3, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_30
    .catchall {:try_start_29 .. :try_end_30} :catchall_26

    .line 7453
    nop

    .end local v2    # "e":Ljava/lang/Exception;
    :goto_31
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7454
    nop

    .line 7455
    return-void

    .line 7453
    :goto_36
    invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 7454
    throw v2
.end method

.method public declared-synchronized disallowUsbTetheringOverVpn(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)I
    .registers 11
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;

    monitor-enter p0

    .line 3728
    :try_start_1
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0
    :try_end_5
    .catchall {:try_start_1 .. :try_end_5} :catchall_9b

    .line 3732
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const/16 v1, 0x8d

    :try_start_7
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;
    :try_end_9
    .catch Ljava/lang/SecurityException; {:try_start_7 .. :try_end_9} :catch_98
    .catch Landroid/os/RemoteException; {:try_start_7 .. :try_end_9} :catch_95
    .catchall {:try_start_7 .. :try_end_9} :catchall_9b

    :try_start_9
    invoke-virtual {v2, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 3733
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    const/16 v3, 0x64

    if-eqz v2, :cond_2b

    .line 3734
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbTethering()I

    move-result v4
    :try_end_15
    .catch Ljava/lang/SecurityException; {:try_start_9 .. :try_end_15} :catch_93
    .catch Landroid/os/RemoteException; {:try_start_9 .. :try_end_15} :catch_95
    .catchall {:try_start_9 .. :try_end_15} :catchall_9b

    if-nez v4, :cond_19

    .line 3735
    monitor-exit p0

    return v3

    .line 3737
    :cond_19
    :try_start_19
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbtetherAuth()I

    move-result v4

    .line 3738
    .local v4, "isUsbAuthEnabled":I
    if-nez v4, :cond_2b

    .line 3739
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getEnterpriseDeviceManagerService()Lcom/samsung/android/knox/IEnterpriseDeviceManager;

    move-result-object v5

    invoke-interface {v5, v0}, Lcom/samsung/android/knox/IEnterpriseDeviceManager;->isCallerValidKPU(Lcom/samsung/android/knox/ContextInfo;)Z

    move-result v5
    :try_end_27
    .catch Ljava/lang/SecurityException; {:try_start_19 .. :try_end_27} :catch_93
    .catch Landroid/os/RemoteException; {:try_start_19 .. :try_end_27} :catch_95
    .catchall {:try_start_19 .. :try_end_27} :catchall_9b

    if-nez v5, :cond_2b

    .line 3740
    monitor-exit p0

    return v1

    .line 3748
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v4    # "isUsbAuthEnabled":I
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_2b
    nop

    .line 3750
    :try_start_2c
    iget v1, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v1
    :try_end_32
    .catchall {:try_start_2c .. :try_end_32} :catchall_9b

    if-nez v1, :cond_38

    .line 3751
    const/16 v1, 0x8c

    monitor-exit p0

    return v1

    .line 3754
    .restart local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_38
    const/16 v1, 0x64

    .line 3756
    .local v1, "returnValue":I
    :try_start_3a
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v2, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->disallowUsbTetheringValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)I

    move-result v2
    :try_end_40
    .catchall {:try_start_3a .. :try_end_40} :catchall_9b

    move v1, v2

    .line 3757
    if-eq v1, v3, :cond_45

    .line 3758
    monitor-exit p0

    return v1

    .line 3761
    :cond_45
    :try_start_45
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2
    :try_end_4b
    .catchall {:try_start_45 .. :try_end_4b} :catchall_9b

    .line 3762
    .restart local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v2, :cond_51

    .line 3763
    const/16 v1, 0x6c

    .line 3764
    monitor-exit p0

    return v1

    .line 3767
    :cond_51
    :try_start_51
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const/4 v4, 0x0

    invoke-virtual {v3, p2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateUsbTetheringForProfileInDb(Ljava/lang/String;I)V

    .line 3768
    invoke-virtual {v2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setUsbTethering(I)V

    .line 3769
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->registerNetdTetherEventListener(Z)V

    .line 3770
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->enableKnoxVpnFlagForTether(Z)V

    .line 3772
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v5

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v3, v5, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesForUsbTethering(ILjava/lang/String;)V

    .line 3774
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbtetherAuth()I

    move-result v3

    .line 3775
    .local v3, "isUsbAuthEnabled":I
    const/4 v5, 0x1

    if-ne v3, v5, :cond_8d

    .line 3776
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const/4 v7, 0x0

    invoke-virtual {v6, p2, v7, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateUsbTetherAuthDetails(Ljava/lang/String;Landroid/os/Bundle;Z)V

    .line 3777
    invoke-virtual {v2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setUsbTetherAuth(I)V

    .line 3778
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    invoke-virtual {v6, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->unbindTetherAuthService(Z)V

    .line 3779
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v6, "com.samsung.knox.vpn.tether.auth"

    invoke-virtual {v5, p2, v6, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->addOrRemoveAppsFromBatteryOptimization(Ljava/lang/String;Ljava/lang/String;Z)V
    :try_end_8d
    .catch Ljava/lang/Exception; {:try_start_51 .. :try_end_8d} :catch_8e
    .catchall {:try_start_51 .. :try_end_8d} :catchall_9b

    .line 3784
    .end local v3    # "isUsbAuthEnabled":I
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_8d
    goto :goto_91

    .line 3782
    :catch_8e
    move-exception v3

    .line 3783
    .local v3, "e":Ljava/lang/Exception;
    const/16 v1, 0x65

    .line 3785
    .end local v3    # "e":Ljava/lang/Exception;
    :goto_91
    monitor-exit p0

    return v1

    .line 3744
    .end local v1    # "returnValue":I
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :catch_93
    move-exception v2

    goto :goto_99

    .line 3746
    :catch_95
    move-exception v2

    .line 3747
    .local v2, "e1":Landroid/os/RemoteException;
    monitor-exit p0

    return v1

    .line 3744
    .end local v2    # "e1":Landroid/os/RemoteException;
    .restart local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :catch_98
    move-exception v2

    .line 3745
    .local v2, "e":Ljava/lang/SecurityException;
    :goto_99
    monitor-exit p0

    return v1

    .line 3727
    .end local v0    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v2    # "e":Ljava/lang/SecurityException;
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    :catchall_9b
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method protected declared-synchronized dump(Ljava/io/FileDescriptor;Ljava/io/PrintWriter;[Ljava/lang/String;)V
    .registers 16
    .param p1, "fd"    # Ljava/io/FileDescriptor;
    .param p2, "pw"    # Ljava/io/PrintWriter;
    .param p3, "args"    # [Ljava/lang/String;

    monitor-enter p0

    .line 9119
    :try_start_1
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    const-string v1, "android.permission.DUMP"

    invoke-virtual {v0, v1}, Landroid/content/Context;->checkCallingOrSelfPermission(Ljava/lang/String;)I

    move-result v0

    if-eqz v0, :cond_3c

    .line 9120
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v1, "knoxvpnprofileinfo: Permission Denial: can\'t dump PersonaManager from from pid="

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    .line 9121
    invoke-static {}, Landroid/os/Binder;->getCallingPid()I

    move-result v1

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v1, ", uid="

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {}, Landroid/os/Binder;->getCallingUid()I

    move-result v1

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v1, " without permission "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v1, "android.permission.DUMP"

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    .line 9120
    invoke-virtual {p2, v0}, Ljava/io/PrintWriter;->println(Ljava/lang/String;)V
    :try_end_3a
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_3a} :catch_7d5
    .catchall {:try_start_1 .. :try_end_3a} :catchall_7d3

    .line 9122
    monitor-exit p0

    return-void

    .line 9125
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_3c
    :try_start_3c
    invoke-static {}, Ljava/lang/System;->currentTimeMillis()J

    move-result-wide v0

    .line 9126
    .local v0, "now":J
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "knoxvpnprofileinfo: The profile info being printed at time "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v0, v1}, Ljava/lang/StringBuilder;->append(J)Ljava/lang/StringBuilder;

    const-string v3, "\n"

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-virtual {p2, v2}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9128
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnClientStatus:Ljava/util/List;

    invoke-interface {v2}, Ljava/util/List;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_60
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_87

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Ljava/lang/String;

    .line 9129
    .local v3, "vpnClientStatus":Ljava/lang/String;
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "knoxvpnprofileinfo:"

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v5, "\n"

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {p2, v4}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9130
    .end local v3    # "vpnClientStatus":Ljava/lang/String;
    goto :goto_60

    .line 9132
    :cond_87
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnPacProcessor:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->getKnoxVpnProxyClientStatus()Ljava/util/List;

    move-result-object v2

    invoke-interface {v2}, Ljava/util/List;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_91
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_b8

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Ljava/lang/String;

    .line 9133
    .local v3, "knoxVpnProxyClientStatus":Ljava/lang/String;
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "knoxvpnprofileinfo:"

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v5, "\n"

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {p2, v4}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9134
    .end local v3    # "knoxVpnProxyClientStatus":Ljava/lang/String;
    goto :goto_91

    .line 9136
    :cond_b8
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->getKnoxVpnTetherAuthClientStatus()Ljava/util/List;

    move-result-object v2

    invoke-interface {v2}, Ljava/util/List;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_c2
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_e9

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Ljava/lang/String;

    .line 9137
    .local v3, "knoxVpnTetherAuthClientStatus":Ljava/lang/String;
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "knoxvpnprofileinfo:"

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v5, "\n"

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {p2, v4}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9138
    .end local v3    # "knoxVpnTetherAuthClientStatus":Ljava/lang/String;
    goto :goto_c2

    .line 9140
    :cond_e9
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getAMSInstance()Lcom/android/server/am/ActivityManagerService;

    move-result-object v2

    invoke-virtual {v2}, Lcom/android/server/am/ActivityManagerService;->getProcessesInErrorState()Ljava/util/List;

    move-result-object v2

    .line 9141
    .local v2, "list":Ljava/util/List;, "Ljava/util/List<Landroid/app/ActivityManager$ProcessErrorStateInfo;>;"
    if-eqz v2, :cond_1bb

    .line 9142
    invoke-interface {v2}, Ljava/util/List;->iterator()Ljava/util/Iterator;

    move-result-object v3

    :goto_f7
    invoke-interface {v3}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_1bb

    invoke-interface {v3}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Landroid/app/ActivityManager$ProcessErrorStateInfo;

    .line 9143
    .local v4, "info":Landroid/app/ActivityManager$ProcessErrorStateInfo;
    iget-object v5, v4, Landroid/app/ActivityManager$ProcessErrorStateInfo;->processName:Ljava/lang/String;

    if-eqz v5, :cond_1b9

    iget-object v5, v4, Landroid/app/ActivityManager$ProcessErrorStateInfo;->processName:Ljava/lang/String;

    const-string v6, "com.knox.vpn.proxyhandler"

    invoke-virtual {v5, v6}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v5

    if-eqz v5, :cond_1b9

    .line 9144
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: knox vpn proxy apk error condition is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget v6, v4, Landroid/app/ActivityManager$ProcessErrorStateInfo;->condition:I

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9145
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: knox vpn proxy apk error longMsg is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v6, v4, Landroid/app/ActivityManager$ProcessErrorStateInfo;->longMsg:Ljava/lang/String;

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9146
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: knox vpn proxy apk error shortMsg is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v6, v4, Landroid/app/ActivityManager$ProcessErrorStateInfo;->shortMsg:Ljava/lang/String;

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9147
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: knox vpn proxy apk error stackTrace is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v6, v4, Landroid/app/ActivityManager$ProcessErrorStateInfo;->stackTrace:Ljava/lang/String;

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9148
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: knox vpn proxy apk error pid is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget v6, v4, Landroid/app/ActivityManager$ProcessErrorStateInfo;->pid:I

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9149
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: knox vpn proxy apk error uid is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget v6, v4, Landroid/app/ActivityManager$ProcessErrorStateInfo;->uid:I

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9151
    .end local v4    # "info":Landroid/app/ActivityManager$ProcessErrorStateInfo;
    :cond_1b9
    goto/16 :goto_f7

    .line 9154
    :cond_1bb
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v3

    invoke-interface {v3}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v3

    :goto_1c5
    invoke-interface {v3}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_7d2

    invoke-interface {v3}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 9155
    .local v4, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: profile name is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9156
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: The default interface to which the profile is connected to is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9157
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: The vitual interface to which the profile is connected to is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9158
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: The vitual interface v4 address to which the profile is connected to is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceAddress()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9159
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: The vitual interface v6 address to which the profile is connected to is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getV6InterfaceAddress()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9160
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: The profile is triggered by the vpn client "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9161
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: The admin id of the profile is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getAdminId()I

    move-result v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9162
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: The profile has been created under the user "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9163
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: The activation state of the vpn profile "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9164
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: is chaining enabled for the profile ? "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getChainingEnabled()I

    move-result v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9165
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: is uid tracking enabled for the profile ? "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUidPidSearchEnabled()I

    move-result v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9166
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: The profile is triggered by the vpn client whose uid is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9167
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: The ipChainValue for the profile configured is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9168
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: The usb tethering for the profile configured is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbTethering()I

    move-result v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9169
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knoxvpnprofileinfo: usb interface name, if active is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getInterfaceNameForUsbtethering()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {p2, v5}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9170
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbtetherAuth()I

    move-result v5

    .line 9171
    .local v5, "isUsbTetherAuthEnabled":I
    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "knoxvpnprofileinfo: is usb tethering configured with auth "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v5}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v7, "\n"

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {p2, v6}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9172
    const/4 v6, 0x1

    if-ne v5, v6, :cond_53d

    .line 9173
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: usbTetherAuthConfig login page configured ? "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    .line 9174
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v9

    const-string/jumbo v10, "tetherLoginpage"

    const/4 v11, 0x0

    invoke-virtual {v8, v9, v10, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUsbTetheringAuthConfig(Ljava/lang/String;Ljava/lang/String;I)Z

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    .line 9173
    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9176
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: usbTetherAuthConfig response page configured ? "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    .line 9177
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v9

    const-string/jumbo v10, "tetherResponsePage"

    invoke-virtual {v8, v9, v10, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUsbTetheringAuthConfig(Ljava/lang/String;Ljava/lang/String;I)Z

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    .line 9176
    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9179
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: usbTetherAuthConfig client cert issuer CN configured ? "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    .line 9180
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v9

    const-string/jumbo v10, "tetherClientCertIssuerCN"

    invoke-virtual {v8, v9, v10, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUsbTetheringAuthConfig(Ljava/lang/String;Ljava/lang/String;I)Z

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    .line 9179
    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9182
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: usbTetherAuthConfig client cert issued CN configured ? "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    .line 9183
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v9

    const-string/jumbo v10, "tetherClientCertIssuedCN"

    invoke-virtual {v8, v9, v10, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUsbTetheringAuthConfig(Ljava/lang/String;Ljava/lang/String;I)Z

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    .line 9182
    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9185
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: usbTetherAuthConfig captive cert configured ? "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    .line 9186
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v9

    const-string/jumbo v10, "tetherCaptivePortalCert"

    invoke-virtual {v8, v9, v10, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUsbTetheringAuthConfig(Ljava/lang/String;Ljava/lang/String;I)Z

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    .line 9185
    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9188
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: usbTetherAuthConfig captive alias configured ? "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    .line 9189
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v9

    const-string/jumbo v10, "tetherCaptivePortalAlias"

    invoke-virtual {v8, v9, v10, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUsbTetheringAuthConfig(Ljava/lang/String;Ljava/lang/String;I)Z

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    .line 9188
    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9191
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: usbTetherAuthConfig ca cert configured ? "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    .line 9192
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v9

    const-string/jumbo v10, "tetherCACert"

    invoke-virtual {v8, v9, v10, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUsbTetheringAuthConfig(Ljava/lang/String;Ljava/lang/String;I)Z

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    .line 9191
    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9194
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: usbTetherAuthConfig ca alias configured ? "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    .line 9195
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v9

    const-string/jumbo v10, "tetherCAlias"

    invoke-virtual {v8, v9, v10, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUsbTetheringAuthConfig(Ljava/lang/String;Ljava/lang/String;I)Z

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    .line 9194
    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9197
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: usbTetherAuthConfig user cert configured ? "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    .line 9198
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v9

    const-string/jumbo v10, "tetherServerCert"

    invoke-virtual {v8, v9, v10, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUsbTetheringAuthConfig(Ljava/lang/String;Ljava/lang/String;I)Z

    move-result v6

    invoke-virtual {v7, v6}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v6, "\n"

    invoke-virtual {v7, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    .line 9197
    invoke-virtual {p2, v6}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9200
    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "knoxvpnprofileinfo: usbTetherAuthConfig user alias configured ? "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    .line 9201
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v8

    const-string/jumbo v9, "tetherServerAlias"

    invoke-virtual {v7, v8, v9, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUsbTetheringAuthConfig(Ljava/lang/String;Ljava/lang/String;I)Z

    move-result v7

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v7, "\n"

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    .line 9200
    invoke-virtual {p2, v6}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9203
    :cond_53d
    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "knoxvpnprofileinfo: connection type is "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVpnConnectionType()I

    move-result v7

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v7, "\n"

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {p2, v6}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9205
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v6

    invoke-interface {v6}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v6

    :goto_563
    invoke-interface {v6}, Ljava/util/Iterator;->hasNext()Z

    move-result v7

    if-eqz v7, :cond_5c8

    invoke-interface {v6}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v7

    check-cast v7, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 9206
    .local v7, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v8

    const/4 v9, -0x2

    if-ne v8, v9, :cond_59d

    .line 9207
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v8

    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v8, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v8

    .line 9208
    .local v8, "userAdded":I
    new-instance v9, Ljava/lang/StringBuilder;

    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v10, "knoxvpnprofileinfo: The following user has been added to the profile "

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9, v8}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v10, "\n"

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v9

    invoke-virtual {p2, v9}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9209
    .end local v8    # "userAdded":I
    goto :goto_5c7

    .line 9210
    :cond_59d
    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "knoxvpnprofileinfo: The following application with uid has been added to the profile "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v9

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v9, " whose package name is "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    .line 9211
    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v9, "\n"

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    .line 9210
    invoke-virtual {p2, v8}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9213
    .end local v7    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :goto_5c7
    goto :goto_563

    .line 9215
    :cond_5c8
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v6

    invoke-virtual {v6}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v6

    :goto_5d0
    invoke-interface {v6}, Ljava/util/Iterator;->hasNext()Z

    move-result v7

    if-eqz v7, :cond_5fb

    invoke-interface {v6}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v7

    check-cast v7, Ljava/lang/Integer;

    invoke-virtual {v7}, Ljava/lang/Integer;->intValue()I

    move-result v7

    .line 9216
    .local v7, "uid":I
    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "knoxvpnprofileinfo: The following application with uid has been exempted from vpn connection "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v7}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v9, "\n"

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-virtual {p2, v8}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9217
    .end local v7    # "uid":I
    goto :goto_5d0

    .line 9219
    :cond_5fb
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getUninsalledAppsFromExemptedList(Ljava/lang/String;)Ljava/util/HashSet;

    move-result-object v6

    invoke-virtual {v6}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v6

    :goto_609
    invoke-interface {v6}, Ljava/util/Iterator;->hasNext()Z

    move-result v7

    if-eqz v7, :cond_630

    invoke-interface {v6}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v7

    check-cast v7, Ljava/lang/String;

    .line 9220
    .local v7, "tPackageName":Ljava/lang/String;
    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "knoxvpnprofileinfo:Exempted app is either uninstalled by end-user or not yet installed "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v9, "\n"

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-virtual {p2, v8}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9221
    .end local v7    # "tPackageName":Ljava/lang/String;
    goto :goto_609

    .line 9223
    :cond_630
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyServer()Ljava/lang/String;

    move-result-object v6

    sget-object v7, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->DEFAULT_PROXY_SERVER:Ljava/lang/String;

    if-ne v6, v7, :cond_640

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPacurl()Landroid/net/Uri;

    move-result-object v6

    sget-object v7, Landroid/net/Uri;->EMPTY:Landroid/net/Uri;

    if-eq v6, v7, :cond_7a4

    .line 9224
    :cond_640
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v6

    .line 9225
    .local v6, "profileName":Ljava/lang/String;
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v7

    if-eqz v7, :cond_68e

    .line 9226
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v7

    invoke-virtual {v7}, Landroid/net/ProxyInfo;->getPort()I

    move-result v7

    .line 9227
    .local v7, "port":I
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v8

    invoke-virtual {v8}, Landroid/net/ProxyInfo;->getHost()Ljava/lang/String;

    move-result-object v8

    .line 9228
    .local v8, "host":Ljava/lang/String;
    new-instance v9, Ljava/lang/StringBuilder;

    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v10, "knoxvpnprofileinfo: The profile has been configured with proxy configuration whose local port as set in f/w is "

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9, v7}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v10, "\n"

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v9

    invoke-virtual {p2, v9}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9229
    new-instance v9, Ljava/lang/StringBuilder;

    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v10, "knoxvpnprofileinfo: The profile has been configured with proxy configuration whose local host as set in f/w is "

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v10, "\n"

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v9

    invoke-virtual {p2, v9}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9232
    .end local v7    # "port":I
    .end local v8    # "host":Ljava/lang/String;
    :cond_68e
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: is the proxy credentials predefined for the profile? "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->isproxyCredentialsPreDefined()Z

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9233
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: is proxy auth required for the profile "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->isProxyAuthRequired()I

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9234
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: The profile has been configured with the pac url "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPacurl()Landroid/net/Uri;

    move-result-object v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9235
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: The profile has been configured with the Static Proxy Server "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyServer()Ljava/lang/String;

    move-result-object v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9236
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: The profile has been configured with the Static Proxy port "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyPort()I

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9238
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: The proxy port retrieved from the apk is "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnPacProcessor:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    invoke-virtual {v8, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->getProxyPortForProfile(Ljava/lang/String;)I

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9239
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: check to see if proxy thread is running or not in the apk is "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnPacProcessor:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    invoke-virtual {v8, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->isProxyThreadRunning(Ljava/lang/String;)Z

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9240
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: current state of the proxy thread in the apk is "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnPacProcessor:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    invoke-virtual {v8, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->getProxythreadStatus(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9241
    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knoxvpnprofileinfo: check to see if proxy thread is alive or not in the apk is "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnPacProcessor:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    invoke-virtual {v8, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->isProxyThreadAlive(Ljava/lang/String;)Z

    move-result v8

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v8, "\n"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {p2, v7}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V

    .line 9244
    .end local v6    # "profileName":Ljava/lang/String;
    :cond_7a4
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {p0, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v6

    .line 9245
    .local v6, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-eqz v6, :cond_7d0

    .line 9246
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v7

    invoke-interface {v6, v7}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getState(Ljava/lang/String;)I

    move-result v7

    .line 9247
    .local v7, "state":I
    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "knoxvpnprofileinfo: The state of the profile in client is "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v7}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v9, "\n"

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-virtual {p2, v8}, Ljava/io/PrintWriter;->print(Ljava/lang/String;)V
    :try_end_7d0
    .catch Ljava/lang/Exception; {:try_start_3c .. :try_end_7d0} :catch_7d5
    .catchall {:try_start_3c .. :try_end_7d0} :catchall_7d3

    .line 9249
    .end local v4    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v5    # "isUsbTetherAuthEnabled":I
    .end local v6    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v7    # "state":I
    :cond_7d0
    goto/16 :goto_1c5

    .line 9252
    .end local v0    # "now":J
    .end local v2    # "list":Ljava/util/List;, "Ljava/util/List<Landroid/app/ActivityManager$ProcessErrorStateInfo;>;"
    :cond_7d2
    goto :goto_7de

    .line 9118
    .end local p1    # "fd":Ljava/io/FileDescriptor;
    .end local p2    # "pw":Ljava/io/PrintWriter;
    .end local p3    # "args":[Ljava/lang/String;
    :catchall_7d3
    move-exception p1

    goto :goto_7e0

    .line 9250
    .restart local p1    # "fd":Ljava/io/FileDescriptor;
    .restart local p2    # "pw":Ljava/io/PrintWriter;
    .restart local p3    # "args":[Ljava/lang/String;
    :catch_7d5
    move-exception v0

    .line 9251
    .local v0, "e":Ljava/lang/Exception;
    :try_start_7d6
    const-string v1, "KnoxVpnEngineService"

    const-string/jumbo v2, "knoxvpnprofileinfo: error occured while trying to print the profile state"

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_7de
    .catchall {:try_start_7d6 .. :try_end_7de} :catchall_7d3

    .line 9253
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_7de
    monitor-exit p0

    return-void

    .line 9118
    .end local p1    # "fd":Ljava/io/FileDescriptor;
    .end local p2    # "pw":Ljava/io/PrintWriter;
    .end local p3    # "args":[Ljava/lang/String;
    :goto_7e0
    monitor-exit p0

    throw p1
.end method

.method public getAllContainerPackagesInVpnProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;ILjava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 14
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "containerId"    # I
    .param p3, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "I",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "[",
            "Ljava/lang/String;",
            ">;"
        }
    .end annotation

    .line 3153
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 3155
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "getAllContainerPackagesInVpnProfile : containerId value is "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v2, " profileName value is "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    const-string v2, "KnoxVpnEngineService"

    invoke-static {v2, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3157
    const/4 v1, -0x1

    .local v1, "uid":I
    const/4 v3, -0x1

    .line 3159
    .local v3, "cid":I
    new-instance v4, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 3160
    .local v4, "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<[Ljava/lang/String;>;"
    const/4 v5, 0x0

    invoke-virtual {v4, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3161
    const/4 v5, 0x1

    const/4 v6, -0x1

    invoke-virtual {v4, v5, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 3163
    iget v5, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v5

    if-nez v5, :cond_3c

    .line 3164
    return-object v4

    .line 3167
    :cond_3c
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v5, p1, p2, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->getAllContainerPackagesInVpnProfileValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;ILjava/lang/String;)Ljava/lang/String;

    move-result-object v5

    .line 3168
    .local v5, "getAllContainerPackagesInVpnProfileValidation":Ljava/lang/String;
    if-nez v5, :cond_45

    .line 3169
    return-object v4

    .line 3172
    :cond_45
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v6, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v6

    .line 3173
    .local v6, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    const/4 v7, 0x0

    .line 3174
    .local v7, "isAddallExist":Z
    if-eqz v6, :cond_75

    .line 3175
    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v2

    invoke-interface {v2}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_56
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v8

    if-eqz v8, :cond_74

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v8

    check-cast v8, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 3176
    .local v8, "p":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    invoke-virtual {v8}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getCid()I

    move-result v3

    .line 3177
    iget-object v9, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v9, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v9

    if-eqz v9, :cond_73

    if-ne p2, v3, :cond_73

    .line 3178
    const/4 v2, 0x1

    .line 3179
    .end local v7    # "isAddallExist":Z
    .local v2, "isAddallExist":Z
    move v7, v2

    goto :goto_74

    .line 3181
    .end local v2    # "isAddallExist":Z
    .end local v8    # "p":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .restart local v7    # "isAddallExist":Z
    :cond_73
    goto :goto_56

    :cond_74
    :goto_74
    goto :goto_8a

    .line 3184
    :cond_75
    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "getAllContainerPackagesInVpnProfile: profile hashmap is  "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v2, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3187
    :goto_8a
    if-eqz v7, :cond_93

    .line 3188
    iput p2, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 3189
    invoke-direct {p0, p1, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getAllRangedPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    move-result-object v2

    return-object v2

    .line 3191
    :cond_93
    iput p2, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 3192
    invoke-direct {p0, p1, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getAllPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    move-result-object v2

    return-object v2
.end method

.method public getAllPackagesInVpnProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 14
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "[",
            "Ljava/lang/String;",
            ">;"
        }
    .end annotation

    .line 3201
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 3203
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const/4 v1, -0x1

    .local v1, "uid":I
    const/4 v2, -0x1

    .line 3204
    .local v2, "cid":I
    const/4 v3, 0x0

    .line 3205
    .local v3, "listOfPackagesOwnedByProfile":[Ljava/lang/String;
    new-instance v4, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 3206
    .local v4, "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<[Ljava/lang/String;>;"
    const/4 v5, 0x0

    invoke-virtual {v4, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3207
    const/4 v5, 0x1

    const/4 v6, -0x1

    invoke-virtual {v4, v5, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 3209
    iget v5, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v5

    if-nez v5, :cond_1e

    .line 3210
    return-object v4

    .line 3213
    :cond_1e
    if-nez p1, :cond_21

    return-object v4

    .line 3214
    :cond_21
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "getAllPackagesInVpnProfile: profileName value is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string/jumbo v6, "vpnContext.personaId value is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget v6, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    const-string v6, "KnoxVpnEngineService"

    invoke-static {v6, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3216
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v5, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->getAllPackagesInVpnProfileValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Ljava/lang/String;

    move-result-object v5

    .line 3217
    .local v5, "getAllPackagesInVpnProfileValidation":Ljava/lang/String;
    if-nez v5, :cond_4c

    .line 3218
    return-object v4

    .line 3221
    :cond_4c
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v7, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v7

    .line 3222
    .local v7, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    const/4 v8, 0x0

    .line 3223
    .local v8, "isAddallExist":Z
    if-nez v7, :cond_5b

    .line 3224
    const-string v9, "Error occured while getting all packages in vpn profile: The error code is 108"

    invoke-static {v6, v9}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3225
    return-object v4

    .line 3227
    :cond_5b
    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v6

    invoke-interface {v6}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v6

    :goto_63
    invoke-interface {v6}, Ljava/util/Iterator;->hasNext()Z

    move-result v9

    if-eqz v9, :cond_82

    invoke-interface {v6}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v9

    check-cast v9, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 3228
    .local v9, "p":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    invoke-virtual {v9}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getCid()I

    move-result v2

    .line 3229
    iget-object v10, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v10, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v10

    if-eqz v10, :cond_81

    iget v10, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    if-ne v10, v2, :cond_81

    .line 3230
    const/4 v8, 0x1

    .line 3231
    goto :goto_82

    .line 3233
    .end local v9    # "p":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :cond_81
    goto :goto_63

    .line 3234
    :cond_82
    :goto_82
    if-eqz v8, :cond_89

    .line 3235
    invoke-direct {p0, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getAllRangedPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    move-result-object v6

    return-object v6

    .line 3237
    :cond_89
    invoke-direct {p0, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getAllPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    move-result-object v6

    return-object v6
.end method

.method public declared-synchronized getAllVpnProfiles(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 19
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/util/List<",
            "Ljava/lang/String;",
            ">;>;"
        }
    .end annotation

    move-object/from16 v1, p0

    move-object/from16 v2, p1

    monitor-enter p0

    .line 1413
    :try_start_5
    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    move-object v3, v0

    .line 1415
    .local v3, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    new-instance v0, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    move-object v4, v0

    .line 1416
    .local v4, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/util/List<Ljava/lang/String;>;>;"
    const/4 v0, 0x0

    invoke-virtual {v4, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1417
    const/4 v5, 0x1

    const/4 v6, -0x1

    invoke-virtual {v4, v5, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1419
    iget v5, v3, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {v1, v2, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v5
    :try_end_1f
    .catchall {:try_start_5 .. :try_end_1f} :catchall_136

    if-nez v5, :cond_23

    .line 1420
    monitor-exit p0

    return-object v4

    .line 1423
    :cond_23
    if-nez v2, :cond_27

    monitor-exit p0

    return-object v4

    .line 1425
    :cond_27
    :try_start_27
    iget v5, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->adminId:I

    .line 1426
    .local v5, "adminId":I
    iget-object v6, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->vendorName:Ljava/lang/String;

    .line 1427
    .local v6, "vendorName":Ljava/lang/String;
    iget v7, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1428
    .local v7, "personaId":I
    iget-object v8, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v8, v7, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v8

    .line 1429
    .local v8, "vendorNameWithCid":Ljava/lang/String;
    const-string v9, "KnoxVpnEngineService"

    new-instance v10, Ljava/lang/StringBuilder;

    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v11, "getAllVpnProfiles: vendorNameWithCid value is "

    invoke-virtual {v10, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v10

    invoke-static {v9, v10}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1431
    const-string v9, "com.android.settings"

    invoke-virtual {v9, v6}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v9

    const/4 v10, 0x0

    if-eqz v9, :cond_72

    .line 1432
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVpnInfoPolicy()Lcom/samsung/android/knox/net/vpn/IVpnInfoPolicy;

    move-result-object v9
    :try_end_57
    .catchall {:try_start_27 .. :try_end_57} :catchall_136

    if-eqz v9, :cond_72

    .line 1434
    :try_start_59
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnInfoPolicy:Lcom/samsung/android/knox/net/vpn/IVpnInfoPolicy;

    invoke-interface {v0, v3}, Lcom/samsung/android/knox/net/vpn/IVpnInfoPolicy;->getAllVpnSettingsProfiles(Lcom/samsung/android/knox/ContextInfo;)Ljava/util/List;

    move-result-object v0

    .line 1435
    .local v0, "vpnSettings":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    if-eqz v0, :cond_67

    .line 1436
    invoke-virtual {v4, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1437
    invoke-virtual {v4, v10, v10}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_67
    .catch Landroid/os/RemoteException; {:try_start_59 .. :try_end_67} :catch_68
    .catchall {:try_start_59 .. :try_end_67} :catchall_136

    .line 1442
    .end local v0    # "vpnSettings":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_67
    goto :goto_70

    .line 1440
    :catch_68
    move-exception v0

    .line 1441
    .local v0, "e":Landroid/os/RemoteException;
    :try_start_69
    const-string v9, "KnoxVpnEngineService"

    const-string v10, "Exception occured while getting vpn settings profiles"

    invoke-static {v9, v10}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_70
    .catchall {:try_start_69 .. :try_end_70} :catchall_136

    .line 1443
    .end local v0    # "e":Landroid/os/RemoteException;
    :goto_70
    monitor-exit p0

    return-object v4

    .line 1447
    :cond_72
    const/4 v9, 0x0

    .line 1448
    .local v9, "tempList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    const/4 v11, 0x0

    .line 1453
    .local v11, "resultList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    :try_start_74
    invoke-direct {v1, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVpnInterface(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v12

    .line 1454
    .local v12, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v12, :cond_87

    .line 1455
    const-string v10, "KnoxVpnEngineService"

    const-string/jumbo v13, "getAllVpnProfiles: interface returned null"

    invoke-static {v10, v13}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1456
    invoke-virtual {v4, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_85
    .catch Ljava/lang/Exception; {:try_start_74 .. :try_end_85} :catch_118
    .catchall {:try_start_74 .. :try_end_85} :catchall_136

    .line 1457
    monitor-exit p0

    return-object v4

    .line 1459
    :cond_87
    :try_start_87
    invoke-interface {v12}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getAllConnections()Ljava/util/List;

    move-result-object v0

    move-object v9, v0

    .line 1460
    if-eqz v9, :cond_110

    .line 1462
    if-nez v11, :cond_9c

    invoke-interface {v9}, Ljava/util/List;->size()I

    move-result v0

    if-lez v0, :cond_9c

    .line 1463
    new-instance v0, Ljava/util/ArrayList;

    invoke-direct {v0}, Ljava/util/ArrayList;-><init>()V

    move-object v11, v0

    .line 1466
    :cond_9c
    invoke-interface {v9}, Ljava/util/List;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_a0
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v13

    if-eqz v13, :cond_110

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v13

    check-cast v13, Ljava/lang/String;

    .line 1467
    .local v13, "profile":Ljava/lang/String;
    iget-object v14, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v14, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getProfileNameFromJsonString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v14

    .line 1468
    .local v14, "profileName":Ljava/lang/String;
    sget-boolean v15, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v15, :cond_d0

    const-string v15, "KnoxVpnEngineService"

    new-instance v10, Ljava/lang/StringBuilder;

    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V

    move-object/from16 v16, v0

    const-string/jumbo v0, "getAllVpnProfiles: profileName > "

    invoke-virtual {v10, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v15, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_d2

    :cond_d0
    move-object/from16 v16, v0

    .line 1469
    :goto_d2
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v0, :cond_ed

    const-string v0, "KnoxVpnEngineService"

    new-instance v10, Ljava/lang/StringBuilder;

    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v15, "getAllVpnProfiles: profile > "

    invoke-virtual {v10, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v10

    invoke-static {v0, v10}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1470
    :cond_ed
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0

    .line 1471
    .local v0, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v0, :cond_10c

    .line 1472
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getAdminId()I

    move-result v10

    if-eq v5, v10, :cond_103

    invoke-static {v5}, Landroid/os/UserHandle;->getAppId(I)I

    move-result v10

    const/16 v15, 0x3e8

    if-ne v10, v15, :cond_10c

    .line 1473
    :cond_103
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v10

    if-ne v7, v10, :cond_10c

    .line 1474
    invoke-interface {v11, v13}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 1476
    .end local v0    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v13    # "profile":Ljava/lang/String;
    .end local v14    # "profileName":Ljava/lang/String;
    :cond_10c
    move-object/from16 v0, v16

    const/4 v10, 0x0

    goto :goto_a0

    .line 1480
    :cond_110
    invoke-virtual {v4, v11}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1481
    const/4 v0, 0x0

    invoke-virtual {v4, v0, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_117
    .catch Ljava/lang/Exception; {:try_start_87 .. :try_end_117} :catch_118
    .catchall {:try_start_87 .. :try_end_117} :catchall_136

    .line 1485
    .end local v12    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    goto :goto_134

    .line 1483
    :catch_118
    move-exception v0

    .line 1484
    .local v0, "e":Ljava/lang/Exception;
    :try_start_119
    const-string v10, "KnoxVpnEngineService"

    new-instance v12, Ljava/lang/StringBuilder;

    invoke-direct {v12}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v13, "getAllVpnProfiles exception result is "

    invoke-virtual {v12, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v13

    invoke-virtual {v12, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v12}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v12

    invoke-static {v10, v12}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_134
    .catchall {:try_start_119 .. :try_end_134} :catchall_136

    .line 1486
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_134
    monitor-exit p0

    return-object v4

    .line 1412
    .end local v3    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v4    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/util/List<Ljava/lang/String;>;>;"
    .end local v5    # "adminId":I
    .end local v6    # "vendorName":Ljava/lang/String;
    .end local v7    # "personaId":I
    .end local v8    # "vendorNameWithCid":Ljava/lang/String;
    .end local v9    # "tempList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    .end local v11    # "resultList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    :catchall_136
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method protected getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .registers 11
    .param p1, "profileName"    # Ljava/lang/String;

    .line 7567
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0

    .line 7568
    .local v0, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    const/4 v8, -0x1

    .line 7569
    .local v8, "noProfileEntryContainer":I
    if-nez v0, :cond_45

    .line 7570
    const/4 v1, 0x3

    const/4 v2, 0x5

    const/4 v3, 0x0

    .line 7571
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v4

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Error getting binder for profile "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, ". Vendor service might not be running"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    .line 7570
    const-string v5, "KnoxVpnEngineService"

    move v7, v8

    invoke-static/range {v1 .. v7}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 7574
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "get binder for profile : Profile does not exist : "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    const-string v2, "KnoxVpnEngineService"

    invoke-static {v2, v1}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 7575
    const/4 v1, 0x0

    return-object v1

    .line 7577
    :cond_45
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v1

    .line 7578
    .local v1, "vendorNameWithCid":Ljava/lang/String;
    invoke-direct {p0, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVpnInterface(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v2

    .line 7580
    .local v2, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    return-object v2
.end method

.method public getCACertificate(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 10
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Lcom/samsung/android/knox/keystore/CertificateInfo;",
            ">;"
        }
    .end annotation

    .line 1616
    const-string v0, "KnoxVpnEngineService"

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v1

    .line 1618
    .local v1, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    new-instance v2, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 1619
    .local v2, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Lcom/samsung/android/knox/keystore/CertificateInfo;>;"
    const/4 v3, 0x0

    invoke-virtual {v2, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1620
    const/4 v4, 0x1

    const/4 v5, -0x1

    invoke-virtual {v2, v4, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1622
    iget v4, v1, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v4

    if-nez v4, :cond_1d

    .line 1623
    return-object v2

    .line 1627
    :cond_1d
    :try_start_1d
    invoke-direct {p0, p1, p2, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->validateAdminAndVendorForProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;)I

    move-result v4

    if-eqz v4, :cond_24

    .line 1628
    return-object v2

    .line 1630
    :cond_24
    invoke-virtual {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v4

    .line 1631
    .local v4, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v4, :cond_31

    .line 1632
    const-string/jumbo v5, "getting CACertificate : Service is not started"

    invoke-static {v0, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 1633
    return-object v3

    .line 1635
    :cond_31
    invoke-interface {v4, p2}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getCACertificate(Ljava/lang/String;)Lcom/samsung/android/knox/keystore/CertificateInfo;

    move-result-object v5

    .line 1636
    .local v5, "cert":Lcom/samsung/android/knox/keystore/CertificateInfo;
    invoke-virtual {v2, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1637
    const/4 v6, 0x0

    invoke-virtual {v2, v6, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_3c
    .catch Ljava/lang/Exception; {:try_start_1d .. :try_end_3c} :catch_3e

    .line 1642
    .end local v4    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v5    # "cert":Lcom/samsung/android/knox/keystore/CertificateInfo;
    nop

    .line 1643
    return-object v2

    .line 1639
    :catch_3e
    move-exception v4

    .line 1640
    .local v4, "e":Ljava/lang/Exception;
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "getting CACertificate : Failure at "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v4}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v0, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 1641
    return-object v3
.end method

.method public getChainingEnabledForProfile(I)I
    .registers 8
    .param p1, "uidOfVendor"    # I

    .line 7895
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    const-string v1, "KnoxVpnEngineService"

    if-eqz v0, :cond_1b

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "getChainingEnabledForProfile: uid value is "

    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7896
    :cond_1b
    const/4 v0, -0x1

    .line 7898
    .local v0, "chainingEnabled":I
    :try_start_1c
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v2

    invoke-interface {v2}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :cond_26
    :goto_26
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_77

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 7899
    .local v3, "profileInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_4f

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "getChainingEnabledForProfile: uidOfVendor value is "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v1, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7900
    :cond_4f
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v4

    if-ne v4, p1, :cond_76

    .line 7901
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_5f

    const-string/jumbo v4, "getChainingEnabledForProfile: vendorName is same"

    invoke-static {v1, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7902
    :cond_5f
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getChainingEnabled()I

    move-result v4

    const/4 v5, 0x1

    if-ne v4, v5, :cond_26

    .line 7903
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_70

    const-string/jumbo v2, "getChainingEnabledForProfile:chaining enabled for profile"

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7904
    :cond_70
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getChainingEnabled()I

    move-result v2
    :try_end_74
    .catch Ljava/lang/Exception; {:try_start_1c .. :try_end_74} :catch_78

    move v0, v2

    .line 7905
    goto :goto_77

    .line 7910
    .end local v3    # "profileInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_76
    goto :goto_26

    .line 7913
    :cond_77
    :goto_77
    goto :goto_91

    .line 7911
    :catch_78
    move-exception v2

    .line 7912
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Exception = "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v1, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 7914
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_91
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_aa

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "getChainingEnabledForProfile: chainingEnabled value is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 7915
    :cond_aa
    return v0
.end method

.method protected getContext()Landroid/content/Context;
    .registers 2

    .line 7758
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    return-object v0
.end method

.method public getDomainsByProfileName(Ljava/lang/String;)Ljava/util/List;
    .registers 3
    .param p1, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Ljava/lang/String;",
            ")",
            "Ljava/util/List<",
            "Ljava/lang/String;",
            ">;"
        }
    .end annotation

    .line 7764
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationMap:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v0, p1}, Ljava/util/concurrent/ConcurrentHashMap;->get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Ljava/util/List;

    return-object v0
.end method

.method public getErrorString(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 9
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/String;",
            ">;"
        }
    .end annotation

    .line 1848
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 1850
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "getErrorString API called for profileName = "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    const-string v2, "KnoxVpnEngineService"

    invoke-static {v2, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1851
    new-instance v1, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 1852
    .local v1, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/String;>;"
    const/4 v3, 0x0

    invoke-virtual {v1, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1853
    const/4 v3, 0x1

    const/4 v4, -0x1

    invoke-virtual {v1, v3, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1855
    iget v3, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v3

    if-nez v3, :cond_32

    .line 1856
    return-object v1

    .line 1860
    :cond_32
    :try_start_32
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v3, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->getErrorStringValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Ljava/lang/String;

    move-result-object v3

    .line 1861
    .local v3, "getErrorStringValidation":Ljava/lang/String;
    if-nez v3, :cond_41

    .line 1862
    const-string/jumbo v4, "getting error string for the profile failed: Error occured while validating the profile"

    invoke-static {v2, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1863
    return-object v1

    .line 1865
    :cond_41
    invoke-virtual {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v4

    .line 1866
    .local v4, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v4, :cond_4e

    .line 1867
    const-string/jumbo v5, "getting error string for the profile failed: Error occured since the service is not started"

    invoke-static {v2, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1868
    return-object v1

    .line 1870
    :cond_4e
    invoke-interface {v4, p2}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getErrorString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v1, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1871
    const/4 v5, 0x0

    invoke-virtual {v1, v5, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_59
    .catch Ljava/lang/Exception; {:try_start_32 .. :try_end_59} :catch_5a

    .line 1874
    .end local v3    # "getErrorStringValidation":Ljava/lang/String;
    .end local v4    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    goto :goto_78

    .line 1872
    :catch_5a
    move-exception v3

    .line 1873
    .local v3, "e":Ljava/lang/Exception;
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_78

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "getting vpn error string : Failure at "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v3}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v2, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 1875
    .end local v3    # "e":Ljava/lang/Exception;
    :cond_78
    :goto_78
    return-object v1
.end method

.method public getInterfaceNameForUid(I)Ljava/lang/String;
    .registers 10
    .param p1, "uid"    # I

    .line 8735
    const/4 v0, 0x0

    .line 8737
    .local v0, "interfaceName":Ljava/lang/String;
    :try_start_1
    invoke-static {}, Landroid/os/Binder;->getCallingUid()I

    move-result v1

    const/16 v2, 0x3e8

    if-eq v1, v2, :cond_a

    return-object v0

    .line 8738
    :cond_a
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_14
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_9f

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 8739
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v3

    const/4 v4, 0x1

    if-eq v3, v4, :cond_29

    goto/16 :goto_9d

    .line 8742
    :cond_29
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v3

    if-ne v3, p1, :cond_36

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getChainingEnabled()I

    move-result v3

    if-eq v3, v4, :cond_36

    .line 8743
    return-object v0

    .line 8744
    :cond_36
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v3

    invoke-interface {v3}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v3

    :goto_3e
    invoke-interface {v3}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_9c

    invoke-interface {v3}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 8745
    .local v4, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v5

    if-ne v5, p1, :cond_56

    .line 8746
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v1

    move-object v0, v1

    .line 8747
    return-object v0

    .line 8748
    :cond_56
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v5

    const/4 v6, -0x2

    if-ne v5, v6, :cond_9b

    .line 8749
    invoke-static {p1}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v5

    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v6

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v6

    if-ne v5, v6, :cond_9b

    .line 8751
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getProfileNameForUid(I)Ljava/lang/String;

    move-result-object v5

    if-eqz v5, :cond_76

    goto :goto_3e

    .line 8753
    :cond_76
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v1

    invoke-virtual {v1}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_7e
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_92

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Ljava/lang/Integer;

    invoke-virtual {v3}, Ljava/lang/Integer;->intValue()I

    move-result v3

    .line 8754
    .local v3, "uid_1":I
    if-ne p1, v3, :cond_91

    .line 8755
    return-object v0

    .line 8757
    .end local v3    # "uid_1":I
    :cond_91
    goto :goto_7e

    .line 8758
    :cond_92
    if-nez p1, :cond_95

    .line 8759
    return-object v0

    .line 8760
    :cond_95
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v1
    :try_end_99
    .catch Ljava/lang/Exception; {:try_start_1 .. :try_end_99} :catch_a0

    move-object v0, v1

    .line 8761
    return-object v0

    .line 8764
    .end local v4    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :cond_9b
    goto :goto_3e

    .line 8765
    :cond_9c
    nop

    .line 8771
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :goto_9d
    goto/16 :goto_14

    .line 8774
    :cond_9f
    goto :goto_b7

    .line 8772
    :catch_a0
    move-exception v1

    .line 8773
    .local v1, "e":Ljava/lang/Exception;
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception occured while trying to fetch interfacename for the uid "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    const-string v3, "KnoxVpnEngineService"

    invoke-static {v3, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 8775
    .end local v1    # "e":Ljava/lang/Exception;
    :goto_b7
    return-object v0
.end method

.method public getKnoxVpnProfileType(Ljava/lang/String;)I
    .registers 6
    .param p1, "profileName"    # Ljava/lang/String;

    .line 3869
    const/4 v0, -0x1

    .line 3871
    .local v0, "profileType":I
    if-eqz p1, :cond_2d

    .line 3872
    :try_start_3
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v1

    .line 3873
    .local v1, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v1, :cond_2d

    .line 3874
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v2
    :try_end_f
    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_f} :catch_11

    move v0, v2

    goto :goto_2d

    .line 3877
    .end local v1    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :catch_11
    move-exception v1

    .line 3878
    .local v1, "e":Ljava/lang/Exception;
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v3, "Exception = "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v1}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    const-string v3, "KnoxVpnEngineService"

    invoke-static {v3, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    goto :goto_2e

    .line 3879
    .end local v1    # "e":Ljava/lang/Exception;
    :cond_2d
    :goto_2d
    nop

    .line 3880
    :goto_2e
    return v0
.end method

.method getNotificationManager()Landroid/app/NotificationManager;
    .registers 3

    .line 529
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationManager:Landroid/app/NotificationManager;

    if-nez v0, :cond_11

    .line 530
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    const-string/jumbo v1, "notification"

    invoke-virtual {v0, v1}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Landroid/app/NotificationManager;

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationManager:Landroid/app/NotificationManager;

    .line 532
    :cond_11
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationManager:Landroid/app/NotificationManager;

    return-object v0
.end method

.method public getProfilesByDomain(Ljava/lang/String;)Ljava/util/List;
    .registers 8
    .param p1, "domain"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Ljava/lang/String;",
            ")",
            "Ljava/util/List<",
            "Ljava/lang/String;",
            ">;"
        }
    .end annotation

    .line 7770
    new-instance v0, Ljava/util/ArrayList;

    invoke-direct {v0}, Ljava/util/ArrayList;-><init>()V

    .line 7771
    .local v0, "profiles":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    invoke-static {}, Landroid/os/Binder;->getCallingUid()I

    move-result v1

    const/16 v2, 0x3e8

    if-eq v1, v2, :cond_e

    .line 7772
    return-object v0

    .line 7774
    :cond_e
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationMap:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v1}, Ljava/util/concurrent/ConcurrentHashMap;->keySet()Ljava/util/Set;

    move-result-object v1

    invoke-interface {v1}, Ljava/util/Set;->iterator()Ljava/util/Iterator;

    move-result-object v1

    :goto_18
    invoke-interface {v1}, Ljava/util/Iterator;->hasNext()Z

    move-result v2

    if-eqz v2, :cond_47

    invoke-interface {v1}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v2

    check-cast v2, Ljava/lang/String;

    .line 7775
    .local v2, "key":Ljava/lang/String;
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mNotificationMap:Ljava/util/concurrent/ConcurrentHashMap;

    invoke-virtual {v3, v2}, Ljava/util/concurrent/ConcurrentHashMap;->get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Ljava/util/ArrayList;

    .line 7776
    .local v3, "items":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    const/4 v4, 0x0

    .local v4, "i":I
    :goto_2d
    invoke-virtual {v3}, Ljava/util/ArrayList;->size()I

    move-result v5

    if-ge v4, v5, :cond_46

    .line 7777
    invoke-virtual {v3, v4}, Ljava/util/ArrayList;->get(I)Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Ljava/lang/String;

    invoke-virtual {v5, p1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v5

    if-eqz v5, :cond_43

    .line 7778
    invoke-virtual {v0, v2}, Ljava/util/ArrayList;->add(Ljava/lang/Object;)Z

    .line 7779
    goto :goto_46

    .line 7776
    :cond_43
    add-int/lit8 v4, v4, 0x1

    goto :goto_2d

    .line 7782
    .end local v2    # "key":Ljava/lang/String;
    .end local v3    # "items":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    .end local v4    # "i":I
    :cond_46
    :goto_46
    goto :goto_18

    .line 7783
    :cond_47
    return-object v0
.end method

.method public getProxyInfoConfig(I)Landroid/net/ProxyInfo;
    .registers 11
    .param p1, "uid"    # I

    .line 8514
    const-string v0, "KnoxVpnEngineService"

    const/4 v1, 0x0

    :try_start_3
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v2

    invoke-interface {v2}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_d
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_fd

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 8515
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyServer()Ljava/lang/String;

    move-result-object v4

    sget-object v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->DEFAULT_PROXY_SERVER:Ljava/lang/String;

    if-ne v4, v5, :cond_29

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPacurl()Landroid/net/Uri;

    move-result-object v4

    sget-object v5, Landroid/net/Uri;->EMPTY:Landroid/net/Uri;

    if-eq v4, v5, :cond_fb

    .line 8516
    :cond_29
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v4

    if-eqz v4, :cond_de

    const/4 v5, 0x1

    if-eq v4, v5, :cond_51

    .line 8542
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_fb

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "knox vpn proxy settings is being queried by CS for unknown state vpn profile "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    goto/16 :goto_fb

    .line 8518
    :cond_51
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v4

    invoke-interface {v4}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v4

    :goto_59
    invoke-interface {v4}, Ljava/util/Iterator;->hasNext()Z

    move-result v5

    if-eqz v5, :cond_dd

    invoke-interface {v4}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 8519
    .local v5, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v6

    if-ne v6, p1, :cond_70

    .line 8520
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v0

    return-object v0

    .line 8521
    :cond_70
    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v6

    const/4 v7, -0x2

    if-ne v6, v7, :cond_db

    .line 8522
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v6

    if-ne p1, v6, :cond_93

    .line 8523
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v4, "knox vpn proxy setting skipping for vendor entry "

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8524
    return-object v1

    .line 8526
    :cond_93
    invoke-static {p1}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v6

    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v7

    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v8

    invoke-virtual {v7, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v7

    if-ne v6, v7, :cond_db

    .line 8527
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v2

    invoke-virtual {v2}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_ad
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_d6

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Ljava/lang/Integer;

    invoke-virtual {v4}, Ljava/lang/Integer;->intValue()I

    move-result v4

    .line 8528
    .local v4, "uid_1":I
    if-ne p1, v4, :cond_d5

    .line 8529
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knox vpn proxy setting skipping for exempted entry "

    invoke-virtual {v2, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8530
    return-object v1

    .line 8532
    .end local v4    # "uid_1":I
    :cond_d5
    goto :goto_ad

    .line 8533
    :cond_d6
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v0

    return-object v0

    .line 8536
    .end local v5    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :cond_db
    goto/16 :goto_59

    .line 8537
    :cond_dd
    goto :goto_fb

    .line 8539
    :cond_de
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_fb

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "knox vpn proxy settings is being queried by CS for the de-activated vpn profile "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileName()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_fb
    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_fb} :catch_fe

    .line 8546
    .end local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_fb
    :goto_fb
    goto/16 :goto_d

    .line 8549
    :cond_fd
    goto :goto_108

    .line 8547
    :catch_fe
    move-exception v2

    .line 8548
    .local v2, "e":Ljava/lang/Exception;
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_108

    const-string v3, "Exception occured while retrieving the profile info object, might be that the proxy info has not been configured yet "

    invoke-static {v0, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 8550
    .end local v2    # "e":Ljava/lang/Exception;
    :cond_108
    :goto_108
    return-object v1
.end method

.method public getProxyInfoForUid(I)[Ljava/lang/String;
    .registers 13
    .param p1, "uid"    # I

    .line 8823
    const-string v0, "KnoxVpnEngineService"

    const/4 v1, 0x2

    new-array v1, v1, [Ljava/lang/String;

    .line 8825
    .local v1, "proxyInfoDetails":[Ljava/lang/String;
    :try_start_5
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v2

    invoke-interface {v2}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_f
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_10d

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 8826
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v4

    const/4 v5, 0x1

    if-eq v4, v5, :cond_24

    goto/16 :goto_10b

    .line 8828
    :cond_24
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v4

    if-nez v4, :cond_2b

    .line 8829
    return-object v1

    .line 8830
    :cond_2b
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v4

    invoke-interface {v4}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v4

    :goto_33
    invoke-interface {v4}, Ljava/util/Iterator;->hasNext()Z

    move-result v6

    if-eqz v6, :cond_10a

    invoke-interface {v4}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 8831
    .local v6, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v7

    const/4 v8, 0x0

    if-ne v7, p1, :cond_74

    .line 8832
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v2

    invoke-virtual {v2}, Landroid/net/ProxyInfo;->getHost()Ljava/lang/String;

    move-result-object v2

    aput-object v2, v1, v8

    .line 8833
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v2

    invoke-virtual {v2}, Landroid/net/ProxyInfo;->getPort()I

    move-result v2

    invoke-static {v2}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;

    move-result-object v2

    aput-object v2, v1, v5

    .line 8834
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v4, "proxy information is requested by the uid belonging to per-app domain "

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8835
    return-object v1

    .line 8836
    :cond_74
    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v7

    const/4 v9, -0x2

    if-ne v7, v9, :cond_108

    .line 8837
    invoke-static {p1}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v7

    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v9

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v10

    invoke-virtual {v9, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v9

    if-ne v7, v9, :cond_108

    .line 8839
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v2

    invoke-virtual {v2}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_95
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_be

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Ljava/lang/Integer;

    invoke-virtual {v4}, Ljava/lang/Integer;->intValue()I

    move-result v4

    .line 8840
    .local v4, "uid_1":I
    if-ne p1, v4, :cond_bd

    .line 8841
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "proxy information is requested by the uid belonging to exempt list in user domain "

    invoke-virtual {v2, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8842
    return-object v1

    .line 8844
    .end local v4    # "uid_1":I
    :cond_bd
    goto :goto_95

    .line 8845
    :cond_be
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v2

    if-ne p1, v2, :cond_da

    .line 8846
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v4, "proxy information is requested by the uid belonging to vpn client "

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8847
    return-object v1

    .line 8849
    :cond_da
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v2

    invoke-virtual {v2}, Landroid/net/ProxyInfo;->getHost()Ljava/lang/String;

    move-result-object v2

    aput-object v2, v1, v8

    .line 8850
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v2

    invoke-virtual {v2}, Landroid/net/ProxyInfo;->getPort()I

    move-result v2

    invoke-static {v2}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;

    move-result-object v2

    aput-object v2, v1, v5

    .line 8851
    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v4, "proxy information is requested by the uid belonging to user domain "

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_107
    .catch Ljava/lang/Exception; {:try_start_5 .. :try_end_107} :catch_10e

    .line 8852
    return-object v1

    .line 8855
    .end local v6    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :cond_108
    goto/16 :goto_33

    .line 8856
    :cond_10a
    nop

    .line 8862
    .end local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :goto_10b
    goto/16 :goto_f

    .line 8865
    :cond_10d
    goto :goto_123

    .line 8863
    :catch_10e
    move-exception v2

    .line 8864
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Exception occured while trying to fetch the proxy information for the uid "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 8866
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_123
    return-object v1
.end method

.method public getState(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 11
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    .line 1801
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 1803
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "getState API called for profileName = "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    const-string v2, "KnoxVpnEngineService"

    invoke-static {v2, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1804
    new-instance v1, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 1805
    .local v1, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v3, -0x1

    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v4

    invoke-virtual {v1, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1806
    const/4 v4, 0x1

    invoke-virtual {v1, v4, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1808
    iget v3, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v3

    if-nez v3, :cond_3e

    .line 1809
    const/16 v2, 0x8c

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1810
    return-object v1

    .line 1814
    :cond_3e
    :try_start_3e
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v3, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->getStateValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)I

    move-result v3

    .line 1815
    .local v3, "getStateValidation":I
    const/16 v4, 0x64

    if-eq v3, v4, :cond_65

    .line 1816
    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v4

    invoke-virtual {v1, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1817
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "knox vpn profile current state request failed: The error code is "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v2, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1818
    return-object v1

    .line 1820
    :cond_65
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v4, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v4

    .line 1821
    .local v4, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v4, :cond_6e

    .line 1822
    return-object v1

    .line 1824
    :cond_6e
    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v5

    const/4 v6, 0x0

    if-nez v5, :cond_80

    .line 1825
    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v5

    invoke-virtual {v1, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1826
    invoke-virtual {v1, v6, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1827
    return-object v1

    .line 1829
    :cond_80
    invoke-virtual {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v5

    .line 1830
    .local v5, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v5, :cond_96

    .line 1831
    const/16 v6, 0x6e

    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v6

    invoke-virtual {v1, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1832
    const-string/jumbo v6, "knox vpn profile current state request failed: The error code is 110"

    invoke-static {v2, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1833
    return-object v1

    .line 1835
    :cond_96
    invoke-interface {v5, p2}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getState(Ljava/lang/String;)I

    move-result v7

    invoke-static {v7}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    .line 1836
    .local v7, "state":Ljava/lang/Integer;
    invoke-virtual {v1, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1837
    invoke-virtual {v1, v6, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_a4
    .catch Ljava/lang/Exception; {:try_start_3e .. :try_end_a4} :catch_a5

    .line 1840
    .end local v3    # "getStateValidation":I
    .end local v4    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v5    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v7    # "state":Ljava/lang/Integer;
    goto :goto_c3

    .line 1838
    :catch_a5
    move-exception v3

    .line 1839
    .local v3, "e":Ljava/lang/Exception;
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_c3

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "getting vpn state : Failure at "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v3}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v2, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 1841
    .end local v3    # "e":Ljava/lang/Exception;
    :cond_c3
    :goto_c3
    return-object v1
.end method

.method public getUidPidEnabled(ILjava/lang/String;)I
    .registers 9
    .param p1, "callerUid"    # I
    .param p2, "profileName"    # Ljava/lang/String;

    .line 3820
    const-string v0, "KnoxVpnEngineService"

    const/4 v1, 0x0

    .line 3822
    .local v1, "uidPidSearchEnabled":I
    :try_start_3
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 3823
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v2, :cond_65

    .line 3824
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_2f

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "The packageName stored in database is "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v4, "callerUid is "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3825
    :cond_2f
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v3

    if-ne v3, p1, :cond_65

    .line 3826
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v3

    if-nez v3, :cond_41

    .line 3827
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUidPidSearchEnabled()I

    move-result v3

    move v1, v3

    goto :goto_65

    .line 3828
    :cond_41
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v3

    const/4 v4, 0x1

    if-ne v3, v4, :cond_65

    .line 3829
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v3

    .line 3830
    .local v3, "activateState":I
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "activated state of the profile "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v0, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3831
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUidPidSearchEnabled()I

    move-result v4
    :try_end_64
    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_64} :catch_66

    move v1, v4

    .line 3837
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "activateState":I
    :cond_65
    :goto_65
    goto :goto_7f

    .line 3835
    :catch_66
    move-exception v2

    .line 3836
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Exception = "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 3838
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_7f
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_98

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "getUidPidSearchEnabledForProfile: uidPidSearchEnabled value is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, v1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3839
    :cond_98
    return v1
.end method

.method public declared-synchronized getUserCertificate(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 10
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Lcom/samsung/android/knox/keystore/CertificateInfo;",
            ">;"
        }
    .end annotation

    monitor-enter p0

    .line 1540
    :try_start_1
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 1542
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    new-instance v1, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 1543
    .local v1, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Lcom/samsung/android/knox/keystore/CertificateInfo;>;"
    const/4 v2, 0x0

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1544
    const/4 v3, 0x1

    const/4 v4, -0x1

    invoke-virtual {v1, v3, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1546
    iget v3, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v3
    :try_end_19
    .catchall {:try_start_1 .. :try_end_19} :catchall_61

    if-nez v3, :cond_1d

    .line 1547
    monitor-exit p0

    return-object v1

    .line 1551
    :cond_1d
    :try_start_1d
    invoke-direct {p0, p1, p2, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->validateAdminAndVendorForProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;)I

    move-result v3
    :try_end_21
    .catch Ljava/lang/Exception; {:try_start_1d .. :try_end_21} :catch_43
    .catchall {:try_start_1d .. :try_end_21} :catchall_61

    if-eqz v3, :cond_25

    .line 1552
    monitor-exit p0

    return-object v1

    .line 1554
    :cond_25
    :try_start_25
    invoke-virtual {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v3

    .line 1555
    .local v3, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v3, :cond_35

    .line 1556
    const-string v4, "KnoxVpnEngineService"

    const-string/jumbo v5, "getting user certificate : VPN Service not started"

    invoke-static {v4, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_33
    .catch Ljava/lang/Exception; {:try_start_25 .. :try_end_33} :catch_43
    .catchall {:try_start_25 .. :try_end_33} :catchall_61

    .line 1557
    monitor-exit p0

    return-object v1

    .line 1559
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_35
    :try_start_35
    invoke-interface {v3, p2}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getUserCertificate(Ljava/lang/String;)Lcom/samsung/android/knox/keystore/CertificateInfo;

    move-result-object v4

    .line 1560
    .local v4, "cert":Lcom/samsung/android/knox/keystore/CertificateInfo;
    invoke-virtual {v1, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1561
    const/4 v5, 0x0

    invoke-virtual {v1, v5, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_40
    .catch Ljava/lang/Exception; {:try_start_35 .. :try_end_40} :catch_43
    .catchall {:try_start_35 .. :try_end_40} :catchall_61

    .line 1565
    .end local v3    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v4    # "cert":Lcom/samsung/android/knox/keystore/CertificateInfo;
    nop

    .line 1566
    monitor-exit p0

    return-object v1

    .line 1562
    :catch_43
    move-exception v3

    .line 1563
    .local v3, "e":Ljava/lang/Exception;
    :try_start_44
    const-string v4, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "getting user certificate : Failure at "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v3}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v4, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_5f
    .catchall {:try_start_44 .. :try_end_5f} :catchall_61

    .line 1564
    monitor-exit p0

    return-object v2

    .line 1539
    .end local v0    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v1    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Lcom/samsung/android/knox/keystore/CertificateInfo;>;"
    .end local v3    # "e":Ljava/lang/Exception;
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    :catchall_61
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method public getVendorNameForProfile(Ljava/lang/String;)Ljava/lang/String;
    .registers 7
    .param p1, "profileName"    # Ljava/lang/String;

    .line 6744
    const-string v0, "KnoxVpnEngineService"

    const/4 v1, 0x0

    .line 6746
    .local v1, "vendorName":Ljava/lang/String;
    :try_start_3
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_1c

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "getVendorNameForProfile: profile name  "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6747
    :cond_1c
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 6748
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-eqz v2, :cond_48

    .line 6749
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getRegularPackageName(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v3

    move-object v1, v3

    .line 6750
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_48

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v4, "getVendorNameForProfile: vendorName  "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_48
    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_48} :catch_49

    .line 6754
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_48
    goto :goto_62

    .line 6752
    :catch_49
    move-exception v2

    .line 6753
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Exception at getVendorNameForProfile API "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 6755
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_62
    return-object v1
.end method

.method public declared-synchronized getVpnModeOfOperation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 11
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    monitor-enter p0

    .line 3466
    :try_start_1
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 3468
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    new-instance v1, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 3469
    .local v1, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v2, -0x1

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v1, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3470
    const/4 v3, 0x1

    invoke-virtual {v1, v3, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 3472
    iget v2, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v2

    if-nez v2, :cond_29

    .line 3473
    const/16 v2, 0x8c

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_27
    .catchall {:try_start_1 .. :try_end_27} :catchall_bd

    .line 3474
    monitor-exit p0

    return-object v1

    .line 3478
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_29
    :try_start_29
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v2, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->getVpnModeOfOperationValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)I

    move-result v2

    .line 3479
    .local v2, "getVpnModeOfOperationValidation":I
    const/16 v3, 0x64

    if-eq v2, v3, :cond_53

    .line 3480
    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v1, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3481
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "getting the mode of operation for the profile has failed:The error code is "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, v2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_51
    .catch Ljava/lang/Exception; {:try_start_29 .. :try_end_51} :catch_9b
    .catchall {:try_start_29 .. :try_end_51} :catchall_bd

    .line 3482
    monitor-exit p0

    return-object v1

    .line 3484
    :cond_53
    :try_start_53
    invoke-virtual {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v3

    .line 3485
    .local v3, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v3, :cond_6c

    .line 3486
    const/16 v4, 0x6e

    invoke-static {v4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v4

    invoke-virtual {v1, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3487
    const-string v4, "KnoxVpnEngineService"

    const-string/jumbo v5, "getting the mode of operation for the profile has failed: The error code is 110"

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_6a
    .catch Ljava/lang/Exception; {:try_start_53 .. :try_end_6a} :catch_9b
    .catchall {:try_start_53 .. :try_end_6a} :catchall_bd

    .line 3488
    monitor-exit p0

    return-object v1

    .line 3490
    :cond_6c
    :try_start_6c
    invoke-interface {v3, p2}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getVpnModeOfOperation(Ljava/lang/String;)I

    move-result v4

    .line 3491
    .local v4, "currentMode":I
    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "getVpnModeOfOperation : profileName = "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v7, " :currentMode = "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3492
    invoke-static {v4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v5

    invoke-virtual {v1, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3493
    const/4 v5, 0x0

    invoke-virtual {v1, v5, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_9a
    .catch Ljava/lang/Exception; {:try_start_6c .. :try_end_9a} :catch_9b
    .catchall {:try_start_6c .. :try_end_9a} :catchall_bd

    .line 3496
    .end local v2    # "getVpnModeOfOperationValidation":I
    .end local v3    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v4    # "currentMode":I
    goto :goto_bb

    .line 3494
    :catch_9b
    move-exception v2

    .line 3495
    .local v2, "e":Ljava/lang/Exception;
    :try_start_9c
    sget-boolean v3, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v3, :cond_bb

    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "getting vpn mode : Failure at "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_bb
    .catchall {:try_start_9c .. :try_end_bb} :catchall_bd

    .line 3497
    .end local v2    # "e":Ljava/lang/Exception;
    :cond_bb
    :goto_bb
    monitor-exit p0

    return-object v1

    .line 3465
    .end local v0    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v1    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    :catchall_bd
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method public declared-synchronized getVpnProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 11
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/String;",
            ">;"
        }
    .end annotation

    monitor-enter p0

    .line 969
    :try_start_1
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 971
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "profile info is going to be fetched for the proifle "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 973
    new-instance v1, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 974
    .local v1, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/String;>;"
    const/4 v2, 0x0

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 975
    const/4 v2, 0x1

    const/4 v3, -0x1

    invoke-virtual {v1, v2, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 977
    iget v2, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v2
    :try_end_30
    .catchall {:try_start_1 .. :try_end_30} :catchall_9b

    if-nez v2, :cond_34

    .line 978
    monitor-exit p0

    return-object v1

    .line 983
    :cond_34
    :try_start_34
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v2, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->getVpnProfileValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Ljava/lang/String;

    move-result-object v2

    .line 984
    .local v2, "getVpnProfileValidation":Ljava/lang/String;
    if-nez v2, :cond_46

    .line 985
    const-string v3, "KnoxVpnEngineService"

    const-string/jumbo v4, "getting vpn profile Info failed: Error occured while validating the profile"

    invoke-static {v3, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_44
    .catch Ljava/lang/Exception; {:try_start_34 .. :try_end_44} :catch_7d
    .catchall {:try_start_34 .. :try_end_44} :catchall_9b

    .line 986
    monitor-exit p0

    return-object v1

    .line 989
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_46
    :try_start_46
    invoke-virtual {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v3

    .line 990
    .local v3, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v3, :cond_56

    .line 991
    const-string v4, "KnoxVpnEngineService"

    const-string/jumbo v5, "getting vpn profile Info failed: Error occured due to invalid interface"

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_54
    .catch Ljava/lang/Exception; {:try_start_46 .. :try_end_54} :catch_7d
    .catchall {:try_start_46 .. :try_end_54} :catchall_9b

    .line 992
    monitor-exit p0

    return-object v1

    .line 995
    :cond_56
    :try_start_56
    invoke-interface {v3, p2}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getConnection(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v4

    .line 996
    .local v4, "jsonProfile":Ljava/lang/String;
    sget-boolean v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v5, :cond_75

    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "getVpnProfile: jsonProfile value is "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 998
    :cond_75
    invoke-virtual {v1, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 999
    const/4 v5, 0x0

    invoke-virtual {v1, v5, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_7c
    .catch Ljava/lang/Exception; {:try_start_56 .. :try_end_7c} :catch_7d
    .catchall {:try_start_56 .. :try_end_7c} :catchall_9b

    .line 1003
    .end local v2    # "getVpnProfileValidation":Ljava/lang/String;
    .end local v3    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v4    # "jsonProfile":Ljava/lang/String;
    goto :goto_99

    .line 1001
    :catch_7d
    move-exception v2

    .line 1002
    .local v2, "e":Ljava/lang/Exception;
    :try_start_7e
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "getVpnProfile exception result is "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_99
    .catchall {:try_start_7e .. :try_end_99} :catchall_9b

    .line 1004
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_99
    monitor-exit p0

    return-object v1

    .line 968
    .end local v0    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v1    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/String;>;"
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    :catchall_9b
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method public declared-synchronized handleActionPackageRemoved(Landroid/os/Bundle;)V
    .registers 15
    .param p1, "map"    # Landroid/os/Bundle;

    monitor-enter p0

    .line 6761
    :try_start_1
    const-string v0, "KnoxVpnEngineService"

    const-string/jumbo v1, "handleActionPackageRemoved"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6762
    const-string/jumbo v0, "uid"

    invoke-virtual {p1, v0}, Landroid/os/Bundle;->getInt(Ljava/lang/String;)I

    move-result v0

    .line 6763
    .local v0, "uid":I
    const-string/jumbo v1, "package"

    invoke-virtual {p1, v1}, Landroid/os/Bundle;->getString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v1

    .line 6764
    .local v1, "originalPackageName":Ljava/lang/String;
    invoke-static {v0}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v2

    .line 6765
    .local v2, "cid":I
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, v2, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v3

    .line 6767
    .local v3, "packageName":Ljava/lang/String;
    const-string/jumbo v4, "new_install_or_update"

    invoke-virtual {p1, v4}, Landroid/os/Bundle;->getBoolean(Ljava/lang/String;)Z

    move-result v4

    .line 6768
    .local v4, "extraReplacing":Z
    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "handleActionPackageRemoved : packageName = "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v7, " : replacing = "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v4}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6769
    invoke-direct {p0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->hasVpnInterface(Ljava/lang/String;)Z

    move-result v5

    const/4 v6, 0x1

    if-eqz v5, :cond_d9

    .line 6771
    if-eqz v4, :cond_59

    .line 6772
    const-string v5, "KnoxVpnEngineService"

    const-string v6, "Package is being reinstalled. Skip remove profile"

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_57
    .catchall {:try_start_1 .. :try_end_57} :catchall_159

    .line 6773
    monitor-exit p0

    return-void

    .line 6775
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_59
    :try_start_59
    const-string v5, "KnoxVpnEngineService"

    const-string/jumbo v7, "handleActionPackageRemoved : packageName is Vpn Vendor"

    invoke-static {v5, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_61
    .catchall {:try_start_59 .. :try_end_61} :catchall_159

    .line 6777
    :try_start_61
    const-string v5, "KnoxVpnEngineService"

    const-string/jumbo v7, "handleActionPackageRemoved : Getting profile list for vendor from DB"

    invoke-static {v5, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6778
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnStorageProvider:Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;

    const-string v7, "VpnProfileInfo"

    const-string/jumbo v8, "vendorName"

    filled-new-array {v8}, [Ljava/lang/String;

    move-result-object v8

    new-array v9, v6, [Ljava/lang/String;

    const/4 v10, 0x0

    aput-object v3, v9, v10

    const/4 v10, 0x0

    invoke-virtual {v5, v7, v8, v9, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/storage/KnoxVpnStorageProvider;->getDataByFields(Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;[Ljava/lang/String;)Ljava/util/ArrayList;

    move-result-object v5

    .line 6780
    .local v5, "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    const/4 v7, 0x0

    .line 6781
    .local v7, "profileName":Ljava/lang/String;
    if-eqz v5, :cond_b7

    .line 6782
    invoke-virtual {v5}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v8

    :goto_85
    invoke-interface {v8}, Ljava/util/Iterator;->hasNext()Z

    move-result v9

    if-eqz v9, :cond_b7

    invoke-interface {v8}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v9

    check-cast v9, Landroid/content/ContentValues;

    .line 6783
    .local v9, "cv":Landroid/content/ContentValues;
    const-string/jumbo v10, "profileName"

    invoke-virtual {v9, v10}, Landroid/content/ContentValues;->getAsString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v10

    move-object v7, v10

    .line 6784
    const-string v10, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v12, "handleActionPackageRemoved : Remvoing profile = "

    invoke-virtual {v11, v12}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    invoke-static {v10, v11}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6785
    invoke-direct {p0, v7, v0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeProfileFromKeyStore(Ljava/lang/String;ILjava/lang/String;)V

    .line 6786
    invoke-direct {p0, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeProfileFromHashMapAndDB(Ljava/lang/String;)V
    :try_end_b6
    .catch Ljava/lang/Exception; {:try_start_61 .. :try_end_b6} :catch_b8
    .catchall {:try_start_61 .. :try_end_b6} :catchall_159

    .line 6787
    .end local v9    # "cv":Landroid/content/ContentValues;
    goto :goto_85

    .line 6791
    .end local v5    # "cvList":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Landroid/content/ContentValues;>;"
    .end local v7    # "profileName":Ljava/lang/String;
    :cond_b7
    goto :goto_d4

    .line 6789
    :catch_b8
    move-exception v5

    .line 6790
    .local v5, "e":Ljava/lang/Exception;
    :try_start_b9
    const-string v7, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "handleActionPackageRemoved : Failure at "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v5}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v7, v8}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 6794
    .end local v5    # "e":Ljava/lang/Exception;
    :goto_d4
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    invoke-static {v5}, Lcom/samsung/android/knox/EnterpriseDeviceManager;->getInstance(Landroid/content/Context;)Lcom/samsung/android/knox/EnterpriseDeviceManager;

    .line 6814
    :cond_d9
    if-eqz v4, :cond_e5

    .line 6815
    const-string v5, "KnoxVpnEngineService"

    const-string/jumbo v6, "vpn handle : package removed: package being updated"

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_e3
    .catchall {:try_start_b9 .. :try_end_e3} :catchall_159

    .line 6816
    monitor-exit p0

    return-void

    .line 6819
    :cond_e5
    :try_start_e5
    const-string v5, "com.samsung.knox.vpn.tether.auth"

    invoke-virtual {v1, v5}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v5

    if-eqz v5, :cond_13e

    .line 6821
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v5

    invoke-interface {v5}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v5

    :goto_f7
    invoke-interface {v5}, Ljava/util/Iterator;->hasNext()Z

    move-result v7

    if-eqz v7, :cond_13e

    invoke-interface {v5}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v7

    check-cast v7, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 6822
    .local v7, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbtetherAuth()I

    move-result v8

    if-ne v8, v6, :cond_13d

    invoke-static {v0}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v8

    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v9

    if-ne v8, v9, :cond_13d

    .line 6823
    const-string v5, "KnoxVpnTetherAuthentication"

    const-string/jumbo v8, "unbind from usb tethering service after usb tether app is uninstalled"

    invoke-static {v5, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_11b
    .catchall {:try_start_e5 .. :try_end_11b} :catchall_159

    .line 6825
    :try_start_11b
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnTetherAuthentication:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;

    invoke-virtual {v5, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnTetherAuthentication;->unbindTetherAuthService(Z)V
    :try_end_120
    .catch Landroid/os/RemoteException; {:try_start_11b .. :try_end_120} :catch_121
    .catchall {:try_start_11b .. :try_end_120} :catchall_159

    .line 6828
    goto :goto_122

    .line 6826
    :catch_121
    move-exception v5

    .line 6829
    :goto_122
    :try_start_122
    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v5

    if-ne v5, v6, :cond_13e

    .line 6830
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getInterfaceNameForUsbtethering()Ljava/lang/String;

    move-result-object v5

    .line 6831
    .local v5, "usbTetheringIface":Ljava/lang/String;
    if-eqz v5, :cond_13c

    .line 6832
    const-string v6, "KnoxVpnTetherAuthentication"

    const-string v8, "Adding tethering blocking rules after usb tether app is uninstalled"

    invoke-static {v6, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6833
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v6, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForDroppingTetherPackets(Ljava/lang/String;)V

    .line 6835
    .end local v5    # "usbTetheringIface":Ljava/lang/String;
    :cond_13c
    goto :goto_13e

    .line 6838
    .end local v7    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :cond_13d
    goto :goto_f7

    .line 6842
    :cond_13e
    :goto_13e
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v5, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getProfileOwningTheUid(I)Ljava/lang/String;

    move-result-object v5

    .line 6843
    .local v5, "profileOwningUid":Ljava/lang/String;
    if-eqz v5, :cond_149

    .line 6844
    invoke-direct {p0, v5, v1, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackageListByUid(Ljava/lang/String;Ljava/lang/String;I)V

    .line 6847
    :cond_149
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v6, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getProfileNameForExemptedUid(I)Ljava/lang/String;

    move-result-object v6

    .line 6848
    .local v6, "profileOwningExemptedUidList":Ljava/lang/String;
    if-eqz v6, :cond_154

    .line 6849
    invoke-direct {p0, v6, v3, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeExemptedUidDetailsAfterUninstall(Ljava/lang/String;Ljava/lang/String;I)V

    .line 6851
    :cond_154
    invoke-direct {p0, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackagesFromPermissionCheckDb(I)V
    :try_end_157
    .catchall {:try_start_122 .. :try_end_157} :catchall_159

    .line 6852
    monitor-exit p0

    return-void

    .line 6760
    .end local v0    # "uid":I
    .end local v1    # "originalPackageName":Ljava/lang/String;
    .end local v2    # "cid":I
    .end local v3    # "packageName":Ljava/lang/String;
    .end local v4    # "extraReplacing":Z
    .end local v5    # "profileOwningUid":Ljava/lang/String;
    .end local v6    # "profileOwningExemptedUidList":Ljava/lang/String;
    .end local p1    # "map":Landroid/os/Bundle;
    :catchall_159
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method protected declared-synchronized initializeVpnDataAndVendors()V
    .registers 4

    monitor-enter p0

    .line 735
    :try_start_1
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v0, :cond_d

    const-string v0, "KnoxVpnEngineService"

    const-string/jumbo v1, "initializeVpnDataAndVendors"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_d
    .catchall {:try_start_1 .. :try_end_d} :catchall_2f

    .line 737
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_d
    :try_start_d
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->initializeHashtable()V

    .line 738
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->checkIfProfileListEmpty()Z

    move-result v0

    if-nez v0, :cond_24

    .line 739
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setupIntentFilter()V

    .line 740
    invoke-static {}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->getInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    move-result-object v0

    iput-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    .line 741
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->addBlockingRulesForPackages()V
    :try_end_24
    .catch Ljava/lang/Exception; {:try_start_d .. :try_end_24} :catch_25
    .catchall {:try_start_d .. :try_end_24} :catchall_2f

    .line 745
    :cond_24
    goto :goto_2d

    .line 743
    :catch_25
    move-exception v0

    .line 744
    .local v0, "e":Ljava/lang/Exception;
    :try_start_26
    const-string v1, "KnoxVpnEngineService"

    const-string v2, "Error occured while trying to ini the BroadcastReceiver"

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_2d
    .catchall {:try_start_26 .. :try_end_2d} :catchall_2f

    .line 746
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_2d
    monitor-exit p0

    return-void

    .line 734
    :catchall_2f
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method public isNetworkBlockedForUid(I)Z
    .registers 12
    .param p1, "uid"    # I

    .line 8876
    const-string v0, "KnoxVpnEngineService"

    const/4 v1, 0x0

    :try_start_3
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntries()Ljava/util/Collection;

    move-result-object v2

    invoke-interface {v2}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_d
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v3

    if-eqz v3, :cond_f7

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    .line 8877
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v4

    const/4 v5, 0x1

    if-eq v4, v5, :cond_22

    goto/16 :goto_f5

    .line 8880
    :cond_22
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v4

    if-ne v4, p1, :cond_2f

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getChainingEnabled()I

    move-result v4

    if-eq v4, v5, :cond_2f

    .line 8881
    return v1

    .line 8882
    :cond_2f
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v4

    invoke-interface {v4}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v4

    :goto_37
    invoke-interface {v4}, Ljava/util/Iterator;->hasNext()Z

    move-result v6

    if-eqz v6, :cond_f4

    invoke-interface {v4}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 8883
    .local v6, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v7

    if-ne v7, p1, :cond_74

    .line 8884
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v2

    if-eqz v2, :cond_5b

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v2}, Ljava/lang/String;->isEmpty()Z

    move-result v2

    if-eqz v2, :cond_5a

    goto :goto_5b

    .line 8888
    :cond_5a
    return v1

    .line 8885
    :cond_5b
    :goto_5b
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_73

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Network blocked returned true for uid when per-app vpn is configured"

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 8886
    :cond_73
    return v5

    .line 8890
    :cond_74
    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v7

    const/4 v8, -0x2

    if-ne v7, v8, :cond_f2

    .line 8891
    invoke-static {p1}, Landroid/os/UserHandle;->getUserId(I)I

    move-result v7

    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v8

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v8, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v8

    if-ne v7, v8, :cond_f2

    .line 8893
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getExemptPackageList()Ljava/util/HashSet;

    move-result-object v2

    invoke-virtual {v2}, Ljava/util/HashSet;->iterator()Ljava/util/Iterator;

    move-result-object v2

    :goto_95
    invoke-interface {v2}, Ljava/util/Iterator;->hasNext()Z

    move-result v4

    if-eqz v4, :cond_a9

    invoke-interface {v2}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Ljava/lang/Integer;

    invoke-virtual {v4}, Ljava/lang/Integer;->intValue()I

    move-result v4

    .line 8894
    .local v4, "uid_1":I
    if-ne p1, v4, :cond_a8

    .line 8895
    return v1

    .line 8897
    .end local v4    # "uid_1":I
    :cond_a8
    goto :goto_95

    .line 8898
    :cond_a9
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorUid()I

    move-result v2

    if-ne p1, v2, :cond_b0

    .line 8899
    return v1

    .line 8901
    :cond_b0
    if-nez p1, :cond_b3

    .line 8902
    return v1

    .line 8908
    :cond_b3
    const/16 v2, 0x2710

    if-ge p1, v2, :cond_b8

    .line 8909
    return v1

    .line 8911
    :cond_b8
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getChainingEnabled()I

    move-result v2

    if-ne v2, v5, :cond_c7

    .line 8912
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v2, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isCallerNonChainedVendor(I)Z

    move-result v2

    .line 8913
    .local v2, "checkIfCallerIsNonChainedVendor":Z
    if-eqz v2, :cond_c7

    .line 8914
    return v1

    .line 8917
    .end local v2    # "checkIfCallerIsNonChainedVendor":Z
    :cond_c7
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v2

    if-eqz v2, :cond_d9

    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v2}, Ljava/lang/String;->isEmpty()Z

    move-result v2

    if-eqz v2, :cond_d8

    goto :goto_d9

    .line 8921
    :cond_d8
    return v1

    .line 8918
    :cond_d9
    :goto_d9
    sget-boolean v2, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v2, :cond_f1

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Network blocked returned true for uid when user-wide vpn is configured "

    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v0, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_f1
    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_f1} :catch_f8

    .line 8919
    :cond_f1
    return v5

    .line 8925
    .end local v6    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :cond_f2
    goto/16 :goto_37

    .line 8926
    :cond_f4
    nop

    .line 8932
    .end local v3    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    :goto_f5
    goto/16 :goto_d

    .line 8935
    :cond_f7
    goto :goto_10d

    .line 8933
    :catch_f8
    move-exception v2

    .line 8934
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Exception occured while trying to find if network is blocked for the uid "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v0, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 8936
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_10d
    return v1
.end method

.method public declared-synchronized isUsbTetheringOverVpnEnabled(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)I
    .registers 7
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;

    monitor-enter p0

    .line 3790
    :try_start_1
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 3792
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    iget v1, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v1
    :try_end_b
    .catchall {:try_start_1 .. :try_end_b} :catchall_37

    if-nez v1, :cond_11

    .line 3793
    const/16 v1, 0x8c

    monitor-exit p0

    return v1

    .line 3796
    :cond_11
    const/16 v1, 0x64

    .line 3798
    .local v1, "returnValue":I
    :try_start_13
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v2, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->isUsbTetheringOverVpnEnabledValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)I

    move-result v2
    :try_end_19
    .catchall {:try_start_13 .. :try_end_19} :catchall_37

    move v1, v2

    .line 3799
    const/16 v2, 0x64

    if-eq v1, v2, :cond_20

    .line 3800
    monitor-exit p0

    return v1

    .line 3803
    :cond_20
    :try_start_20
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2
    :try_end_26
    .catchall {:try_start_20 .. :try_end_26} :catchall_37

    .line 3804
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v2, :cond_2c

    .line 3805
    const/16 v1, 0x6c

    .line 3806
    monitor-exit p0

    return v1

    .line 3809
    :cond_2c
    :try_start_2c
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbTethering()I

    move-result v3
    :try_end_30
    .catch Ljava/lang/Exception; {:try_start_2c .. :try_end_30} :catch_32
    .catchall {:try_start_2c .. :try_end_30} :catchall_37

    move v1, v3

    .line 3812
    goto :goto_35

    .line 3810
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :catch_32
    move-exception v3

    .line 3811
    .local v3, "e":Ljava/lang/Exception;
    const/16 v1, 0x65

    .line 3813
    .end local v3    # "e":Ljava/lang/Exception;
    :goto_35
    monitor-exit p0

    return v1

    .line 3789
    .end local v0    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v1    # "returnValue":I
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    :catchall_37
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method public notifyToAddSystemService(Ljava/lang/String;Landroid/os/IBinder;)V
    .registers 3
    .param p1, "name"    # Ljava/lang/String;
    .param p2, "obj"    # Landroid/os/IBinder;

    .line 9000
    return-void
.end method

.method public onAdminAdded(I)V
    .registers 4
    .param p1, "uid"    # I

    .line 319
    const-string v0, "KnoxVpnEngineService"

    const-string v1, "[onAdminAdded]"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 320
    return-void
.end method

.method public onAdminRemoved(I)V
    .registers 4
    .param p1, "uid"    # I

    .line 326
    const-string v0, "KnoxVpnEngineService"

    const-string v1, "[onAdminRemoved]"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 327
    return-void
.end method

.method public onPreAdminRemoval(I)V
    .registers 5
    .param p1, "uid"    # I

    .line 340
    const-string v0, "KnoxVpnEngineService"

    const-string v1, "[onPreAdminRemoval]"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 341
    sget-boolean v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v1, :cond_1f

    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string v2, "Admin has VPN Permission : Pre admin remove "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 343
    :cond_1f
    :try_start_1f
    new-instance v0, Landroid/os/Bundle;

    invoke-direct {v0}, Landroid/os/Bundle;-><init>()V

    .line 344
    .local v0, "map":Landroid/os/Bundle;
    const-string/jumbo v1, "uid"

    invoke-virtual {v0, v1, p1}, Landroid/os/Bundle;->putInt(Ljava/lang/String;I)V

    .line 345
    const/16 v1, 0x13

    invoke-direct {p0, v1, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->sendMessageToHandler(ILandroid/os/Bundle;)V
    :try_end_2f
    .catch Ljava/lang/Exception; {:try_start_1f .. :try_end_2f} :catch_30

    .line 348
    .end local v0    # "map":Landroid/os/Bundle;
    goto :goto_31

    .line 346
    :catch_30
    move-exception v0

    .line 349
    :goto_31
    return-void
.end method

.method public removeAllContainerPackagesFromVpn(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;ILjava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 13
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "containerId"    # I
    .param p3, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "I",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    .line 3331
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 3333
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    new-instance v1, Ljava/lang/StringBuilder;

    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v2, "removeAllContainerPackagesFromVpn : containerId value is "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v2, " profileName value is "

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1, p3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    const-string v2, "KnoxVpnEngineService"

    invoke-static {v2, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3335
    new-instance v1, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 3336
    .local v1, "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v3, -0x1

    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v4

    invoke-virtual {v1, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3337
    const/4 v4, 0x1

    invoke-virtual {v1, v4, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 3339
    iget v5, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v5

    if-nez v5, :cond_46

    .line 3340
    const/16 v2, 0x8c

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3341
    return-object v1

    .line 3344
    :cond_46
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v5, p1, p2, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->removeAllContainerPackagesFromVpnValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;ILjava/lang/String;)I

    move-result v5

    .line 3345
    .local v5, "removeAllContainerPackagesFromVpnValidation":I
    const/16 v6, 0x64

    if-eq v5, v6, :cond_76

    .line 3346
    invoke-static {v5}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v1, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3347
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "removing all the container packages from vpn failed: The error code is "

    invoke-virtual {v3, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v5}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v2, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3348
    const/16 v2, 0x71

    if-ne v5, v2, :cond_75

    .line 3349
    const/16 v2, 0xb

    invoke-virtual {v1, v4, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 3350
    :cond_75
    return-object v1

    .line 3353
    :cond_76
    iput p2, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 3354
    invoke-direct {p0, p1, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeAllPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    move-result-object v1

    .line 3357
    :try_start_7c
    invoke-virtual {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Ljava/lang/Integer;

    invoke-virtual {v6}, Ljava/lang/Integer;->intValue()I

    move-result v6

    if-nez v6, :cond_a8

    .line 3358
    new-instance v6, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v7, "KNOX_VPN"

    const-string v8, "API:removeAllContainerPackagesFromVpn"

    invoke-direct {v6, v7, v4, v8}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 3359
    invoke-direct {p0, v6, p1, p3, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 3360
    iget v3, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    if-eqz v3, :cond_a3

    .line 3361
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v4, "cid"

    iget v6, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v3, v4, v6}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 3363
    :cond_a3
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v3}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_a8
    .catch Ljava/lang/Exception; {:try_start_7c .. :try_end_a8} :catch_a9

    .line 3367
    :cond_a8
    goto :goto_c2

    .line 3365
    :catch_a9
    move-exception v3

    .line 3366
    .local v3, "e":Ljava/lang/Exception;
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception = "

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v3}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v2, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 3369
    .end local v3    # "e":Ljava/lang/Exception;
    :goto_c2
    return-object v1
.end method

.method public declared-synchronized removeAllPackagesFromVpn(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 11
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    monitor-enter p0

    .line 3376
    :try_start_1
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 3378
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    sget-boolean v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v1, :cond_2b

    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "removeAllPackagesFromVpn: vpnContext.personaId value is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    iget v3, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string/jumbo v3, "profileName value is "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3379
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_2b
    new-instance v1, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 3380
    .local v1, "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v2, -0x1

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v1, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3381
    const/4 v3, 0x1

    invoke-virtual {v1, v3, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 3383
    iget v4, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v4

    if-nez v4, :cond_4f

    .line 3384
    const/16 v2, 0x8c

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_4d
    .catchall {:try_start_1 .. :try_end_4d} :catchall_c8

    .line 3385
    monitor-exit p0

    return-object v1

    .line 3388
    :cond_4f
    :try_start_4f
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v4, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->removeAllPackagesFromVpnValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)I

    move-result v4

    .line 3389
    .local v4, "removeAllPackagesFromVpnValidation":I
    const/16 v5, 0x64

    if-eq v4, v5, :cond_79

    .line 3390
    invoke-static {v4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3391
    const-string v2, "KnoxVpnEngineService"

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "removing all the packages from vpn failed: The error code is "

    invoke-virtual {v3, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v2, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_77
    .catchall {:try_start_4f .. :try_end_77} :catchall_c8

    .line 3392
    monitor-exit p0

    return-object v1

    .line 3395
    :cond_79
    :try_start_79
    invoke-direct {p0, p1, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeAllPackages(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    move-result-object v5
    :try_end_7d
    .catchall {:try_start_79 .. :try_end_7d} :catchall_c8

    move-object v1, v5

    .line 3398
    :try_start_7e
    invoke-virtual {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Ljava/lang/Integer;

    invoke-virtual {v5}, Ljava/lang/Integer;->intValue()I

    move-result v5

    if-nez v5, :cond_aa

    .line 3399
    new-instance v5, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v6, "KNOX_VPN"

    const-string v7, "API:removeAllPackagesFromVpn"

    invoke-direct {v5, v6, v3, v7}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 3400
    invoke-direct {p0, v5, p1, p2, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 3401
    iget v2, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    if-eqz v2, :cond_a5

    .line 3402
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v3, "cid"

    iget v5, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    invoke-virtual {v2, v3, v5}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 3404
    :cond_a5
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v2}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_aa
    .catch Ljava/lang/Exception; {:try_start_7e .. :try_end_aa} :catch_ab
    .catchall {:try_start_7e .. :try_end_aa} :catchall_c8

    .line 3408
    :cond_aa
    goto :goto_c6

    .line 3406
    :catch_ab
    move-exception v2

    .line 3407
    .local v2, "e":Ljava/lang/Exception;
    :try_start_ac
    const-string v3, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception = "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v3, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_c6
    .catchall {:try_start_ac .. :try_end_c6} :catchall_c8

    .line 3410
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_c6
    monitor-exit p0

    return-object v1

    .line 3375
    .end local v0    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v1    # "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local v4    # "removeAllPackagesFromVpnValidation":I
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    :catchall_c8
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method public declared-synchronized removeContainerPackagesFromVpn(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I[Ljava/lang/String;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 47
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "containerId"    # I
    .param p3, "packageList"    # [Ljava/lang/String;
    .param p4, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "I[",
            "Ljava/lang/String;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    move-object/from16 v1, p0

    move-object/from16 v2, p1

    move/from16 v3, p2

    move-object/from16 v4, p3

    move-object/from16 v5, p4

    monitor-enter p0

    .line 2933
    :try_start_b
    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    move-object v6, v0

    .line 2935
    .local v6, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const-string v0, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "removeContainerPackagesFromVpn : containerId value is "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v8, " profileName value is "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v0, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2936
    const/4 v7, 0x0

    .local v7, "ALL_PACKAGES_REMOVED":I
    const/4 v8, 0x1

    .local v8, "PARTIAL_PACKAGES_REMOVED":I
    const/4 v9, 0x2

    .line 2937
    .local v9, "NO_PACKAGES_REMOVED":I
    move/from16 v10, p2

    .line 2938
    .local v10, "cid":I
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v11, "ADD_ALL_PACKAGES"

    invoke-virtual {v0, v10, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v0

    move-object v11, v0

    .line 2940
    .local v11, "tAddAllPackageName":Ljava/lang/String;
    new-instance v0, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    move-object v12, v0

    .line 2941
    .local v12, "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v13, -0x1

    invoke-static {v13}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2942
    const/4 v14, 0x1

    invoke-virtual {v12, v14, v13}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 2944
    iget v0, v6, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {v1, v2, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v0

    if-nez v0, :cond_62

    .line 2945
    const/16 v0, 0x8c

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_60
    .catchall {:try_start_b .. :try_end_60} :catchall_49c

    .line 2946
    monitor-exit p0

    return-object v12

    .line 2950
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_62
    :try_start_62
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v0, v2, v3, v4, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->removeContainerPackagesFromVpnValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I[Ljava/lang/String;Ljava/lang/String;)I

    move-result v0
    :try_end_68
    .catch Ljava/lang/Exception; {:try_start_62 .. :try_end_68} :catch_448
    .catchall {:try_start_62 .. :try_end_68} :catchall_49c

    move v15, v0

    .line 2951
    .local v15, "removeContainerPackagesFromVpnValidation":I
    const/16 v0, 0x64

    if-eq v15, v0, :cond_a4

    .line 2952
    :try_start_6d
    invoke-static {v15}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2953
    const-string v0, "KnoxVpnEngineService"

    new-instance v13, Ljava/lang/StringBuilder;

    invoke-direct {v13}, Ljava/lang/StringBuilder;-><init>()V

    const-string v14, "Error occured while removing the container packages from vpn: The error code is "

    invoke-virtual {v13, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13, v15}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v13}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v13

    invoke-static {v0, v13}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2954
    const/16 v0, 0x71

    if-ne v15, v0, :cond_94

    .line 2955
    const/16 v0, 0xb

    const/4 v13, 0x1

    invoke-virtual {v12, v13, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_94
    .catch Ljava/lang/Exception; {:try_start_6d .. :try_end_94} :catch_96
    .catchall {:try_start_6d .. :try_end_94} :catchall_49c

    .line 2956
    :cond_94
    monitor-exit p0

    return-object v12

    .line 3108
    .end local v15    # "removeContainerPackagesFromVpnValidation":I
    :catch_96
    move-exception v0

    move-object/from16 v17, v6

    move/from16 v18, v7

    move/from16 v23, v8

    move/from16 v26, v9

    move-object/from16 v27, v11

    move v7, v3

    goto/16 :goto_454

    .line 2959
    .restart local v15    # "removeContainerPackagesFromVpnValidation":I
    :cond_a4
    :try_start_a4
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0
    :try_end_aa
    .catch Ljava/lang/Exception; {:try_start_a4 .. :try_end_aa} :catch_448
    .catchall {:try_start_a4 .. :try_end_aa} :catchall_49c

    move-object v13, v0

    .line 2960
    .local v13, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v13, :cond_bf

    .line 2961
    const/16 v0, 0x6c

    :try_start_af
    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2962
    const-string v0, "KnoxVpnEngineService"

    const-string v14, "Error while removing the container packages from vpn: The error code is 108"

    invoke-static {v0, v14}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_bd
    .catch Ljava/lang/Exception; {:try_start_af .. :try_end_bd} :catch_96
    .catchall {:try_start_af .. :try_end_bd} :catchall_49c

    .line 2963
    monitor-exit p0

    return-object v12

    .line 2966
    :cond_bf
    :try_start_bf
    new-instance v0, Ljava/util/ArrayList;

    invoke-direct {v0}, Ljava/util/ArrayList;-><init>()V

    move-object v14, v0

    .line 2967
    .local v14, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    new-instance v0, Ljava/util/ArrayList;

    invoke-direct {v0}, Ljava/util/ArrayList;-><init>()V
    :try_end_ca
    .catch Ljava/lang/Exception; {:try_start_bf .. :try_end_ca} :catch_448
    .catchall {:try_start_bf .. :try_end_ca} :catchall_49c

    move-object/from16 v16, v0

    .line 2969
    .local v16, "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    move-object/from16 v17, v6

    .end local v6    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .local v17, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    :try_start_ce
    array-length v6, v4
    :try_end_cf
    .catch Ljava/lang/Exception; {:try_start_ce .. :try_end_cf} :catch_43d
    .catchall {:try_start_ce .. :try_end_cf} :catchall_49c

    move/from16 v18, v7

    .end local v7    # "ALL_PACKAGES_REMOVED":I
    .local v18, "ALL_PACKAGES_REMOVED":I
    const/4 v7, 0x0

    :goto_d2
    if-ge v7, v6, :cond_276

    :try_start_d4
    aget-object v0, v4, v7

    move-object/from16 v19, v0

    .line 2970
    .local v19, "packageName":Ljava/lang/String;
    const/16 v20, 0x0

    .line 2971
    .local v20, "sharedUidPackages":[Ljava/lang/String;
    const/16 v21, 0x0

    .line 2972
    .local v21, "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    move/from16 v22, v6

    move-object/from16 v6, v19

    .end local v19    # "packageName":Ljava/lang/String;
    .local v6, "packageName":Ljava/lang/String;
    invoke-virtual {v6, v11}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v0

    if-eqz v0, :cond_f2

    .line 2973
    move/from16 v23, v8

    move/from16 v26, v9

    move-object/from16 v27, v11

    move/from16 v28, v15

    move-object/from16 v9, v16

    goto/16 :goto_250

    .line 2974
    :cond_f2
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0, v10, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v0
    :try_end_f8
    .catch Ljava/lang/Exception; {:try_start_d4 .. :try_end_f8} :catch_26b
    .catchall {:try_start_d4 .. :try_end_f8} :catchall_49c

    move-object/from16 v19, v0

    .line 2975
    .local v19, "tPackageName":Ljava/lang/String;
    move/from16 v23, v8

    move-object/from16 v8, v19

    .end local v19    # "tPackageName":Ljava/lang/String;
    .local v8, "tPackageName":Ljava/lang/String;
    .local v23, "PARTIAL_PACKAGES_REMOVED":I
    :try_start_fe
    invoke-direct {v1, v5, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackagesFromDatabase(Ljava/lang/String;Ljava/lang/String;)Z

    move-result v0
    :try_end_102
    .catch Ljava/lang/Exception; {:try_start_fe .. :try_end_102} :catch_262
    .catchall {:try_start_fe .. :try_end_102} :catchall_49c

    move/from16 v19, v0

    .line 2976
    .local v19, "result":Z
    if-nez v19, :cond_189

    .line 2977
    :try_start_106
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v24
    :try_end_10a
    .catch Ljava/lang/Exception; {:try_start_106 .. :try_end_10a} :catch_181
    .catchall {:try_start_106 .. :try_end_10a} :catchall_49c

    .line 2979
    .local v24, "blockToken":J
    move/from16 v26, v9

    const/4 v9, 0x1

    .end local v9    # "NO_PACKAGES_REMOVED":I
    .local v26, "NO_PACKAGES_REMOVED":I
    :try_start_10d
    new-array v0, v9, [Ljava/lang/String;

    const/4 v9, 0x0

    aput-object v6, v0, v9

    invoke-direct {v1, v0, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getSharedUidPackges([Ljava/lang/String;I)[Ljava/lang/String;

    move-result-object v0
    :try_end_116
    .catch Ljava/lang/Exception; {:try_start_10d .. :try_end_116} :catch_128
    .catchall {:try_start_10d .. :try_end_116} :catchall_11c

    move-object/from16 v20, v0

    .line 2983
    :try_start_118
    invoke-static/range {v24 .. v25}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    goto :goto_12c

    :catchall_11c
    move-exception v0

    invoke-static/range {v24 .. v25}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 2984
    nop

    .end local v10    # "cid":I
    .end local v11    # "tAddAllPackageName":Ljava/lang/String;
    .end local v12    # "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local v17    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v18    # "ALL_PACKAGES_REMOVED":I
    .end local v23    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v26    # "NO_PACKAGES_REMOVED":I
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "containerId":I
    .end local p3    # "packageList":[Ljava/lang/String;
    .end local p4    # "profileName":Ljava/lang/String;
    throw v0
    :try_end_122
    .catch Ljava/lang/Exception; {:try_start_118 .. :try_end_122} :catch_122
    .catchall {:try_start_118 .. :try_end_122} :catchall_49c

    .line 3108
    .end local v6    # "packageName":Ljava/lang/String;
    .end local v8    # "tPackageName":Ljava/lang/String;
    .end local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v14    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v15    # "removeContainerPackagesFromVpnValidation":I
    .end local v16    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v19    # "result":Z
    .end local v20    # "sharedUidPackages":[Ljava/lang/String;
    .end local v21    # "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    .end local v24    # "blockToken":J
    .restart local v10    # "cid":I
    .restart local v11    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v12    # "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .restart local v17    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v18    # "ALL_PACKAGES_REMOVED":I
    .restart local v23    # "PARTIAL_PACKAGES_REMOVED":I
    .restart local v26    # "NO_PACKAGES_REMOVED":I
    .restart local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .restart local p2    # "containerId":I
    .restart local p3    # "packageList":[Ljava/lang/String;
    .restart local p4    # "profileName":Ljava/lang/String;
    :catch_122
    move-exception v0

    move v7, v3

    move-object/from16 v27, v11

    goto/16 :goto_454

    .line 2980
    .restart local v6    # "packageName":Ljava/lang/String;
    .restart local v8    # "tPackageName":Ljava/lang/String;
    .restart local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v14    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v15    # "removeContainerPackagesFromVpnValidation":I
    .restart local v16    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v19    # "result":Z
    .restart local v20    # "sharedUidPackages":[Ljava/lang/String;
    .restart local v21    # "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    .restart local v24    # "blockToken":J
    :catch_128
    move-exception v0

    .line 2983
    :try_start_129
    invoke-static/range {v24 .. v25}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 2984
    :goto_12c
    move-object/from16 v0, v20

    .line 2985
    .end local v20    # "sharedUidPackages":[Ljava/lang/String;
    .local v0, "sharedUidPackages":[Ljava/lang/String;
    if-eqz v0, :cond_171

    array-length v9, v0

    if-gtz v9, :cond_13b

    .line 2986
    move-object/from16 v27, v11

    move/from16 v28, v15

    move-object/from16 v9, v16

    goto/16 :goto_250

    .line 2987
    :cond_13b
    new-instance v9, Ljava/util/ArrayList;

    invoke-direct {v9}, Ljava/util/ArrayList;-><init>()V
    :try_end_140
    .catch Ljava/lang/Exception; {:try_start_129 .. :try_end_140} :catch_17b
    .catchall {:try_start_129 .. :try_end_140} :catchall_49c

    .line 2988
    .end local v21    # "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    .local v9, "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    move-object/from16 v27, v11

    .end local v11    # "tAddAllPackageName":Ljava/lang/String;
    .local v27, "tAddAllPackageName":Ljava/lang/String;
    :try_start_142
    array-length v11, v0

    move/from16 v28, v15

    const/4 v15, 0x0

    .end local v15    # "removeContainerPackagesFromVpnValidation":I
    .local v28, "removeContainerPackagesFromVpnValidation":I
    :goto_146
    if-ge v15, v11, :cond_168

    aget-object v20, v0, v15

    move-object/from16 v21, v20

    .line 2989
    .local v21, "packageName_1":Ljava/lang/String;
    move-object/from16 v20, v0

    .end local v0    # "sharedUidPackages":[Ljava/lang/String;
    .restart local v20    # "sharedUidPackages":[Ljava/lang/String;
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move/from16 v29, v11

    move-object/from16 v11, v21

    .end local v21    # "packageName_1":Ljava/lang/String;
    .local v11, "packageName_1":Ljava/lang/String;
    invoke-virtual {v0, v10, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v0

    .line 2990
    .local v0, "tPackageName_1":Ljava/lang/String;
    invoke-direct {v1, v5, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackagesFromDatabase(Ljava/lang/String;Ljava/lang/String;)Z

    move-result v21

    .line 2991
    .local v21, "result_1":Z
    if-eqz v21, :cond_161

    .line 2992
    invoke-virtual {v9, v0}, Ljava/util/ArrayList;->add(Ljava/lang/Object;)Z
    :try_end_161
    .catch Ljava/lang/Exception; {:try_start_142 .. :try_end_161} :catch_16d
    .catchall {:try_start_142 .. :try_end_161} :catchall_49c

    .line 2988
    .end local v0    # "tPackageName_1":Ljava/lang/String;
    .end local v11    # "packageName_1":Ljava/lang/String;
    .end local v21    # "result_1":Z
    :cond_161
    add-int/lit8 v15, v15, 0x1

    move-object/from16 v0, v20

    move/from16 v11, v29

    goto :goto_146

    .end local v20    # "sharedUidPackages":[Ljava/lang/String;
    .local v0, "sharedUidPackages":[Ljava/lang/String;
    :cond_168
    move-object/from16 v20, v0

    .end local v0    # "sharedUidPackages":[Ljava/lang/String;
    .restart local v20    # "sharedUidPackages":[Ljava/lang/String;
    move-object/from16 v21, v9

    goto :goto_18f

    .line 3108
    .end local v6    # "packageName":Ljava/lang/String;
    .end local v8    # "tPackageName":Ljava/lang/String;
    .end local v9    # "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    .end local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v14    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v16    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v19    # "result":Z
    .end local v20    # "sharedUidPackages":[Ljava/lang/String;
    .end local v24    # "blockToken":J
    .end local v28    # "removeContainerPackagesFromVpnValidation":I
    :catch_16d
    move-exception v0

    move v7, v3

    goto/16 :goto_454

    .line 2985
    .end local v27    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v0    # "sharedUidPackages":[Ljava/lang/String;
    .restart local v6    # "packageName":Ljava/lang/String;
    .restart local v8    # "tPackageName":Ljava/lang/String;
    .local v11, "tAddAllPackageName":Ljava/lang/String;
    .restart local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v14    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v15    # "removeContainerPackagesFromVpnValidation":I
    .restart local v16    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v19    # "result":Z
    .local v21, "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    .restart local v24    # "blockToken":J
    :cond_171
    move-object/from16 v20, v0

    move-object/from16 v27, v11

    move/from16 v28, v15

    .end local v0    # "sharedUidPackages":[Ljava/lang/String;
    .end local v11    # "tAddAllPackageName":Ljava/lang/String;
    .end local v15    # "removeContainerPackagesFromVpnValidation":I
    .restart local v20    # "sharedUidPackages":[Ljava/lang/String;
    .restart local v27    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v28    # "removeContainerPackagesFromVpnValidation":I
    move-object/from16 v9, v16

    goto/16 :goto_250

    .line 3108
    .end local v6    # "packageName":Ljava/lang/String;
    .end local v8    # "tPackageName":Ljava/lang/String;
    .end local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v14    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v16    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v19    # "result":Z
    .end local v20    # "sharedUidPackages":[Ljava/lang/String;
    .end local v21    # "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    .end local v24    # "blockToken":J
    .end local v27    # "tAddAllPackageName":Ljava/lang/String;
    .end local v28    # "removeContainerPackagesFromVpnValidation":I
    .restart local v11    # "tAddAllPackageName":Ljava/lang/String;
    :catch_17b
    move-exception v0

    move-object/from16 v27, v11

    move v7, v3

    .end local v11    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v27    # "tAddAllPackageName":Ljava/lang/String;
    goto/16 :goto_454

    .end local v26    # "NO_PACKAGES_REMOVED":I
    .end local v27    # "tAddAllPackageName":Ljava/lang/String;
    .local v9, "NO_PACKAGES_REMOVED":I
    .restart local v11    # "tAddAllPackageName":Ljava/lang/String;
    :catch_181
    move-exception v0

    move/from16 v26, v9

    move-object/from16 v27, v11

    move v7, v3

    goto/16 :goto_269

    .line 2976
    .restart local v6    # "packageName":Ljava/lang/String;
    .restart local v8    # "tPackageName":Ljava/lang/String;
    .restart local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v14    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v15    # "removeContainerPackagesFromVpnValidation":I
    .restart local v16    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v19    # "result":Z
    .restart local v20    # "sharedUidPackages":[Ljava/lang/String;
    .restart local v21    # "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    :cond_189
    move/from16 v26, v9

    move-object/from16 v27, v11

    move/from16 v28, v15

    .line 2995
    .end local v9    # "NO_PACKAGES_REMOVED":I
    .end local v11    # "tAddAllPackageName":Ljava/lang/String;
    .end local v15    # "removeContainerPackagesFromVpnValidation":I
    .restart local v26    # "NO_PACKAGES_REMOVED":I
    .restart local v27    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v28    # "removeContainerPackagesFromVpnValidation":I
    :goto_18f
    if-eqz v21, :cond_206

    :try_start_191
    invoke-virtual/range {v21 .. v21}, Ljava/util/ArrayList;->size()I

    move-result v9

    if-gtz v9, :cond_19b

    move-object/from16 v9, v16

    goto/16 :goto_208

    .line 3028
    :cond_19b
    invoke-virtual/range {v21 .. v21}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v9

    :goto_19f
    invoke-interface {v9}, Ljava/util/Iterator;->hasNext()Z

    move-result v11

    if-eqz v11, :cond_203

    invoke-interface {v9}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v11

    check-cast v11, Ljava/lang/String;

    .line 3029
    .local v11, "tPackageName_2":Ljava/lang/String;
    invoke-virtual {v13, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackage(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    move-result-object v15

    .line 3030
    .local v15, "packageInfo_1":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    if-nez v15, :cond_1b2

    .line 3031
    goto :goto_19f

    .line 3032
    :cond_1b2
    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getCid()I

    move-result v0

    if-eq v0, v10, :cond_1b9

    .line 3033
    goto :goto_19f

    .line 3035
    :cond_1b9
    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v0

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    move-object/from16 v25, v9

    move-object/from16 v9, v16

    .end local v16    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v9, "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    invoke-interface {v9, v0}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 3037
    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v0
    :try_end_1cc
    .catch Ljava/lang/Exception; {:try_start_191 .. :try_end_1cc} :catch_439
    .catchall {:try_start_191 .. :try_end_1cc} :catchall_49c

    if-nez v0, :cond_1d6

    .line 3038
    :try_start_1ce
    invoke-virtual {v13, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->removePackageEntry(Ljava/lang/String;)V
    :try_end_1d1
    .catch Ljava/lang/Exception; {:try_start_1ce .. :try_end_1d1} :catch_16d
    .catchall {:try_start_1ce .. :try_end_1d1} :catchall_49c

    .line 3039
    move-object/from16 v16, v9

    move-object/from16 v9, v25

    goto :goto_19f

    .line 3042
    :cond_1d6
    :try_start_1d6
    invoke-virtual {v15}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v0

    .line 3043
    .local v0, "uid_1":I
    move-object/from16 v16, v15

    .end local v15    # "packageInfo_1":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .local v16, "packageInfo_1":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v15

    invoke-interface {v14, v15}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 3046
    invoke-direct {v1, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackagesFromPermissionCheckDb(I)V

    .line 3048
    invoke-direct {v1, v5, v0, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->unsetDnsSystemProperty(Ljava/lang/String;II)V

    .line 3050
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v15

    const/4 v3, 0x0

    invoke-virtual {v15, v0, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateProxyList(IZ)Ljava/util/HashMap;

    move-result-object v15

    const/4 v3, 0x2

    invoke-direct {v1, v3, v5, v15}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 3052
    invoke-virtual {v13, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->removePackageEntry(Ljava/lang/String;)V

    .line 3056
    invoke-direct {v1, v5, v10, v0, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeUIDListFromExceptionList(Ljava/lang/String;IILjava/lang/String;)V

    .line 3058
    .end local v0    # "uid_1":I
    .end local v11    # "tPackageName_2":Ljava/lang/String;
    .end local v16    # "packageInfo_1":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    move/from16 v3, p2

    move-object/from16 v16, v9

    move-object/from16 v9, v25

    goto :goto_19f

    .line 3028
    .end local v9    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v16, "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :cond_203
    move-object/from16 v9, v16

    .end local v16    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v9    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    goto :goto_250

    .line 2995
    .end local v9    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v16    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :cond_206
    move-object/from16 v9, v16

    .line 2996
    .end local v16    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v9    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :goto_208
    invoke-virtual {v13, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackage(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    move-result-object v0

    .line 2997
    .local v0, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    if-nez v0, :cond_20f

    .line 2998
    goto :goto_250

    .line 3000
    :cond_20f
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getCid()I

    move-result v3

    if-eq v3, v10, :cond_216

    .line 3001
    goto :goto_250

    .line 3003
    :cond_216
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v3

    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-interface {v9, v3}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 3005
    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v3

    if-nez v3, :cond_22b

    .line 3006
    invoke-virtual {v13, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->removePackageEntry(Ljava/lang/String;)V

    .line 3007
    goto :goto_250

    .line 3010
    :cond_22b
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v3

    .line 3011
    .local v3, "uid":I
    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v11

    invoke-interface {v14, v11}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 3014
    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackagesFromPermissionCheckDb(I)V

    .line 3016
    invoke-direct {v1, v5, v3, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->unsetDnsSystemProperty(Ljava/lang/String;II)V

    .line 3018
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v11

    const/4 v15, 0x0

    invoke-virtual {v11, v3, v15}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateProxyList(IZ)Ljava/util/HashMap;

    move-result-object v11

    const/4 v15, 0x2

    invoke-direct {v1, v15, v5, v11}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 3020
    invoke-virtual {v13, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->removePackageEntry(Ljava/lang/String;)V

    .line 3024
    invoke-direct {v1, v5, v10, v3, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeUIDListFromExceptionList(Ljava/lang/String;IILjava/lang/String;)V

    .line 3027
    .end local v0    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v3    # "uid":I
    nop

    .line 2969
    .end local v6    # "packageName":Ljava/lang/String;
    .end local v8    # "tPackageName":Ljava/lang/String;
    .end local v19    # "result":Z
    .end local v20    # "sharedUidPackages":[Ljava/lang/String;
    .end local v21    # "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    :goto_250
    add-int/lit8 v7, v7, 0x1

    move/from16 v3, p2

    move-object/from16 v16, v9

    move/from16 v6, v22

    move/from16 v8, v23

    move/from16 v9, v26

    move-object/from16 v11, v27

    move/from16 v15, v28

    goto/16 :goto_d2

    .line 3108
    .end local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v14    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v26    # "NO_PACKAGES_REMOVED":I
    .end local v27    # "tAddAllPackageName":Ljava/lang/String;
    .end local v28    # "removeContainerPackagesFromVpnValidation":I
    .local v9, "NO_PACKAGES_REMOVED":I
    .local v11, "tAddAllPackageName":Ljava/lang/String;
    :catch_262
    move-exception v0

    move/from16 v26, v9

    move-object/from16 v27, v11

    move/from16 v7, p2

    .end local v9    # "NO_PACKAGES_REMOVED":I
    .end local v11    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v26    # "NO_PACKAGES_REMOVED":I
    .restart local v27    # "tAddAllPackageName":Ljava/lang/String;
    :goto_269
    goto/16 :goto_454

    .end local v23    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v26    # "NO_PACKAGES_REMOVED":I
    .end local v27    # "tAddAllPackageName":Ljava/lang/String;
    .local v8, "PARTIAL_PACKAGES_REMOVED":I
    .restart local v9    # "NO_PACKAGES_REMOVED":I
    .restart local v11    # "tAddAllPackageName":Ljava/lang/String;
    :catch_26b
    move-exception v0

    move/from16 v23, v8

    move/from16 v26, v9

    move-object/from16 v27, v11

    move/from16 v7, p2

    .end local v8    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v9    # "NO_PACKAGES_REMOVED":I
    .end local v11    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v23    # "PARTIAL_PACKAGES_REMOVED":I
    .restart local v26    # "NO_PACKAGES_REMOVED":I
    .restart local v27    # "tAddAllPackageName":Ljava/lang/String;
    goto/16 :goto_454

    .line 3062
    .end local v23    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v26    # "NO_PACKAGES_REMOVED":I
    .end local v27    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v8    # "PARTIAL_PACKAGES_REMOVED":I
    .restart local v9    # "NO_PACKAGES_REMOVED":I
    .restart local v11    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v14    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v15, "removeContainerPackagesFromVpnValidation":I
    .restart local v16    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :cond_276
    move/from16 v23, v8

    move/from16 v26, v9

    move-object/from16 v27, v11

    move/from16 v28, v15

    move-object/from16 v9, v16

    .end local v8    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v11    # "tAddAllPackageName":Ljava/lang/String;
    .end local v15    # "removeContainerPackagesFromVpnValidation":I
    .end local v16    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v9, "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v23    # "PARTIAL_PACKAGES_REMOVED":I
    .restart local v26    # "NO_PACKAGES_REMOVED":I
    .restart local v27    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v28    # "removeContainerPackagesFromVpnValidation":I
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v3

    invoke-direct {v1, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v6

    invoke-virtual {v0, v14, v3, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeMiscRules(Ljava/util/List;Ljava/lang/String;I)V

    .line 3063
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v0, v3, v6, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;Ljava/util/List;)V

    .line 3066
    invoke-direct {v1, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->refreshDomainInHashMap(Ljava/lang/String;)V

    .line 3068
    const/4 v3, 0x0

    invoke-direct {v1, v5, v10, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateNotification(Ljava/lang/String;IZ)V

    .line 3070
    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageCount()I

    move-result v0

    move v3, v0

    .line 3071
    .local v3, "size":I
    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVpnConnectionType()I

    move-result v0

    move v6, v0

    .line 3073
    .local v6, "vpnConnectionType":I
    const/4 v0, 0x0

    .line 3074
    .local v0, "onDemand":Z
    const/4 v7, 0x1

    if-ne v6, v7, :cond_2ba

    .line 3075
    iget-object v7, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mProcessManager:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;

    invoke-virtual {v7, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;->processRunCheck(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;)Z

    move-result v7

    .line 3076
    .local v7, "isRunning":Z
    if-nez v7, :cond_2ba

    .line 3077
    const/4 v0, 0x1

    move v7, v0

    goto :goto_2bb

    .line 3081
    .end local v7    # "isRunning":Z
    :cond_2ba
    move v7, v0

    .end local v0    # "onDemand":Z
    .local v7, "onDemand":Z
    :goto_2bb
    if-lez v3, :cond_2bf

    if-eqz v7, :cond_37d

    :cond_2bf
    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v0
    :try_end_2c3
    .catch Ljava/lang/Exception; {:try_start_1d6 .. :try_end_2c3} :catch_439
    .catchall {:try_start_1d6 .. :try_end_2c3} :catchall_49c

    const/4 v8, 0x1

    if-ne v0, v8, :cond_37d

    .line 3083
    :try_start_2c6
    invoke-virtual {v1, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v0

    .line 3084
    .local v0, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-eqz v0, :cond_335

    .line 3085
    invoke-interface {v0, v5}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->stopConnection(Ljava/lang/String;)I

    move-result v8

    .line 3086
    .local v8, "stopStatus":I
    if-eqz v8, :cond_2f7

    .line 3087
    const/16 v29, 0x3

    const/16 v30, 0x5

    const/16 v31, 0x0

    .line 3088
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v32

    const-string v33, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string v15, "Error occurred trying to stop vpn connection from profile "

    invoke-virtual {v11, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v34

    iget v11, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 3087
    move/from16 v35, v11

    invoke-static/range {v29 .. v35}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    goto :goto_31b

    .line 3092
    :cond_2f7
    const/16 v35, 0x5

    const/16 v36, 0x5

    const/16 v37, 0x1

    .line 3093
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v38

    const-string v39, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string v15, "Connection with vpn vendor service stopped for profile "

    invoke-virtual {v11, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v40

    iget v11, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 3092
    move/from16 v41, v11

    invoke-static/range {v35 .. v41}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 3097
    :goto_31b
    const-string v11, "KnoxVpnEngineService"

    new-instance v15, Ljava/lang/StringBuilder;

    invoke-direct {v15}, Ljava/lang/StringBuilder;-><init>()V

    move-object/from16 v16, v0

    .end local v0    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .local v16, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    const-string/jumbo v0, "stopping the vpn connection status for on-demand configuration after removing all the container packages "

    invoke-virtual {v15, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v15, v8}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v15}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    invoke-static {v11, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_334
    .catch Ljava/lang/Exception; {:try_start_2c6 .. :try_end_334} :catch_338
    .catchall {:try_start_2c6 .. :try_end_334} :catchall_49c

    goto :goto_337

    .line 3084
    .end local v8    # "stopStatus":I
    .end local v16    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .restart local v0    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :cond_335
    move-object/from16 v16, v0

    .line 3106
    .end local v0    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :goto_337
    goto :goto_37d

    .line 3100
    :catch_338
    move-exception v0

    .line 3101
    .local v0, "e":Ljava/lang/Exception;
    const/16 v29, 0x3

    const/16 v30, 0x5

    const/16 v31, 0x0

    .line 3102
    :try_start_33f
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v32

    const-string v33, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v11, "Exception stopping connection for profile "

    invoke-virtual {v8, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v11, " after removing all container packages"

    invoke-virtual {v8, v11}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v34

    iget v8, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 3101
    move/from16 v35, v8

    invoke-static/range {v29 .. v35}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 3105
    const-string v8, "KnoxVpnEngineService"

    new-instance v11, Ljava/lang/StringBuilder;

    invoke-direct {v11}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v15, "stopping the vpn connection failed for on-demand configuration after removing all the container packages "

    invoke-virtual {v11, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v15

    invoke-virtual {v11, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v11}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v11

    invoke-static {v8, v11}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_37d
    .catch Ljava/lang/Exception; {:try_start_33f .. :try_end_37d} :catch_439
    .catchall {:try_start_33f .. :try_end_37d} :catchall_49c

    .line 3118
    .end local v0    # "e":Ljava/lang/Exception;
    .end local v3    # "size":I
    .end local v6    # "vpnConnectionType":I
    .end local v7    # "onDemand":Z
    .end local v9    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v14    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v28    # "removeContainerPackagesFromVpnValidation":I
    :cond_37d
    :goto_37d
    nop

    .line 3120
    :try_start_37e
    const-string v0, "KnoxVpnEngineService"

    const-string/jumbo v3, "removing all container packages from vpn is a success: The error code is 0"

    invoke-static {v0, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3121
    const/4 v3, 0x0

    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3122
    invoke-virtual {v12, v3, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 3124
    const/16 v28, 0x5

    const/16 v29, 0x5

    const/16 v30, 0x1

    .line 3125
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v31

    const-string v32, "KnoxVpnEngineService"

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "success while removing all the packages from vpn for profile "

    invoke-virtual {v0, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v33

    iget v0, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 3124
    move/from16 v34, v0

    invoke-static/range {v28 .. v34}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_3b6
    .catchall {:try_start_37e .. :try_end_3b6} :catchall_49c

    .line 3130
    :try_start_3b6
    invoke-virtual {v12}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Ljava/lang/Integer;

    invoke-virtual {v0}, Ljava/lang/Integer;->intValue()I

    move-result v0

    if-nez v0, :cond_417

    .line 3131
    new-instance v0, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v3, "KNOX_VPN"

    const-string v6, "API:removeContainerPackagesFromVpn"

    const/4 v7, 0x1

    invoke-direct {v0, v3, v7, v6}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 3132
    const/4 v3, -0x1

    invoke-direct {v1, v0, v2, v5, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 3133
    invoke-static/range {p3 .. p3}, Ljava/util/Arrays;->sort([Ljava/lang/Object;)V

    .line 3134
    new-instance v0, Ljava/lang/StringBuffer;

    const/4 v3, 0x0

    aget-object v3, v4, v3

    invoke-direct {v0, v3}, Ljava/lang/StringBuffer;-><init>(Ljava/lang/String;)V

    .line 3135
    .local v0, "pkgList":Ljava/lang/StringBuffer;
    const/4 v3, 0x1

    .local v3, "i":I
    :goto_3de
    array-length v6, v4

    if-ge v3, v6, :cond_3fa

    .line 3136
    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, ","

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    aget-object v7, v4, v3

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v0, v6}, Ljava/lang/StringBuffer;->append(Ljava/lang/String;)Ljava/lang/StringBuffer;

    .line 3135
    add-int/lit8 v3, v3, 0x1

    goto :goto_3de

    .line 3138
    .end local v3    # "i":I
    :cond_3fa
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string/jumbo v6, "pkgLst"

    invoke-virtual {v0}, Ljava/lang/StringBuffer;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v3, v6, v7}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;Ljava/lang/String;)V

    .line 3139
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v6, "cid"
    :try_end_40a
    .catch Ljava/lang/Exception; {:try_start_3b6 .. :try_end_40a} :catch_41a
    .catchall {:try_start_3b6 .. :try_end_40a} :catchall_49c

    move/from16 v7, p2

    :try_start_40c
    invoke-virtual {v3, v6, v7}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 3140
    iget-object v3, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v3}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_414
    .catch Ljava/lang/Exception; {:try_start_40c .. :try_end_414} :catch_415
    .catchall {:try_start_40c .. :try_end_414} :catchall_49c

    goto :goto_419

    .line 3142
    .end local v0    # "pkgList":Ljava/lang/StringBuffer;
    :catch_415
    move-exception v0

    goto :goto_41d

    .line 3130
    :cond_417
    move/from16 v7, p2

    .line 3144
    :goto_419
    goto :goto_437

    .line 3142
    :catch_41a
    move-exception v0

    move/from16 v7, p2

    .line 3143
    .local v0, "e":Ljava/lang/Exception;
    :goto_41d
    :try_start_41d
    const-string v3, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v8, "Exception = "

    invoke-virtual {v6, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v8

    invoke-virtual {v6, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v3, v6}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_437
    .catchall {:try_start_41d .. :try_end_437} :catchall_49c

    .line 3146
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_437
    monitor-exit p0

    return-object v12

    .line 3108
    :catch_439
    move-exception v0

    move/from16 v7, p2

    goto :goto_454

    .end local v18    # "ALL_PACKAGES_REMOVED":I
    .end local v23    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v26    # "NO_PACKAGES_REMOVED":I
    .end local v27    # "tAddAllPackageName":Ljava/lang/String;
    .local v7, "ALL_PACKAGES_REMOVED":I
    .local v8, "PARTIAL_PACKAGES_REMOVED":I
    .local v9, "NO_PACKAGES_REMOVED":I
    .restart local v11    # "tAddAllPackageName":Ljava/lang/String;
    :catch_43d
    move-exception v0

    move/from16 v18, v7

    move/from16 v23, v8

    move/from16 v26, v9

    move-object/from16 v27, v11

    move v7, v3

    .end local v7    # "ALL_PACKAGES_REMOVED":I
    .end local v8    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v9    # "NO_PACKAGES_REMOVED":I
    .end local v11    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v18    # "ALL_PACKAGES_REMOVED":I
    .restart local v23    # "PARTIAL_PACKAGES_REMOVED":I
    .restart local v26    # "NO_PACKAGES_REMOVED":I
    .restart local v27    # "tAddAllPackageName":Ljava/lang/String;
    goto :goto_454

    .end local v17    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v18    # "ALL_PACKAGES_REMOVED":I
    .end local v23    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v26    # "NO_PACKAGES_REMOVED":I
    .end local v27    # "tAddAllPackageName":Ljava/lang/String;
    .local v6, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v7    # "ALL_PACKAGES_REMOVED":I
    .restart local v8    # "PARTIAL_PACKAGES_REMOVED":I
    .restart local v9    # "NO_PACKAGES_REMOVED":I
    .restart local v11    # "tAddAllPackageName":Ljava/lang/String;
    :catch_448
    move-exception v0

    move-object/from16 v17, v6

    move/from16 v18, v7

    move/from16 v23, v8

    move/from16 v26, v9

    move-object/from16 v27, v11

    move v7, v3

    .line 3109
    .end local v6    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v7    # "ALL_PACKAGES_REMOVED":I
    .end local v8    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v9    # "NO_PACKAGES_REMOVED":I
    .end local v11    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v0    # "e":Ljava/lang/Exception;
    .restart local v17    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v18    # "ALL_PACKAGES_REMOVED":I
    .restart local v23    # "PARTIAL_PACKAGES_REMOVED":I
    .restart local v26    # "NO_PACKAGES_REMOVED":I
    .restart local v27    # "tAddAllPackageName":Ljava/lang/String;
    :goto_454
    :try_start_454
    const-string v3, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v8, "Error occured while removing all container packages from vpn: exception occured: The error code is -1"

    invoke-virtual {v6, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v8

    invoke-virtual {v6, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v3, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3110
    const/4 v3, -0x1

    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v12, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3112
    const/16 v28, 0x3

    const/16 v29, 0x5

    const/16 v30, 0x0

    .line 3113
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v31

    const-string v32, "KnoxVpnEngineService"

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception while removing all container packages from vpn for profile "

    invoke-virtual {v3, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v33

    iget v3, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 3112
    move/from16 v34, v3

    invoke-static/range {v28 .. v34}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_49a
    .catchall {:try_start_454 .. :try_end_49a} :catchall_49c

    .line 3117
    monitor-exit p0

    return-object v12

    .line 2932
    .end local v0    # "e":Ljava/lang/Exception;
    .end local v10    # "cid":I
    .end local v12    # "errorResponse":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local v17    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v18    # "ALL_PACKAGES_REMOVED":I
    .end local v23    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v26    # "NO_PACKAGES_REMOVED":I
    .end local v27    # "tAddAllPackageName":Ljava/lang/String;
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "containerId":I
    .end local p3    # "packageList":[Ljava/lang/String;
    .end local p4    # "profileName":Ljava/lang/String;
    :catchall_49c
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method public declared-synchronized removePackagesFromVpn(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;[Ljava/lang/String;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 48
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "packageList"    # [Ljava/lang/String;
    .param p3, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "[",
            "Ljava/lang/String;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    move-object/from16 v1, p0

    move-object/from16 v2, p1

    move-object/from16 v3, p2

    move-object/from16 v4, p3

    monitor-enter p0

    .line 2149
    :try_start_9
    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    move-object v5, v0

    .line 2151
    .local v5, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const-string v0, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "package is going to be removed from vpn for the profile "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v0, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2152
    const/4 v6, 0x0

    .local v6, "ALL_PACKAGES_REMOVED":I
    const/4 v7, 0x1

    .local v7, "PARTIAL_PACKAGES_REMOVED":I
    const/4 v8, 0x2

    .line 2153
    .local v8, "NO_PACKAGES_REMOVED":I
    invoke-virtual/range {p1 .. p1}, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->getPersonaId()I

    move-result v0

    move v9, v0

    .line 2154
    .local v9, "cid":I
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    const-string v10, "ADD_ALL_PACKAGES"

    invoke-virtual {v0, v9, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v0

    move-object v10, v0

    .line 2156
    .local v10, "tAddAllPackageName":Ljava/lang/String;
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    move-object v11, v0

    .line 2157
    .local v11, "successPackages":Ljava/lang/StringBuilder;
    new-instance v0, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    move-object v12, v0

    .line 2158
    .local v12, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v13, 0x2

    invoke-static {v13}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2159
    const/4 v14, -0x1

    const/4 v15, 0x1

    invoke-virtual {v12, v15, v14}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 2161
    iget v0, v5, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {v1, v2, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v0

    if-nez v0, :cond_62

    .line 2162
    const/16 v0, 0x8c

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_60
    .catchall {:try_start_9 .. :try_end_60} :catchall_4f0

    .line 2163
    monitor-exit p0

    return-object v12

    .line 2167
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_62
    :try_start_62
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v0, v2, v3, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->removePackagesFromVpnValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;[Ljava/lang/String;Ljava/lang/String;)I

    move-result v0
    :try_end_68
    .catch Ljava/lang/Exception; {:try_start_62 .. :try_end_68} :catch_4a0
    .catchall {:try_start_62 .. :try_end_68} :catchall_4f0

    move/from16 v16, v0

    .line 2168
    .local v16, "removePackagesFromVpnValidation":I
    const/16 v0, 0x64

    move/from16 v14, v16

    .end local v16    # "removePackagesFromVpnValidation":I
    .local v14, "removePackagesFromVpnValidation":I
    if-eq v14, v0, :cond_9c

    .line 2169
    :try_start_70
    invoke-static {v14}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2170
    const-string v0, "KnoxVpnEngineService"

    new-instance v13, Ljava/lang/StringBuilder;

    invoke-direct {v13}, Ljava/lang/StringBuilder;-><init>()V

    const-string v15, "Error occured while removing packages from vpn: The error code is "

    invoke-virtual {v13, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13, v14}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v13}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v13

    invoke-static {v0, v13}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_8d
    .catch Ljava/lang/Exception; {:try_start_70 .. :try_end_8d} :catch_8f
    .catchall {:try_start_70 .. :try_end_8d} :catchall_4f0

    .line 2171
    monitor-exit p0

    return-object v12

    .line 2330
    .end local v14    # "removePackagesFromVpnValidation":I
    :catch_8f
    move-exception v0

    move-object/from16 v20, v5

    move/from16 v24, v6

    move/from16 v25, v7

    move/from16 v28, v8

    move-object/from16 v30, v10

    goto/16 :goto_4ab

    .line 2174
    .restart local v14    # "removePackagesFromVpnValidation":I
    :cond_9c
    :try_start_9c
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0
    :try_end_a2
    .catch Ljava/lang/Exception; {:try_start_9c .. :try_end_a2} :catch_4a0
    .catchall {:try_start_9c .. :try_end_a2} :catchall_4f0

    move-object/from16 v16, v0

    .line 2175
    .local v16, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    move-object/from16 v13, v16

    .end local v16    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .local v13, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v13, :cond_ba

    .line 2176
    const/16 v0, 0x6c

    :try_start_aa
    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2177
    const-string v0, "KnoxVpnEngineService"

    const-string v15, "Error while removing the packages from vpn: The error code is 108"

    invoke-static {v0, v15}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_b8
    .catch Ljava/lang/Exception; {:try_start_aa .. :try_end_b8} :catch_8f
    .catchall {:try_start_aa .. :try_end_b8} :catchall_4f0

    .line 2178
    monitor-exit p0

    return-object v12

    .line 2181
    :cond_ba
    :try_start_ba
    new-instance v0, Ljava/util/ArrayList;

    invoke-direct {v0}, Ljava/util/ArrayList;-><init>()V

    move-object/from16 v16, v0

    .line 2182
    .local v16, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    new-instance v0, Ljava/util/ArrayList;

    invoke-direct {v0}, Ljava/util/ArrayList;-><init>()V

    move-object/from16 v19, v0

    .line 2184
    .local v19, "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    array-length v15, v3
    :try_end_c9
    .catch Ljava/lang/Exception; {:try_start_ba .. :try_end_c9} :catch_4a0
    .catchall {:try_start_ba .. :try_end_c9} :catchall_4f0

    move-object/from16 v20, v5

    .end local v5    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .local v20, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const/4 v5, 0x0

    :goto_cc
    if-ge v5, v15, :cond_2b5

    :try_start_ce
    aget-object v0, v3, v5
    :try_end_d0
    .catch Ljava/lang/Exception; {:try_start_ce .. :try_end_d0} :catch_2aa
    .catchall {:try_start_ce .. :try_end_d0} :catchall_4f0

    move-object/from16 v21, v0

    .line 2185
    .local v21, "packageName":Ljava/lang/String;
    const/16 v22, 0x0

    .line 2186
    .local v22, "sharedUidPackages":[Ljava/lang/String;
    const/16 v23, 0x0

    .line 2187
    .local v23, "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    move/from16 v24, v6

    move-object/from16 v6, v21

    .end local v21    # "packageName":Ljava/lang/String;
    .local v6, "packageName":Ljava/lang/String;
    .local v24, "ALL_PACKAGES_REMOVED":I
    :try_start_da
    invoke-virtual {v6, v10}, Ljava/lang/String;->equalsIgnoreCase(Ljava/lang/String;)Z

    move-result v0

    if-eqz v0, :cond_f0

    .line 2188
    move/from16 v25, v7

    move/from16 v28, v8

    move-object/from16 v30, v10

    move/from16 v26, v14

    move-object/from16 v8, v16

    move-object/from16 v14, v19

    move/from16 v16, v15

    goto/16 :goto_286

    .line 2189
    :cond_f0
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v0, v9, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v0
    :try_end_f6
    .catch Ljava/lang/Exception; {:try_start_da .. :try_end_f6} :catch_2a1
    .catchall {:try_start_da .. :try_end_f6} :catchall_4f0

    move-object/from16 v21, v0

    .line 2190
    .local v21, "tPackageName":Ljava/lang/String;
    move/from16 v25, v7

    move-object/from16 v7, v21

    .end local v21    # "tPackageName":Ljava/lang/String;
    .local v7, "tPackageName":Ljava/lang/String;
    .local v25, "PARTIAL_PACKAGES_REMOVED":I
    :try_start_fc
    invoke-direct {v1, v4, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackagesFromDatabase(Ljava/lang/String;Ljava/lang/String;)Z

    move-result v0

    move/from16 v21, v0

    .line 2191
    .local v21, "result":Z
    if-nez v21, :cond_183

    .line 2192
    invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J

    move-result-wide v26
    :try_end_108
    .catch Ljava/lang/Exception; {:try_start_fc .. :try_end_108} :catch_29a
    .catchall {:try_start_fc .. :try_end_108} :catchall_4f0

    .line 2194
    .local v26, "blockToken":J
    move/from16 v28, v8

    const/4 v8, 0x1

    .end local v8    # "NO_PACKAGES_REMOVED":I
    .local v28, "NO_PACKAGES_REMOVED":I
    :try_start_10b
    new-array v0, v8, [Ljava/lang/String;

    const/4 v8, 0x0

    aput-object v6, v0, v8

    invoke-direct {v1, v0, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getSharedUidPackges([Ljava/lang/String;I)[Ljava/lang/String;

    move-result-object v0
    :try_end_114
    .catch Ljava/lang/Exception; {:try_start_10b .. :try_end_114} :catch_125
    .catchall {:try_start_10b .. :try_end_114} :catchall_11a

    move-object/from16 v22, v0

    .line 2198
    :try_start_116
    invoke-static/range {v26 .. v27}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    goto :goto_129

    :catchall_11a
    move-exception v0

    invoke-static/range {v26 .. v27}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 2199
    nop

    .end local v9    # "cid":I
    .end local v10    # "tAddAllPackageName":Ljava/lang/String;
    .end local v11    # "successPackages":Ljava/lang/StringBuilder;
    .end local v12    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local v20    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v24    # "ALL_PACKAGES_REMOVED":I
    .end local v25    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v28    # "NO_PACKAGES_REMOVED":I
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "packageList":[Ljava/lang/String;
    .end local p3    # "profileName":Ljava/lang/String;
    throw v0
    :try_end_120
    .catch Ljava/lang/Exception; {:try_start_116 .. :try_end_120} :catch_120
    .catchall {:try_start_116 .. :try_end_120} :catchall_4f0

    .line 2330
    .end local v6    # "packageName":Ljava/lang/String;
    .end local v7    # "tPackageName":Ljava/lang/String;
    .end local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v14    # "removePackagesFromVpnValidation":I
    .end local v16    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v19    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v21    # "result":Z
    .end local v22    # "sharedUidPackages":[Ljava/lang/String;
    .end local v23    # "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    .end local v26    # "blockToken":J
    .restart local v9    # "cid":I
    .restart local v10    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v11    # "successPackages":Ljava/lang/StringBuilder;
    .restart local v12    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .restart local v20    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v24    # "ALL_PACKAGES_REMOVED":I
    .restart local v25    # "PARTIAL_PACKAGES_REMOVED":I
    .restart local v28    # "NO_PACKAGES_REMOVED":I
    .restart local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .restart local p2    # "packageList":[Ljava/lang/String;
    .restart local p3    # "profileName":Ljava/lang/String;
    :catch_120
    move-exception v0

    move-object/from16 v30, v10

    goto/16 :goto_4ab

    .line 2195
    .restart local v6    # "packageName":Ljava/lang/String;
    .restart local v7    # "tPackageName":Ljava/lang/String;
    .restart local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v14    # "removePackagesFromVpnValidation":I
    .restart local v16    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v19    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v21    # "result":Z
    .restart local v22    # "sharedUidPackages":[Ljava/lang/String;
    .restart local v23    # "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    .restart local v26    # "blockToken":J
    :catch_125
    move-exception v0

    .line 2198
    :try_start_126
    invoke-static/range {v26 .. v27}, Landroid/os/Binder;->restoreCallingIdentity(J)V

    .line 2199
    :goto_129
    move-object/from16 v0, v22

    .line 2200
    .end local v22    # "sharedUidPackages":[Ljava/lang/String;
    .local v0, "sharedUidPackages":[Ljava/lang/String;
    if-eqz v0, :cond_16e

    array-length v8, v0

    if-gtz v8, :cond_13c

    .line 2201
    move-object/from16 v30, v10

    move/from16 v26, v14

    move-object/from16 v8, v16

    move-object/from16 v14, v19

    move/from16 v16, v15

    goto/16 :goto_286

    .line 2202
    :cond_13c
    new-instance v8, Ljava/util/ArrayList;

    invoke-direct {v8}, Ljava/util/ArrayList;-><init>()V

    .line 2203
    .end local v23    # "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    .local v8, "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    move-object/from16 v29, v6

    .end local v6    # "packageName":Ljava/lang/String;
    .local v29, "packageName":Ljava/lang/String;
    array-length v6, v0
    :try_end_144
    .catch Ljava/lang/Exception; {:try_start_126 .. :try_end_144} :catch_17e
    .catchall {:try_start_126 .. :try_end_144} :catchall_4f0

    move-object/from16 v30, v10

    const/4 v10, 0x0

    .end local v10    # "tAddAllPackageName":Ljava/lang/String;
    .local v30, "tAddAllPackageName":Ljava/lang/String;
    :goto_147
    if-ge v10, v6, :cond_169

    :try_start_149
    aget-object v22, v0, v10

    move-object/from16 v23, v22

    .line 2204
    .local v23, "packageName_1":Ljava/lang/String;
    move-object/from16 v22, v0

    .end local v0    # "sharedUidPackages":[Ljava/lang/String;
    .restart local v22    # "sharedUidPackages":[Ljava/lang/String;
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move/from16 v31, v6

    move-object/from16 v6, v23

    .end local v23    # "packageName_1":Ljava/lang/String;
    .local v6, "packageName_1":Ljava/lang/String;
    invoke-virtual {v0, v9, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getPersonifiedName(ILjava/lang/String;)Ljava/lang/String;

    move-result-object v0

    .line 2205
    .local v0, "tPackageName_1":Ljava/lang/String;
    invoke-direct {v1, v4, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackagesFromDatabase(Ljava/lang/String;Ljava/lang/String;)Z

    move-result v23

    .line 2206
    .local v23, "result_1":Z
    if-eqz v23, :cond_162

    .line 2207
    invoke-virtual {v8, v0}, Ljava/util/ArrayList;->add(Ljava/lang/Object;)Z

    .line 2203
    .end local v0    # "tPackageName_1":Ljava/lang/String;
    .end local v6    # "packageName_1":Ljava/lang/String;
    .end local v23    # "result_1":Z
    :cond_162
    add-int/lit8 v10, v10, 0x1

    move-object/from16 v0, v22

    move/from16 v6, v31

    goto :goto_147

    .end local v22    # "sharedUidPackages":[Ljava/lang/String;
    .local v0, "sharedUidPackages":[Ljava/lang/String;
    :cond_169
    move-object/from16 v22, v0

    .end local v0    # "sharedUidPackages":[Ljava/lang/String;
    .restart local v22    # "sharedUidPackages":[Ljava/lang/String;
    move-object/from16 v23, v8

    goto :goto_189

    .line 2200
    .end local v8    # "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    .end local v22    # "sharedUidPackages":[Ljava/lang/String;
    .end local v29    # "packageName":Ljava/lang/String;
    .end local v30    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v0    # "sharedUidPackages":[Ljava/lang/String;
    .local v6, "packageName":Ljava/lang/String;
    .restart local v10    # "tAddAllPackageName":Ljava/lang/String;
    .local v23, "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    :cond_16e
    move-object/from16 v22, v0

    move-object/from16 v29, v6

    move-object/from16 v30, v10

    .end local v0    # "sharedUidPackages":[Ljava/lang/String;
    .end local v6    # "packageName":Ljava/lang/String;
    .end local v10    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v22    # "sharedUidPackages":[Ljava/lang/String;
    .restart local v29    # "packageName":Ljava/lang/String;
    .restart local v30    # "tAddAllPackageName":Ljava/lang/String;
    move/from16 v26, v14

    move-object/from16 v8, v16

    move-object/from16 v14, v19

    move/from16 v16, v15

    goto/16 :goto_286

    .line 2330
    .end local v7    # "tPackageName":Ljava/lang/String;
    .end local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v14    # "removePackagesFromVpnValidation":I
    .end local v16    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v19    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v21    # "result":Z
    .end local v22    # "sharedUidPackages":[Ljava/lang/String;
    .end local v23    # "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    .end local v26    # "blockToken":J
    .end local v29    # "packageName":Ljava/lang/String;
    .end local v30    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v10    # "tAddAllPackageName":Ljava/lang/String;
    :catch_17e
    move-exception v0

    move-object/from16 v30, v10

    .end local v10    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v30    # "tAddAllPackageName":Ljava/lang/String;
    goto/16 :goto_4ab

    .line 2191
    .end local v28    # "NO_PACKAGES_REMOVED":I
    .end local v30    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v6    # "packageName":Ljava/lang/String;
    .restart local v7    # "tPackageName":Ljava/lang/String;
    .local v8, "NO_PACKAGES_REMOVED":I
    .restart local v10    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v14    # "removePackagesFromVpnValidation":I
    .restart local v16    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v19    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v21    # "result":Z
    .restart local v22    # "sharedUidPackages":[Ljava/lang/String;
    .restart local v23    # "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    :cond_183
    move-object/from16 v29, v6

    move/from16 v28, v8

    move-object/from16 v30, v10

    .line 2210
    .end local v6    # "packageName":Ljava/lang/String;
    .end local v8    # "NO_PACKAGES_REMOVED":I
    .end local v10    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v28    # "NO_PACKAGES_REMOVED":I
    .restart local v29    # "packageName":Ljava/lang/String;
    .restart local v30    # "tAddAllPackageName":Ljava/lang/String;
    :goto_189
    if-eqz v23, :cond_226

    invoke-virtual/range {v23 .. v23}, Ljava/util/ArrayList;->size()I

    move-result v0

    if-gtz v0, :cond_19b

    move/from16 v26, v14

    move-object/from16 v8, v16

    move-object/from16 v14, v19

    move/from16 v16, v15

    goto/16 :goto_22e

    .line 2246
    :cond_19b
    invoke-virtual/range {v23 .. v23}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;

    move-result-object v0

    :goto_19f
    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z

    move-result v6

    if-eqz v6, :cond_21d

    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Ljava/lang/String;

    .line 2247
    .local v6, "tPackageName_2":Ljava/lang/String;
    invoke-virtual {v13, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackage(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    move-result-object v8

    .line 2248
    .local v8, "packageInfo_1":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    if-nez v8, :cond_1b2

    .line 2249
    goto :goto_19f

    .line 2251
    :cond_1b2
    invoke-virtual {v8}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getCid()I

    move-result v10

    if-eq v10, v9, :cond_1b9

    .line 2252
    goto :goto_19f

    .line 2254
    :cond_1b9
    invoke-virtual {v8}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v10

    invoke-static {v10}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v10

    move/from16 v26, v14

    move-object/from16 v14, v19

    .end local v19    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v14, "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v26, "removePackagesFromVpnValidation":I
    invoke-interface {v14, v10}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 2256
    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v10

    if-nez v10, :cond_1de

    .line 2257
    invoke-virtual {v13, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->removePackageEntry(Ljava/lang/String;)V

    .line 2258
    invoke-virtual {v11, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v10, ", "

    invoke-virtual {v11, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    .line 2259
    move-object/from16 v19, v14

    move/from16 v14, v26

    goto :goto_19f

    .line 2262
    :cond_1de
    invoke-virtual {v8}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v10

    .line 2263
    .local v10, "uid_1":I
    move-object/from16 v19, v0

    invoke-static {v10}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    move-object/from16 v27, v8

    move-object/from16 v8, v16

    .end local v16    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v8, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v27, "packageInfo_1":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    invoke-interface {v8, v0}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 2266
    invoke-direct {v1, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackagesFromPermissionCheckDb(I)V

    .line 2268
    invoke-direct {v1, v4, v10, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->unsetDnsSystemProperty(Ljava/lang/String;II)V

    .line 2270
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v0

    move/from16 v16, v15

    const/4 v15, 0x0

    invoke-virtual {v0, v10, v15}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateProxyList(IZ)Ljava/util/HashMap;

    move-result-object v0

    const/4 v15, 0x2

    invoke-direct {v1, v15, v4, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 2272
    invoke-virtual {v13, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->removePackageEntry(Ljava/lang/String;)V

    .line 2274
    invoke-virtual {v11, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v0, ", "

    invoke-virtual {v11, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    .line 2278
    invoke-direct {v1, v4, v9, v10, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeUIDListFromExceptionList(Ljava/lang/String;IILjava/lang/String;)V

    .line 2280
    .end local v6    # "tPackageName_2":Ljava/lang/String;
    .end local v10    # "uid_1":I
    .end local v27    # "packageInfo_1":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    move/from16 v15, v16

    move-object/from16 v0, v19

    move-object/from16 v16, v8

    move-object/from16 v19, v14

    move/from16 v14, v26

    goto :goto_19f

    .line 2246
    .end local v8    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v26    # "removePackagesFromVpnValidation":I
    .local v14, "removePackagesFromVpnValidation":I
    .restart local v16    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v19    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :cond_21d
    move/from16 v26, v14

    move-object/from16 v8, v16

    move-object/from16 v14, v19

    move/from16 v16, v15

    .end local v16    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v19    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v8    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v14, "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v26    # "removePackagesFromVpnValidation":I
    goto :goto_286

    .line 2210
    .end local v8    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v26    # "removePackagesFromVpnValidation":I
    .local v14, "removePackagesFromVpnValidation":I
    .restart local v16    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v19    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :cond_226
    move/from16 v26, v14

    move-object/from16 v8, v16

    move-object/from16 v14, v19

    move/from16 v16, v15

    .line 2211
    .end local v16    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v19    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v8    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v14, "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v26    # "removePackagesFromVpnValidation":I
    :goto_22e
    invoke-virtual {v13, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackage(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    move-result-object v0

    .line 2212
    .local v0, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    if-nez v0, :cond_235

    .line 2213
    goto :goto_286

    .line 2215
    :cond_235
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getCid()I

    move-result v6

    if-eq v6, v9, :cond_23c

    .line 2216
    goto :goto_286

    .line 2218
    :cond_23c
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v6

    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v6

    invoke-interface {v14, v6}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 2220
    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v6

    if-nez v6, :cond_259

    .line 2221
    invoke-virtual {v13, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->removePackageEntry(Ljava/lang/String;)V

    .line 2222
    invoke-virtual {v11, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, ", "

    invoke-virtual {v11, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    .line 2223
    goto :goto_286

    .line 2226
    :cond_259
    invoke-virtual {v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v6

    .line 2227
    .local v6, "uid":I
    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v10

    invoke-interface {v8, v10}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 2230
    invoke-direct {v1, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removePackagesFromPermissionCheckDb(I)V

    .line 2232
    invoke-direct {v1, v4, v6, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->unsetDnsSystemProperty(Ljava/lang/String;II)V

    .line 2234
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v10

    const/4 v15, 0x0

    invoke-virtual {v10, v6, v15}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateProxyList(IZ)Ljava/util/HashMap;

    move-result-object v10

    const/4 v15, 0x2

    invoke-direct {v1, v15, v4, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 2236
    invoke-virtual {v13, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->removePackageEntry(Ljava/lang/String;)V

    .line 2238
    invoke-virtual {v11, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v10, ", "

    invoke-virtual {v11, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    .line 2242
    invoke-direct {v1, v4, v9, v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeUIDListFromExceptionList(Ljava/lang/String;IILjava/lang/String;)V

    .line 2245
    .end local v0    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    .end local v6    # "uid":I
    nop

    .line 2184
    .end local v7    # "tPackageName":Ljava/lang/String;
    .end local v21    # "result":Z
    .end local v22    # "sharedUidPackages":[Ljava/lang/String;
    .end local v23    # "substituteSharedUidPackage":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Ljava/lang/String;>;"
    .end local v29    # "packageName":Ljava/lang/String;
    :goto_286
    add-int/lit8 v5, v5, 0x1

    move-object/from16 v19, v14

    move/from16 v15, v16

    move/from16 v6, v24

    move/from16 v7, v25

    move/from16 v14, v26

    move-object/from16 v10, v30

    move-object/from16 v16, v8

    move/from16 v8, v28

    goto/16 :goto_cc

    .line 2330
    .end local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v14    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v26    # "removePackagesFromVpnValidation":I
    .end local v28    # "NO_PACKAGES_REMOVED":I
    .end local v30    # "tAddAllPackageName":Ljava/lang/String;
    .local v8, "NO_PACKAGES_REMOVED":I
    .local v10, "tAddAllPackageName":Ljava/lang/String;
    :catch_29a
    move-exception v0

    move/from16 v28, v8

    move-object/from16 v30, v10

    .end local v8    # "NO_PACKAGES_REMOVED":I
    .end local v10    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v28    # "NO_PACKAGES_REMOVED":I
    .restart local v30    # "tAddAllPackageName":Ljava/lang/String;
    goto/16 :goto_4ab

    .end local v25    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v28    # "NO_PACKAGES_REMOVED":I
    .end local v30    # "tAddAllPackageName":Ljava/lang/String;
    .local v7, "PARTIAL_PACKAGES_REMOVED":I
    .restart local v8    # "NO_PACKAGES_REMOVED":I
    .restart local v10    # "tAddAllPackageName":Ljava/lang/String;
    :catch_2a1
    move-exception v0

    move/from16 v25, v7

    move/from16 v28, v8

    move-object/from16 v30, v10

    .end local v7    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v8    # "NO_PACKAGES_REMOVED":I
    .end local v10    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v25    # "PARTIAL_PACKAGES_REMOVED":I
    .restart local v28    # "NO_PACKAGES_REMOVED":I
    .restart local v30    # "tAddAllPackageName":Ljava/lang/String;
    goto/16 :goto_4ab

    .end local v24    # "ALL_PACKAGES_REMOVED":I
    .end local v25    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v28    # "NO_PACKAGES_REMOVED":I
    .end local v30    # "tAddAllPackageName":Ljava/lang/String;
    .local v6, "ALL_PACKAGES_REMOVED":I
    .restart local v7    # "PARTIAL_PACKAGES_REMOVED":I
    .restart local v8    # "NO_PACKAGES_REMOVED":I
    .restart local v10    # "tAddAllPackageName":Ljava/lang/String;
    :catch_2aa
    move-exception v0

    move/from16 v24, v6

    move/from16 v25, v7

    move/from16 v28, v8

    move-object/from16 v30, v10

    .end local v6    # "ALL_PACKAGES_REMOVED":I
    .end local v7    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v8    # "NO_PACKAGES_REMOVED":I
    .end local v10    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v24    # "ALL_PACKAGES_REMOVED":I
    .restart local v25    # "PARTIAL_PACKAGES_REMOVED":I
    .restart local v28    # "NO_PACKAGES_REMOVED":I
    .restart local v30    # "tAddAllPackageName":Ljava/lang/String;
    goto/16 :goto_4ab

    .line 2284
    .end local v24    # "ALL_PACKAGES_REMOVED":I
    .end local v25    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v28    # "NO_PACKAGES_REMOVED":I
    .end local v30    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v6    # "ALL_PACKAGES_REMOVED":I
    .restart local v7    # "PARTIAL_PACKAGES_REMOVED":I
    .restart local v8    # "NO_PACKAGES_REMOVED":I
    .restart local v10    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .local v14, "removePackagesFromVpnValidation":I
    .restart local v16    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v19    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    :cond_2b5
    move/from16 v24, v6

    move/from16 v25, v7

    move/from16 v28, v8

    move-object/from16 v30, v10

    move/from16 v26, v14

    move-object/from16 v8, v16

    move-object/from16 v14, v19

    .end local v6    # "ALL_PACKAGES_REMOVED":I
    .end local v7    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v10    # "tAddAllPackageName":Ljava/lang/String;
    .end local v16    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v19    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v8, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .local v14, "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .restart local v24    # "ALL_PACKAGES_REMOVED":I
    .restart local v25    # "PARTIAL_PACKAGES_REMOVED":I
    .restart local v26    # "removePackagesFromVpnValidation":I
    .restart local v28    # "NO_PACKAGES_REMOVED":I
    .restart local v30    # "tAddAllPackageName":Ljava/lang/String;
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v5

    invoke-direct {v1, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v6

    invoke-virtual {v0, v8, v5, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeMiscRules(Ljava/util/List;Ljava/lang/String;I)V

    .line 2285
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v0, v5, v6, v14}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;Ljava/util/List;)V

    .line 2288
    invoke-direct {v1, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->refreshDomainInHashMap(Ljava/lang/String;)V

    .line 2290
    const/4 v5, 0x0

    invoke-direct {v1, v4, v9, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateNotification(Ljava/lang/String;IZ)V

    .line 2292
    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageCount()I

    move-result v0

    move v5, v0

    .line 2293
    .local v5, "size":I
    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVpnConnectionType()I

    move-result v0

    move v6, v0

    .line 2295
    .local v6, "vpnConnectionType":I
    const/4 v0, 0x0

    .line 2296
    .local v0, "onDemand":Z
    const/4 v7, 0x1

    if-ne v6, v7, :cond_2fd

    .line 2297
    iget-object v7, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mProcessManager:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;

    invoke-virtual {v7, v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;->processRunCheck(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;)Z

    move-result v7

    .line 2298
    .local v7, "isRunning":Z
    if-nez v7, :cond_2fd

    .line 2299
    const/4 v0, 0x1

    move v7, v0

    goto :goto_2fe

    .line 2303
    .end local v7    # "isRunning":Z
    :cond_2fd
    move v7, v0

    .end local v0    # "onDemand":Z
    .local v7, "onDemand":Z
    :goto_2fe
    if-lez v5, :cond_302

    if-eqz v7, :cond_3db

    :cond_302
    invoke-virtual {v13}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v0
    :try_end_306
    .catch Ljava/lang/Exception; {:try_start_149 .. :try_end_306} :catch_49e
    .catchall {:try_start_149 .. :try_end_306} :catchall_4f0

    const/4 v10, 0x1

    if-ne v0, v10, :cond_3d9

    .line 2305
    :try_start_309
    invoke-virtual {v1, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v0

    .line 2306
    .local v0, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-eqz v0, :cond_38c

    .line 2307
    invoke-interface {v0, v4}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->stopConnection(Ljava/lang/String;)I

    move-result v10
    :try_end_313
    .catch Ljava/lang/Exception; {:try_start_309 .. :try_end_313} :catch_391
    .catchall {:try_start_309 .. :try_end_313} :catchall_4f0

    .line 2308
    .local v10, "stopStatus":I
    if-eqz v10, :cond_345

    .line 2309
    const/16 v31, 0x3

    const/16 v32, 0x5

    const/16 v33, 0x0

    .line 2310
    :try_start_31b
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v34

    const-string v35, "KnoxVpnEngineService"

    new-instance v15, Ljava/lang/StringBuilder;

    invoke-direct {v15}, Ljava/lang/StringBuilder;-><init>()V

    move-object/from16 v16, v0

    .end local v0    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .local v16, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    const-string v0, "Error stopping connection for vpn profile "

    invoke-virtual {v15, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v15, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v0, ". Vendor service might not be running"

    invoke-virtual {v15, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v15}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v36

    iget v0, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2309
    move/from16 v37, v0

    invoke-static/range {v31 .. v37}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_340
    .catch Ljava/lang/Exception; {:try_start_31b .. :try_end_340} :catch_341
    .catchall {:try_start_31b .. :try_end_340} :catchall_4f0

    goto :goto_370

    .line 2322
    .end local v10    # "stopStatus":I
    .end local v16    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :catch_341
    move-exception v0

    move/from16 v19, v5

    goto :goto_394

    .line 2314
    .restart local v0    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .restart local v10    # "stopStatus":I
    :cond_345
    move-object/from16 v16, v0

    .end local v0    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .restart local v16    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    const/16 v37, 0x5

    const/16 v38, 0x5

    const/16 v39, 0x1

    .line 2315
    :try_start_34d
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v40

    const-string v41, "KnoxVpnEngineService"

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v15, "Connection with vpn vendor service stopped for profile "

    invoke-virtual {v0, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v15, " after removing all the packages"

    invoke-virtual {v0, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v42

    iget v0, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2314
    move/from16 v43, v0

    invoke-static/range {v37 .. v43}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 2319
    :goto_370
    const-string v0, "KnoxVpnEngineService"

    new-instance v15, Ljava/lang/StringBuilder;

    invoke-direct {v15}, Ljava/lang/StringBuilder;-><init>()V
    :try_end_377
    .catch Ljava/lang/Exception; {:try_start_34d .. :try_end_377} :catch_391
    .catchall {:try_start_34d .. :try_end_377} :catchall_4f0

    move/from16 v19, v5

    .end local v5    # "size":I
    .local v19, "size":I
    :try_start_379
    const-string/jumbo v5, "stopping the vpn connection status for on-demand configuration after removing all the packages "

    invoke-virtual {v15, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v15, v10}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v15}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_389
    .catch Ljava/lang/Exception; {:try_start_379 .. :try_end_389} :catch_38a
    .catchall {:try_start_379 .. :try_end_389} :catchall_4f0

    goto :goto_390

    .line 2322
    .end local v10    # "stopStatus":I
    .end local v16    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    :catch_38a
    move-exception v0

    goto :goto_394

    .line 2306
    .end local v19    # "size":I
    .restart local v0    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .restart local v5    # "size":I
    :cond_38c
    move-object/from16 v16, v0

    move/from16 v19, v5

    .line 2328
    .end local v0    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v5    # "size":I
    .restart local v19    # "size":I
    :goto_390
    goto :goto_3db

    .line 2322
    .end local v19    # "size":I
    .restart local v5    # "size":I
    :catch_391
    move-exception v0

    move/from16 v19, v5

    .line 2323
    .end local v5    # "size":I
    .local v0, "e":Ljava/lang/Exception;
    .restart local v19    # "size":I
    :goto_394
    const/16 v31, 0x3

    const/16 v32, 0x5

    const/16 v33, 0x0

    .line 2324
    :try_start_39a
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v34

    const-string v35, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v10, "Exception stopping connection for profile "

    invoke-virtual {v5, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v10, " after removing packages from vpn"

    invoke-virtual {v5, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v36

    iget v5, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2323
    move/from16 v37, v5

    invoke-static/range {v31 .. v37}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 2327
    const-string v5, "KnoxVpnEngineService"

    new-instance v10, Ljava/lang/StringBuilder;

    invoke-direct {v10}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v15, "stopping the vpn connection failed for on-demand configuration after removing all the packages "

    invoke-virtual {v10, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v15

    invoke-virtual {v10, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v10}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v10

    invoke-static {v5, v10}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_3d8
    .catch Ljava/lang/Exception; {:try_start_39a .. :try_end_3d8} :catch_49e
    .catchall {:try_start_39a .. :try_end_3d8} :catchall_4f0

    goto :goto_3db

    .line 2303
    .end local v0    # "e":Ljava/lang/Exception;
    .end local v19    # "size":I
    .restart local v5    # "size":I
    :cond_3d9
    move/from16 v19, v5

    .line 2338
    .end local v5    # "size":I
    .end local v6    # "vpnConnectionType":I
    .end local v7    # "onDemand":Z
    .end local v8    # "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v13    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v14    # "filteredUidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    .end local v26    # "removePackagesFromVpnValidation":I
    :cond_3db
    :goto_3db
    nop

    .line 2340
    :try_start_3dc
    const-string v0, "KnoxVpnEngineService"

    const-string/jumbo v5, "removing packages from vpn is a success: The error code is 0"

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2341
    const/4 v5, 0x0

    invoke-static {v5}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v12, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2342
    invoke-virtual {v12, v5, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_3ef
    .catchall {:try_start_3dc .. :try_end_3ef} :catchall_4f0

    .line 2345
    :try_start_3ef
    invoke-virtual {v12}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Ljava/lang/Integer;

    invoke-virtual {v0}, Ljava/lang/Integer;->intValue()I

    move-result v0

    if-nez v0, :cond_444

    .line 2346
    new-instance v0, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v5, "KNOX_VPN"

    const-string v6, "API:removePackagesFromVpn"

    const/4 v7, 0x1

    invoke-direct {v0, v5, v7, v6}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 2347
    const/4 v5, -0x1

    invoke-direct {v1, v0, v2, v4, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 2348
    invoke-static/range {p2 .. p2}, Ljava/util/Arrays;->sort([Ljava/lang/Object;)V

    .line 2349
    new-instance v0, Ljava/lang/StringBuffer;

    const/4 v5, 0x0

    aget-object v6, v3, v5

    invoke-direct {v0, v6}, Ljava/lang/StringBuffer;-><init>(Ljava/lang/String;)V

    .line 2350
    .local v0, "pkgList":Ljava/lang/StringBuffer;
    const/4 v5, 0x1

    .local v5, "i":I
    :goto_417
    array-length v6, v3

    if-ge v5, v6, :cond_433

    .line 2351
    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, ","

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    aget-object v7, v3, v5

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v0, v6}, Ljava/lang/StringBuffer;->append(Ljava/lang/String;)Ljava/lang/StringBuffer;

    .line 2350
    add-int/lit8 v5, v5, 0x1

    goto :goto_417

    .line 2353
    .end local v5    # "i":I
    :cond_433
    iget-object v5, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string/jumbo v6, "pkgLst"

    invoke-virtual {v0}, Ljava/lang/StringBuffer;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v5, v6, v7}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;Ljava/lang/String;)V

    .line 2354
    iget-object v5, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v5}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_444
    .catch Ljava/lang/Exception; {:try_start_3ef .. :try_end_444} :catch_445
    .catchall {:try_start_3ef .. :try_end_444} :catchall_4f0

    .line 2358
    .end local v0    # "pkgList":Ljava/lang/StringBuffer;
    :cond_444
    goto :goto_460

    .line 2356
    :catch_445
    move-exception v0

    .line 2357
    .local v0, "e":Ljava/lang/Exception;
    :try_start_446
    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "Exception = "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 2360
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_460
    invoke-virtual {v11}, Ljava/lang/StringBuilder;->length()I

    move-result v0

    if-lez v0, :cond_49c

    .line 2361
    const/16 v31, 0x5

    const/16 v32, 0x5

    const/16 v33, 0x1

    .line 2362
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v34

    const-string v35, "KnoxVpnEngineService"

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    .line 2363
    invoke-virtual {v11}, Ljava/lang/StringBuilder;->length()I

    move-result v5

    const/4 v6, 0x2

    sub-int/2addr v5, v6

    const/4 v6, 0x0

    invoke-virtual {v11, v6, v5}, Ljava/lang/StringBuilder;->subSequence(II)Ljava/lang/CharSequence;

    move-result-object v5

    invoke-interface {v5}, Ljava/lang/CharSequence;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v5, " removed from vpn for profile "

    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v36

    iget v0, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2361
    move/from16 v37, v0

    invoke-static/range {v31 .. v37}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_49c
    .catchall {:try_start_446 .. :try_end_49c} :catchall_4f0

    .line 2367
    :cond_49c
    monitor-exit p0

    return-object v12

    .line 2330
    :catch_49e
    move-exception v0

    goto :goto_4ab

    .end local v20    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v24    # "ALL_PACKAGES_REMOVED":I
    .end local v25    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v28    # "NO_PACKAGES_REMOVED":I
    .end local v30    # "tAddAllPackageName":Ljava/lang/String;
    .local v5, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .local v6, "ALL_PACKAGES_REMOVED":I
    .local v7, "PARTIAL_PACKAGES_REMOVED":I
    .local v8, "NO_PACKAGES_REMOVED":I
    .local v10, "tAddAllPackageName":Ljava/lang/String;
    :catch_4a0
    move-exception v0

    move-object/from16 v20, v5

    move/from16 v24, v6

    move/from16 v25, v7

    move/from16 v28, v8

    move-object/from16 v30, v10

    .line 2331
    .end local v5    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v6    # "ALL_PACKAGES_REMOVED":I
    .end local v7    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v8    # "NO_PACKAGES_REMOVED":I
    .end local v10    # "tAddAllPackageName":Ljava/lang/String;
    .restart local v0    # "e":Ljava/lang/Exception;
    .restart local v20    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .restart local v24    # "ALL_PACKAGES_REMOVED":I
    .restart local v25    # "PARTIAL_PACKAGES_REMOVED":I
    .restart local v28    # "NO_PACKAGES_REMOVED":I
    .restart local v30    # "tAddAllPackageName":Ljava/lang/String;
    :goto_4ab
    :try_start_4ab
    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, "Error occured while removing packages from vpn: exception occured: The error code is -1"

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 2332
    const/4 v5, -0x1

    invoke-static {v5}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v5

    invoke-virtual {v12, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 2333
    const/4 v13, 0x3

    const/4 v14, 0x5

    const/4 v15, 0x0

    .line 2334
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v16

    const-string v17, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception while removing packages from vpn for profile "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v18

    iget v5, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 2333
    move/from16 v19, v5

    invoke-static/range {v13 .. v19}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_4ee
    .catchall {:try_start_4ab .. :try_end_4ee} :catchall_4f0

    .line 2337
    monitor-exit p0

    return-object v12

    .line 2148
    .end local v0    # "e":Ljava/lang/Exception;
    .end local v9    # "cid":I
    .end local v11    # "successPackages":Ljava/lang/StringBuilder;
    .end local v12    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local v20    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v24    # "ALL_PACKAGES_REMOVED":I
    .end local v25    # "PARTIAL_PACKAGES_REMOVED":I
    .end local v28    # "NO_PACKAGES_REMOVED":I
    .end local v30    # "tAddAllPackageName":Ljava/lang/String;
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "packageList":[Ljava/lang/String;
    .end local p3    # "profileName":Ljava/lang/String;
    :catchall_4f0
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method protected declared-synchronized removeRulesAfterVpnDisconnected(Landroid/os/Bundle;)V
    .registers 5
    .param p1, "map"    # Landroid/os/Bundle;

    monitor-enter p0

    .line 6386
    :try_start_1
    const-string v0, "bundle_profile_name"

    invoke-virtual {p1, v0}, Landroid/os/Bundle;->getString(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v0

    .line 6387
    .local v0, "profileName":Ljava/lang/String;
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v1
    :try_end_d
    .catchall {:try_start_1 .. :try_end_d} :catchall_1e

    .line 6388
    .local v1, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v1, :cond_11

    .line 6389
    monitor-exit p0

    return-void

    .line 6391
    :cond_11
    :try_start_11
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v2
    :try_end_15
    .catchall {:try_start_11 .. :try_end_15} :catchall_1e

    if-nez v2, :cond_19

    .line 6392
    monitor-exit p0

    return-void

    .line 6394
    :cond_19
    :try_start_19
    invoke-direct {p0, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->handleChainingScenarioForStopConnection(Ljava/lang/String;)V
    :try_end_1c
    .catchall {:try_start_19 .. :try_end_1c} :catchall_1e

    .line 6396
    monitor-exit p0

    return-void

    .line 6385
    .end local v0    # "profileName":Ljava/lang/String;
    .end local v1    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    .end local p1    # "map":Landroid/os/Bundle;
    :catchall_1e
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method public declared-synchronized removeVpnProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 35
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    move-object/from16 v1, p0

    move-object/from16 v2, p1

    move-object/from16 v3, p2

    monitor-enter p0

    .line 1011
    :try_start_7
    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    move-object v4, v0

    .line 1013
    .local v4, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const-string v0, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knox vpn profile is going to be removed : profileName value is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1015
    const/4 v5, -0x1

    .line 1017
    .local v5, "profileId":I
    new-instance v0, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    move-object v6, v0

    .line 1018
    .local v6, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v0, -0x1

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-virtual {v6, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1019
    const/4 v7, 0x1

    invoke-virtual {v6, v7, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1021
    iget v0, v4, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {v1, v2, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v0

    if-nez v0, :cond_49

    .line 1022
    const/16 v0, 0x8c

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v6, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_47
    .catchall {:try_start_7 .. :try_end_47} :catchall_2d1

    .line 1023
    monitor-exit p0

    return-object v6

    .line 1026
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_49
    :try_start_49
    const-string v0, "com.android.settings"

    iget-object v8, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->vendorName:Ljava/lang/String;

    invoke-virtual {v0, v8}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v0

    const/4 v8, 0x0

    if-eqz v0, :cond_77

    .line 1027
    invoke-direct/range {p0 .. p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVpnInfoPolicy()Lcom/samsung/android/knox/net/vpn/IVpnInfoPolicy;

    move-result-object v0
    :try_end_58
    .catchall {:try_start_49 .. :try_end_58} :catchall_2d1

    if-eqz v0, :cond_77

    .line 1029
    :try_start_5a
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mVpnInfoPolicy:Lcom/samsung/android/knox/net/vpn/IVpnInfoPolicy;

    invoke-interface {v0, v4, v3}, Lcom/samsung/android/knox/net/vpn/IVpnInfoPolicy;->deleteProfile(Lcom/samsung/android/knox/ContextInfo;Ljava/lang/String;)Z

    move-result v0

    if-eqz v0, :cond_6c

    .line 1030
    invoke-static {v8}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v6, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1031
    invoke-virtual {v6, v8, v8}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_6c
    .catch Landroid/os/RemoteException; {:try_start_5a .. :try_end_6c} :catch_6d
    .catchall {:try_start_5a .. :try_end_6c} :catchall_2d1

    .line 1035
    :cond_6c
    goto :goto_75

    .line 1033
    :catch_6d
    move-exception v0

    .line 1034
    .local v0, "e":Landroid/os/RemoteException;
    :try_start_6e
    const-string v7, "KnoxVpnEngineService"

    const-string v8, "Exception occured while removing vpn settings profile"

    invoke-static {v7, v8}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_75
    .catchall {:try_start_6e .. :try_end_75} :catchall_2d1

    .line 1036
    .end local v0    # "e":Landroid/os/RemoteException;
    :goto_75
    monitor-exit p0

    return-object v6

    .line 1042
    :cond_77
    :try_start_77
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v0, v2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->removeVpnProfileValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)I

    move-result v0

    .line 1043
    .local v0, "removeVpnProfileValidation":I
    const/16 v9, 0x64

    if-eq v0, v9, :cond_c4

    .line 1044
    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-virtual {v6, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1045
    const-string v7, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v9, "Error occured while removing the vpn profile: The error code is "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v7, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1046
    const/4 v9, 0x3

    const/4 v10, 0x5

    const/4 v11, 0x0

    .line 1047
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v12

    const-string v13, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string v8, "Error validating information from profile "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v8, " before removing"

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v14

    iget v15, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1046
    invoke-static/range {v9 .. v15}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_c2
    .catch Ljava/lang/Exception; {:try_start_77 .. :try_end_c2} :catch_295
    .catchall {:try_start_77 .. :try_end_c2} :catchall_2d1

    .line 1050
    monitor-exit p0

    return-object v6

    .line 1053
    :cond_c4
    :try_start_c4
    invoke-virtual {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v9

    .line 1054
    .local v9, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v9, :cond_dc

    .line 1055
    const/16 v7, 0x6e

    invoke-static {v7}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-virtual {v6, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1056
    const-string v7, "KnoxVpnEngineService"

    const-string v8, "Error occured while removing the vpn profile: The error code is 110"

    invoke-static {v7, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_da
    .catch Ljava/lang/Exception; {:try_start_c4 .. :try_end_da} :catch_295
    .catchall {:try_start_c4 .. :try_end_da} :catchall_2d1

    .line 1057
    monitor-exit p0

    return-object v6

    .line 1060
    :cond_dc
    :try_start_dc
    iget-object v10, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v10, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v10

    .line 1061
    .local v10, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v11

    .line 1062
    .local v11, "activateState":I
    move v12, v11

    .line 1063
    .local v12, "isProfileActivated":I
    if-ne v12, v7, :cond_1c9

    .line 1064
    invoke-interface {v9, v3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getState(Ljava/lang/String;)I

    move-result v13

    .line 1065
    .local v13, "currentStateOfProfile":I
    const-string v14, "KnoxVpnEngineService"

    new-instance v15, Ljava/lang/StringBuilder;

    invoke-direct {v15}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v8, "knox vpn profile is going to be removed: currentStateOfProfile value is "

    invoke-virtual {v15, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v15, v13}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v15}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v14, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1066
    const/4 v8, 0x5

    if-ne v13, v7, :cond_109

    if-eq v13, v8, :cond_16f

    .line 1067
    :cond_109
    invoke-interface {v9, v3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->stopConnection(Ljava/lang/String;)I

    move-result v14

    .line 1068
    .local v14, "stopConnectionStatus":I
    if-eqz v14, :cond_134

    .line 1069
    const/16 v17, 0x3

    const/16 v18, 0x5

    const/16 v19, 0x0

    .line 1070
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v20

    const-string v21, "KnoxVpnEngineService"

    new-instance v15, Ljava/lang/StringBuilder;

    invoke-direct {v15}, Ljava/lang/StringBuilder;-><init>()V

    const-string v8, "Error occurred trying to stop vpn connection from profile "

    invoke-virtual {v15, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v15, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v15}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v22

    iget v8, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1069
    move/from16 v23, v8

    invoke-static/range {v17 .. v23}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    goto :goto_158

    .line 1074
    :cond_134
    const/16 v25, 0x5

    const/16 v26, 0x5

    const/16 v27, 0x1

    .line 1075
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v28

    const-string v29, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v15, "Connection with vpn vendor service stopped for profile "

    invoke-virtual {v8, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v30

    iget v8, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1074
    move/from16 v31, v8

    invoke-static/range {v25 .. v31}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 1079
    :goto_158
    const-string v8, "KnoxVpnEngineService"

    new-instance v15, Ljava/lang/StringBuilder;

    invoke-direct {v15}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "knox vpn profile is going to be removed: stopConnectionStatus value is "

    invoke-virtual {v15, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v15, v13}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v15}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-static {v8, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1083
    .end local v14    # "stopConnectionStatus":I
    :cond_16f
    invoke-interface {v9, v3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->getState(Ljava/lang/String;)I

    move-result v7

    .line 1084
    .end local v13    # "currentStateOfProfile":I
    .local v7, "currentStateOfProfile":I
    const-string v8, "KnoxVpnEngineService"

    new-instance v13, Ljava/lang/StringBuilder;

    invoke-direct {v13}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v14, "knox vpn profile is going to be removed: currentStateOfProfile after stopping the connection is "

    invoke-virtual {v13, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13, v7}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v13}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v13

    invoke-static {v8, v13}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1085
    const/4 v8, 0x1

    if-eq v7, v8, :cond_1c9

    const/4 v8, 0x5

    if-eq v7, v8, :cond_1c9

    .line 1086
    const/16 v8, 0x132

    invoke-static {v8}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v8

    invoke-virtual {v6, v8}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1087
    const-string v8, "KnoxVpnEngineService"

    const-string v13, "Error occured while removing the vpn profile: The error code is 306"

    invoke-static {v8, v13}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1088
    const/4 v14, 0x3

    const/4 v15, 0x5

    const/16 v16, 0x0

    .line 1089
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v17

    const-string v18, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v13, "Error occurred while removing vpn profile "

    invoke-virtual {v8, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v13, ". Stop vpn connection before removing profile"

    invoke-virtual {v8, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v19

    iget v8, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1088
    move/from16 v20, v8

    invoke-static/range {v14 .. v20}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_1c7
    .catch Ljava/lang/Exception; {:try_start_dc .. :try_end_1c7} :catch_295
    .catchall {:try_start_dc .. :try_end_1c7} :catchall_2d1

    .line 1092
    monitor-exit p0

    return-object v6

    .line 1096
    .end local v7    # "currentStateOfProfile":I
    :cond_1c9
    :try_start_1c9
    invoke-virtual {v10}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProfileId()I

    move-result v7

    move v5, v7

    .line 1098
    invoke-interface {v9, v3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->removeConnection(Ljava/lang/String;)I

    move-result v7

    .line 1099
    .local v7, "removeStatus":I
    if-nez v7, :cond_261

    .line 1100
    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeProfileFromHashMapAndDB(Ljava/lang/String;)V

    .line 1111
    const-string v8, "KnoxVpnEngineService"

    new-instance v13, Ljava/lang/StringBuilder;

    invoke-direct {v13}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v14, "knox vpn profile removal is a success: The error code is "

    invoke-virtual {v13, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13, v7}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v13}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v13

    invoke-static {v8, v13}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1113
    const/16 v18, 0x5

    const/16 v19, 0x5

    const/16 v20, 0x1

    .line 1114
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v21

    const-string v22, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v13, "Vpn profile "

    invoke-virtual {v8, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v13, " successfully removed"

    invoke-virtual {v8, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v23

    iget v8, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1113
    move/from16 v24, v8

    invoke-static/range {v18 .. v24}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 1118
    invoke-static {v7}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v8

    invoke-virtual {v6, v8}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1119
    const/4 v8, 0x0

    invoke-virtual {v6, v8, v8}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_222
    .catch Ljava/lang/Exception; {:try_start_1c9 .. :try_end_222} :catch_295
    .catchall {:try_start_1c9 .. :try_end_222} :catchall_2d1

    .line 1127
    .end local v0    # "removeVpnProfileValidation":I
    .end local v7    # "removeStatus":I
    .end local v9    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v10    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v11    # "activateState":I
    .end local v12    # "isProfileActivated":I
    nop

    .line 1129
    :try_start_223
    invoke-virtual {v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Ljava/lang/Integer;

    invoke-virtual {v0}, Ljava/lang/Integer;->intValue()I

    move-result v0

    if-nez v0, :cond_243

    .line 1130
    new-instance v0, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v7, "KNOX_VPN"

    const-string v8, "API:removeVpnProfile"

    const/4 v9, 0x1

    invoke-direct {v0, v7, v9, v8}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 1131
    invoke-direct {v1, v0, v2, v3, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 1132
    iget-object v0, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v0}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_243
    .catch Ljava/lang/Exception; {:try_start_223 .. :try_end_243} :catch_244
    .catchall {:try_start_223 .. :try_end_243} :catchall_2d1

    .line 1136
    :cond_243
    goto :goto_25f

    .line 1134
    :catch_244
    move-exception v0

    .line 1135
    .local v0, "e":Ljava/lang/Exception;
    :try_start_245
    const-string v7, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v9, "Exception = "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v7, v8}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_25f
    .catchall {:try_start_245 .. :try_end_25f} :catchall_2d1

    .line 1137
    .end local v0    # "e":Ljava/lang/Exception;
    :goto_25f
    monitor-exit p0

    return-object v6

    .line 1102
    .local v0, "removeVpnProfileValidation":I
    .restart local v7    # "removeStatus":I
    .restart local v9    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .restart local v10    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .restart local v11    # "activateState":I
    .restart local v12    # "isProfileActivated":I
    :cond_261
    const/16 v8, 0x66

    :try_start_263
    invoke-static {v8}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v8

    invoke-virtual {v6, v8}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1103
    const-string v8, "KnoxVpnEngineService"

    const-string v13, "Error occured while removing the vpn profile: The error code is 102"

    invoke-static {v8, v13}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1104
    const/4 v14, 0x3

    const/4 v15, 0x5

    const/16 v16, 0x0

    .line 1105
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v17

    const-string v18, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v13, "Error received from vendor while removing vpn connection for profile "

    invoke-virtual {v8, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v19

    iget v8, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1104
    move/from16 v20, v8

    invoke-static/range {v14 .. v20}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_293
    .catch Ljava/lang/Exception; {:try_start_263 .. :try_end_293} :catch_295
    .catchall {:try_start_263 .. :try_end_293} :catchall_2d1

    .line 1108
    monitor-exit p0

    return-object v6

    .line 1120
    .end local v0    # "removeVpnProfileValidation":I
    .end local v7    # "removeStatus":I
    .end local v9    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v10    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v11    # "activateState":I
    .end local v12    # "isProfileActivated":I
    :catch_295
    move-exception v0

    .line 1121
    .local v0, "e":Ljava/lang/Exception;
    :try_start_296
    const-string v7, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v9, "Error occured while removing the vpn profile: exception occured: The error code is -1"

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v7, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1122
    const/4 v9, 0x3

    const/4 v10, 0x5

    const/4 v11, 0x0

    .line 1123
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v12

    const-string v13, "KnoxVpnEngineService"

    new-instance v7, Ljava/lang/StringBuilder;

    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V

    const-string v8, "Exception occurred while removing vpn profile "

    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v14

    iget v15, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1122
    invoke-static/range {v9 .. v15}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_2cf
    .catchall {:try_start_296 .. :try_end_2cf} :catchall_2d1

    .line 1126
    monitor-exit p0

    return-object v6

    .line 1010
    .end local v0    # "e":Ljava/lang/Exception;
    .end local v4    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v5    # "profileId":I
    .end local v6    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    :catchall_2d1
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method public declared-synchronized removeVpnUidRanges(Landroid/net/NetworkInfo;)V
    .registers 16
    .param p1, "ni"    # Landroid/net/NetworkInfo;

    monitor-enter p0

    .line 6265
    :try_start_1
    sget-boolean v0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v0, :cond_d

    const-string v0, "KnoxVpnEngineService"

    const-string/jumbo v1, "updating firewall rules after vpn is down"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_d
    .catchall {:try_start_1 .. :try_end_d} :catchall_1b5

    .line 6266
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_d
    if-nez p1, :cond_11

    .line 6267
    monitor-exit p0

    return-void

    .line 6268
    .restart local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_11
    :try_start_11
    invoke-static {}, Landroid/os/Binder;->getCallingUid()I

    move-result v0
    :try_end_15
    .catchall {:try_start_11 .. :try_end_15} :catchall_1b5

    const/16 v1, 0x3e8

    if-eq v0, v1, :cond_1b

    .line 6269
    monitor-exit p0

    return-void

    .line 6271
    :cond_1b
    :try_start_1b
    invoke-virtual {p1}, Landroid/net/NetworkInfo;->getprofileName()Ljava/lang/String;

    move-result-object v0

    .line 6272
    .local v0, "profileName":Ljava/lang/String;
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v1, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v1
    :try_end_25
    .catchall {:try_start_1b .. :try_end_25} :catchall_1b5

    .line 6273
    .local v1, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v1, :cond_29

    .line 6274
    monitor-exit p0

    return-void

    .line 6276
    :cond_29
    :try_start_29
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v2
    :try_end_2d
    .catchall {:try_start_29 .. :try_end_2d} :catchall_1b5

    if-nez v2, :cond_31

    .line 6277
    monitor-exit p0

    return-void

    .line 6280
    :cond_31
    :try_start_31
    invoke-static {}, Ljava/lang/System;->currentTimeMillis()J

    move-result-wide v2

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVpnStartTime()J

    move-result-wide v4

    sub-long/2addr v2, v4

    .line 6281
    .local v2, "vpnConnectedTime":J
    new-instance v4, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v5, "KNOX_VPN"

    const-string v6, "API:removeVpnUidRanges"

    const/4 v7, 0x1

    invoke-direct {v4, v5, v7, v6}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 6282
    const-string/jumbo v5, "vpnCt"

    invoke-virtual {v4, v5, v2, v3}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;J)V

    .line 6283
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string/jumbo v5, "vndrPkgN"

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVendorPkgName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v4, v5, v6}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;Ljava/lang/String;)V

    .line 6284
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v4}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V

    .line 6286
    const-string v4, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "removeVpnUidRanges:defaultInterface value to which the virual tunnel was added is "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, " for the profile "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6289
    const-string v4, "Strawberry"

    const-string v5, "Combination"

    invoke-virtual {v4, v5}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result v4

    if-eqz v4, :cond_b3

    const-string v4, "33"

    .line 6290
    invoke-static {v4}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I

    move-result v4

    const/16 v5, 0x1c

    if-lt v4, v5, :cond_b3

    .line 6292
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVpnType()I

    move-result v4

    if-ne v4, v7, :cond_b3

    .line 6293
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultNetworkId()I

    move-result v4

    .line 6294
    .local v4, "defaultNetworkId":I
    const-string v5, "KnoxVpnEngineService"

    const-string/jumbo v6, "removeRulesForStrongswanP $$$ BEYOND EXYNOS CASE $$$"

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6295
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v6

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v8

    invoke-virtual {v5, v6, v4, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesForStrongswanP(IILjava/lang/String;)V

    .line 6301
    .end local v4    # "defaultNetworkId":I
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_b3
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v5

    invoke-direct {p0, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v6

    invoke-virtual {v4, v5, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeNatRules(Ljava/lang/String;I)V

    .line 6303
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v5

    invoke-direct {p0, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v6

    invoke-virtual {v4, v5, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeIpRouteAndPolicyRules(Ljava/lang/String;I)V

    .line 6305
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v6

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v8

    invoke-virtual {v4, v5, v6, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesForNoUidPackets(Ljava/lang/String;ILjava/lang/String;)V

    .line 6307
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v5

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v4, v5, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesToAcceptIncomingPackets(ILjava/lang/String;)V

    .line 6314
    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    const/4 v9, 0x1

    .line 6315
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v10

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceAddress()Ljava/lang/String;

    move-result-object v11

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getDefaultInterface()Ljava/lang/String;

    move-result-object v12

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getV6InterfaceAddress()Ljava/lang/String;

    move-result-object v13

    .line 6314
    invoke-virtual/range {v8 .. v13}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->updateDropRulesForNoUidPackets(ILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V

    .line 6317
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyServer()Ljava/lang/String;

    move-result-object v4

    sget-object v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->DEFAULT_PROXY_SERVER:Ljava/lang/String;

    if-ne v4, v5, :cond_111

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPacurl()Landroid/net/Uri;

    move-result-object v4

    sget-object v5, Landroid/net/Uri;->EMPTY:Landroid/net/Uri;

    if-eq v4, v5, :cond_150

    .line 6319
    :cond_111
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPersonaId()I

    move-result v4

    const/16 v5, 0x3ea

    invoke-static {v4, v5}, Landroid/os/UserHandle;->getUid(II)I

    move-result v4

    .line 6320
    .local v4, "uid":I
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v6

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v8

    invoke-virtual {v5, v6, v8, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesToAcceptProxyPackets(ILjava/lang/String;I)V

    .line 6322
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v5

    if-eqz v5, :cond_143

    .line 6323
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getProxyInfo()Landroid/net/ProxyInfo;

    move-result-object v8

    invoke-virtual {v8}, Landroid/net/ProxyInfo;->getPort()I

    move-result v8

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v9

    invoke-virtual {v5, v6, v8, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesToAllowAccessToLocalHostWithValidMark(Ljava/lang/String;II)V

    .line 6326
    :cond_143
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v5

    if-ne v5, v7, :cond_150

    .line 6327
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnPacProcessor()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;

    move-result-object v5

    invoke-virtual {v5, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnPacProcessor;->resetInterfaceName(Ljava/lang/String;)V

    .line 6331
    .end local v4    # "uid":I
    :cond_150
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getUsbTethering()I

    move-result v4

    if-ne v4, v7, :cond_17e

    .line 6332
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v4

    if-ne v4, v7, :cond_171

    .line 6333
    const-string v4, "KnoxVpnEngineService"

    const-string v5, "Applying rules to drop tether packets since vpn is down, but still in activated state"

    invoke-static {v4, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 6334
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getInterfaceNameForUsbtethering()Ljava/lang/String;

    move-result-object v4

    .line 6335
    .local v4, "usbTetheringIface":Ljava/lang/String;
    if-eqz v4, :cond_170

    .line 6336
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v5, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addRulesForDroppingTetherPackets(Ljava/lang/String;)V

    .line 6337
    .end local v4    # "usbTetheringIface":Ljava/lang/String;
    :cond_170
    goto :goto_17e

    .line 6338
    :cond_171
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceType()I

    move-result v5

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v4, v5, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeRulesForUsbTethering(ILjava/lang/String;)V

    .line 6342
    :cond_17e
    :goto_17e
    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v4

    .line 6343
    .local v4, "activateState":I
    if-eqz v4, :cond_197

    if-eq v4, v7, :cond_187

    goto :goto_1a4

    .line 6349
    :cond_187
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    sget-object v6, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnConstants;->BLOCK_APP_TRAFFIC:Ljava/lang/String;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v7

    const/4 v8, 0x3

    invoke-virtual {v5, v6, v7, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMarkingRulesForFilteredPackages(Ljava/lang/String;Ljava/lang/String;I)V

    .line 6350
    invoke-virtual {p0, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateBlockingRules(Ljava/lang/String;)V

    .line 6351
    goto :goto_1a4

    .line 6345
    :cond_197
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getIpChainName()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->flushMarkingRulesForFilteredPackages(Ljava/lang/String;)V

    .line 6346
    invoke-direct {p0, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->removeMiscRulesForProfile(Ljava/lang/String;)V

    .line 6347
    nop

    .line 6356
    :goto_1a4
    invoke-direct {p0, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->resetInterfaceParameter(Ljava/lang/String;)V

    .line 6357
    sget-boolean v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v5, :cond_1b3

    const-string v5, "KnoxVpnEngineService"

    const-string/jumbo v6, "updating firewall rules after vpn down is finished"

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_1b3
    .catchall {:try_start_31 .. :try_end_1b3} :catchall_1b5

    .line 6358
    :cond_1b3
    monitor-exit p0

    return-void

    .line 6264
    .end local v0    # "profileName":Ljava/lang/String;
    .end local v1    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v2    # "vpnConnectedTime":J
    .end local v4    # "activateState":I
    .end local p1    # "ni":Landroid/net/NetworkInfo;
    :catchall_1b5
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method public setAutoRetryOnConnectionError(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Z)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 15
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .param p3, "enable"    # Z

    .line 3559
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 3561
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const/4 v1, -0x1

    .line 3562
    .local v1, "adminId":I
    const/4 v2, 0x0

    .line 3563
    .local v2, "success":Z
    new-instance v3, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 3564
    .local v3, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Boolean;>;"
    const/4 v4, 0x0

    invoke-static {v4}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;

    move-result-object v5

    invoke-virtual {v3, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3565
    const/4 v5, 0x1

    const/4 v6, -0x1

    invoke-virtual {v3, v5, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 3567
    const-string v7, "KnoxVpnEngineService"

    if-nez p1, :cond_27

    .line 3568
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_26

    const-string/jumbo v4, "setAutoRetryOnConnectionError : vpnContext is null"

    invoke-static {v7, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 3569
    :cond_26
    return-object v3

    .line 3572
    :cond_27
    iget v8, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v8

    if-nez v8, :cond_30

    .line 3573
    return-object v3

    .line 3576
    :cond_30
    iget v1, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->adminId:I

    .line 3577
    if-eqz p2, :cond_89

    .line 3579
    :try_start_34
    invoke-direct {p0, p1, p2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->validateAdminAndVendorForProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;)I

    move-result v8

    if-eqz v8, :cond_3b

    .line 3580
    return-object v3

    .line 3582
    :cond_3b
    invoke-virtual {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v8

    .line 3583
    .local v8, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v8, :cond_48

    .line 3584
    const-string/jumbo v4, "setAutoRetryOnConnectionError : VPN Service not started"

    invoke-static {v7, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 3585
    return-object v3

    .line 3587
    :cond_48
    invoke-interface {v8, p2, p3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->setAutoRetryOnConnectionError(Ljava/lang/String;Z)Z

    move-result v9

    move v2, v9

    .line 3588
    new-instance v9, Ljava/lang/StringBuilder;

    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v10, "setAutoRetryOnConnectionError : success = "

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9, v2}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v9

    invoke-static {v7, v9}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3589
    invoke-static {v2}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;

    move-result-object v9

    invoke-virtual {v3, v9}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3590
    invoke-virtual {v3, v4, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_6c
    .catch Ljava/lang/Exception; {:try_start_34 .. :try_end_6c} :catch_6d

    .line 3594
    .end local v8    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    goto :goto_89

    .line 3591
    :catch_6d
    move-exception v4

    .line 3592
    .local v4, "e":Ljava/lang/Exception;
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "setAutoRetryOnConnectionError : Failure at "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v4}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v7, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 3593
    const/4 v5, 0x0

    return-object v5

    .line 3598
    .end local v4    # "e":Ljava/lang/Exception;
    :cond_89
    :goto_89
    :try_start_89
    invoke-virtual {v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Ljava/lang/Boolean;

    invoke-virtual {v4}, Ljava/lang/Boolean;->booleanValue()Z

    move-result v4

    if-ne v4, v5, :cond_af

    .line 3599
    new-instance v4, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v8, "KNOX_VPN"

    const-string v9, "API:setAutoRetryOnConnectionError"

    invoke-direct {v4, v8, v5, v9}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 3600
    invoke-direct {p0, v4, p1, p2, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 3601
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v5, "enb"

    invoke-virtual {v4, v5, p3}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;Z)V

    .line 3602
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v4}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_af
    .catch Ljava/lang/Exception; {:try_start_89 .. :try_end_af} :catch_b0

    .line 3606
    :cond_af
    goto :goto_c9

    .line 3604
    :catch_b0
    move-exception v4

    .line 3605
    .restart local v4    # "e":Ljava/lang/Exception;
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception = "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v4}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v7, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 3607
    .end local v4    # "e":Ljava/lang/Exception;
    :goto_c9
    return-object v3
.end method

.method public setCACertificate(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;[B)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 13
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .param p3, "pkcs12Blob"    # [B
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            "[B)",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Boolean;",
            ">;"
        }
    .end annotation

    .line 1573
    const-string v0, "KnoxVpnEngineService"

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v1

    .line 1575
    .local v1, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const/4 v2, 0x0

    .line 1576
    .local v2, "success":Z
    new-instance v3, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 1577
    .local v3, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Boolean;>;"
    const/4 v4, 0x0

    invoke-static {v4}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;

    move-result-object v5

    invoke-virtual {v3, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1578
    const/4 v5, 0x1

    const/4 v6, -0x1

    invoke-virtual {v3, v5, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1580
    iget v7, v1, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v7

    if-nez v7, :cond_22

    .line 1581
    return-object v3

    .line 1585
    :cond_22
    :try_start_22
    invoke-direct {p0, p1, p2, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->validateAdminAndVendorForProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;)I

    move-result v7

    if-eqz v7, :cond_29

    .line 1586
    return-object v3

    .line 1588
    :cond_29
    invoke-virtual {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v7

    .line 1589
    .local v7, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v7, :cond_36

    .line 1590
    const-string/jumbo v4, "setting CACertificate : Service is not started"

    invoke-static {v0, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 1591
    return-object v3

    .line 1593
    :cond_36
    invoke-interface {v7, p2, p3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->setCACertificate(Ljava/lang/String;[B)Z

    move-result v8

    move v2, v8

    .line 1594
    invoke-static {v2}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;

    move-result-object v8

    invoke-virtual {v3, v8}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1595
    invoke-virtual {v3, v4, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_45
    .catch Ljava/lang/Exception; {:try_start_22 .. :try_end_45} :catch_80

    .line 1599
    .end local v7    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    nop

    .line 1601
    :try_start_46
    invoke-virtual {v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Ljava/lang/Boolean;

    invoke-virtual {v4}, Ljava/lang/Boolean;->booleanValue()Z

    move-result v4

    if-ne v4, v5, :cond_65

    .line 1602
    new-instance v4, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v7, "KNOX_VPN"

    const-string v8, "API:setCACertificate"

    invoke-direct {v4, v7, v5, v8}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 1603
    invoke-direct {p0, v4, p1, p2, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 1604
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v4}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_65
    .catch Ljava/lang/Exception; {:try_start_46 .. :try_end_65} :catch_66

    .line 1608
    :cond_65
    goto :goto_7f

    .line 1606
    :catch_66
    move-exception v4

    .line 1607
    .local v4, "e":Ljava/lang/Exception;
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception = "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v4}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v0, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 1609
    .end local v4    # "e":Ljava/lang/Exception;
    :goto_7f
    return-object v3

    .line 1596
    :catch_80
    move-exception v4

    .line 1597
    .restart local v4    # "e":Ljava/lang/Exception;
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "setting CACertificate : Failure at "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v4}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v0, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 1598
    const/4 v0, 0x0

    return-object v0
.end method

.method public setDnsPropertyForNetwork(Landroid/net/NetworkInfo;)V
    .registers 12
    .param p1, "ni"    # Landroid/net/NetworkInfo;

    .line 7044
    const/4 v0, -0x1

    .local v0, "uid":I
    const/4 v1, -0x1

    .line 7045
    .local v1, "cid":I
    if-nez p1, :cond_5

    .line 7046
    return-void

    .line 7047
    :cond_5
    invoke-static {}, Landroid/os/Binder;->getCallingUid()I

    move-result v2

    const/16 v3, 0x3e8

    if-eq v2, v3, :cond_e

    .line 7048
    return-void

    .line 7050
    :cond_e
    invoke-virtual {p1}, Landroid/net/NetworkInfo;->getprofileName()Ljava/lang/String;

    move-result-object v2

    .line 7051
    .local v2, "profileName":Ljava/lang/String;
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v3

    .line 7052
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v3, :cond_1b

    .line 7053
    return-void

    .line 7055
    :cond_1b
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v4

    if-nez v4, :cond_22

    .line 7056
    return-void

    .line 7058
    :cond_22
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v4

    .line 7059
    .local v4, "activateState":I
    if-nez v4, :cond_29

    .line 7060
    return-void

    .line 7062
    :cond_29
    invoke-virtual {p1}, Landroid/net/NetworkInfo;->getKnoxInterfaceName()Ljava/lang/String;

    move-result-object v5

    .line 7063
    .local v5, "interfaceName":Ljava/lang/String;
    if-nez v5, :cond_30

    .line 7064
    return-void

    .line 7066
    :cond_30
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v6

    invoke-interface {v6}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v6

    :goto_38
    invoke-interface {v6}, Ljava/util/Iterator;->hasNext()Z

    move-result v7

    if-eqz v7, :cond_6e

    invoke-interface {v6}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v7

    check-cast v7, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 7067
    .local v7, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v8, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v8

    if-eqz v8, :cond_66

    .line 7068
    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v8, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v1

    .line 7069
    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v8, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->startUid(I)I

    move-result v8

    iget-object v9, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v9, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->stopUid(I)I

    move-result v9

    invoke-direct {p0, v2, v8, v9, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setDnsSystemProperty(Ljava/lang/String;IILjava/lang/String;)V

    goto :goto_6d

    .line 7071
    :cond_66
    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v0

    .line 7072
    invoke-direct {p0, v2, v0, v0, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setDnsSystemProperty(Ljava/lang/String;IILjava/lang/String;)V

    .line 7074
    .end local v7    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :goto_6d
    goto :goto_38

    .line 7075
    :cond_6e
    return-void
.end method

.method public setInitialTimeToTunnelEstablishment(Ljava/lang/String;J)V
    .registers 5
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "initialTime"    # J

    .line 6363
    iget-object v0, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v0

    .line 6364
    .local v0, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v0, :cond_9

    .line 6365
    return-void

    .line 6366
    :cond_9
    invoke-virtual {v0, p2, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setVpnStartTimeToConnect(J)V

    .line 6367
    return-void
.end method

.method public setServerCertValidationUserAcceptanceCriteria(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;ZLjava/util/List;I)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 16
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .param p3, "enableValidation"    # Z
    .param p4, "condition"    # Ljava/util/List;
    .param p5, "frequency"    # I

    .line 3505
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 3507
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const/4 v1, 0x0

    .line 3508
    .local v1, "success":Z
    new-instance v2, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 3509
    .local v2, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Boolean;>;"
    const/4 v3, 0x0

    invoke-static {v3}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;

    move-result-object v4

    invoke-virtual {v2, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3510
    const/4 v4, 0x1

    const/4 v5, -0x1

    invoke-virtual {v2, v4, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 3512
    iget v6, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v6

    if-nez v6, :cond_20

    .line 3513
    return-object v2

    .line 3516
    :cond_20
    const-string v6, "KnoxVpnEngineService"

    if-eqz p2, :cond_64

    .line 3518
    :try_start_24
    invoke-direct {p0, p1, p2, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->validateAdminAndVendorForProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;)I

    move-result v7

    if-eqz v7, :cond_2b

    .line 3519
    return-object v2

    .line 3521
    :cond_2b
    invoke-virtual {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v7

    .line 3522
    .local v7, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v7, :cond_38

    .line 3523
    const-string/jumbo v3, "setting server cert validation : VPN Service not started"

    invoke-static {v6, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 3524
    return-object v2

    .line 3526
    :cond_38
    invoke-interface {v7, p2, p3, p4, p5}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->setServerCertValidationUserAcceptanceCriteria(Ljava/lang/String;ZLjava/util/List;I)Z

    move-result v8

    move v1, v8

    .line 3528
    invoke-static {v1}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;

    move-result-object v8

    invoke-virtual {v2, v8}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3529
    invoke-virtual {v2, v3, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_47
    .catch Ljava/lang/Exception; {:try_start_24 .. :try_end_47} :catch_48

    .line 3533
    .end local v7    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    goto :goto_64

    .line 3530
    :catch_48
    move-exception v3

    .line 3531
    .local v3, "e":Ljava/lang/Exception;
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "setting server cert validation : Failure at "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v3}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v6, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 3532
    const/4 v4, 0x0

    return-object v4

    .line 3536
    .end local v3    # "e":Ljava/lang/Exception;
    :cond_64
    :goto_64
    :try_start_64
    invoke-virtual {v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v7

    check-cast v7, Ljava/lang/Boolean;

    invoke-virtual {v7}, Ljava/lang/Boolean;->booleanValue()Z

    move-result v7

    if-ne v7, v4, :cond_d1

    .line 3537
    new-instance v7, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v8, "KNOX_VPN"

    const-string v9, "API:setServerCertValidationUserAcceptanceCriteria"

    invoke-direct {v7, v8, v4, v9}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 3538
    invoke-direct {p0, v7, p1, p2, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 3539
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v5, "enb"

    invoke-virtual {v4, v5, p3}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;Z)V

    .line 3540
    new-instance v4, Ljava/lang/StringBuffer;

    invoke-interface {p4, v3}, Ljava/util/List;->get(I)Ljava/lang/Object;

    move-result-object v3

    invoke-static {v3}, Ljava/lang/String;->valueOf(Ljava/lang/Object;)Ljava/lang/String;

    move-result-object v3

    invoke-direct {v4, v3}, Ljava/lang/StringBuffer;-><init>(Ljava/lang/String;)V

    move-object v3, v4

    .line 3541
    .local v3, "cond":Ljava/lang/StringBuffer;
    const/4 v4, 0x1

    .local v4, "i":I
    :goto_94
    invoke-interface {p4}, Ljava/util/List;->size()I

    move-result v5

    if-ge v4, v5, :cond_b9

    .line 3542
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v7, ","

    invoke-virtual {v5, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-interface {p4, v4}, Ljava/util/List;->get(I)Ljava/lang/Object;

    move-result-object v7

    invoke-static {v7}, Ljava/lang/String;->valueOf(Ljava/lang/Object;)Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v5, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v3, v5}, Ljava/lang/StringBuffer;->append(Ljava/lang/String;)Ljava/lang/StringBuffer;

    .line 3541
    add-int/lit8 v4, v4, 0x1

    goto :goto_94

    .line 3544
    .end local v4    # "i":I
    :cond_b9
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v5, "cndt"

    invoke-virtual {v3}, Ljava/lang/StringBuffer;->toString()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v4, v5, v7}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;Ljava/lang/String;)V

    .line 3545
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string/jumbo v5, "fq"

    invoke-virtual {v4, v5, p5}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 3546
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v4}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_d1
    .catch Ljava/lang/Exception; {:try_start_64 .. :try_end_d1} :catch_d2

    .line 3550
    .end local v3    # "cond":Ljava/lang/StringBuffer;
    :cond_d1
    goto :goto_eb

    .line 3548
    :catch_d2
    move-exception v3

    .line 3549
    .local v3, "e":Ljava/lang/Exception;
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception = "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v3}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v6, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 3551
    .end local v3    # "e":Ljava/lang/Exception;
    :goto_eb
    return-object v2
.end method

.method public declared-synchronized setUserCertificate(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;[BLjava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 13
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .param p3, "pkcs12Blob"    # [B
    .param p4, "password"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            "[B",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Boolean;",
            ">;"
        }
    .end annotation

    monitor-enter p0

    .line 1494
    :try_start_1
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 1496
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const/4 v1, 0x0

    .line 1497
    .local v1, "success":Z
    new-instance v2, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 1498
    .local v2, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Boolean;>;"
    const/4 v3, 0x0

    invoke-static {v3}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;

    move-result-object v4

    invoke-virtual {v2, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1499
    const/4 v4, -0x1

    const/4 v5, 0x1

    invoke-virtual {v2, v5, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1501
    iget v6, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v6
    :try_end_1e
    .catchall {:try_start_1 .. :try_end_1e} :catchall_a8

    if-nez v6, :cond_22

    .line 1502
    monitor-exit p0

    return-object v2

    .line 1505
    :cond_22
    if-eqz p2, :cond_6b

    .line 1507
    :try_start_24
    invoke-direct {p0, p1, p2, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->validateAdminAndVendorForProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;)I

    move-result v6
    :try_end_28
    .catch Ljava/lang/Exception; {:try_start_24 .. :try_end_28} :catch_4c
    .catchall {:try_start_24 .. :try_end_28} :catchall_a8

    if-eqz v6, :cond_2c

    .line 1508
    monitor-exit p0

    return-object v2

    .line 1510
    :cond_2c
    :try_start_2c
    invoke-virtual {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v6

    .line 1511
    .local v6, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v6, :cond_3c

    .line 1512
    const-string v3, "KnoxVpnEngineService"

    const-string/jumbo v4, "setting user certificate : VPN Service not started"

    invoke-static {v3, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_3a
    .catch Ljava/lang/Exception; {:try_start_2c .. :try_end_3a} :catch_4c
    .catchall {:try_start_2c .. :try_end_3a} :catchall_a8

    .line 1513
    monitor-exit p0

    return-object v2

    .line 1515
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_3c
    :try_start_3c
    invoke-interface {v6, p2, p3, p4}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->setUserCertificate(Ljava/lang/String;[BLjava/lang/String;)Z

    move-result v7

    move v1, v7

    .line 1517
    invoke-static {v1}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;

    move-result-object v7

    invoke-virtual {v2, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1518
    invoke-virtual {v2, v3, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_4b
    .catch Ljava/lang/Exception; {:try_start_3c .. :try_end_4b} :catch_4c
    .catchall {:try_start_3c .. :try_end_4b} :catchall_a8

    .line 1522
    .end local v6    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    goto :goto_6b

    .line 1519
    :catch_4c
    move-exception v3

    .line 1520
    .local v3, "e":Ljava/lang/Exception;
    :try_start_4d
    const-string v4, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "setting user certificate : Failure at "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v3}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v4, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_68
    .catchall {:try_start_4d .. :try_end_68} :catchall_a8

    .line 1521
    const/4 v4, 0x0

    monitor-exit p0

    return-object v4

    .line 1525
    .end local v3    # "e":Ljava/lang/Exception;
    :cond_6b
    :goto_6b
    :try_start_6b
    invoke-virtual {v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v3

    check-cast v3, Ljava/lang/Boolean;

    invoke-virtual {v3}, Ljava/lang/Boolean;->booleanValue()Z

    move-result v3

    if-ne v3, v5, :cond_8a

    .line 1526
    new-instance v3, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v6, "KNOX_VPN"

    const-string v7, "API:setUserCertificate"

    invoke-direct {v3, v6, v5, v7}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 1527
    invoke-direct {p0, v3, p1, p2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 1528
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v3}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_8a
    .catch Ljava/lang/Exception; {:try_start_6b .. :try_end_8a} :catch_8b
    .catchall {:try_start_6b .. :try_end_8a} :catchall_a8

    .line 1532
    :cond_8a
    goto :goto_a6

    .line 1530
    :catch_8b
    move-exception v3

    .line 1531
    .restart local v3    # "e":Ljava/lang/Exception;
    :try_start_8c
    const-string v4, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Exception = "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v3}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v4, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_a6
    .catchall {:try_start_8c .. :try_end_a6} :catchall_a8

    .line 1533
    .end local v3    # "e":Ljava/lang/Exception;
    :goto_a6
    monitor-exit p0

    return-object v2

    .line 1493
    .end local v0    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v1    # "success":Z
    .end local v2    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Boolean;>;"
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    .end local p3    # "pkcs12Blob":[B
    .end local p4    # "password":Ljava/lang/String;
    :catchall_a8
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method public declared-synchronized setVpnModeOfOperation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 14
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .param p3, "vpnMode"    # I
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            "I)",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    monitor-enter p0

    .line 3417
    :try_start_1
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 3419
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    new-instance v1, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 3420
    .local v1, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v2, -0x1

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v1, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3421
    const/4 v3, 0x1

    invoke-virtual {v1, v3, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 3423
    iget v4, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v4

    if-nez v4, :cond_29

    .line 3424
    const/16 v2, 0x8c

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_27
    .catchall {:try_start_1 .. :try_end_27} :catchall_100

    .line 3425
    monitor-exit p0

    return-object v1

    .line 3429
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_29
    :try_start_29
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnApiValidation:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;

    invoke-virtual {v4, p1, p2, p3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnApiValidation;->setVpnModeOfOperationValidation(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)I

    move-result v4

    .line 3430
    .local v4, "setVpnModeOfOperationValidation":I
    const/16 v5, 0x64

    if-eq v4, v5, :cond_53

    .line 3431
    invoke-static {v4}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v5

    invoke-virtual {v1, v5}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3432
    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "setting the mode of operation for the profile has failed:The error code is "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_51
    .catch Ljava/lang/Exception; {:try_start_29 .. :try_end_51} :catch_9b
    .catchall {:try_start_29 .. :try_end_51} :catchall_100

    .line 3433
    monitor-exit p0

    return-object v1

    .line 3435
    :cond_53
    :try_start_53
    invoke-virtual {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v5

    .line 3436
    .local v5, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v5, :cond_6c

    .line 3437
    const/16 v6, 0x6e

    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v6

    invoke-virtual {v1, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3438
    const-string v6, "KnoxVpnEngineService"

    const-string/jumbo v7, "setting the mode of operation for the profile has failed: The error code is 110"

    invoke-static {v6, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_6a
    .catch Ljava/lang/Exception; {:try_start_53 .. :try_end_6a} :catch_9b
    .catchall {:try_start_53 .. :try_end_6a} :catchall_100

    .line 3439
    monitor-exit p0

    return-object v1

    .line 3441
    :cond_6c
    :try_start_6c
    invoke-interface {v5, p2, p3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->setVpnModeOfOperation(Ljava/lang/String;I)I

    move-result v6

    .line 3442
    .local v6, "setMode":I
    const-string v7, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "setVpnModeOfOperation : profileName = "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v9, " :setMode = "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v7, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3443
    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-virtual {v1, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 3444
    const/4 v7, 0x0

    invoke-virtual {v1, v7, v7}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_9a
    .catch Ljava/lang/Exception; {:try_start_6c .. :try_end_9a} :catch_9b
    .catchall {:try_start_6c .. :try_end_9a} :catchall_100

    .line 3447
    .end local v4    # "setVpnModeOfOperationValidation":I
    .end local v5    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v6    # "setMode":I
    goto :goto_bb

    .line 3445
    :catch_9b
    move-exception v4

    .line 3446
    .local v4, "e":Ljava/lang/Exception;
    :try_start_9c
    sget-boolean v5, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v5, :cond_bb

    const-string v5, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v7, "setting vpn mode : Failure at "

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v4}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v5, v6}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_bb
    .catchall {:try_start_9c .. :try_end_bb} :catchall_100

    .line 3450
    .end local v4    # "e":Ljava/lang/Exception;
    :cond_bb
    :goto_bb
    :try_start_bb
    invoke-virtual {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->getData()Ljava/lang/Object;

    move-result-object v4

    check-cast v4, Ljava/lang/Integer;

    invoke-virtual {v4}, Ljava/lang/Integer;->intValue()I

    move-result v4

    if-nez v4, :cond_e2

    .line 3451
    new-instance v4, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string v5, "KNOX_VPN"

    const-string v6, "API:setVpnModeOfOperation"

    invoke-direct {v4, v5, v3, v6}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;-><init>(Ljava/lang/String;ILjava/lang/String;)V

    iput-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    .line 3452
    invoke-direct {p0, v4, p1, p2, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setCommonProperties(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;I)V

    .line 3453
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    const-string/jumbo v3, "vpnMd"

    invoke-virtual {v2, v3, p3}, Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;->setProperty(Ljava/lang/String;I)V

    .line 3454
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mData:Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;

    invoke-static {v2}, Lcom/samsung/android/knox/analytics/KnoxAnalytics;->log(Lcom/samsung/android/knox/analytics/KnoxAnalyticsData;)V
    :try_end_e2
    .catch Ljava/lang/Exception; {:try_start_bb .. :try_end_e2} :catch_e3
    .catchall {:try_start_bb .. :try_end_e2} :catchall_100

    .line 3458
    :cond_e2
    goto :goto_fe

    .line 3456
    :catch_e3
    move-exception v2

    .line 3457
    .local v2, "e":Ljava/lang/Exception;
    :try_start_e4
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v5, "Exception = "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_fe
    .catchall {:try_start_e4 .. :try_end_fe} :catchall_100

    .line 3459
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_fe
    monitor-exit p0

    return-object v1

    .line 3416
    .end local v0    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v1    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    .end local p3    # "vpnMode":I
    :catchall_100
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method public showToastVpnEULA()V
    .registers 6

    .line 9258
    const-string v0, "KnoxVpnEngineService"

    const-string v1, "Show EULA Toast for ONS- START"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 9259
    iget-object v1, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mContext:Landroid/content/Context;

    const v2, 0x10405c3

    invoke-virtual {v1, v2}, Landroid/content/Context;->getString(I)Ljava/lang/String;

    move-result-object v1

    .line 9260
    .local v1, "toastText":Ljava/lang/String;
    new-instance v2, Landroid/os/Message;

    invoke-direct {v2}, Landroid/os/Message;-><init>()V

    .line 9261
    .local v2, "msg":Landroid/os/Message;
    new-instance v3, Landroid/os/Bundle;

    invoke-direct {v3}, Landroid/os/Bundle;-><init>()V

    .line 9262
    .local v3, "bundle":Landroid/os/Bundle;
    const-string/jumbo v4, "message"

    invoke-virtual {v3, v4, v1}, Landroid/os/Bundle;->putString(Ljava/lang/String;Ljava/lang/String;)V

    .line 9263
    invoke-virtual {v2, v3}, Landroid/os/Message;->setData(Landroid/os/Bundle;)V

    .line 9264
    const/16 v4, 0x20

    iput v4, v2, Landroid/os/Message;->what:I

    .line 9265
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mHandler:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;

    invoke-virtual {v4, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService$KnoxVpnHandler;->sendMessage(Landroid/os/Message;)Z

    .line 9266
    const-string v4, "Show EULA Toast for ONS - END"

    invoke-static {v0, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 9267
    return-void
.end method

.method public declared-synchronized startConnection(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 38
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    move-object/from16 v1, p0

    move-object/from16 v2, p1

    move-object/from16 v3, p2

    monitor-enter p0

    .line 1650
    :try_start_7
    invoke-direct/range {p0 .. p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    move-object v4, v0

    .line 1652
    .local v4, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const-string v0, "KnoxVpnEngineService"

    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "knox vpn profile is going to be started for the profile "

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-static {v0, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1653
    new-instance v0, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    move-object v5, v0

    .line 1654
    .local v5, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v0, -0x1

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v6

    invoke-virtual {v5, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1655
    const/4 v6, 0x1

    invoke-virtual {v5, v6, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1657
    iget v7, v4, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {v1, v2, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v7

    if-nez v7, :cond_48

    .line 1658
    const/16 v0, 0x8c

    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v0

    invoke-virtual {v5, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_46
    .catchall {:try_start_7 .. :try_end_46} :catchall_1f0

    .line 1659
    monitor-exit p0

    return-object v5

    .line 1662
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_48
    :try_start_48
    iget-object v7, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v7, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v7
    :try_end_4e
    .catchall {:try_start_48 .. :try_end_4e} :catchall_1f0

    .line 1663
    .local v7, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v7, :cond_52

    .line 1664
    monitor-exit p0

    return-object v5

    .line 1668
    .restart local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_52
    const/4 v8, 0x0

    :try_start_53
    invoke-direct {v1, v2, v3, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->validateAdminAndVendorForProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;)I

    move-result v9

    if-eqz v9, :cond_7f

    .line 1669
    const/16 v0, 0x8

    invoke-virtual {v5, v6, v0}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1670
    const/4 v9, 0x3

    const/4 v10, 0x5

    const/4 v11, 0x0

    .line 1671
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v12

    const-string v13, "KnoxVpnEngineService"

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Error while validating admin and vendor for profile "

    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v14

    iget v15, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1670
    invoke-static/range {v9 .. v15}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_7d
    .catch Ljava/lang/Exception; {:try_start_53 .. :try_end_7d} :catch_1b2
    .catchall {:try_start_53 .. :try_end_7d} :catchall_1f0

    .line 1674
    monitor-exit p0

    return-object v5

    .line 1676
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_7f
    :try_start_7f
    invoke-virtual {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v9

    .line 1677
    .local v9, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v9, :cond_8f

    .line 1678
    const-string v0, "KnoxVpnEngineService"

    const-string/jumbo v6, "starting vpn connection : Mocana Service is not started"

    invoke-static {v0, v6}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_8d
    .catch Ljava/lang/Exception; {:try_start_7f .. :try_end_8d} :catch_1b2
    .catchall {:try_start_7f .. :try_end_8d} :catchall_1f0

    .line 1679
    monitor-exit p0

    return-object v8

    .line 1682
    :cond_8f
    :try_start_8f
    invoke-direct {v1, v3}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVPNTransitionState(Ljava/lang/String;)I

    move-result v10

    .line 1683
    .local v10, "state":I
    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v11

    .line 1684
    .local v11, "active":I
    invoke-virtual {v7}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getVpnConnectionType()I

    move-result v12

    .line 1685
    .local v12, "vpnConnectionType":I
    if-eq v10, v6, :cond_a2

    const/4 v14, 0x5

    if-eq v10, v14, :cond_a2

    if-ne v10, v0, :cond_a4

    :cond_a2
    if-nez v11, :cond_a6

    :cond_a4
    move v0, v6

    goto :goto_a7

    :cond_a6
    const/4 v0, 0x0

    .line 1687
    .local v0, "notAllowed":Z
    :goto_a7
    if-nez v12, :cond_ab

    move v14, v6

    goto :goto_ac

    :cond_ab
    const/4 v14, 0x0

    .line 1689
    .local v14, "keepOn":Z
    :goto_ac
    const/4 v15, 0x0

    .line 1690
    .local v15, "onDemand":Z
    if-ne v12, v6, :cond_b8

    .line 1691
    iget-object v8, v1, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mProcessManager:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;

    invoke-virtual {v8, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnProcessManager;->processRunCheck(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;)Z

    move-result v8

    .line 1692
    .local v8, "isRunning":Z
    if-eqz v8, :cond_b8

    .line 1693
    const/4 v15, 0x1

    .line 1696
    .end local v8    # "isRunning":Z
    :cond_b8
    if-eqz v0, :cond_10a

    .line 1697
    const-string v8, "KnoxVpnEngineService"

    new-instance v13, Ljava/lang/StringBuilder;

    invoke-direct {v13}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "not allowd state for starting a vpn : profileName = "

    invoke-virtual {v13, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v6, ": state = "

    invoke-virtual {v13, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v13, v10}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v13}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v6

    invoke-static {v8, v6}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1699
    const/16 v17, 0x3

    const/16 v18, 0x5

    const/16 v19, 0x0

    .line 1700
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v20

    const-string v21, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v8, "Not allowed to start connection for profile "

    invoke-virtual {v6, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v8, ". Check vpn and profile status"

    invoke-virtual {v6, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v22

    iget v6, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1699
    move/from16 v23, v6

    invoke-static/range {v17 .. v23}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    .line 1704
    const/16 v6, 0xc

    const/4 v8, 0x1

    invoke-virtual {v5, v8, v6}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V
    :try_end_108
    .catch Ljava/lang/Exception; {:try_start_8f .. :try_end_108} :catch_1b2
    .catchall {:try_start_8f .. :try_end_108} :catchall_1f0

    .line 1705
    monitor-exit p0

    return-object v5

    .line 1708
    :cond_10a
    :try_start_10a
    sget-boolean v6, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v6, :cond_12d

    const-string v6, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v13, "keepOn =  "

    invoke-virtual {v8, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v14}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v13, " / onDemand = "

    invoke-virtual {v8, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v15}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v6, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1710
    :cond_12d
    if-nez v14, :cond_131

    if-eqz v15, :cond_18b

    .line 1711
    :cond_131
    invoke-interface {v9, v3}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->startConnection(Ljava/lang/String;)I

    move-result v6

    .line 1712
    .local v6, "startVpn":I
    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v8

    invoke-virtual {v5, v8}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1713
    const/4 v8, 0x0

    invoke-virtual {v5, v8, v8}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1714
    if-eqz v6, :cond_167

    .line 1715
    const/16 v16, 0x3

    const/16 v17, 0x5

    const/16 v18, 0x0

    .line 1716
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v19

    const-string v20, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v13, "Error trying to start vpn connection for profile "

    invoke-virtual {v8, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v21

    iget v8, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1715
    move/from16 v22, v8

    invoke-static/range {v16 .. v22}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    goto :goto_18b

    .line 1720
    :cond_167
    const/16 v22, 0x5

    const/16 v23, 0x5

    const/16 v24, 0x1

    .line 1721
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v25

    const-string v26, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string v13, "Connection established for vpn profile "

    invoke-virtual {v8, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v27

    iget v8, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1720
    move/from16 v28, v8

    invoke-static/range {v22 .. v28}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_18b
    .catch Ljava/lang/Exception; {:try_start_10a .. :try_end_18b} :catch_1b2
    .catchall {:try_start_10a .. :try_end_18b} :catchall_1f0

    .line 1735
    .end local v0    # "notAllowed":Z
    .end local v6    # "startVpn":I
    .end local v9    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v10    # "state":I
    .end local v11    # "active":I
    .end local v12    # "vpnConnectionType":I
    .end local v14    # "keepOn":Z
    .end local v15    # "onDemand":Z
    :cond_18b
    :goto_18b
    nop

    .line 1737
    const/16 v28, 0x5

    const/16 v29, 0x5

    const/16 v30, 0x1

    .line 1738
    :try_start_192
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v31

    const-string v32, "KnoxVpnEngineService"

    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string v6, "Vpn connection established for profile "

    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v33

    iget v0, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1737
    move/from16 v34, v0

    invoke-static/range {v28 .. v34}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_1b0
    .catchall {:try_start_192 .. :try_end_1b0} :catchall_1f0

    .line 1742
    monitor-exit p0

    return-object v5

    .line 1726
    :catch_1b2
    move-exception v0

    .line 1727
    .local v0, "e":Ljava/lang/Exception;
    :try_start_1b3
    const-string v6, "KnoxVpnEngineService"

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "starting vpn connection : Failure at "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v0}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v9

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v6, v8}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 1729
    const/4 v9, 0x3

    const/4 v10, 0x5

    const/4 v11, 0x0

    .line 1730
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v12

    const-string v13, "KnoxVpnEngineService"

    new-instance v6, Ljava/lang/StringBuilder;

    invoke-direct {v6}, Ljava/lang/StringBuilder;-><init>()V

    const-string v8, "Exception starting connection for profile "

    invoke-virtual {v6, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v6}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v14

    iget v15, v2, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1729
    invoke-static/range {v9 .. v15}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_1ed
    .catchall {:try_start_1b3 .. :try_end_1ed} :catchall_1f0

    .line 1734
    monitor-exit p0

    const/4 v6, 0x0

    return-object v6

    .line 1649
    .end local v0    # "e":Ljava/lang/Exception;
    .end local v4    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v5    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local v7    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    :catchall_1f0
    move-exception v0

    monitor-exit p0

    throw v0
.end method

.method protected startVpnForPerApplication(Ljava/lang/String;Ljava/util/List;Z)I
    .registers 15
    .param p1, "profileName"    # Ljava/lang/String;
    .param p3, "start"    # Z
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Ljava/lang/String;",
            "Ljava/util/List<",
            "Ljava/lang/Integer;",
            ">;Z)I"
        }
    .end annotation

    .line 3982
    .local p2, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v1, "startVpnForPerApplication: profileName value is "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    const-string v1, "KnoxVpnEngineService"

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3983
    const/4 v0, 0x0

    .line 3985
    .local v0, "startVpnResult":I
    :try_start_18
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 3986
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v2, :cond_23

    .line 3987
    const/16 v1, 0x6c

    return v1

    .line 3990
    :cond_23
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->checkIfProfileHasChainingFeature(Ljava/lang/String;)I

    move-result v3

    .line 3991
    .local v3, "isChainingEnabled":I
    const/4 v4, 0x1

    if-ne v3, v4, :cond_35

    .line 3992
    invoke-virtual {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkChainingStatus(Ljava/lang/String;)I

    move-result v5

    .line 3993
    .local v5, "chainingStatus":I
    if-nez v5, :cond_35

    .line 3994
    const/16 v1, 0x1f6

    return v1

    .line 3998
    .end local v5    # "chainingStatus":I
    :cond_35
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v5

    .line 3999
    .local v5, "activateState":I
    if-nez v5, :cond_3e

    .line 4000
    const/16 v1, 0x12d

    return v1

    .line 4003
    :cond_3e
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVPNTransitionState(Ljava/lang/String;)I

    move-result v6

    const/4 v7, -0x1

    const/4 v8, 0x0

    if-eq v6, v7, :cond_cc

    if-eq v6, v4, :cond_cc

    const/4 v4, 0x2

    if-eq v6, v4, :cond_c2

    const/4 v4, 0x3

    if-eq v6, v4, :cond_b8

    const/4 v9, 0x4

    if-eq v6, v9, :cond_5d

    const/4 v4, 0x5

    if-eq v6, v4, :cond_cc

    .line 4031
    const-string/jumbo v4, "startVpnForPackage : VPN State not valid"

    invoke-static {v1, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 4032
    const/4 v0, -0x1

    goto/16 :goto_f3

    .line 4005
    :cond_5d
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    .line 4006
    .local v6, "interfaceValue":Ljava/lang/String;
    sget-boolean v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v8, :cond_83

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v9, "startVpnForPackage: for connected state profileName value is "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string/jumbo v9, "interfaceValue value is "

    invoke-virtual {v8, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v1, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4007
    :cond_83
    if-nez v6, :cond_86

    .line 4008
    return v7

    .line 4010
    :cond_86
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v8

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v9

    invoke-virtual {v7, p2, v8, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRules(Ljava/util/List;Ljava/lang/String;I)V

    .line 4011
    invoke-interface {p2}, Ljava/util/List;->iterator()Ljava/util/Iterator;

    move-result-object v7

    :goto_97
    invoke-interface {v7}, Ljava/util/Iterator;->hasNext()Z

    move-result v8

    if-eqz v8, :cond_b7

    invoke-interface {v7}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v8

    check-cast v8, Ljava/lang/Integer;

    invoke-virtual {v8}, Ljava/lang/Integer;->intValue()I

    move-result v8

    .line 4012
    .local v8, "uid":I
    invoke-direct {p0, p1, v8, v8, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setDnsSystemProperty(Ljava/lang/String;IILjava/lang/String;)V

    .line 4013
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v9

    const/4 v10, 0x0

    invoke-virtual {v9, v8, v10}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateProxyList(IZ)Ljava/util/HashMap;

    move-result-object v9

    invoke-direct {p0, v4, p1, v9}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 4014
    .end local v8    # "uid":I
    goto :goto_97

    .line 4015
    :cond_b7
    goto :goto_f3

    .line 4028
    .end local v6    # "interfaceValue":Ljava/lang/String;
    :cond_b8
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v6

    invoke-virtual {v4, p2, v8, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRules(Ljava/util/List;Ljava/lang/String;I)V

    .line 4029
    goto :goto_f3

    .line 4025
    :cond_c2
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v6

    invoke-virtual {v4, p2, v8, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRules(Ljava/util/List;Ljava/lang/String;I)V

    .line 4026
    goto :goto_f3

    .line 4019
    :cond_cc
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_e5

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "startVpnForPackage: profileName : "

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v1, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 4020
    :cond_e5
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v6

    invoke-virtual {v4, p2, v8, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRules(Ljava/util/List;Ljava/lang/String;I)V

    .line 4021
    if-eqz p3, :cond_f3

    .line 4022
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnProfile(Ljava/lang/String;)I
    :try_end_f3
    .catch Ljava/lang/Exception; {:try_start_18 .. :try_end_f3} :catch_f4

    .line 4038
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "isChainingEnabled":I
    .end local v5    # "activateState":I
    :cond_f3
    :goto_f3
    goto :goto_10f

    .line 4035
    :catch_f4
    move-exception v2

    .line 4036
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v4, "startVpnForPackage: "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v1, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 4037
    const/4 v0, -0x1

    .line 4039
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_10f
    return v0
.end method

.method protected startVpnForUserwideVpn(Ljava/lang/String;IZ)I
    .registers 15
    .param p1, "profileName"    # Ljava/lang/String;
    .param p2, "cid"    # I
    .param p3, "start"    # Z

    .line 3914
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v1, "startVpnForPackage: profileName value is "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string v1, " container id value is "

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v0, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    const-string v1, "KnoxVpnEngineService"

    invoke-static {v1, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3915
    const/4 v0, 0x0

    .line 3918
    .local v0, "startVpnResult":I
    :try_start_20
    iget-object v2, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v2, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v2

    .line 3919
    .local v2, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v2, :cond_2b

    .line 3920
    const/16 v1, 0x6c

    return v1

    .line 3923
    :cond_2b
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v3, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->checkIfProfileHasChainingFeature(Ljava/lang/String;)I

    move-result v3

    .line 3924
    .local v3, "isChainingEnabled":I
    const/4 v4, 0x1

    if-ne v3, v4, :cond_3d

    .line 3925
    invoke-virtual {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkChainingStatus(Ljava/lang/String;)I

    move-result v5

    .line 3926
    .local v5, "chainingStatus":I
    if-nez v5, :cond_3d

    .line 3927
    const/16 v1, 0x1f6

    return v1

    .line 3931
    .end local v5    # "chainingStatus":I
    :cond_3d
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getActivateState()I

    move-result v5

    .line 3932
    .local v5, "activateState":I
    if-nez v5, :cond_46

    .line 3933
    const/16 v1, 0x12d

    return v1

    .line 3938
    :cond_46
    const/4 v6, -0x2

    invoke-direct {p0, p1, p2, v6, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->addUIDListToExceptionList(Ljava/lang/String;IILjava/lang/String;)V

    .line 3941
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVPNTransitionState(Ljava/lang/String;)I

    move-result v6

    const/4 v7, -0x1

    const/4 v8, 0x0

    if-eq v6, v7, :cond_ca

    if-eq v6, v4, :cond_ca

    const/4 v9, 0x2

    if-eq v6, v9, :cond_c0

    const/4 v9, 0x3

    if-eq v6, v9, :cond_b6

    const/4 v10, 0x4

    if-eq v6, v10, :cond_69

    const/4 v4, 0x5

    if-eq v6, v4, :cond_ca

    .line 3967
    const-string/jumbo v4, "startVpnForPackage : VPN State not valid"

    invoke-static {v1, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 3968
    const/4 v0, -0x1

    goto/16 :goto_f1

    .line 3943
    :cond_69
    invoke-virtual {v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v6

    .line 3944
    .local v6, "interfaceValue":Ljava/lang/String;
    sget-boolean v8, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v8, :cond_8f

    new-instance v8, Ljava/lang/StringBuilder;

    invoke-direct {v8}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v10, "startVpnForPackage: for connected state profileName value is "

    invoke-virtual {v8, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    const-string/jumbo v10, "interfaceValue value is "

    invoke-virtual {v8, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v8}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v8

    invoke-static {v1, v8}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3945
    :cond_8f
    if-nez v6, :cond_92

    .line 3946
    return v7

    .line 3948
    :cond_92
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v8

    invoke-virtual {v7, p2, v6, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRulesRange(ILjava/lang/String;I)V

    .line 3949
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->startUid(I)I

    move-result v7

    iget-object v8, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v8, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->stopUid(I)I

    move-result v8

    invoke-direct {p0, p1, v7, v8, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->setDnsSystemProperty(Ljava/lang/String;IILjava/lang/String;)V

    .line 3950
    invoke-direct {p0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getKnoxVpnHelperInstance()Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    move-result-object v7

    invoke-virtual {v7, p2, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->updateProxyList(IZ)Ljava/util/HashMap;

    move-result-object v4

    invoke-direct {p0, v9, p1, v4}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateProxyRules(ILjava/lang/String;Ljava/util/HashMap;)V

    .line 3951
    goto :goto_f1

    .line 3964
    .end local v6    # "interfaceValue":Ljava/lang/String;
    :cond_b6
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v6

    invoke-virtual {v4, p2, v8, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRulesRange(ILjava/lang/String;I)V

    .line 3965
    goto :goto_f1

    .line 3961
    :cond_c0
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v6

    invoke-virtual {v4, p2, v8, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRulesRange(ILjava/lang/String;I)V

    .line 3962
    goto :goto_f1

    .line 3955
    :cond_ca
    sget-boolean v4, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->DBG:Z

    if-eqz v4, :cond_e3

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v6, "startVpnForPackage: profileName : "

    invoke-virtual {v4, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v1, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 3956
    :cond_e3
    iget-object v4, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v6

    invoke-virtual {v4, p2, v8, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->addMiscRulesRange(ILjava/lang/String;I)V

    .line 3957
    if-eqz p3, :cond_f1

    .line 3958
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->startVpnProfile(Ljava/lang/String;)I
    :try_end_f1
    .catch Ljava/lang/Exception; {:try_start_20 .. :try_end_f1} :catch_f2

    .line 3974
    .end local v2    # "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    .end local v3    # "isChainingEnabled":I
    .end local v5    # "activateState":I
    :cond_f1
    :goto_f1
    goto :goto_10d

    .line 3971
    :catch_f2
    move-exception v2

    .line 3972
    .local v2, "e":Ljava/lang/Exception;
    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v4, "startVpnForPackage: "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v1, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 3973
    const/4 v0, -0x1

    .line 3975
    .end local v2    # "e":Ljava/lang/Exception;
    :goto_10d
    return v0
.end method

.method public declared-synchronized stopConnection(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;
    .registers 15
    .param p1, "vpnContext"    # Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .param p2, "profileName"    # Ljava/lang/String;
    .annotation system Ldalvik/annotation/Signature;
        value = {
            "(",
            "Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;",
            "Ljava/lang/String;",
            ")",
            "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<",
            "Ljava/lang/Integer;",
            ">;"
        }
    .end annotation

    monitor-enter p0

    .line 1749
    :try_start_1
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->checkCallingUidPermission(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;)Lcom/samsung/android/knox/ContextInfo;

    move-result-object v0

    .line 1751
    .local v0, "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    const-string v1, "KnoxVpnEngineService"

    new-instance v2, Ljava/lang/StringBuilder;

    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v3, "knox vpn profile is going to be stopped for the profile "

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 1752
    new-instance v1, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;

    invoke-direct {v1}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;-><init>()V

    .line 1753
    .local v1, "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    const/4 v2, -0x1

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v3

    invoke-virtual {v1, v3}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1754
    const/4 v3, 0x1

    invoke-virtual {v1, v3, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1756
    iget v2, v0, Lcom/samsung/android/knox/ContextInfo;->mCallerUid:I

    invoke-direct {p0, p1, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->updateIfNonLegacyUserAndCheckIfVendorAllowed(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;I)Z

    move-result v2

    if-nez v2, :cond_40

    .line 1757
    const/16 v2, 0x8c

    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v2

    invoke-virtual {v1, v2}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V
    :try_end_3e
    .catchall {:try_start_1 .. :try_end_3e} :catchall_e8

    .line 1758
    monitor-exit p0

    return-object v1

    .line 1762
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_40
    :try_start_40
    invoke-direct {p0, p1, p2, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->validateAdminAndVendorForProfile(Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;Ljava/lang/String;Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;)I

    move-result v2
    :try_end_44
    .catch Ljava/lang/Exception; {:try_start_40 .. :try_end_44} :catch_ab
    .catchall {:try_start_40 .. :try_end_44} :catchall_e8

    if-eqz v2, :cond_48

    .line 1763
    monitor-exit p0

    return-object v1

    .line 1765
    .restart local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_48
    :try_start_48
    invoke-virtual {p0, p2}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getBinderInterfaceForProfile(Ljava/lang/String;)Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;

    move-result-object v2

    .line 1766
    .local v2, "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    if-nez v2, :cond_58

    .line 1767
    const-string v3, "KnoxVpnEngineService"

    const-string/jumbo v4, "stopping vpn connection : Service is not started"

    invoke-static {v3, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_56
    .catch Ljava/lang/Exception; {:try_start_48 .. :try_end_56} :catch_ab
    .catchall {:try_start_48 .. :try_end_56} :catchall_e8

    .line 1768
    monitor-exit p0

    return-object v1

    .line 1770
    .end local p0    # "this":Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;
    :cond_58
    :try_start_58
    invoke-interface {v2, p2}, Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;->stopConnection(Ljava/lang/String;)I

    move-result v3

    .line 1771
    .local v3, "stopStatus":I
    invoke-static {v3}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v4

    invoke-virtual {v1, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setData(Ljava/lang/Object;)V

    .line 1772
    const/4 v4, 0x0

    invoke-virtual {v1, v4, v4}, Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;->setStatus(II)V

    .line 1773
    if-eqz v3, :cond_89

    .line 1774
    const/4 v5, 0x3

    const/4 v6, 0x5

    const/4 v7, 0x0

    .line 1775
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v8

    const-string v9, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string v10, "Error occurred trying to stop vpn connection from profile "

    invoke-virtual {v4, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v10

    iget v11, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1774
    invoke-static/range {v5 .. v11}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V

    goto :goto_a8

    .line 1779
    :cond_89
    const/4 v4, 0x5

    const/4 v5, 0x5

    const/4 v6, 0x1

    .line 1780
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v7

    const-string v8, "KnoxVpnEngineService"

    new-instance v9, Ljava/lang/StringBuilder;

    invoke-direct {v9}, Ljava/lang/StringBuilder;-><init>()V

    const-string v10, "Connection with vpn vendor service stopped for profile "

    invoke-virtual {v9, v10}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v9

    iget v10, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1779
    invoke-static/range {v4 .. v10}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_a8
    .catch Ljava/lang/Exception; {:try_start_58 .. :try_end_a8} :catch_ab
    .catchall {:try_start_58 .. :try_end_a8} :catchall_e8

    .line 1793
    .end local v2    # "vpnInterface":Lcom/samsung/android/knox/net/vpn/serviceprovider/IKnoxVpnService;
    .end local v3    # "stopStatus":I
    :goto_a8
    nop

    .line 1794
    monitor-exit p0

    return-object v1

    .line 1784
    :catch_ab
    move-exception v2

    .line 1785
    .local v2, "e":Ljava/lang/Exception;
    :try_start_ac
    const-string v3, "KnoxVpnEngineService"

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    const-string/jumbo v5, "stopping vpn connection : Failure at "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-static {v2}, Landroid/util/Log;->getStackTraceString(Ljava/lang/Throwable;)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-static {v3, v4}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    .line 1787
    const/4 v5, 0x3

    const/4 v6, 0x5

    const/4 v7, 0x0

    .line 1788
    invoke-static {}, Landroid/os/Process;->myPid()I

    move-result v8

    const-string v9, "KnoxVpnEngineService"

    new-instance v3, Ljava/lang/StringBuilder;

    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V

    const-string v4, "Exception stopping connection for profile "

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v10

    iget v11, p1, Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;->personaId:I

    .line 1787
    invoke-static/range {v5 .. v11}, Landroid/sec/enterprise/auditlog/AuditLog;->logAsUser(IIZILjava/lang/String;Ljava/lang/String;I)V
    :try_end_e6
    .catchall {:try_start_ac .. :try_end_e6} :catchall_e8

    .line 1792
    monitor-exit p0

    return-object v1

    .line 1748
    .end local v0    # "cxtInfo":Lcom/samsung/android/knox/ContextInfo;
    .end local v1    # "responseData":Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData;, "Lcom/samsung/android/knox/net/vpn/EnterpriseResponseData<Ljava/lang/Integer;>;"
    .end local v2    # "e":Ljava/lang/Exception;
    .end local p1    # "vpnContext":Lcom/samsung/android/knox/net/vpn/KnoxVpnContext;
    .end local p2    # "profileName":Ljava/lang/String;
    :catchall_e8
    move-exception p1

    monitor-exit p0

    throw p1
.end method

.method public systemReady()V
    .registers 3

    .line 333
    const-string v0, "KnoxVpnEngineService"

    const-string/jumbo v1, "system ready is being called"

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    .line 334
    return-void
.end method

.method public unsetDnsPropertyForNetwork(Landroid/net/NetworkInfo;)V
    .registers 10
    .param p1, "ni"    # Landroid/net/NetworkInfo;

    .line 7078
    const/4 v0, -0x1

    .local v0, "uid":I
    const/4 v1, -0x1

    .line 7079
    .local v1, "cid":I
    if-nez p1, :cond_5

    .line 7080
    return-void

    .line 7081
    :cond_5
    invoke-static {}, Landroid/os/Binder;->getCallingUid()I

    move-result v2

    const/16 v3, 0x3e8

    if-eq v2, v3, :cond_e

    .line 7082
    return-void

    .line 7084
    :cond_e
    invoke-virtual {p1}, Landroid/net/NetworkInfo;->getprofileName()Ljava/lang/String;

    move-result-object v2

    .line 7085
    .local v2, "profileName":Ljava/lang/String;
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v3, v2}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v3

    .line 7086
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v3, :cond_1b

    .line 7087
    return-void

    .line 7089
    :cond_1b
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getRouteType()I

    move-result v4

    if-nez v4, :cond_22

    .line 7090
    return-void

    .line 7092
    :cond_22
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v4

    invoke-interface {v4}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v4

    :goto_2a
    invoke-interface {v4}, Ljava/util/Iterator;->hasNext()Z

    move-result v5

    if-eqz v5, :cond_60

    invoke-interface {v4}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v5

    check-cast v5, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 7093
    .local v5, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v6, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v6

    if-eqz v6, :cond_58

    .line 7094
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v7

    invoke-virtual {v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v1

    .line 7095
    iget-object v6, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v6, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->startUid(I)I

    move-result v6

    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7, v1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->stopUid(I)I

    move-result v7

    invoke-direct {p0, v2, v6, v7}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->unsetDnsSystemProperty(Ljava/lang/String;II)V

    goto :goto_5f

    .line 7097
    :cond_58
    invoke-virtual {v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v0

    .line 7098
    invoke-direct {p0, v2, v0, v0}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->unsetDnsSystemProperty(Ljava/lang/String;II)V

    .line 7100
    .end local v5    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :goto_5f
    goto :goto_2a

    .line 7101
    :cond_60
    return-void
.end method

.method protected updateBlockingRules(Ljava/lang/String;)V
    .registers 11
    .param p1, "profileName"    # Ljava/lang/String;

    .line 7173
    const/4 v0, -0x1

    .local v0, "uid":I
    const/4 v1, -0x1

    .line 7174
    .local v1, "cid":I
    new-instance v2, Ljava/util/ArrayList;

    invoke-direct {v2}, Ljava/util/ArrayList;-><init>()V

    .line 7175
    .local v2, "uidList":Ljava/util/List;, "Ljava/util/List<Ljava/lang/Integer;>;"
    iget-object v3, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->vpnConfig:Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;

    invoke-virtual {v3, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileConfig;->getProfileEntry(Ljava/lang/String;)Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;

    move-result-object v3

    .line 7176
    .local v3, "profileEntry":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;
    if-nez v3, :cond_10

    .line 7177
    return-void

    .line 7179
    :cond_10
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getInterfaceName()Ljava/lang/String;

    move-result-object v4

    .line 7180
    .local v4, "iface":Ljava/lang/String;
    invoke-virtual {v3}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->getPackageList()Ljava/util/Collection;

    move-result-object v5

    invoke-interface {v5}, Ljava/util/Collection;->iterator()Ljava/util/Iterator;

    move-result-object v5

    :goto_1c
    invoke-interface {v5}, Ljava/util/Iterator;->hasNext()Z

    move-result v6

    if-eqz v6, :cond_50

    invoke-interface {v5}, Ljava/util/Iterator;->next()Ljava/lang/Object;

    move-result-object v6

    check-cast v6, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;

    .line 7181
    .local v6, "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v7, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->isPackageForAddAllPackages(Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;)Z

    move-result v7

    if-eqz v7, :cond_44

    .line 7182
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mKnoxVpnHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;

    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getPackageName()Ljava/lang/String;

    move-result-object v8

    invoke-virtual {v7, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnHelper;->getContainerIdFromPackageName(Ljava/lang/String;)I

    move-result v1

    .line 7183
    iget-object v7, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v8

    invoke-virtual {v7, v1, v4, v8}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeMiscRulesRange(ILjava/lang/String;I)V

    goto :goto_4f

    .line 7185
    :cond_44
    invoke-virtual {v6}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;->getUid()I

    move-result v0

    .line 7186
    invoke-static {v0}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v7

    invoke-interface {v2, v7}, Ljava/util/List;->add(Ljava/lang/Object;)Z

    .line 7188
    .end local v6    # "packageInfo":Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnPackageInfo;
    :goto_4f
    goto :goto_1c

    .line 7189
    :cond_50
    invoke-interface {v2}, Ljava/util/List;->isEmpty()Z

    move-result v5

    if-nez v5, :cond_5f

    .line 7190
    iget-object v5, p0, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->mFirewallHelper:Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;

    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->getVirtualInterfaceType(Ljava/lang/String;)I

    move-result v6

    invoke-virtual {v5, v2, v4, v6}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnFirewallHelper;->removeMiscRules(Ljava/util/List;Ljava/lang/String;I)V

    .line 7192
    :cond_5f
    const/4 v5, 0x0

    invoke-virtual {v3, v5}, Lcom/android/server/enterprise/vpn/knoxvpn/profile/VpnProfileInfo;->setInterfaceName(Ljava/lang/String;)V

    .line 7193
    invoke-direct {p0, p1}, Lcom/android/server/enterprise/vpn/knoxvpn/KnoxVpnEngineService;->addMiscRulesForProfile(Ljava/lang/String;)V

    .line 7194
    return-void
.end method
